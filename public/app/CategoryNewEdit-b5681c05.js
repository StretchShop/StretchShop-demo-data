import{E as N,S as F}from"./Sidebar-1b644fbe.js";import{r as h,c as d,b as r,w as g,a as t,F as I,d as E,h as p,j as U,i as M,f as m,G as _,L as f,o as u,t as w,Y as V,Z as B}from"./sett-4d48a041.js";import{_ as G}from"./index-278cccc9.js";import"./edit-e2caae93.js";const j={name:"CategoryNewEdit",data(){return{sidebar:!1,categories:[],filteredProductsCount:null,products:[],categoryMainImageFile:null,breadcrumbs:[],categoryDetail:null,language:{code:"en",longCode:"en-US",name:"English"},newLanguage:null,editing:!1,userEditAllowed:!1,groupsLastRefresh:0,filteredCategoriesSlugs:[],fireCounter:0,dataToGenerateFromName:{slug:!0,externalId:!0},categoryTypes:["products","pages"]}},created:function(){this.language=this.$store.state.language},computed:{user(){return this.$store.getters.getUserProfile},editorToolsConfig(){let s=this;return{image:{config:{uploader:{uploadByFile(a){return s.$helpers.uploadFileGlobal("image","categories","categories/upload/"+s.categoryDetail.pathSlug+"/editor",a,s.$httpc,s.$store)},uploadByUrl(a){}}}},attaches:{config:{uploader:{uploadByFile(a){return s.$helpers.uploadFileGlobal("file","categories","categories/upload/"+s.categoryDetail.pathSlug+"/editor",a,s.$httpc,s.$store)}}}}}}},beforeRouteLeave(s,a,i){this.eventBus.emit("removeEditor"),i()},components:{editorwrapper:N,sidebar:F},watch:{user(s,a){s&&s!==null&&(this.getUserEditAllowed(),this.userEditAllowed&&this.getCategoryDetail())}},mounted:function(){this.getUserEditAllowed(),this.userEditAllowed&&this.getCategoryDetail()},methods:{getUserEditAllowed(){if(this.language=this.$store.state.language,this.user&&this.user!==null&&this.user.type&&this.user.type==="admin"){this.userEditAllowed=!0,this.user.settings.language&&(this.language=this.$store.state.language);return}this.userEditAllowed=!1},changeEditedLang(){this.fireCounter++,this.editing&&this.newLanguage&&this.newLanguage.code&&this.fireCounter===1&&(window.location=window.location.origin+this.$route.path+"?lang="+this.newLanguage.code)},processCategoryResponse(s){const a=new Date;this.groupsLastRefresh=a.getTime(),s.data&&(this.categoryDetail=s.data,s.data.parentCategories&&(this.breadcrumbs=s.data.parentCategories),this.editing=!0,this.newLanguage=this.language),s.data.categories&&(this.categories=s.data.categories)},getCategoryDetail:function(){const s=this;this.$route.params&&this.$route.params.category&&this.$route.params.category.toString().trim()!==""&&(this.$route.params.category.toString().trim()==="---new"?setTimeout(function(){s.categoryDetail=s.getEmptyCategory(),s.eventBus.emit("runEditor"),s.editing=!0},1e3):this.$httpc.get("category/"+this.$route.params.category,{timeout:7e3}).then(function(a){s.processCategoryResponse(a)}).catch(function(a){console.error(a)}).then(function(){s.eventBus.emit("runEditor")}))},getFilteredCategories:function(s){const a=this;return s&&s.toString().trim()!==""?this.$httpc.post("categories/find",{query:{pathSlug:{$regex:s},type:a.categoryDetail&&a.categoryDetail.type?a.categoryDetail.type:"products"}}).then(function(i){return i.data&&i.data.categories?i.data.categories:[]}).then(function(i){const c=[];for(let e=0;e<i.length;e++)a.categoryDetail.parentPath.indexOf(i[e].pathSlug)<0&&c.push(i[e].pathSlug);return a.filteredCategoriesSlugs=c,c}).catch(function(i){console.error("CategoryNewEdit getFilteredCategories() error:",i)}):(a.filteredCategoriesSlugs=[],[])},getCategoryBackground(){var s,a;return this.categoryDetail&&this.categoryDetail.slug&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getImagePath("categories",this.$store.state.coredata,this.categoryDetail.slug,this.categoryDetail.slug+".jpg")+"?"+new Date((a=(s=this.categoryDetail)==null?void 0:s.dates)==null?void 0:a.dateUpdated).getTime():""},categoryMainImageUpload(s){if(this.categoryMainImageFile=s.target.files,this.categoryMainImageFile){const i=this,c=new FormData;if(this.categoryMainImageFile.length&&this.categoryMainImageFile.length>0)for(var a=0;a<this.categoryMainImageFile.length;a++){const e=this.categoryMainImageFile[a];c.append("files["+a+"]",e)}else c.append("files[0]",this.categoryMainImageFile);this.$httpc.post("/categories/upload/"+this.categoryDetail.slug,c,{needsAuth:!0}).then(function(e){if(e&&e.data&&e.data.substr(0,1)==="'"&&e.data[e.data.length-1]==="'"){const l=e.data.length-2;if(e.data=e.data.substr(1,l),e.data=JSON.parse(e.data),console.log("categories/upload response.data: ",e.data,e.data.files,e.data.files.length>0,e.data.files[0].path,e.data.files[0].path.trim()!==""),e.data.files&&e.data.files.length>0&&e.data.files[0].path&&e.data.files[0].path.trim()!==""){const y=i.$el.querySelector(".category-list .category-header");if(y){const v=new Date;y.setAttribute("style","background-image: url('"+i.$store.state.coredata.settings.assets.url+"/categories/"+e.data.files[0].path+"?"+v.getTime()+"')")}}}})}},categoryMainImageDelete(){const s=this;if(confirm("Are you sure?")){const a={timeout:15e3,needsAuth:!0},i=this.getCategoryBackground(this.categoryDetail.slug);let c="";if(i.trim()!==""){const e=i.split("/");e.length>0&&(c=e[e.length-1])}console.debug(this.categoryDetail.slug,i),this.$httpc.delete("user/image/categories/"+this.categoryDetail.slug+"/"+c,a).then(function(e){e&&e.data&&e.data.success&&s.$el.querySelector(".category-list .category-header").setAttribute("style","")})}},save(s){const a=this,i=this.categoryDetail;i&&i._id&&!i.id&&(i.id=i._id),i.parentPath&&i.parentPath.length>0&&(i.parentPathSlug=i.parentPath[i.parentPath.length-1]),i.parentCategories&&delete i.parentCategories,i.subs&&delete i.subs,i.subsSlugs&&delete i.subsSlugs,i.count&&delete i.count,i.minMaxPrice&&delete i.minMaxPrice,i.descriptionLong[this.language.code]=s;const c={categories:[]};c.categories.push(i),this.$httpc.put("categories",c,{needsAuth:!0}).then(function(e){if(e.data&&e.data.length>0){const l=e.data[0],y=a.$router.resolve({name:"categoryNewEdit",params:{category:l.pathSlug}});window.location=y.href}}).catch(function(e){console.error("save error:",e)})},deleteCategory(){const a={categories:[{id:this.categoryDetail._id}]};this.categoryDetail&&this.categoryDetail._id&&confirm("Are you sure you want to delete this product?")&&this.$httpc.delete("categories",{data:a}).then(i=>{i&&i.data&&alert("Category has been successfully removed. You will be redirected now")})},getEmptyCategory(){const s=this;return{externalId:null,publisher:s.$store.state.user.profile.email,slug:null,pathSlug:null,parentPath:[],parentPathSlug:null,type:"products",subtype:"physical",name:s.$helpers.getLangsObject(s.$store.state.coredata.langCodes),descriptionShort:s.$helpers.getLangsObject(s.$store.state.coredata.langCodes),descriptionLong:s.$helpers.getLangsObject(s.$store.state.coredata.langCodes),categories:[],dates:{dateCreated:null,dateUpdated:null,dateSynced:null},data:{},note:null}},checkNameDependents(){if(this.categoryDetail&&!this.categoryDetail._id){let s=this.language&&this.language.code?this.language.code:null;this.newLanguage&&this.newLanguage.code&&(s=this.newLanguage.code),this.categoryDetail.name&&this.categoryDetail.name[s]&&this.categoryDetail.name[s].trim()!==""&&((this.categoryDetail.slug&&this.categoryDetail.slug.trim()===""||this.dataToGenerateFromName.slug)&&(this.categoryDetail.slug=this.$helpers.stringToSlug(this.categoryDetail.name[s]),this.dataToGenerateFromName.slug=!0),(this.categoryDetail.externalId&&this.categoryDetail.externalId.trim()===""||this.dataToGenerateFromName.externalId)&&(this.categoryDetail.externalId=this.$helpers.stringToSlug(this.categoryDetail.name[s]),this.dataToGenerateFromName.externalId=!0))}},getActivity(){const s={start:null,end:null};return this.categoryDetail&&this.categoryDetail!==null&&this.categoryDetail.activity&&this.categoryDetail.activity!==null&&(this.categoryDetail.activity.start&&this.categoryDetail.activity.start.toString().trim()!==""&&(s.start=new Date(this.categoryDetail.activity.start)),this.categoryDetail.activity.end&&this.categoryDetail.activity.end.toString().trim()!==""&&(s.end=new Date(this.categoryDetail.activity.end))),s},setActivity(s,a){a&&this.categoryDetail&&this.categoryDetail!==null&&(this.categoryDetail.activity||(this.categoryDetail.activity={start:null,end:null}),this.categoryDetail.activity[s]=a)},toggleSidebar(){this.sidebar=!this.sidebar}}},n=s=>(V("data-v-a8290e43"),s=s(),B(),s),H={key:0,class:"container category-list",id:"category-new-edit"},O={class:"category-categories-parent"},R={class:"title is-3","aria-controls":"contentCategoriesParent"},q=n(()=>t("span",{translate:"yes"},"Parent Categories",-1)),W={class:"categoriesParent-hidden collapse-content",id:"contentCategoriesParent","aria-expanded":"true"},Y={class:"container is-fluid p-3"},z={class:"columns"},J={class:"column"},K={class:"category-hidden-properties"},Z={class:"title is-3","aria-controls":"contentHiddenProperties",translate:"yes"},Q=n(()=>t("span",{translate:"yes"},"Category's hidden properties",-1)),X={class:"editableByAuthor-hidden collapse-content",id:"contentHiddenProperties","aria-expanded":"true"},$={class:"container is-fluid p-3"},tt={class:"columns"},et={class:"column"},at={class:"field"},st=n(()=>t("label",{class:"label floating",translate:"yes"},"Type",-1)),it={class:"control"},ot={class:"columns"},lt={class:"column"},nt={class:"field"},rt=n(()=>t("label",{class:"label floating",translate:"yes"},"Subtype",-1)),ct={class:"control"},dt={class:"columns"},gt={class:"column"},ut={class:"field"},ht=n(()=>t("label",{class:"label floating",translate:"yes"},"External Id",-1)),yt={class:"control"},pt={class:"columns"},mt={class:"column"},_t={class:"field"},ft=n(()=>t("label",{class:"label floating",translate:"yes"},"Slug",-1)),vt={class:"control"},Dt={class:"columns"},bt={class:"column"},Ct={class:"field"},wt=n(()=>t("label",{class:"label floating",translate:"yes"},"Note",-1)),St={class:"control"},xt={key:0,class:"columns"},Pt={class:"column"},It={class:"field"},Et=n(()=>t("label",{class:"label floating",translate:"yes"},"Activity Start",-1)),kt={class:"control"},At={class:"columns"},Tt={class:"column"},Lt={class:"field"},Nt=n(()=>t("label",{class:"label floating",translate:"yes"},"Activity End",-1)),Ft={class:"control"},Ut={key:0},Mt={class:"title is-3","aria-controls":"contentHiddenPropertiesAdmin",translate:"yes"},Vt=n(()=>t("span",{translate:"yes"},"Editable by admin user",-1)),Bt={class:"editableByAuthor-hidden collapse-content",id:"contentHiddenPropertiesAdmin","aria-expanded":"true"},Gt={class:"container is-fluid p-3"},jt={class:"columns"},Ht={class:"column"},Ot={class:"field"},Rt=n(()=>t("label",{class:"label floating",translate:"yes"},"Publisher",-1)),qt={class:"control"},Wt={class:"columns"},Yt={class:"column is-3 pr-6 has-text-left",id:"category-edit-navigation"},zt={key:0,class:"mt-6"},Jt={class:"menu"},Kt=n(()=>t("p",{class:"menu-label",translate:"yes"}," Sub-Categories ",-1)),Zt={class:"menu-list"},Qt={class:"column is-9"},Xt={key:0,class:"breadcrumb","aria-label":"breadcrumbs"},$t={class:"is-active"},te={class:"column"},ee={class:"category-image-wrapper"},ae={class:"category-image-actions"},se={class:"file is-primary action action-inline edit"},ie={class:"file-label"},oe=n(()=>t("span",{class:"file-cta"},[t("span",{class:"file-icon"},[t("i",{class:"fa fa-file-upload"})]),t("span",{class:"file-label",translate:"yes"}," Click to upload ")],-1)),le=n(()=>t("i",{class:"fa fa-trash"},null,-1)),ne=n(()=>t("span",{translate:"yes"},"Click to remove",-1)),re={class:"columns"},ce={class:"column data-main"},de={class:"field"},ge=n(()=>t("label",{class:"label floating",translate:"yes"},"Name",-1)),ue={class:"control"},he={class:"field"},ye=n(()=>t("label",{class:"label floating",translate:"yes"},"Description Short",-1)),pe={class:"control"},me={class:"columns"},_e={key:0,class:"column"},fe={key:0,class:"columns category-delete"},ve={class:"column is-12"},De=n(()=>t("p",{translate:"yes"},"Warning: This action cannot be undone! This action does not remove category's content!",-1));function be(s,a,i,c,e,l){var x,P;const y=h("font-awesome-icon"),v=h("o-inputitems"),k=h("o-field"),D=h("o-collapse"),A=h("o-autocomplete"),S=h("o-datetimepicker"),T=h("sidebar"),b=h("router-link"),L=h("editorwrapper");return e.categoryDetail?(u(),d("div",H,[r(T,{fullheight:!0,overlay:!1,right:!0,open:e.sidebar,canCancel:!1},{default:g(()=>[t("div",O,[r(D,{open:!0,"aria-id":"contentCategoriesParent"},{trigger:g(o=>[t("h3",R,[q,m(),r(y,{icon:o.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:g(()=>[t("div",W,[t("div",Y,[t("div",z,[t("div",J,[t("section",null,[r(k,{label:"Enter parent categories' url slugs"},{default:g(()=>[r(v,{modelValue:e.categoryDetail.parentPath,"onUpdate:modelValue":a[0]||(a[0]=o=>e.categoryDetail.parentPath=o),data:e.filteredCategoriesSlugs,autocomplete:"","allow-new":!1,field:"user.first_name",iconPack:"fas",icon:"tags",placeholder:"Parent Categories",type:"is-info",onTyping:l.getFilteredCategories},null,8,["modelValue","data","onTyping"])]),_:1})])])])])])]),_:1})]),t("div",K,[r(D,{open:!0,"aria-id":"contentHiddenProperties"},{trigger:g(o=>[t("h3",Z,[Q,m(),r(y,{icon:o.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:g(()=>[t("div",X,[t("div",$,[t("div",tt,[t("div",et,[t("div",at,[st,t("div",it,[r(A,{modelValue:e.categoryDetail.type,"onUpdate:modelValue":a[1]||(a[1]=o=>e.categoryDetail.type=o),placeholder:"e.g. products","keep-first":!0,"open-on-focus":!0,data:e.categoryTypes,field:"categoryDetail.type",clearable:!1},null,8,["modelValue","data"])])])])]),t("div",ot,[t("div",lt,[t("div",nt,[rt,t("div",ct,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":a[2]||(a[2]=o=>e.categoryDetail.subtype=o),translate:"yes",placeholder:"Subtype"},null,512),[[f,e.categoryDetail.subtype]])])])])]),t("div",dt,[t("div",gt,[t("div",ut,[ht,t("div",yt,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":a[3]||(a[3]=o=>e.categoryDetail.externalId=o),translate:"yes",placeholder:"External Id"},null,512),[[f,e.categoryDetail.externalId]])])])])]),t("div",pt,[t("div",mt,[t("div",_t,[ft,t("div",vt,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":a[4]||(a[4]=o=>e.categoryDetail.slug=o),translate:"yes",placeholder:"Slug"},null,512),[[f,e.categoryDetail.slug]])])])])]),t("div",Dt,[t("div",bt,[t("div",Ct,[wt,t("div",St,[_(t("textarea",{class:"textarea","onUpdate:modelValue":a[5]||(a[5]=o=>e.categoryDetail.note=o),translate:"yes",placeholder:"Note"},null,512),[[f,e.categoryDetail.note]])])])])]),e.categoryDetail?(u(),d("div",xt,[t("div",Pt,[t("div",It,[Et,t("div",kt,[r(S,{value:l.getActivity().start,onInput:a[6]||(a[6]=o=>l.setActivity("start",o)),placeholder:"Activity Start DateTime",iconPack:"fa",icon:"calendar-alt",iconPrev:"angle-left",iconNext:"angle-right",position:"bottom-left","trap-focus":""},null,8,["value"])])])])])):p("v-if",!0),t("div",At,[t("div",Tt,[t("div",Lt,[Nt,t("div",Ft,[r(S,{value:l.getActivity().end,onInput:a[7]||(a[7]=o=>l.setActivity("end",o)),placeholder:"Activity End DateTime",iconPack:"fa",icon:"calendar-alt",iconPrev:"angle-left",iconNext:"angle-right",position:"bottom-left","trap-focus":""},null,8,["value"])])])])])])])]),_:1}),p(" author-hidden-properties "),l.user&&l.user!=null&&l.user.type&&l.user.type=="admin"?(u(),d("div",Ut,[r(D,{open:!0,"aria-id":"contentHiddenPropertiesAdmin"},{trigger:g(o=>[t("h3",Mt,[Vt,m(),r(y,{icon:o.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:g(()=>[t("div",Bt,[t("div",Gt,[t("div",jt,[t("div",Ht,[t("div",Ot,[Rt,t("div",qt,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":a[8]||(a[8]=o=>e.categoryDetail.publisher=o),translate:"yes",placeholder:"Publisher"},null,512),[[f,e.categoryDetail.publisher]])])])])])])])]),_:1})])):p("v-if",!0)])]),_:1},8,["open"]),t("div",Wt,[t("div",Yt,[e.categoryDetail&&e.categoryDetail.subs?(u(),d("nav",zt,[t("aside",Jt,[Kt,t("ul",Zt,[(u(!0),d(I,null,E(this.categoryDetail.subs,(o,C)=>(u(),d("li",{key:C},[r(b,{class:"panel-block",title:o.descriptionShort[e.language.code],to:{name:"categoryList",params:{category:o.pathSlug}}},{default:g(()=>[m(w(o.name[e.language.code]),1)]),_:2},1032,["title","to"])]))),128))])])])):p("v-if",!0)]),t("div",Qt,[e.breadcrumbs&&e.breadcrumbs!=null&&e.breadcrumbs.length>0?(u(),d("nav",Xt,[t("ul",null,[(u(!0),d(I,null,E(e.breadcrumbs,(o,C)=>(u(),d("li",{key:C},[r(b,{title:o.name[e.language.code],to:{name:"categoryList",params:{category:o.pathSlug}}},{default:g(()=>[m(w(o.name[e.language.code]),1)]),_:2},1032,["title","to"])]))),128)),t("li",$t,[r(b,{title:e.categoryDetail.name[e.language.code],to:{name:"categoryList",params:{category:e.categoryDetail.pathSlug}},"aria-current":"page"},{default:g(()=>[m(w(e.categoryDetail.name[e.language.code]),1)]),_:1},8,["title","to"])])])])):p("v-if",!0),t("div",{class:"columns category-header",style:U({backgroundImage:"url("+l.getCategoryBackground()+")"})},[t("div",te,[t("div",ee,[t("div",ae,[t("div",se,[t("label",ie,[t("input",{class:"file-input",type:"file",name:"resume",onInput:a[9]||(a[9]=o=>l.categoryMainImageUpload(o))},null,32),oe])]),t("a",{class:"action action-inline remove button is-danger is-outlined",onClick:a[10]||(a[10]=M(o=>l.categoryMainImageDelete(),["prevent"]))},[le,m("Â  "),ne])])]),t("div",re,[t("div",ce,[t("div",de,[ge,t("div",ue,[_(t("input",{class:"input cat-edit-h1",type:"text","onUpdate:modelValue":a[11]||(a[11]=o=>e.categoryDetail.name[e.language.code]=o),onKeyup:a[12]||(a[12]=o=>l.checkNameDependents()),translate:"yes",placeholder:"Name"},null,544),[[f,e.categoryDetail.name[e.language.code]]])])]),t("div",he,[ye,t("div",pe,[_(t("input",{class:"input is-6 mb-5 has-text-grey-dark",type:"text","onUpdate:modelValue":a[13]||(a[13]=o=>e.categoryDetail.descriptionShort[e.language.code]=o),translate:"yes",placeholder:"Description Short"},null,512),[[f,e.categoryDetail.descriptionShort[e.language.code]]])])])])]),t("div",me,[this.editorToolsConfig&&((x=e.language)!=null&&x.code)&&((P=e.categoryDetail)!=null&&P.descriptionLong)?(u(),d("div",_e,[r(L,{type:"editorjs",editordata:{editorjs:{setup:l.editorToolsConfig,data:e.categoryDetail.descriptionLong[e.language.code]}}},null,8,["editordata"])])):p("v-if",!0)])])],4)])]),this.categoryDetail&&this.categoryDetail!=null?(u(),d("div",fe,[t("div",ve,[t("section",null,[t("button",{class:"button is-danger",onClick:a[14]||(a[14]=o=>l.deleteCategory()),translate:"yes"},"DELETE This Category"),De])])])):p("v-if",!0)])):p("v-if",!0)}const Pe=G(j,[["render",be],["__scopeId","data-v-a8290e43"],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryNewEdit.vue"]]);export{Pe as default};
