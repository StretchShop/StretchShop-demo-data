import{C as K}from"./content-tools.min.36c196aa.js";import{_ as N,r as b,o as d,c,a as t,m as k,f as y,b as _,h as T,F as P,i as w,t as L,j as m,e as g,v as f,w as C,g as v,S as j,P as H,p as q,k as G}from"./index.f358bf2e.js";const B={props:["modal"],name:"ProductNewEditProperty",data(){return{propertyKey:null,propertyName:null,propertyValue:null,propertyLang:null}},mounted:function(){},methods:{setProperty(){console.log(this.$parent.setProperty(this.propertyKey,this.propertyValue,this.propertyLang,this.propertyName))}}},z={key:0,class:"modal is-active"},J=t("div",{class:"modal-background"},null,-1),W={class:"animation-content"},Y={action:""},Q={class:"modal-card",style:{width:"auto"}},X=t("header",{class:"modal-card-head"},[t("p",{class:"modal-card-title",translate:"yes"},"New Product Property")],-1),Z={class:"modal-card-body"},$={class:"control select"},tt=t("option",{disabled:"disabled",value:"",translate:"yes"},"Select language",-1),et=t("option",{value:""},[v("-- "),t("span",{translate:"yes"},"None"),v(" --")],-1),st=["value"],ot={class:"modal-card-foot"};function rt(o,e,r,n,s,l){const h=b("o-field");return r.modal?(d(),c("div",z,[J,t("div",W,[t("form",Y,[t("div",Q,[X,t("section",Z,[o.$store.state.coredata&&o.$store.state.coredata.langs?(d(),k(h,{key:0,label:"Language"},{default:y(()=>[t("div",$,[_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=p=>s.propertyLang=p)},[tt,et,(d(!0),c(P,null,w(o.$store.state.coredata.langs,p=>(d(),c("option",{value:p.code,key:p.code},L(p.name),9,st))),128))],512),[[T,s.propertyLang]])])]),_:1})):m("",!0),g(h,{label:"Property key"},{default:y(()=>[_(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=p=>s.propertyKey=p),placeholder:"Property key",required:""},null,512),[[f,s.propertyKey]])]),_:1}),s.propertyLang?(d(),k(h,{key:1,label:"Property Name"},{default:y(()=>[_(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=p=>s.propertyName=p),placeholder:"Property Name"},null,512),[[f,s.propertyName]])]),_:1})):m("",!0),g(h,{label:"Property value"},{default:y(()=>[_(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=p=>s.propertyValue=p),placeholder:"Property value",required:""},null,512),[[f,s.propertyValue]])]),_:1})]),t("footer",ot,[t("button",{class:"button",type:"button",onClick:e[4]||(e[4]=p=>o.$parent.modal=!1),translate:"yes"},"Close"),t("button",{class:"button is-primary",onClick:e[5]||(e[5]=C(p=>l.setProperty(),["prevent"])),translate:"yes"},"Add Property")])])])])])):m("",!0)}var it=N(B,[["render",rt],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/ProductNewEditProperty.vue"]]);const lt={name:"ProductNewEdit",data(){return{product:null,productMainImageFile:null,productPropertyLangSwitches:{},parentCategoryDetail:null,language:{code:"en",longCode:"en-US",name:"English"},newLanguage:null,variationModel:null,editor:null,editing:!1,userEditAllowed:!1,filteredCategoriesSlugs:[],filteredProductCodes:[],renderComponent:!0,modal:null,fireCounter:0,showPriceLevels:!1,dataToGenerateFromName:{slug:!0,externalId:!0},productTypes:["product","subscription"]}},components:{"slider-carousel":j,"product-box":H,"product-property":it},created:function(){this.language=this.$store.state.language},computed:{user(){return this.$store.getters.getUserProfile}},beforeRouteLeave(o,e,r){this.editor&&this.editor.destroy(),r()},watch:{user(o,e){console.log("new & old",o,e),o&&o!==null&&(this.getUserEditAllowed(),this.userEditAllowed&&this.getProductDetail())}},mounted:function(){this.getUserEditAllowed(),console.log("mounted this.userEditAllowed",this.userEditAllowed),this.userEditAllowed&&this.getProductDetail()},methods:{getUserEditAllowed(){if(this.language=this.$store.state.language,this.user&&this.user!==null&&this.user.type&&this.user.type==="admin"){this.userEditAllowed=!0,this.user.settings.language&&(this.language=this.$store.state.language);return}this.userEditAllowed=!1},getProductDetail:function(){const o=this;this.$route.params&&this.$route.params.category&&this.$route.params.category.toString().trim()!==""&&this.$route.params.product&&this.$route.params.product.toString().trim()!==""&&(this.$route.params.product.toString().trim()==="---new"&&this.$route.params.slug.toString().trim()==="---new"?setTimeout(function(){o.product=o.getEmptyProduct(),o.runEditor()},1e3):this.$httpc.get("products/"+this.$route.params.category+"/detail/"+this.$route.params.product+"?edit=true").then(function(e){if(e.data){if(o.product=e.data,o.product.name&&o.$store.state&&typeof o.product.name[o.language.code]!="undefined"&&(document.title=o.product.name[o.language.code]+" - StretchShop"),o.product&&o.product.categories&&(o.filteredCategoriesSlugs=o.product.categories),o.product&&o.product.properties){const r=Object.keys(o.product.properties);if(r&&r.length>0)for(let n=0;n<r.length;n++){const s=r[n];o.productPropertyLangSwitches[s]={name:o.checkIfPropertyHasLang(o.product.properties[s],"name"),value:o.checkIfPropertyHasLang(o.product.properties[s],"value")}}}o.runEditor()}e.data.products&&(o.products=e.data.products),e.data.parentCategoryDetail&&(o.parentCategoryDetail=e.data.parentCategoryDetail)}).catch(function(e){console.log(e)}).then(function(){}))},getProductImagePath(o){if(o&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url){const e=new Date;return this.$helpers.getProductImagePath(this.$store.state.coredata,o)+"?"+e.getTime()}return null},getProductGalleryImagePath(o,e){return o&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getProductImagePath(this.$store.state.coredata,o,e):null},newPropertyCardModal(){this.modal=!0},checkIfPropertyHasLang(o,e){if(o&&o[e]&&this.$store&&this.$store.state&&this.$store.state.coredata&&this.$store.state.coredata.langCodes){const n=Object.keys(o[e]).filter(s=>this.$store.state.coredata.langCodes.includes(s));if(n&&n.length>0)return!0}return!1},changePropertyLangOption(o,e,r){console.log("value query:",".product-properties .table data-key["+e+"] .field.property-"+r+" input[text]");const n=this.$el.querySelector('.product-properties .table [data-key="'+e+'"] .field.property-'+r+" input[type=text]").value,s=this.productPropertyLangSwitches[e];let l="remove";s[r]===!1&&(l="add");const h=this.product.properties[e];if(console.log("changePropertyLangOption params and value:",o,e,r,n,l),r&&r==="name"){if(l==="remove")s.name===!0&&s.value===!0?(delete h.name,delete this.product.properties[e],this.product.properties[n]=h):s.name===!0&&s.value===!1&&(delete this.product.properties[e],this.product.properties[n]=h.value);else if(l==="add"){this.product.properties[e].constructor!==Object&&(this.product.properties[e]={value:this.product.properties[e]}),this.product.properties[e][r]={};for(let p=0;p<this.$store.state.coredata.langCodes.length;p++)this.product.properties[e][r][this.$store.state.coredata.langCodes[p]]=null;this.product.properties[e][r][this.language.code]=n}}else if(r&&r==="value"){if(l==="remove")s.name===!0?this.product.properties[e].value=n:s.name===!1&&(this.product.properties[e]=n);else if(l==="add"){this.product.properties[e].constructor===Object?(delete h.value,this.product.properties[e]=h):(this.product.properties[e]={},this.product.properties[e][r]={});for(let p=0;p<this.$store.state.coredata.langCodes.length;p++)this.product.properties[e][r][this.$store.state.coredata.langCodes[p]]=null;h.value&&h.value.constructor===Array?this.product.properties[e][r][this.language.code]=h.value:h&&h.constructor===Array?this.product.properties[e][r][this.language.code]=h:this.product.properties[e][r][this.language.code]=n}}this.productPropertyLangSwitches[e]&&(console.log("this.productPropertyLangSwitches[key][type]:",this.productPropertyLangSwitches[e][r]),this.productPropertyLangSwitches[e][r]=!this.productPropertyLangSwitches[e][r])},changePropertyValue(o,e){const r=this.$el.querySelector('.product-properties .table [data-key="'+o+'"] .field.property-'+e+" input[type=text]").value,n=this.productPropertyLangSwitches[o];if(console.log("incoming type & nameLangOptions",e,n),e==="key")typeof this.product.properties[r]!="undefined"?this.$helpers.formUndecorateAndDecorateFields(["property-key"],[{name:"property-key",action:"exists"}]):this.renamePropertyKey(o,r);else if(n&&typeof n[e]!="undefined")if(e==="name")if(n[e]===!0)console.log("change for lang version of "+e+"."+this.language.code+":",r),this.product.properties[o][e][this.language.code]=r;else if(console.log("change for key:value version of "+e+":",r),typeof this.product.properties[r]!="undefined")this.$helpers.formUndecorateAndDecorateFields(["property-name"],[{name:"property-name",action:"exists"}]);else{const s=document.querySelector(".field.property-name");this.$helpers.undecorateFormField(s,"exists"),this.renamePropertyKey(o,r)}else e==="value"&&(n[e]===!0?(console.log("change for lang version of "+e+" - this.product.properties["+o+"]["+e+"]["+this.language.code+"]:",r),this.product.properties[o][e][this.language.code]=r):(console.log("change for key:value version of "+e+":",r),typeof this.product.properties[o].value!="undefined"?this.product.properties[o].value=r:this.product.properties[o]=r))},renamePropertyKey(o,e){const r=this.product.properties[o],n=this.productPropertyLangSwitches[o];delete this.product.properties[o],delete this.productPropertyLangSwitches[o],this.product.properties[e]=r,this.productPropertyLangSwitches[e]=n;const s=this.$el.querySelector('.product-properties .table [data-key="'+o+'"]');s&&s.setAttribute("data-key",e),this.$forceUpdate()},getPropertyStrings(o,e){if(o.constructor===Array)return{name:e,value:o.join(", ")};if(o.constructor===Object){if(typeof o.name!="undefined"&&typeof o.value!="undefined"&&this.$store&&this.$store.state&&this.$store.state.language){const r=this.getPropertyNameResult(o,e),n=this.getPropertyValueResult(o,e);if(r!==""&&n!=="")return{name:r,value:n}}else if(typeof o.value!="undefined"&&this.$store&&this.$store.state&&this.$store.state.language){const r=e,n=this.getPropertyValueResult(o);if(r!==""&&n!=="")return{name:r,value:n}}return{name:e,value:o}}else return{name:e,value:o}},getPropertyNameResult(o,e){return typeof o.name[this.$store.state.language.code]!="undefined"?o.name[this.$store.state.language.code]:e.name},getPropertyValueResult(o){return typeof o.value[this.$store.state.language.code]!="undefined"?o.value[this.$store.state.language.code].constructor===Array?o.value[this.$store.state.language.code].join(", "):o.value[this.$store.state.language.code]:o.value},getFilteredCategories:function(o){const e=this;return o&&o.toString().trim()!==""?this.$httpc.post("categories/find",{query:{pathSlug:{$regex:o},type:"products"}}).then(function(r){if(r.data)return r.data}).catch(function(r){console.log(r)}).then(function(r){const n=[];if(r&&r.categories)for(let s=0;s<r.categories.length;s++)e.product.categories.indexOf(r.categories[s].pathSlug)<0&&n.push(r.categories[s].pathSlug);return e.filteredCategoriesSlugs=n,n}):(e.filteredCategoriesSlugs=[],[])},getFilteredRelatedProducts:function(o){const e=this;return o&&o.toString().trim()!==""?this.$httpc.post("products/find",{query:{orderCode:{$regex:o}}}).then(function(r){if(r.data)return r.data}).catch(function(r){console.log(r)}).then(function(r){const n=[];for(let s=0;s<r.length;s++)e.product.data.related.products.indexOf(r[s].orderCode)<0&&n.push(r[s].orderCode);return e.filteredProductCodes=n,n}):(e.filteredProductCodes=[],[])},setProperty(o,e,r,n){if(console.log("add("+o+","+e+") in lang:"+r+" with Name:"+n),typeof o!="undefined"&&typeof e!="undefined"&&o&&e)if(this.product&&this.product.properties&&typeof this.product.properties[o]!="undefined"){const s=this.product.properties[o];typeof n!="undefined"&&n!==o&&(s.name={},typeof r!="undefined"?s.name[r]=n:s.name=n)}else{let s={};typeof n!="undefined"&&n&&(s.name={},typeof r!="undefined"&&r?s.name[r]=n:s.name=n),typeof r!="undefined"&&r?(s.value={},s.value[r]=e):typeof s.name!="undefined"?s.value=e:s=e,s&&(this.product.properties[o]=s)}this.modal=!1},removeProperty(o){console.log("remove("+o+")"),this.product&&this.product.properties&&typeof this.product.properties[o]!="undefined"&&(delete this.product.properties[o],this.$forceUpdate())},runEditor(){const o=this;this.$route.query.lang&&this.$store.dispatch("checkLanguage",this.$route.query.lang).then(r=>{console.log("language check result:",r),o.language&&o.language.code&&r&&r.code&&o.language.code!==r.code&&(o.language=r)}),setTimeout(function(){o.editor=K.EditorApp.get(),console.log("get editor"),o.editor.init("*[data-editable]","data-name"),console.log("init editor"),o.editor.start(),console.log("start editor"),o.editor.ignition().state("editing"),console.log("editor ignition state editing"),o.editing=!0,o.newLanguage=o.language,o.editor.addEventListener("saved",e=>{console.log("editor saved",e);const r=e.detail().regions;console.log("regions",r),o.editor.busy(!0),r&&typeof r.description!="undefined"&&(o.product.descriptionLong[o.language.code]=r.description,console.log("product descriptionLong:",o.product.descriptionLong[o.language.code])),o.saveProduct()})},1e3)},productMainImageDelete(){const o=this;if(confirm("Are you sure?")){const e={timeout:15e3,needsAuth:!0},r=this.getProductImagePath(this.product.orderCode);let n="";if(r.trim()!==""){const s=r.split("/");s.length>0&&(n=s[s.length-1])}console.log(this.product.orderCode,r),this.$httpc.delete("user/image/products/"+this.product.orderCode+"/"+n,e).then(function(s){s&&s.data&&s.data.success&&(console.log("image delete response",s.data),o.$el.querySelector(".product-image-wrapper img.image-main").setAttribute("src",o.getProductImagePath(o.product.orderCode)))})}},productMainImageUpload(o){const e=this;if(e.productMainImageFile=o.target.files,console.log("productMainImageFile:",e.productMainImageFile),e.productMainImageFile){console.log("incoming:",e.productMainImageFile,e.productMainImageFile.length);const s=new FormData;if(e.productMainImageFile.length&&typeof e.productMainImageFile.length!="undefined"&&e.productMainImageFile.length>0){for(var r=0;r<e.productMainImageFile.length;r++){const l=e.productMainImageFile[r];s.append("files["+r+"]",l)}console.log("incoming 2.1")}else s.append("files[0]",e.productMainImageFile),console.log("incoming 2.2");for(var n of s.entries())console.log(n[0]+", "+n[1]);e.$httpc.post("/products/upload/"+e.product.orderCode+"/main",s,{needsAuth:!0}).then(function(l){if(l&&l.data&&l.data.substr(0,1)==="'"&&l.data[l.data.length-1]==="'"){const h=l.data.length-2;if(l.data=l.data.substr(1,h),l.data=JSON.parse(l.data),l.data.files&&l.data.files.length>0&&l.data.files[0].path&&l.data.files[0].path.trim()!==""){const p=e.$el.querySelector(".product-image-wrapper img.image-main");if(p){const I=new Date;p.setAttribute("src",e.$store.state.coredata.settings.assets.url+"/products/"+l.data.files[0].path+"?"+I.getTime())}}}}).catch(l=>{console.error("product main image upload error:",l)})}},changeEditedLang(){this.fireCounter++,this.editing&&this.newLanguage&&this.newLanguage.code&&this.fireCounter===1&&(window.location=window.location.origin+this.$route.path+"?lang="+this.newLanguage.code)},saveProduct(){const o=this;if(this.product&&this.product._id&&!this.product.id&&(this.product.id=this.product._id),this.product.price&&this.product.stockAmount&&(this.product.price=parseFloat(this.product.price),this.product.stockAmount=parseFloat(this.product.stockAmount)),this.product.priceLevels){const r=Object.keys(this.product.priceLevels);r.length>0&&r.forEach(function(n){const s=Object.keys(o.product.priceLevels[n]);s.length>0&&s.forEach(function(l){o.product.priceLevels[n][l].price=parseFloat(o.product.priceLevels[n][l].price)})})}const e={products:[]};e.products.push(this.product),this.$httpc.put("products",e,{needsAuth:!0}).then(function(r){if(r.data&&r.data.length>0){const n=r.data[0],s=o.$router.resolve({name:"productNewEdit",params:{category:n.categories[0],slug:n.slug,product:n._id}});window.location=s.href}}).catch(function(r){console.log("saveProduct error:",r)})},deleteProduct(){const e={products:[{id:this.product._id}]};this.product&&this.product._id&&confirm("Are you sure you want to delete this product?")&&this.$httpc.delete("products",{data:e}).then(r=>{r&&r.data&&alert("Product has been successfully removed. You will be redirected now")})},getEmptyProduct(){const o=this;return{externalId:null,orderCode:null,variationGroupId:null,publisher:o.user.email,type:"product",subtype:null,name:o.$helpers.getLangsObject(o.$store.state.coredata.langCodes),descriptionShort:o.$helpers.getLangsObject(o.$store.state.coredata.langCodes),descriptionLong:o.$helpers.getLangsObject(o.$store.state.coredata.langCodes),price:0,tax:null,stockAmount:0,slug:null,properties:{},categories:[],dates:{dateCreated:null,dateUpdated:null,dateSynced:null},data:{related:{products:[],productResults:[]},gallery:{name:o.$helpers.getLangsObject(o.$store.state.coredata.langCodes),images:[]}},note:null,parentCategoryDetail:{},activity:{start:null,end:null}}},checkNameDependents(){if(this.product&&!this.product._id){let o=this.language&&this.language.code?this.language.code:null;this.newLanguage&&this.newLanguage.code&&(o=this.newLanguage.code),this.product.name&&this.product.name[o]&&this.product.name[o].trim()!==""&&((this.product.slug&&this.product.slug.trim()===""||this.dataToGenerateFromName.slug)&&(this.product.slug=this.$helpers.stringToSlug(this.product.name[o]),this.dataToGenerateFromName.slug=!0),(this.product.externalId&&this.product.externalId.trim()===""||this.dataToGenerateFromName.externalId)&&(this.product.externalId=this.$helpers.stringToSlug(this.product.name[o]),this.dataToGenerateFromName.externalId=!0))}},getActivity(){const o={start:null,end:null};return this.product&&this.product!==null&&this.product.activity&&this.product.activity!==null&&(this.product.activity.start&&this.product.activity.start.toString().trim()!==""&&(o.start=new Date(this.product.activity.start)),this.product.activity.end&&this.product.activity.end.toString().trim()!==""&&(o.end=new Date(this.product.activity.end))),o},setActivity(o,e){e&&this.product&&this.product!==null&&(this.product.activity||(this.product.activity={start:null,end:null}),this.product.activity[o]=e)},recalculatePriceLevels(o){const e=this;this.$httpc.get("products/rebuildpl/"+o).then(function(r){r&&r.data&&r.data!==null&&r.data.levels&&(e.product.priceLevels=r.data.levels)})},checkForSubscriptionData(){this.product&&this.product.type&&this.product.type==="subscription"&&(this.product.data||(this.product.data={}),this.product.data.subscription||(this.product.data.subscription={period:"month",duration:1,cycles:0}))}}},a=o=>(q("data-v-e7ba09b4"),o=o(),G(),o),nt={key:0,class:"container product-detail",id:"product-new-edit"},at={class:"field product-edit-language hidden"},dt=a(()=>t("label",{class:"label",translate:"yes"},"Edit Language",-1)),ct={class:"control select"},ut=["value"],pt={key:0,class:"product-hidden-properties"},ht={class:"title is-3","aria-controls":"contentHiddenProperties",translate:"yes"},gt=a(()=>t("span",{translate:"yes"},"Product's hidden properties",-1)),mt=v(),_t={class:"editableByAuthor-hidden collapse-content",id:"contentHiddenProperties","aria-expanded":"true"},ft={class:"columns"},yt={class:"column is-12"},vt={key:0,class:"columns"},bt={class:"column is-3"},Pt={class:"field"},wt=a(()=>t("label",{class:"label",translate:"yes"},"Type",-1)),Lt={class:"control"},Ct={class:"column is-3"},St={class:"field"},xt=a(()=>t("label",{class:"label",translate:"yes"},"Subtype",-1)),It={class:"control"},At={class:"column is-3"},kt={class:"field"},Et=a(()=>t("label",{class:"label",translate:"yes"},"External Id",-1)),Dt={class:"control"},Vt={class:"column is-3"},Ut={class:"field"},Ft=a(()=>t("label",{class:"label",translate:"yes"},"Variation Group Id",-1)),Nt={class:"control"},Tt={class:"columns"},Mt={class:"column is-12"},Ot={key:0,class:"columns"},Rt={class:"column is-3"},Kt={class:"field"},jt=a(()=>t("label",{class:"label",translate:"yes"},"Slug",-1)),Ht={class:"control"},qt={class:"column is-6"},Gt={class:"field"},Bt=a(()=>t("label",{class:"label",translate:"yes"},"Note",-1)),zt={class:"control"},Jt={class:"columns"},Wt={class:"column is-12"},Yt={key:0,class:"columns"},Qt={class:"column is-3"},Xt={class:"field"},Zt=a(()=>t("label",{class:"label",translate:"yes"},"Activity Start",-1)),$t={class:"control"},te={class:"column is-3"},ee={class:"field"},se=a(()=>t("label",{class:"label",translate:"yes"},"Activity End",-1)),oe={class:"control"},re={class:"column is-6"},ie={key:0,class:"columns"},le={class:"column is-4"},ne={class:"field"},ae=a(()=>t("label",{class:"label",translate:"yes"},"Subscription Period",-1)),de={class:"control"},ce={class:"column is-4"},ue={class:"field"},pe=a(()=>t("label",{class:"label",translate:"yes"},"Subscription Duration",-1)),he={class:"control"},ge={class:"column is-4"},me={class:"field"},_e=a(()=>t("label",{class:"label",translate:"yes"},"Subscription Cycles",-1)),fe={class:"control"},ye={key:0},ve={class:"title is-3","aria-controls":"contentHiddenProperties",translate:"yes"},be=a(()=>t("span",{translate:"yes"},"Editable by admin user",-1)),Pe=v(),we={class:"editableByAdmin-hidden"},Le={class:"columns"},Ce={class:"column is-4 is-offset-4"},Se={class:"field"},xe=a(()=>t("label",{class:"label",translate:"yes"},"Publisher",-1)),Ie={class:"control"},Ae={class:"columns reversed"},ke={class:"column is-7"},Ee={class:"product-image-wrapper"},De=["src","alt"],Ve={class:"file is-primary action edit"},Ue={class:"file-label"},Fe=a(()=>t("span",{class:"file-cta"},[t("span",{class:"file-icon"},[t("i",{class:"fa fa-file-upload"})]),t("span",{class:"file-label",translate:"yes"}," Click to upload ")],-1)),Ne=a(()=>t("i",{class:"fa fa-trash"},null,-1)),Te=v("\xA0 "),Me=a(()=>t("span",{translate:"yes"},"Click to remove",-1)),Oe=[Ne,Te,Me],Re={class:"column is-5 data-main"},Ke={key:0,class:"breadcrumb","aria-label":"breadcrumbs"},je={key:0},He={class:"is-active"},qe={key:1},Ge={class:"field"},Be=a(()=>t("label",{class:"label",translate:"yes"},"Name",-1)),ze={class:"control"},Je={class:"content"},We={class:"columns"},Ye=a(()=>t("div",{class:"column is-6 has-text-right"},[t("span",{translate:"yes"},"Order code")],-1)),Qe={class:"column is-6"},Xe={class:"field"},Ze=a(()=>t("label",{class:"label",translate:"yes"},"Order code",-1)),$e={class:"control"},ts=a(()=>t("p",{class:"help is-danger",translate:"yes"},"Changing OrderCode may disable images and other external dependecies",-1)),es={class:"columns"},ss=a(()=>t("div",{class:"column is-6 has-text-right"},[t("span",{translate:"yes"},"In stock")],-1)),os={class:"column is-6"},rs={class:"field"},is=a(()=>t("label",{class:"label",translate:"yes"},"In stock",-1)),ls={class:"control"},ns={class:"columns"},as={class:"column is-6"},ds={class:"field"},cs={class:"label"},us=a(()=>t("span",{translate:"yes"},"Price",-1)),ps={class:"control"},hs={class:"column is-6"},gs=["data-id"],ms=v(" \xA0 "),_s=a(()=>t("span",{translate:"yes"},"Add to Cart",-1)),fs={class:"columns"},ys={class:"column is-12"},vs={key:0},bs=a(()=>t("span",{id:"productPriceLevels"},"Edit Price Levels",-1)),Ps=[bs],ws={class:"column is-6"},Ls={class:"column is-6"},Cs=["onUpdate:modelValue","onKeyup"],Ss={key:1,class:"columns product-descriptions reversed-desktop"},xs={class:"column is-5"},Is={class:"field"},As=a(()=>t("label",{class:"label",translate:"yes"},"Description Short",-1)),ks={class:"control"},Es={key:0},Ds=a(()=>t("p",{class:"variations-title",translate:"yes"}," Variations ",-1)),Vs={class:"image is-32x32"},Us=["src","alt"],Fs={class:"column is-7"},Ns=["innerHTML"],Ts={key:2,class:"product-properties bg-grey"},Ms={class:"columns"},Os=a(()=>t("div",{class:"column is-6"},[t("h3",{class:"title is-3 has-text-left",translate:"yes"},"Properties")],-1)),Rs={class:"column is-6 has-text-right"},Ks=a(()=>t("i",{class:"fa fa-plus"},null,-1)),js=v("\xA0 "),Hs=a(()=>t("span",{translate:"yes"},"Add New Property",-1)),qs=[Ks,js,Hs],Gs={class:"columns"},Bs={class:"column is-12"},zs={class:"table"},Js=["data-key"],Ws={class:"field property-key"},Ys=a(()=>t("label",{class:"label",translate:"yes"},"Property Key",-1)),Qs={class:"control"},Xs=["disabled","data-orig","value","onKeyup"],Zs=a(()=>t("div",{class:"form-messages is-hidden"},[t("div",{class:"form-message","data-message":"exists",translate:"yes"},"This key already exists")],-1)),$s={class:"field property-name"},to=a(()=>t("label",{class:"label",translate:"yes"},"Property Name",-1)),eo={class:"control"},so=["data-orig","value","onKeyup"],oo=v("Lang"),ro=a(()=>t("div",{class:"form-messages is-hidden"},[t("div",{class:"form-message","data-message":"exists",translate:"yes"},"This key already exists")],-1)),io={class:"field property-value"},lo=a(()=>t("label",{class:"label",translate:"yes"},"Property Value",-1)),no={class:"control"},ao=["data-orig","value","onKeyup"],co=v("Lang"),uo={width:"50",class:"has-text-centered"},po=["onClick"],ho={key:3},go={key:4,class:"columns product-related"},mo={class:"column is-12"},_o=a(()=>t("h3",{class:"title is-3 has-text-left",translate:"yes"},"Related",-1)),fo={class:"tile is-ancestor"},yo={key:5,class:"columns product-delete"},vo={class:"column is-12"},bo=a(()=>t("p",{translate:"yes"},"Warning: This action cannot be undone!",-1));function Po(o,e,r,n,s,l){const h=b("font-awesome-icon"),p=b("o-autocomplete"),I=b("o-datepicker"),E=b("o-collapse"),D=b("o-inputitems"),V=b("o-field"),A=b("router-link"),U=b("o-switch"),M=b("slider-carousel"),O=b("product-box"),R=b("product-property");return s.product&&s.userEditAllowed?(d(),c("div",nt,[t("div",at,[dt,t("div",ct,[_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>s.newLanguage=i),onChange:e[1]||(e[1]=i=>l.changeEditedLang())},[(d(!0),c(P,null,w(o.$store.state.coredata.langs,(i,u)=>(d(),c("option",{key:u+"langs",value:i},L(i.name),9,ut))),128))],544),[[T,s.newLanguage]])])]),s.editing?(d(),c("div",pt,[g(E,{open:!1,"aria-id":"contentHiddenProperties"},{trigger:y(i=>[t("h3",ht,[gt,mt,g(h,{icon:(i.open,"angle-up")},null,8,["icon"])])]),default:y(()=>[t("div",_t,[t("div",ft,[t("div",yt,[s.editing?(d(),c("div",vt,[t("div",bt,[t("div",Pt,[wt,t("div",Lt,[g(p,{modelValue:s.product.type,"onUpdate:modelValue":e[2]||(e[2]=i=>s.product.type=i),placeholder:"e.g. product","keep-first":!0,"open-on-focus":!0,data:s.productTypes,onBlur:l.checkForSubscriptionData,field:"product.type",clearable:!1},null,8,["modelValue","data","onBlur"])])])]),t("div",Ct,[t("div",St,[xt,t("div",It,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":e[3]||(e[3]=i=>s.product.subtype=i),translate:"yes",placeholder:"Subtype"},null,512),[[f,s.product.subtype]])])])]),t("div",At,[t("div",kt,[Et,t("div",Dt,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":e[4]||(e[4]=i=>s.product.externalId=i),translate:"yes",placeholder:"External Id"},null,512),[[f,s.product.externalId]])])])]),t("div",Vt,[t("div",Ut,[Ft,t("div",Nt,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":e[5]||(e[5]=i=>s.product.variationGroupId=i),translate:"yes",placeholder:"Variation Group Id"},null,512),[[f,s.product.variationGroupId]])])])])])):m("",!0)])]),t("div",Tt,[t("div",Mt,[s.editing?(d(),c("div",Ot,[t("div",Rt,[t("div",Kt,[jt,t("div",Ht,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":e[6]||(e[6]=i=>s.product.slug=i),translate:"yes",placeholder:"Slug"},null,512),[[f,s.product.slug]])])])]),t("div",qt,[t("div",Gt,[Bt,t("div",zt,[_(t("textarea",{class:"textarea","onUpdate:modelValue":e[7]||(e[7]=i=>s.product.note=i),translate:"yes",placeholder:"Note"},null,512),[[f,s.product.note]])])])])])):m("",!0)])]),t("div",Jt,[t("div",Wt,[s.product?(d(),c("div",Yt,[t("div",Qt,[t("div",Xt,[Zt,t("div",$t,[g(I,{value:l.getActivity().start,onInput:e[8]||(e[8]=i=>l.setActivity("start",i)),placeholder:"Activity Start DateTime",icon:"calendar-alt","trap-focus":""},null,8,["value"])])])]),t("div",te,[t("div",ee,[se,t("div",oe,[g(I,{value:l.getActivity().end,onInput:e[9]||(e[9]=i=>l.setActivity("end",i)),placeholder:"Activity End DateTime",icon:"calendar-alt","trap-focus":""},null,8,["value"])])])]),t("div",re,[s.product.type==="subscription"&&s.product.data&&s.product.data.subscription?(d(),c("div",ie,[t("div",le,[t("div",ne,[ae,t("div",de,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":e[10]||(e[10]=i=>s.product.data.subscription.period=i),translate:"yes",placeholder:"Slug"},null,512),[[f,s.product.data.subscription.period]])])])]),t("div",ce,[t("div",ue,[pe,t("div",he,[_(t("input",{class:"input",type:"number","onUpdate:modelValue":e[11]||(e[11]=i=>s.product.data.subscription.duration=i),translate:"yes",placeholder:"Slug"},null,512),[[f,s.product.data.subscription.duration]])])])]),t("div",ge,[t("div",me,[_e,t("div",fe,[_(t("input",{class:"input",type:"number","onUpdate:modelValue":e[12]||(e[12]=i=>s.product.data.subscription.cycles=i),translate:"yes",placeholder:"Slug"},null,512),[[f,s.product.data.subscription.cycles]])])])])])):m("",!0)])])):m("",!0)])])])]),_:1}),l.user&&l.user!=null&&l.user.type&&l.user.type=="admin"?(d(),c("div",ye,[g(E,{open:!1,"aria-id":"contentHiddenPropertiesAdmin"},{trigger:y(i=>[t("h3",ve,[be,Pe,g(h,{icon:i.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:y(()=>[t("div",we,[t("div",Le,[t("div",Ce,[t("div",Se,[xe,t("div",Ie,[_(t("input",{class:"input",type:"text","onUpdate:modelValue":e[13]||(e[13]=i=>s.product.publisher=i),translate:"yes",placeholder:"Publisher"},null,512),[[f,s.product.publisher]])])])])])])]),_:1})])):m("",!0)])):m("",!0),t("div",Ae,[t("div",ke,[t("div",Ee,[t("img",{src:l.getProductImagePath(s.product.orderCode),alt:s.product.name[s.language.code],class:"image-main",onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,De),t("div",Ve,[t("label",Ue,[t("input",{class:"file-input",type:"file",name:"resume",onInput:e[14]||(e[14]=i=>l.productMainImageUpload(i))},null,32),Fe])]),t("a",{class:"action remove button is-danger is-outlined",onClick:e[15]||(e[15]=C(i=>l.productMainImageDelete(),["prevent"]))},Oe)])]),t("div",Re,[t("section",null,[g(V,{label:"Enter categories' url slugs"},{default:y(()=>[g(D,{modelValue:s.product.categories,"onUpdate:modelValue":e[16]||(e[16]=i=>s.product.categories=i),data:s.filteredCategoriesSlugs,autocomplete:"","allow-new":!1,field:"user.first_name",iconPack:"fas",icon:"tags",placeholder:"Categories",type:"is-info",onTyping:l.getFilteredCategories},null,8,["modelValue","data","onTyping"])]),_:1})]),s.parentCategoryDetail?(d(),c("nav",Ke,[s.parentCategoryDetail.parentCategories?(d(),c("ul",je,[(d(!0),c(P,null,w(s.parentCategoryDetail.parentCategories,(i,u)=>(d(),c("li",{key:u},[g(A,{title:i.name[s.language.code],to:{name:"categoryList",params:{category:i.pathSlug}}},{default:y(()=>[v(L(i.name[s.language.code]),1)]),_:2},1032,["title","to"])]))),128)),t("li",He,[g(A,{title:s.parentCategoryDetail.name[s.language.code],to:{name:"categoryList",params:{category:s.parentCategoryDetail.pathSlug}},"aria-current":"page"},{default:y(()=>[v(L(s.parentCategoryDetail.name[s.language.code]),1)]),_:1},8,["title","to"])])])):m("",!0)])):m("",!0),s.product&&s.product!=null?(d(),c("div",qe,[t("div",Ge,[Be,t("div",ze,[_(t("input",{class:"input is-size-1 has-text-weight-semibold has-text-centered",type:"text","onUpdate:modelValue":e[17]||(e[17]=i=>s.product.name[s.language.code]=i),onKeyup:e[18]||(e[18]=i=>l.checkNameDependents()),translate:"yes",placeholder:"Name"},null,544),[[f,s.product.name[s.language.code]]])])]),t("div",Je,[t("div",We,[Ye,t("div",Qe,[t("div",Xe,[Ze,t("div",$e,[_(t("input",{class:"input has-text-weight-normal has-text-left",type:"text","onUpdate:modelValue":e[19]||(e[19]=i=>s.product.orderCode=i),translate:"yes",placeholder:"Order code"},null,512),[[f,s.product.orderCode]])]),ts])])]),t("div",es,[ss,t("div",os,[t("div",rs,[is,t("div",ls,[_(t("input",{class:"input has-text-weight-normal has-text-left",type:"text","onUpdate:modelValue":e[20]||(e[20]=i=>s.product.stockAmount=i),translate:"yes",placeholder:"In stock"},null,512),[[f,s.product.stockAmount]])])])])]),t("div",ns,[t("div",as,[t("div",ds,[t("label",cs,[us,v(" "+L(o.$store.state.currency.symbol),1)]),t("div",ps,[_(t("input",{class:"input is-size-2 has-text-weight-normal has-text-right",type:"number","onUpdate:modelValue":e[21]||(e[21]=i=>s.product.price=i),translate:"yes",placeholder:"Price"},null,512),[[f,s.product.price]])])])]),t("div",hs,[t("button",{class:"button add-to-cart is-primary","data-id":s.product._id,onClick:e[22]||(e[22]=C(i=>o.addToCart(i),["prevent"])),disabled:""},[g(h,{icon:"cart-plus"}),ms,_s],8,gs)])]),t("div",fs,[t("div",ys,[s.product.priceLevels?(d(),c("div",vs,[g(E,{open:!1,"aria-id":"contentIdForA11y2",animation:"slide",modelValue:s.showPriceLevels,"onUpdate:modelValue":e[25]||(e[25]=i=>s.showPriceLevels=i)},{trigger:y(()=>[t("a",{href:"#",onClick:e[23]||(e[23]=C(i=>s.showPriceLevels=!s.showPriceLevels,["prevent"])),"aria-controls":"contentIdForA11y2"},Ps)]),default:y(()=>[(d(!0),c(P,null,w(s.product.priceLevels,(i,u)=>(d(),c("div",{key:u},[(d(!0),c(P,null,w(i,(S,x)=>(d(),c("div",{class:"columns",key:x},[t("div",ws,L(u+"."+x),1),t("div",Ls,[_(t("input",{class:"input has-text-weight-normal has-text-right",type:"number","onUpdate:modelValue":F=>s.product.priceLevels[u][x].price=F,placeholder:"Price",onKeyup:F=>s.product.priceLevels[u][x].type="defined"},null,40,Cs),[[f,s.product.priceLevels[u][x].price]])])]))),128))]))),128)),t("div",null,[t("button",{class:"button add-to-cart",onClick:e[24]||(e[24]=C(i=>l.recalculatePriceLevels(s.product._id),["prevent"])),translate:"yes"}," Recalculate Price Levels ")])]),_:1},8,["modelValue"])])):m("",!0)])])])])):m("",!0)])]),s.product&&s.product!=null?(d(),c("div",Ss,[t("div",xs,[t("div",Is,[As,t("div",ks,[_(t("input",{class:"input is-size-5 has-text-weight-normal has-text-centered",type:"text","onUpdate:modelValue":e[26]||(e[26]=i=>s.product.descriptionShort[s.language.code]=i),translate:"yes",placeholder:"Description Short"},null,512),[[f,s.product.descriptionShort[s.language.code]]])])]),s.product.data&&s.product.data.variations?(d(),c("div",Es,[t("section",null,[t("section",null,[Ds,(d(!0),c(P,null,w(s.product.data.variations,(i,u)=>(d(),k(A,{key:i._id+u,class:"content",title:i.name[o.$store.state.language.code],to:{name:"productDetail",params:{category:i.categories[0],product:i._id,slug:i.slug}}},{default:y(()=>[t("figure",Vs,[t("img",{src:l.getProductImagePath(i.orderCode),alt:i.name[o.$store.state.language.code]},null,8,Us)]),v(" "+L(i.name[o.$store.state.language.code]),1)]),_:2},1032,["title","to"]))),128))])])])):m("",!0)]),t("div",Fs,[t("div",{class:"productContent","data-editable":"","data-name":"description",innerHTML:s.product.descriptionLong[s.language.code]},null,8,Ns)])])):m("",!0),s.product&&s.product!=null&&s.product.properties?(d(),c("div",Ts,[t("div",Ms,[Os,t("div",Rs,[t("a",{class:"button is-primary is-info",onClick:e[27]||(e[27]=C(i=>l.newPropertyCardModal(),["prevent"]))},qs)])]),t("div",Gs,[t("div",Bs,[t("div",null,[t("table",zs,[(d(!0),c(P,null,w(s.product.properties,(i,u)=>(d(),c("tr",{key:u,"data-key":u},[t("th",null,[t("div",Ws,[Ys,t("div",Qs,[t("input",{class:"input has-text-weight-normal has-text-left",disabled:l.getPropertyStrings(i,u).name===u,type:"text",translate:"yes",placeholder:"Property Key","data-orig":u,value:u,onKeyup:S=>l.changePropertyValue(u,"key")},null,40,Xs)]),Zs])]),t("td",null,[t("div",$s,[to,t("div",eo,[t("input",{class:"input has-text-weight-normal has-text-left",type:"text",translate:"yes",placeholder:"Property Name","data-orig":l.getPropertyStrings(i,u).name,value:l.getPropertyStrings(i,u).name,onKeyup:S=>l.changePropertyValue(u,"name")},null,40,so),g(U,{type:"is-info",value:l.checkIfPropertyHasLang(i,"name"),onInput:S=>l.changePropertyLangOption(i,u,"name"),translate:"yes"},{default:y(()=>[oo]),_:2},1032,["value","onInput"])]),ro])]),t("td",null,[t("div",io,[lo,t("div",no,[t("input",{class:"input has-text-weight-normal has-text-left",type:"text",translate:"yes",placeholder:"Property Value","data-orig":l.getPropertyStrings(i,u).value,value:l.getPropertyStrings(i,u).value,onKeyup:S=>l.changePropertyValue(u,"value")},null,40,ao),g(U,{type:"is-info",value:l.checkIfPropertyHasLang(i,"value"),onInput:S=>l.changePropertyLangOption(i,u,"value")},{default:y(()=>[co]),_:2},1032,["value","onInput"])])])]),t("td",uo,[t("a",{href:"#revemoProperty",class:"is-size-4 has-text-danger",onClick:C(S=>l.removeProperty(u),["prevent"])},[g(h,{icon:"minus"})],8,po)])],8,Js))),128))])])])])])):m("",!0),g(M,{product:s.product,editable:!0},null,8,["product"]),s.product&&s.product.data&&s.product.data.related&&s.product.data.related.products?(d(),c("section",ho,[g(V,{label:"Enter order codes of related products"},{default:y(()=>[g(D,{modelValue:s.product.data.related.products,"onUpdate:modelValue":e[28]||(e[28]=i=>s.product.data.related.products=i),data:s.filteredProductCodes,autocomplete:"","allow-new":!1,field:"user.first_name",iconPack:"fas",icon:"tags",placeholder:"Related",type:"is-info",onTyping:l.getFilteredRelatedProducts},null,8,["modelValue","data","onTyping"])]),_:1})])):m("",!0),s.product&&s.product!=null&&s.product.data&&s.product.data.related&&s.product.data.related.productResults&&s.product.data.related.productResults.length>0&&o.$store&&o.$store.state&&o.$store.state.coredata?(d(),c("div",go,[t("div",mo,[_o,t("div",fo,[(d(!0),c(P,null,w(s.product.data.related.productResults,(i,u)=>(d(),k(A,{key:i._id+u,class:"tile is-parent is-3",title:i.descriptionShort[s.language.code],to:{name:"productDetail",params:{category:s.parentCategoryDetail.pathSlug,product:i._id,slug:i.slug}}},{default:y(()=>[g(O,{product:i},null,8,["product"])]),_:2},1032,["title","to"]))),128))])])])):m("",!0),s.product&&s.product!=null?(d(),c("div",yo,[t("div",vo,[t("section",null,[t("button",{class:"button is-danger",onClick:e[29]||(e[29]=i=>l.deleteProduct()),translate:"yes"},"DELETE This Product"),bo])])])):m("",!0),g(R,{modal:s.modal},null,8,["modal"])])):m("",!0)}var Co=N(lt,[["render",Po],["__scopeId","data-v-e7ba09b4"],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/ProductNewEdit.vue"]]);export{Co as default};
