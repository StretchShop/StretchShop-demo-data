import{B as tt}from"./index.78dc2935.js";var ft={exports:{}};(function(Y){(function(){var h;h={},h.Machine=function(){function _(k){this.context=k,this._stateTransitions={},this._stateTransitionsAny={},this._defaultTransition=null,this._initialState=null,this._currentState=null}return _.prototype.addTransition=function(k,P,z,V){return z||(z=P),this._stateTransitions[[k,P]]=[z,V]},_.prototype.addTransitions=function(k,P,z,V){var N,M,D,u;for(z||(z=P),u=[],M=0,D=k.length;M<D;M++)N=k[M],u.push(this.addTransition(N,P,z,V));return u},_.prototype.addTransitionAny=function(k,P,z){return P||(P=k),this._stateTransitionsAny[k]=[P,z]},_.prototype.setDefaultTransition=function(k,P){return this._defaultTransition=[k,P]},_.prototype.getTransition=function(k,P){if(this._stateTransitions[[k,P]])return this._stateTransitions[[k,P]];if(this._stateTransitionsAny[P])return this._stateTransitionsAny[P];if(this._defaultTransition)return this._defaultTransition;throw new Error("Transition is undefined: ("+k+", "+P+")")},_.prototype.getCurrentState=function(){return this._currentState},_.prototype.setInitialState=function(k){if(this._initialState=k,!this._currentState)return this.reset()},_.prototype.reset=function(){return this._currentState=this._initialState},_.prototype.process=function(k){var P;return P=this.getTransition(k,this._currentState),P[1]&&P[1].call(this.context||(this.context=this),k),this._currentState=P[0]},_}(),typeof window!="undefined"&&(window.FSM=h),Y.exports&&(Y.exports=h)}).call(tt),function(){var h,_,k,P,z,V,N,M,D,u,e,t,n,i,r,o,s,a,c,p,g,v,C,T,w,I,R=[].slice,A=[].indexOf||function(E){for(var l=0,d=this.length;l<d;l++)if(l in this&&this[l]===E)return l;return-1};a={},typeof window!="undefined"&&(window.HTMLString=a),Y.exports&&(Y.exports=a),a.String=function(){E._parser=null;function E(l,d){d==null&&(d=!1),this._preserveWhitespace=d,l?(a.String._parser===null&&(a.String._parser=new I),this.characters=a.String._parser.parse(l,this._preserveWhitespace).characters):this.characters=[]}return E.prototype.isWhitespace=function(){var l,d,f,m;for(m=this.characters,d=0,f=m.length;d<f;d++)if(l=m[d],!l.isWhitespace())return!1;return!0},E.prototype.length=function(){return this.characters.length},E.prototype.preserveWhitespace=function(){return this._preserveWhitespace},E.prototype.capitalize=function(){var l,d;return d=this.copy(),d.length()&&(l=d.characters[0]._c.toUpperCase(),d.characters[0]._c=l),d},E.prototype.charAt=function(l){return this.characters[l].copy()},E.prototype.concat=function(){var l,d,f,m,y,S,b,L,x,H,O,B,F,U,W,G,j;for(b=2<=arguments.length?R.call(arguments,0,x=arguments.length-1):(x=0,[]),f=arguments[x++],typeof f=="undefined"||typeof f=="boolean"||(b.push(f),f=!0),y=this.copy(),H=0,F=b.length;H<F;H++)if(S=b[H],S.length!==0){if(L=S,typeof S=="string"&&(L=new a.String(S,this._preserveWhitespace)),f&&y.length())for(d=y.charAt(y.length()-1),m=d.tags(),d.isTag()&&m.shift(),typeof S!="string"&&(L=L.copy()),G=L.characters,O=0,U=G.length;O<U;O++)l=G[O],l.addTags.apply(l,m);for(j=L.characters,B=0,W=j.length;B<W;B++)l=j[B],y.characters.push(l)}return y},E.prototype.contains=function(l){var d,f,m,y,S,b,L;if(typeof l=="string")return this.text().indexOf(l)>-1;for(m=0;m<=this.length()-l.length();){for(f=!0,L=l.characters,y=S=0,b=L.length;S<b;y=++S)if(d=L[y],!d.eq(this.characters[y+m])){f=!1;break}if(f)return!0;m++}return!1},E.prototype.endsWith=function(l){var d,f,m,y,S,b;if(typeof l=="string")return l===""||this.text().slice(-l.length)===l;for(f=this.characters.slice().reverse(),b=l.characters.slice().reverse(),m=y=0,S=b.length;y<S;m=++y)if(d=b[m],!d.eq(f[m]))return!1;return!0},E.prototype.format=function(){var l,d,f,m,y,S,b;for(d=arguments[0],S=arguments[1],y=3<=arguments.length?R.call(arguments,2):[],S<0&&(S=this.length()+S+1),d<0&&(d=this.length()+d),m=this.copy(),f=b=d;d<=S?b<S:b>S;f=d<=S?++b:--b)l=m.characters[f],l.addTags.apply(l,y);return m},E.prototype.hasTags=function(){var l,d,f,m,y,S,b,L;for(m=2<=arguments.length?R.call(arguments,0,y=arguments.length-1):(y=0,[]),f=arguments[y++],typeof f=="undefined"||typeof f=="boolean"||(m.push(f),f=!1),d=!1,L=this.characters,S=0,b=L.length;S<b;S++)if(l=L[S],l.hasTags.apply(l,m))d=!0;else if(f)return!1;return d},E.prototype.html=function(){var l,d,f,m,y,S,b,L,x,H,O,B,F,U,W,G,j,q,K,X,Z,$,Q;for(y="",L=[],S=[],f=[],X=this.characters,H=0,U=X.length;H<U;H++){for(l=X[H],f=[],Z=L.slice().reverse(),O=0,W=Z.length;O<W;O++)if(b=Z[O],f.push(b),!l.hasTags(b)){for(B=0,G=f.length;B<G;B++)d=f[B],y+=d.tail(),L.pop(),S.pop();f=[]}for($=l._tags,F=0,j=$.length;F<j;F++)x=$[F],S.indexOf(x.head())===-1&&(x.selfClosing()||(m=x.head(),y+=m,L.push(x),S.push(m)));l._tags.length>0&&l._tags[0].selfClosing()&&(y+=l._tags[0].head()),y+=l.c()}for(Q=L.reverse(),K=0,q=Q.length;K<q;K++)x=Q[K],y+=x.tail();return y},E.prototype.indexOf=function(l,d){var f,m,y,S,b,L;if(d==null&&(d=0),d<0&&(d=0),typeof l=="string")return this.text().indexOf(l,d);for(;d<=this.length()-l.length();){for(m=!0,L=l.characters,y=S=0,b=L.length;S<b;y=++S)if(f=L[y],!f.eq(this.characters[y+d])){m=!1;break}if(m)return d;d++}return-1},E.prototype.insert=function(l,d,f){var m,y,S,b,L,x,H,O,B,F,U,W,G,j,q,K;if(f==null&&(f=!0),y=this.slice(0,l),H=this.slice(l),l<0&&(l=this.length()+l),L=d,typeof d=="string"&&(L=new a.String(d,this._preserveWhitespace)),f&&l>0)for(S=this.charAt(l-1),b=S.tags(),S.isTag()&&b.shift(),typeof d!="string"&&(L=L.copy()),j=L.characters,O=0,U=j.length;O<U;O++)m=j[O],m.addTags.apply(m,b);for(x=y,q=L.characters,B=0,W=q.length;B<W;B++)m=q[B],x.characters.push(m);for(K=H.characters,F=0,G=K.length;F<G;F++)m=K[F],x.characters.push(m);return x},E.prototype.lastIndexOf=function(l,d){var f,m,y,S,b,L,x,H,O;if(d==null&&(d=0),d<0&&(d=0),m=this.characters.slice(d).reverse(),d=0,typeof l=="string"){if(!this.contains(l))return-1;for(l=l.split("").reverse();d<=m.length-l.length;){for(y=!0,b=0,S=L=0,H=l.length;L<H;S=++L)if(f=l[S],m[S+d].isTag()&&(b+=1),f!==m[b+S+d].c()){y=!1;break}if(y)return d;d++}return-1}for(l=l.characters.slice().reverse();d<=m.length-l.length;){for(y=!0,S=x=0,O=l.length;x<O;S=++x)if(f=l[S],!f.eq(m[S+d])){y=!1;break}if(y)return d;d++}return-1},E.prototype.optimize=function(){var l,d,f,m,y,S,b,L,x,H,O,B,F,U,W,G,j,q,K,X,Z,$,Q,pt,_t,et,nt,it,ot,st,at,ut,lt,ct,ht;for(L=[],S=[],m=null,ot=this.characters.slice().reverse(),W=0,K=ot.length;W<K;W++){for(l=ot[W],l._runLengthMap={},l._runLengthMapSize=0,d=[],st=L.slice().reverse(),G=0,X=st.length;G<X;G++)if(b=st[G],d.push(b),!l.hasTags(b)){for(j=0,Z=d.length;j<Z;j++)L.pop(),S.pop();d=[]}for(at=l._tags,q=0,$=at.length;q<$;q++)U=at[q],S.indexOf(U.head())===-1&&(U.selfClosing()||(L.push(U),S.push(U.head())));for(et=0,Q=L.length;et<Q;et++){if(U=L[et],f=U.head(),!m){l._runLengthMap[f]=[U,1];continue}l._runLengthMap[f]||(l._runLengthMap[f]=[U,0]),B=0,m._runLengthMap[f]&&(B=m._runLengthMap[f][1]),l._runLengthMap[f][1]=B+1}m=l}for(H=function(rt,J){return J[1]-rt[1]},ut=this.characters,ht=[],nt=0,pt=ut.length;nt<pt;nt++)if(l=ut[nt],y=l._tags.length,!(y>0&&l._tags[0].selfClosing()&&y<3||y<2)){O=[],lt=l._runLengthMap;for(U in lt)x=lt[U],O.push(x);for(O.sort(H),ct=l._tags.slice(),it=0,_t=ct.length;it<_t;it++)U=ct[it],U.selfClosing()||l.removeTags(U);ht.push(l.addTags.apply(l,function(){var rt,J,dt;for(dt=[],J=0,rt=O.length;J<rt;J++)F=O[J],dt.push(F[0]);return dt}()))}return ht},E.prototype.slice=function(l,d){var f,m;return m=new a.String("",this._preserveWhitespace),m.characters=function(){var y,S,b,L;for(b=this.characters.slice(l,d),L=[],y=0,S=b.length;y<S;y++)f=b[y],L.push(f.copy());return L}.call(this),m},E.prototype.split=function(l,d){var f,m,y,S,b,L,x,H,O,B;for(l==null&&(l=""),d==null&&(d=0),L=0,f=0,b=[0];!(d>0&&f>d||(S=this.indexOf(l,L),S===-1));)b.push(S),L=S+1;for(b.push(this.length()),H=[],y=O=0,B=b.length-2;0<=B?O<=B:O>=B;y=0<=B?++O:--O)x=b[y],y>0&&(x+=1),m=b[y+1],H.push(this.slice(x,m));return H},E.prototype.startsWith=function(l){var d,f,m,y,S;if(typeof l=="string")return this.text().slice(0,l.length)===l;for(S=l.characters,f=m=0,y=S.length;m<y;f=++m)if(d=S[f],!d.eq(this.characters[f]))return!1;return!0},E.prototype.substr=function(l,d){return d<=0?new a.String("",this._preserveWhitespace):(l<0&&(l=this.length()+l),d===void 0&&(d=this.length()-l),this.slice(l,l+d))},E.prototype.substring=function(l,d){return d===void 0&&(d=this.length()),this.slice(l,d)},E.prototype.text=function(){var l,d,f,m,y;for(d="",y=this.characters,f=0,m=y.length;f<m;f++){if(l=y[f],l.isTag()){l.isTag("br")&&(d+=`
`);continue}if(l.c()==="&nbsp;"){d+=l.c();continue}d+=l.c()}return this.constructor.decode(d)},E.prototype.toLowerCase=function(){var l,d,f,m,y;for(d=this.copy(),y=d.characters,f=0,m=y.length;f<m;f++)l=y[f],l._c.length===1&&(l._c=l._c.toLowerCase());return d},E.prototype.toUpperCase=function(){var l,d,f,m,y;for(d=this.copy(),y=d.characters,f=0,m=y.length;f<m;f++)l=y[f],l._c.length===1&&(l._c=l._c.toUpperCase());return d},E.prototype.trim=function(){var l,d,f,m,y,S,b,L,x,H;for(x=this.characters,d=y=0,b=x.length;y<b&&(l=x[d],!!l.isWhitespace());d=++y);for(H=this.characters.slice().reverse(),m=S=0,L=H.length;S<L&&(l=H[m],!!l.isWhitespace());m=++S);return m=this.length()-m-1,f=new a.String("",this._preserveWhitespace),f.characters=function(){var O,B,F,U;for(F=this.characters.slice(d,+m+1||9e9),U=[],O=0,B=F.length;O<B;O++)l=F[O],U.push(l.copy());return U}.call(this),f},E.prototype.trimLeft=function(){var l,d,f,m,y,S,b;for(m=this.length()-1,b=this.characters,d=y=0,S=b.length;y<S&&(l=b[d],!!l.isWhitespace());d=++y);return f=new a.String("",this._preserveWhitespace),f.characters=function(){var L,x,H,O;for(H=this.characters.slice(d,+m+1||9e9),O=[],L=0,x=H.length;L<x;L++)l=H[L],O.push(l.copy());return O}.call(this),f},E.prototype.trimRight=function(){var l,d,f,m,y,S,b;for(d=0,b=this.characters.slice().reverse(),m=y=0,S=b.length;y<S&&(l=b[m],!!l.isWhitespace());m=++y);return m=this.length()-m-1,f=new a.String("",this._preserveWhitespace),f.characters=function(){var L,x,H,O;for(H=this.characters.slice(d,+m+1||9e9),O=[],L=0,x=H.length;L<x;L++)l=H[L],O.push(l.copy());return O}.call(this),f},E.prototype.unformat=function(){var l,d,f,m,y,S,b;for(d=arguments[0],S=arguments[1],y=3<=arguments.length?R.call(arguments,2):[],S<0&&(S=this.length()+S+1),d<0&&(d=this.length()+d),m=this.copy(),f=b=d;d<=S?b<S:b>S;f=d<=S?++b:--b)l=m.characters[f],l.removeTags.apply(l,y);return m},E.prototype.copy=function(){var l,d;return d=new a.String("",this._preserveWhitespace),d.characters=function(){var f,m,y,S;for(y=this.characters,S=[],f=0,m=y.length;f<m;f++)l=y[f],S.push(l.copy());return S}.call(this),d},E.decode=function(l){var d;return d=document.createElement("textarea"),d.innerHTML=l,d.textContent},E.encode=function(l){var d;return d=document.createElement("textarea"),d.textContent=l,d.innerHTML},E.join=function(l,d){var f,m,y,S;for(f=d.shift(),y=0,S=d.length;y<S;y++)m=d[y],f=f.concat(l,m);return f},E}(),h="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz-_$".split(""),_=h.concat("1234567890".split("")),M=_.concat([":"]),s=_.concat(["#"]),g=_.concat([":"]),i=1,o=2,p=3,c=4,r=5,T=6,v=7,w=8,C=9,u=10,N=11,D=12,k=13,n=14,e=15,t=16,z=17,V=18,P=19,I=function(){function E(){this.fsm=new FSM.Machine(this),this.fsm.setInitialState(i),this.fsm.addTransitionAny(i,null,function(l){return this._pushChar(l)}),this.fsm.addTransition("<",i,p),this.fsm.addTransition("&",i,o),this.fsm.addTransitions(s,o,null,function(l){return this.entity+=l}),this.fsm.addTransition(";",o,i,function(){return this._pushChar("&"+this.entity+";"),this.entity=""}),this.fsm.addTransitions([" ",`
`],p),this.fsm.addTransitions(h,p,c,function(){return this._back()}),this.fsm.addTransition("/",p,r),this.fsm.addTransitions([" ",`
`],c),this.fsm.addTransitions(h,c,T,function(){return this._back()}),this.fsm.addTransitions([" ",`
`],r),this.fsm.addTransitions(h,r,v,function(){return this._back()}),this.fsm.addTransitions(g,T,null,function(l){return this.tagName+=l}),this.fsm.addTransitions([" ",`
`],T,u),this.fsm.addTransition("/",T,w,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",T,i,function(){return this._pushTag()}),this.fsm.addTransitions([" ",`
`],w),this.fsm.addTransition(">",w,i,function(){return this._pushTag()}),this.fsm.addTransitions([" ",`
`],u),this.fsm.addTransition("/",u,w,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",u,i,function(){return this._pushTag()}),this.fsm.addTransitions(h,u,N,function(){return this._back()}),this.fsm.addTransitions(g,v,null,function(l){return this.tagName+=l}),this.fsm.addTransitions([" ",`
`],v,C),this.fsm.addTransition(">",v,i,function(){return this._popTag()}),this.fsm.addTransitions([" ",`
`],C),this.fsm.addTransition(">",C,i,function(){return this._popTag()}),this.fsm.addTransitions(M,N,null,function(l){return this.attributeName+=l}),this.fsm.addTransitions([" ",`
`],N,D),this.fsm.addTransition("=",N,k),this.fsm.addTransitions([" ",`
`],D),this.fsm.addTransition("=",D,k),this.fsm.addTransitions(">",N,u,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitionAny(D,u,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitions([" ",`
`],k),this.fsm.addTransition("'",k,n),this.fsm.addTransition('"',k,e),this.fsm.addTransitions(_.concat(["&"],k,t,function(){return this._back()})),this.fsm.addTransition(" ",t,u,function(){return this._pushAttribute()}),this.fsm.addTransitions(["/",">"],t,u,function(){return this._back(),this._pushAttribute()}),this.fsm.addTransition("&",t,z),this.fsm.addTransitionAny(t,null,function(l){return this.attributeValue+=l}),this.fsm.addTransition("'",n,u,function(){return this._pushAttribute()}),this.fsm.addTransition("&",n,V),this.fsm.addTransitionAny(n,null,function(l){return this.attributeValue+=l}),this.fsm.addTransition('"',e,u,function(){return this._pushAttribute()}),this.fsm.addTransition("&",e,P),this.fsm.addTransitionAny(e,null,function(l){return this.attributeValue+=l}),this.fsm.addTransitions(s,z,null,function(l){return this.entity+=l}),this.fsm.addTransitions(s,V,function(l){return this.entity+=l}),this.fsm.addTransitions(s,P,null,function(l){return this.entity+=l}),this.fsm.addTransition(";",z,t,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",V,n,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",P,e,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""})}return E.prototype._back=function(){return this.head--},E.prototype._pushAttribute=function(){return this.attributes[this.attributeName]=this.attributeValue,this.attributeName="",this.attributeValue=""},E.prototype._pushChar=function(l){var d,f;if(d=new a.Character(l,this.tags),this._preserveWhitespace){this.string.characters.push(d);return}if(!(this.string.length()&&!d.isTag()&&!d.isEntity()&&d.isWhitespace()&&(f=this.string.characters[this.string.length()-1],f.isWhitespace()&&!f.isTag()&&!f.isEntity())))return this.string.characters.push(d)},E.prototype._pushTag=function(){var l,d;return l=new a.Tag(this.tagName,this.attributes),this.tags.push(l),l.selfClosing()&&(this._pushChar(""),this.tags.pop(),!this.selfClosed&&(d=this.tagName,A.call(a.Tag.SELF_CLOSING,d)>=0)&&this.fsm.reset()),this.tagName="",this.selfClosed=!1,this.attributes={}},E.prototype._popTag=function(){for(var l,d;d=this.tags.pop(),this.string.length()&&(l=this.string.characters[this.string.length()-1],!l.isTag()&&!l.isEntity()&&l.isWhitespace()&&l.removeTags(d)),d.name()!==this.tagName.toLowerCase(););return this.tagName=""},E.prototype.parse=function(l,d){var f,m;for(this._preserveWhitespace=d,this.reset(),l=this.preprocess(l),this.fsm.parser=this;this.head<l.length;){f=l[this.head];try{this.fsm.process(f)}catch(y){throw m=y,new Error("Error at char "+this.head+" >> "+m)}this.head++}return this.string},E.prototype.preprocess=function(l){return l=l.replace(/\r\n/g,`
`).replace(/\r/g,`
`),l=l.replace(/<!--[\s\S]*?-->/g,""),this._preserveWhitespace||(l=l.replace(/\s+/g," ")),l},E.prototype.reset=function(){return this.fsm.reset(),this.head=0,this.string=new a.String,this.entity="",this.tags=[],this.tagName="",this.selfClosing=!1,this.attributes={},this.attributeName="",this.attributeValue=""},E}(),a.Tag=function(){function E(l,d){var f,m;this._name=l.toLowerCase(),this._selfClosing=a.Tag.SELF_CLOSING[this._name]===!0,this._head=null,this._attributes={};for(f in d)m=d[f],this._attributes[f]=m}return E.SELF_CLOSING={area:!0,base:!0,br:!0,hr:!0,img:!0,input:!0,"link meta":!0,wbr:!0},E.prototype.head=function(){var l,d,f,m;if(!this._head){l=[],m=this._attributes;for(d in m)f=m[d],f?l.push(""+d+'="'+f+'"'):l.push(""+d);l.sort(),l.unshift(this._name),this._head="<"+l.join(" ")+">"}return this._head},E.prototype.name=function(){return this._name},E.prototype.selfClosing=function(){return this._selfClosing},E.prototype.tail=function(){return this._selfClosing?"":"</"+this._name+">"},E.prototype.attr=function(l,d){return d===void 0?this._attributes[l]:(this._attributes[l]=d,this._head=null)},E.prototype.removeAttr=function(l){if(this._attributes[l]!==void 0)return delete this._attributes[l],this._head=null},E.prototype.copy=function(){return new a.Tag(this._name,this._attributes)},E}(),a.Character=function(){function E(l,d){this._c=l,l.length>1&&(this._c=l.toLowerCase()),this._tags=[],this.addTags.apply(this,d)}return E.prototype.c=function(){return this._c},E.prototype.isEntity=function(){return this._c.length>1},E.prototype.isTag=function(l){return!(this._tags.length===0||!this._tags[0].selfClosing()||l&&this._tags[0].name()!==l)},E.prototype.isWhitespace=function(){var l;return(l=this._c)===" "||l===`
`||l==="&nbsp;"||this.isTag("br")},E.prototype.tags=function(){var l;return function(){var d,f,m,y;for(m=this._tags,y=[],d=0,f=m.length;d<f;d++)l=m[d],y.push(l.copy());return y}.call(this)},E.prototype.addTags=function(){var l,d,f,m,y;for(d=1<=arguments.length?R.call(arguments,0):[],y=[],f=0,m=d.length;f<m;f++)if(l=d[f],!Array.isArray(l)){if(l.selfClosing()){this.isTag()||this._tags.unshift(l.copy());continue}y.push(this._tags.push(l.copy()))}return y},E.prototype.eq=function(l){var d,f,m,y,S,b,L,x;if(this.c()!==l.c()||this._tags.length!==l._tags.length)return!1;for(f={},L=this._tags,m=0,S=L.length;m<S;m++)d=L[m],f[d.head()]=!0;for(x=l._tags,y=0,b=x.length;y<b;y++)if(d=x[y],!f[d.head()])return!1;return!0},E.prototype.hasTags=function(){var l,d,f,m,y,S,b,L,x;for(m=1<=arguments.length?R.call(arguments,0):[],f={},d={},x=this._tags,y=0,b=x.length;y<b;y++)l=x[y],f[l.name()]=!0,d[l.head()]=!0;for(S=0,L=m.length;S<L;S++)if(l=m[S],typeof l=="string"){if(f[l]===void 0)return!1}else if(d[l.head()]===void 0)return!1;return!0},E.prototype.removeTags=function(){var l,d,f,m,y,S;if(m=1<=arguments.length?R.call(arguments,0):[],m.length===0){this._tags=[];return}for(d={},l={},y=0,S=m.length;y<S;y++)f=m[y],typeof f=="string"?d[f]=f:l[f.head()]=f;return this._tags=this._tags.filter(function(b){if(!l[b.head()]&&!d[b.name()])return b})},E.prototype.copy=function(){var l;return new a.Character(this._c,function(){var d,f,m,y;for(m=this._tags,y=[],d=0,f=m.length;d<f;d++)l=m[d],y.push(l.copy());return y}.call(this))},E}()}.call(tt),function(){var h,_,k,P,z,V,N=[].indexOf||function(M){for(var D=0,u=this.length;D<u;D++)if(D in this&&this[D]===M)return D;return-1};h={},h.Range=function(){function M(D,u){this.set(D,u)}return M.prototype.isCollapsed=function(){return this._from===this._to},M.prototype.span=function(){return this._to-this._from},M.prototype.collapse=function(){return this._to=this._from},M.prototype.eq=function(D){return this.get()[0]===D.get()[0]&&this.get()[1]===D.get()[1]},M.prototype.get=function(){return[this._from,this._to]},M.prototype.select=function(D){var u,e,t,n,i,r,o,s,a;return h.Range.unselectAll(),u=document.createRange(),s=P(D,this._from),i=s[0],o=s[1],a=P(D,this._to),e=a[0],n=a[1],r=i.length||0,t=e.length||0,u.setStart(i,Math.min(o,r)),u.setEnd(e,Math.min(n,t)),window.getSelection().addRange(u)},M.prototype.set=function(D,u){return D=Math.max(0,D),u=Math.max(0,u),this._from=Math.min(D,u),this._to=Math.max(D,u)},M.prepareElement=function(D){var u,e,t,n,i,r;for(t=D.querySelectorAll(_.join(", ")),r=[],u=n=0,i=t.length;n<i;u=++n)e=t[u],e.parentNode.insertBefore(document.createTextNode(""),e),u<t.length-1?r.push(e.parentNode.insertBefore(document.createTextNode(""),e.nextSibling)):r.push(void 0);return r},M.query=function(D){var u,e,t,n,i,r,o;n=new h.Range(0,0);try{u=window.getSelection().getRangeAt(0)}catch{return n}return D.firstChild===null&&D.lastChild===null||!k(u.startContainer,D)||!k(u.endContainer,D)||(o=z(D,u),i=o[0],r=o[1],e=o[2],t=o[3],n.set(V(D,i)+r,V(D,e)+t)),n},M.rect=function(){var D,u,e;try{D=window.getSelection().getRangeAt(0)}catch{return null}return D.collapsed?(u=document.createElement("span"),D.insertNode(u),e=u.getBoundingClientRect(),u.parentNode.removeChild(u),e):D.getBoundingClientRect()},M.unselectAll=function(){if(window.getSelection())return window.getSelection().removeAllRanges()},M}(),_=["br","img","input"],k=function(M,D){for(;M;){if(M===D)return!0;M=M.parentNode}return!1},P=function(M,D){var u,e,t,n,i;if(M.childNodes.length===0)return[M,D];for(u=null,e=D,t=function(){var r,o,s,a;for(s=M.childNodes,a=[],r=0,o=s.length;r<o;r++)n=s[r],a.push(n);return a}();t.length>0;)switch(u=t.shift(),u.nodeType){case Node.TEXT_NODE:if(u.textContent.length>=e)return[u,e];e-=u.textContent.length;break;case Node.ELEMENT_NODE:if(i=u.nodeName.toLowerCase(),N.call(_,i)>=0){if(e===0)return[u,0];e=Math.max(0,e-1)}else u.childNodes&&Array.prototype.unshift.apply(t,function(){var r,o,s,a;for(s=u.childNodes,a=[],r=0,o=s.length;r<o;r++)n=s[r],a.push(n);return a}())}return[u,e]},V=function(M,D){var u,e,t,n,i,r;if(M.childNodes.length===0)return 0;for(t=0,u=function(){var o,s,a,c;for(a=M.childNodes,c=[],o=0,s=a.length;o<s;o++)e=a[o],c.push(e);return c}();u.length>0;){if(n=u.shift(),n===D)return i=n.nodeName.toLowerCase(),N.call(_,i)>=0?t+1:t;switch(n.nodeType){case Node.TEXT_NODE:t+=n.textContent.length;break;case Node.ELEMENT_NODE:r=n.nodeName.toLowerCase(),N.call(_,r)>=0?t+=1:n.childNodes&&Array.prototype.unshift.apply(u,function(){var o,s,a,c;for(a=n.childNodes,c=[],o=0,s=a.length;o<s;o++)e=a[o],c.push(e);return c}())}}return t},z=function(M,D){var u,e,t,n,i,r,o,s,a,c,p,g,v,C;if(e=M.childNodes,a=D.cloneRange(),a.collapse(!0),i=D.cloneRange(),i.collapse(!1),o=a.startContainer,s=a.startOffset,t=i.endContainer,n=i.endOffset,!a.comparePoint)return[o,s,t,n];if(o===M){for(o=e[e.length-1],s=o.textContent.length,r=c=0,g=e.length;c<g;r=++c)if(u=e[r],a.comparePoint(u,0)===1){r===0?(o=u,s=0):(o=e[r-1],s=u.textContent.length),C=o.nodeName.toLowerCase,N.call(_,C)>=0&&(s=1);break}}if(D.collapsed)return[o,s,o,s];if(t===M)for(t=e[e.length-1],n=t.textContent.length,r=p=0,v=e.length;p<v;r=++p)u=e[r],i.comparePoint(u,0)===1&&(r===0?t=u:t=e[r-1],n=u.textContent.length+1);return[o,s,t,n]},typeof window!="undefined"&&(window.ContentSelect=h),Y.exports&&(Y.exports=h)}.call(tt),function(){var h,_,k,P,z=[].slice,V=[].indexOf||function(u){for(var e=0,t=this.length;e<t;e++)if(e in this&&this[e]===u)return e;return-1},N={}.hasOwnProperty,M=function(u,e){for(var t in e)N.call(e,t)&&(u[t]=e[t]);function n(){this.constructor=u}return n.prototype=e.prototype,u.prototype=new n,u.__super__=e.prototype,u},D=function(u,e){return function(){return u.apply(e,arguments)}};h={ALIGNMENT_CLASS_NAMES:{left:"align-left",right:"align-right"},DEFAULT_MAX_ELEMENT_WIDTH:800,DEFAULT_MIN_ELEMENT_WIDTH:80,DRAG_HOLD_DURATION:500,DROP_EDGE_SIZE:50,ENABLE_DRAG_CLONING:!1,HELPER_CHAR_LIMIT:250,INDENT:"    ",LANGUAGE:"en",LINE_ENDINGS:`
`,PREFER_LINE_BREAKS:!1,RESIZE_CORNER_SIZE:15,TRIM_WHITESPACE:!0,_translations:{},_:function(u){var e;return e=h.LANGUAGE,h._translations[e]&&h._translations[e][u]?h._translations[e][u]:u},addTranslations:function(u,e){return h._translations[u]=e},addCSSClass:function(u,e){var t,n,i;if(u.classList){u.classList.add(e);return}if(n=u.getAttribute("class"),n){if(i=function(){var r,o,s,a;for(s=n.split(" "),a=[],r=0,o=s.length;r<o;r++)t=s[r],a.push(t);return a}(),i.indexOf(e)===-1)return u.setAttribute("class",""+n+" "+e)}else return u.setAttribute("class",e)},attributesToString:function(u){var e,t,n,i,r,o;if(!u)return"";for(n=function(){var s;s=[];for(t in u)s.push(t);return s}(),n.sort(),e=[],r=0,o=n.length;r<o;r++)t=n[r],i=u[t],i===""?e.push(t):(i=HTMLString.String.encode(i),i=i.replace(/"/g,"&quot;"),e.push(""+t+'="'+i+'"'));return e.join(" ")},removeCSSClass:function(u,e){var t,n,i,r;if(u.classList){u.classList.remove(e),u.classList.length===0&&u.removeAttribute("class");return}if(n=u.getAttribute("class"),n&&(r=function(){var o,s,a,c;for(a=n.split(" "),c=[],o=0,s=a.length;o<s;o++)t=a[o],c.push(t);return c}(),i=r.indexOf(e),i>-1))return r.splice(i,1),r.length?u.setAttribute("class",r.join(" ")):u.removeAttribute("class")}},typeof window!="undefined"&&(window.ContentEdit=h),Y.exports&&(Y.exports=h),k=function(){function u(){this._tagNames={}}return u.prototype.register=function(){var e,t,n,i,r,o;for(e=arguments[0],n=2<=arguments.length?z.call(arguments,1):[],o=[],i=0,r=n.length;i<r;i++)t=n[i],o.push(this._tagNames[t.toLowerCase()]=e);return o},u.prototype.match=function(e){return e=e.toLowerCase(),this._tagNames[e]?this._tagNames[e]:h.Static},u}(),h.TagNames=function(){var u;function e(){}return u=null,e.get=function(){return u!=null?u:u=new k},e}(),h.Node=function(){function u(){this._bindings={},this._parent=null,this._modified=null}return u.prototype.lastModified=function(){return this._modified},u.prototype.parent=function(){return this._parent},u.prototype.parents=function(){var e,t;for(t=[],e=this._parent;e;)t.push(e),e=e._parent;return t},u.prototype.type=function(){return"Node"},u.prototype.html=function(e){throw new Error("`html` not implemented")},u.prototype.bind=function(e,t){return this._bindings[e]===void 0&&(this._bindings[e]=[]),this._bindings[e].push(t),t},u.prototype.trigger=function(){var e,t,n,i,r,o,s;if(n=arguments[0],e=2<=arguments.length?z.call(arguments,1):[],!!this._bindings[n]){for(o=this._bindings[n],s=[],i=0,r=o.length;i<r;i++)t=o[i],t&&s.push(t.call.apply(t,[this].concat(z.call(e))));return s}},u.prototype.unbind=function(e,t){var n,i,r,o,s,a;if(!e){this._bindings={};return}if(!t){this._bindings[e]=void 0;return}if(!!this._bindings[e]){for(s=this._bindings[e],a=[],n=r=0,o=s.length;r<o;n=++r)i=s[n],i===t?a.push(this._bindings[e].splice(n,1)):a.push(void 0);return a}},u.prototype.commit=function(){return this._modified=null,h.Root.get().trigger("commit",this)},u.prototype.taint=function(){var e,t,n,i,r,o;for(e=Date.now(),this._modified=e,o=this.parents(),i=0,r=o.length;i<r;i++)t=o[i],t._modified=e;return n=h.Root.get(),n._modified=e,n.trigger("taint",this)},u.prototype.closest=function(e){var t;for(t=this.parent();t&&!e(t);)t.parent?t=t.parent():t=null;return t},u.prototype.next=function(){var e,t,n,i,r,o;if(this.children&&this.children.length>0)return this.children[0];for(o=[this].concat(this.parents()),i=0,r=o.length;i<r;i++){if(n=o[i],!n.parent())return null;if(e=n.parent().children,t=e.indexOf(n),t<e.length-1)return e[t+1]}},u.prototype.nextContent=function(){return this.nextWithTest(function(e){return e.content!==void 0})},u.prototype.nextSibling=function(){var e;return e=this.parent().children.indexOf(this),e===this.parent().children.length-1?null:this.parent().children[e+1]},u.prototype.nextWithTest=function(e){var t;for(t=this;t;)if(t=t.next(),t&&e(t))return t},u.prototype.previous=function(){var e,t;if(!this.parent())return null;if(e=this.parent().children,e[0]===this)return this.parent();for(t=e[e.indexOf(this)-1];t.children&&t.children.length;)t=t.children[t.children.length-1];return t},u.prototype.previousContent=function(){return this.previousWithTest(function(e){return e.content!==void 0})},u.prototype.previousSibling=function(){var e;return e=this.parent().children.indexOf(this),e===0?null:this.parent().children[e-1]},u.prototype.previousWithTest=function(e){var t;for(t=this;t;)if(t=t.previous(),t&&e(t))return t},u.extend=function(e){var t,n,i;i=e.prototype;for(t in i)n=i[t],t!=="constructor"&&(this.prototype[t]=n);for(t in e)n=e[t],!(V.call("__super__",t)>=0)&&(this.prototype[t]=n);return this},u.fromDOMElement=function(e){throw new Error("`fromDOMElement` not implemented")},u}(),h.NodeCollection=function(u){M(e,u);function e(){e.__super__.constructor.call(this),this.children=[]}return e.prototype.descendants=function(){var t,n,i;for(t=[],i=this.children.slice();i.length>0;)n=i.shift(),t.push(n),n.children&&n.children.length>0&&(i=n.children.slice().concat(i));return t},e.prototype.isMounted=function(){return!1},e.prototype.type=function(){return"NodeCollection"},e.prototype.attach=function(t,n){return t.parent()&&t.parent().detach(t),t._parent=this,n!==void 0?this.children.splice(n,0,t):this.children.push(t),t.mount&&this.isMounted()&&t.mount(),this.taint(),h.Root.get().trigger("attach",this,t)},e.prototype.commit=function(){var t,n,i,r;for(r=this.descendants(),n=0,i=r.length;n<i;n++)t=r[n],t._modified=null;return this._modified=null,h.Root.get().trigger("commit",this)},e.prototype.detach=function(t){var n;if(n=this.children.indexOf(t),n!==-1)return t.unmount&&this.isMounted()&&t.isMounted()&&t.unmount(),this.children.splice(n,1),t._parent=null,this.taint(),h.Root.get().trigger("detach",this,t)},e}(h.Node),h.Element=function(u){M(e,u);function e(t,n){e.__super__.constructor.call(this),this._tagName=t.toLowerCase(),this._attributes=n||{},this._domElement=null,this._behaviours={drag:!0,drop:!0,merge:!0,remove:!0,resize:!0,spawn:!0}}return e.prototype.attributes=function(){var t,n,i,r;t={},r=this._attributes;for(n in r)i=r[n],t[n]=i;return t},e.prototype.cssTypeName=function(){return"element"},e.prototype.domElement=function(){return this._domElement},e.prototype.isFixed=function(){return this.parent()&&this.parent().type()==="Fixture"},e.prototype.isFocused=function(){return h.Root.get().focused()===this},e.prototype.isMounted=function(){return this._domElement!==null},e.prototype.type=function(){return"Element"},e.prototype.typeName=function(){return"Element"},e.prototype.addCSSClass=function(t){var n;if(n=!1,this.hasCSSClass(t)||(n=!0,this.attr("class")?this.attr("class",""+this.attr("class")+" "+t):this.attr("class",t)),this._addCSSClass(t),n)return this.taint()},e.prototype.attr=function(t,n){return t=t.toLowerCase(),n===void 0?this._attributes[t]:(this._attributes[t]=n,this.isMounted()&&t.toLowerCase()!=="class"&&this._domElement.setAttribute(t,n),this.taint())},e.prototype.blur=function(){var t;if(t=h.Root.get(),this.isFocused())return this._removeCSSClass("ce-element--focused"),t._focused=null,t.trigger("blur",this)},e.prototype.can=function(t,n){return n===void 0?!this.isFixed()&&this._behaviours[t]:this._behaviours[t]=n},e.prototype.clone=function(){var t;return t=document.createElement("div"),t.innerHTML=this.html(),this.constructor.fromDOMElement(t.children[0])},e.prototype.createDraggingDOMElement=function(){var t;if(!!this.isMounted())return t=document.createElement("div"),t.setAttribute("class","ce-drag-helper ce-drag-helper--type-"+this.cssTypeName()),t.setAttribute("data-ce-type",h._(this.typeName())),t},e.prototype.drag=function(t,n){var i;if(!!(this.isMounted()&&this.can("drag")))return i=h.Root.get(),i.startDragging(this,t,n),i.trigger("drag",this)},e.prototype.drop=function(t,n){var i;if(!!this.can("drop")){if(i=h.Root.get(),t){if(t._removeCSSClass("ce-element--drop"),t._removeCSSClass("ce-element--drop-"+n[0]),t._removeCSSClass("ce-element--drop-"+n[1]),this.constructor.droppers[t.type()]){this.constructor.droppers[t.type()](this,t,n),i.trigger("drop",this,t,n);return}else if(t.constructor.droppers[this.type()]){t.constructor.droppers[this.type()](this,t,n),i.trigger("drop",this,t,n);return}}return i.trigger("drop",this,null,null)}},e.prototype.focus=function(t){var n;if(n=h.Root.get(),!this.isFocused())return n.focused()&&n.focused().blur(),this._addCSSClass("ce-element--focused"),n._focused=this,this.isMounted()&&!t&&this.domElement().focus(),n.trigger("focus",this)},e.prototype.hasCSSClass=function(t){var n,i;return!!(this.attr("class")&&(i=function(){var r,o,s,a;for(s=this.attr("class").split(" "),a=[],r=0,o=s.length;r<o;r++)n=s[r],a.push(n);return a}.call(this),i.indexOf(t)>-1))},e.prototype.merge=function(t){if(!(this.can("merge")&&this.can("remove")))return!1;if(this.constructor.mergers[t.type()])return this.constructor.mergers[t.type()](t,this);if(t.constructor.mergers[this.type()])return t.constructor.mergers[this.type()](t,this)},e.prototype.mount=function(){var t;return this._domElement||(this._domElement=document.createElement(this.tagName())),t=this.nextSibling(),t?this.parent().domElement().insertBefore(this._domElement,t.domElement()):this.isFixed()?(this.parent().domElement().parentNode.replaceChild(this._domElement,this.parent().domElement()),this.parent()._domElement=this._domElement):this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._addCSSClass("ce-element"),this._addCSSClass("ce-element--type-"+this.cssTypeName()),this.isFocused()&&this._addCSSClass("ce-element--focused"),h.Root.get().trigger("mount",this)},e.prototype.removeAttr=function(t){if(t=t.toLowerCase(),!!this._attributes[t])return delete this._attributes[t],this.isMounted()&&t.toLowerCase()!=="class"&&this._domElement.removeAttribute(t),this.taint()},e.prototype.removeCSSClass=function(t){var n,i,r;if(!!this.hasCSSClass(t))return r=function(){var o,s,a,c;for(a=this.attr("class").split(" "),c=[],o=0,s=a.length;o<s;o++)n=a[o],c.push(n);return c}.call(this),i=r.indexOf(t),i>-1&&r.splice(i,1),r.length?this.attr("class",r.join(" ")):this.removeAttr("class"),this._removeCSSClass(t),this.taint()},e.prototype.tagName=function(t){return t===void 0?this._tagName:(this._tagName=t.toLowerCase(),this.isMounted()&&(this.unmount(),this.mount()),this.taint())},e.prototype.unmount=function(){if(this._removeDOMEventListeners(),this.isFixed()){this._removeCSSClass("ce-element"),this._removeCSSClass("ce-element--type-"+this.cssTypeName()),this._removeCSSClass("ce-element--focused");return}return this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,h.Root.get().trigger("unmount",this)},e.prototype._addDOMEventListeners=function(){var t,n,i,r;this._domEventHandlers={dragstart:function(o){return function(s){return s.preventDefault()}}(),focus:function(o){return function(s){return s.preventDefault()}}(),keydown:function(o){return function(s){return o._onKeyDown(s)}}(this),keyup:function(o){return function(s){return o._onKeyUp(s)}}(this),mousedown:function(o){return function(s){if(s.button===0)return o._onMouseDown(s)}}(this),mousemove:function(o){return function(s){return o._onMouseMove(s)}}(this),mouseover:function(o){return function(s){return o._onMouseOver(s)}}(this),mouseout:function(o){return function(s){return o._onMouseOut(s)}}(this),mouseup:function(o){return function(s){if(s.button===0)return o._onMouseUp(s)}}(this),dragover:function(o){return function(s){return s.preventDefault()}}(),drop:function(o){return function(s){return o._onNativeDrop(s)}}(this),paste:function(o){return function(s){return o._onPaste(s)}}(this)},i=this._domEventHandlers,r=[];for(n in i)t=i[n],r.push(this._domElement.addEventListener(n,t));return r},e.prototype._onKeyDown=function(t){},e.prototype._onKeyUp=function(t){},e.prototype._onMouseDown=function(t){if(this.focus)return this.focus(!0)},e.prototype._onMouseMove=function(t){return this._onOver(t)},e.prototype._onMouseOver=function(t){return this._onOver(t)},e.prototype._onMouseOut=function(t){var n,i;if(this._removeCSSClass("ce-element--over"),i=h.Root.get(),n=i.dragging(),n)return this._removeCSSClass("ce-element--drop"),this._removeCSSClass("ce-element--drop-above"),this._removeCSSClass("ce-element--drop-below"),this._removeCSSClass("ce-element--drop-center"),this._removeCSSClass("ce-element--drop-left"),this._removeCSSClass("ce-element--drop-right"),i._dropTarget=null},e.prototype._onMouseUp=function(t){return this._ieMouseDownEchoed=!1},e.prototype._onNativeDrop=function(t){return t.preventDefault(),t.stopPropagation(),h.Root.get().trigger("native-drop",this,t)},e.prototype._onPaste=function(t){return t.preventDefault(),t.stopPropagation(),h.Root.get().trigger("paste",this,t)},e.prototype._onOver=function(t){var n,i;if(this._addCSSClass("ce-element--over"),i=h.Root.get(),n=i.dragging(),!!n&&n!==this&&!i._dropTarget&&!!this.can("drop")&&!!(this.constructor.droppers[n.type()]||n.constructor.droppers[this.type()]))return this._addCSSClass("ce-element--drop"),i._dropTarget=this},e.prototype._removeDOMEventListeners=function(){var t,n,i,r;i=this._domEventHandlers,r=[];for(n in i)t=i[n],r.push(this._domElement.removeEventListener(n,t));return r},e.prototype._addCSSClass=function(t){if(!!this.isMounted())return h.addCSSClass(this._domElement,t)},e.prototype._attributesToString=function(){return Object.getOwnPropertyNames(this._attributes).length>0?" "+h.attributesToString(this._attributes):""},e.prototype._removeCSSClass=function(t){if(!!this.isMounted())return h.removeCSSClass(this._domElement,t)},e.droppers={},e.mergers={},e.placements=["above","below"],e.getDOMElementAttributes=function(t){var n,i,r,o,s;if(!t.hasAttributes())return{};for(i={},s=t.attributes,r=0,o=s.length;r<o;r++)n=s[r],i[n.name.toLowerCase()]=n.value;return i},e._dropVert=function(t,n,i){var r;return h.ENABLE_DRAG_CLONING&&window.event.altKey?t=t.clone():t.parent().detach(t),r=n.parent().children.indexOf(n),i[0]==="below"&&(r+=1),n.parent().attach(t,r)},e._dropBoth=function(t,n,i){var r,o,s,a,c,p,g,v;if(h.ENABLE_DRAG_CLONING&&window.event.altKey?t=t.clone():t.parent().detach(t),c=n.parent().children.indexOf(n),i[0]==="below"&&i[1]==="center"&&(c+=1),o=h.ALIGNMENT_CLASS_NAMES.left,s=h.ALIGNMENT_CLASS_NAMES.right,t.a){if(t._removeCSSClass(o),t._removeCSSClass(s),t.a.class){for(r=[],v=t.a.class.split(" "),p=0,g=v.length;p<g;p++)a=v[p],!(a===o||a===s)&&r.push(a);r.length?t.a.class=r.join(" "):delete t.a.class}}else t.removeCSSClass(o),t.removeCSSClass(s);return i[1]==="left"&&(t.a?(t.a.class?t.a.class+=" "+o:t.a.class=o,t._addCSSClass(o)):t.addCSSClass(o)),i[1]==="right"&&(t.a?(t.a.class?t.a.class+=" "+s:t.a.class=s,t._addCSSClass(s)):t.addCSSClass(s)),n.parent().attach(t,c)},e}(h.Node),h.ElementCollection=function(u){M(e,u),e.extend(h.NodeCollection);function e(t,n){e.__super__.constructor.call(this,t,n),h.NodeCollection.prototype.constructor.call(this)}return e.prototype.cssTypeName=function(){return"element-collection"},e.prototype.isMounted=function(){return this._domElement!==null},e.prototype.type=function(){return"ElementCollection"},e.prototype.createDraggingDOMElement=function(){var t,n;if(!!this.isMounted())return t=e.__super__.createDraggingDOMElement.call(this),n=this._domElement.textContent,n.length>h.HELPER_CHAR_LIMIT&&(n=n.substr(0,h.HELPER_CHAR_LIMIT)),t.innerHTML=n,t},e.prototype.detach=function(t){if(h.NodeCollection.prototype.detach.call(this,t),this.children.length===0&&this.parent())return this.parent().detach(this)},e.prototype.html=function(t){var n,i,r,o;return t==null&&(t=""),r=function(){var s,a,c,p;for(c=this.children,p=[],s=0,a=c.length;s<a;s++)i=c[s],p.push(i.html(t+h.INDENT));return p}.call(this),o=h.LINE_ENDINGS,this.isFixed()?r.join(o):(n=this._attributesToString(),""+t+"<"+this.tagName()+n+">"+o+(""+r.join(o)+o)+(""+t+"</"+this.tagName()+">"))},e.prototype.mount=function(){var t,n,i,r,o,s,a,c;this._domElement=document.createElement(this._tagName),s=this._attributes;for(n in s)i=s[n],this._domElement.setAttribute(n,i);for(e.__super__.mount.call(this),a=this.children,c=[],r=0,o=a.length;r<o;r++)t=a[r],c.push(t.mount());return c},e.prototype.unmount=function(){var t,n,i,r;for(r=this.children,n=0,i=r.length;n<i;n++)t=r[n],t.unmount();return e.__super__.unmount.call(this)},e.prototype.blur=void 0,e.prototype.focus=void 0,e}(h.Element),h.ResizableElement=function(u){M(e,u);function e(t,n){e.__super__.constructor.call(this,t,n),this._domSizeInfoElement=null,this._aspectRatio=1}return e.prototype.aspectRatio=function(){return this._aspectRatio},e.prototype.maxSize=function(){var t;return t=parseInt(this.attr("data-ce-max-width")||0),t||(t=h.DEFAULT_MAX_ELEMENT_WIDTH),t=Math.max(t,this.size()[0]),[t,t*this.aspectRatio()]},e.prototype.minSize=function(){var t;return t=parseInt(this.attr("data-ce-min-width")||0),t||(t=h.DEFAULT_MIN_ELEMENT_WIDTH),t=Math.min(t,this.size()[0]),[t,t*this.aspectRatio()]},e.prototype.type=function(){return"ResizableElement"},e.prototype.mount=function(){return e.__super__.mount.call(this),this._domElement.setAttribute("data-ce-size",this._getSizeInfo())},e.prototype.resize=function(t,n,i){if(!!(this.isMounted()&&this.can("resize")))return h.Root.get().startResizing(this,t,n,i,!0)},e.prototype.size=function(t){var n,i,r,o;if(!t)return o=parseInt(this.attr("width")||1),n=parseInt(this.attr("height")||1),[o,n];if(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),r=this.minSize(),t[0]=Math.max(t[0],r[0]),t[1]=Math.max(t[1],r[1]),i=this.maxSize(),t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),this.attr("width",parseInt(t[0])),this.attr("height",parseInt(t[1])),this.isMounted())return this._domElement.style.width=""+t[0]+"px",this._domElement.style.height=""+t[1]+"px",this._domElement.setAttribute("data-ce-size",this._getSizeInfo())},e.prototype._onMouseDown=function(t){var n;return e.__super__._onMouseDown.call(this,t),n=this._getResizeCorner(t.clientX,t.clientY),n?this.resize(n,t.clientX,t.clientY):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(i){return function(){return i.drag(t.pageX,t.pageY)}}(this),150))},e.prototype._onMouseMove=function(t){var n;if(e.__super__._onMouseMove.call(this),!!this.can("resize")&&(this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right"),n=this._getResizeCorner(t.clientX,t.clientY),n))return this._addCSSClass("ce-element--resize-"+n[0]+"-"+n[1])},e.prototype._onMouseOut=function(t){return e.__super__._onMouseOut.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right")},e.prototype._onMouseUp=function(t){if(e.__super__._onMouseUp.call(this),this._dragTimeout)return clearTimeout(this._dragTimeout)},e.prototype._getResizeCorner=function(t,n){var i,r,o,s,a;return o=this._domElement.getBoundingClientRect(),a=[t-o.left,n-o.top],t=a[0],n=a[1],s=this.size(),r=h.RESIZE_CORNER_SIZE,r=Math.min(r,Math.max(parseInt(s[0]/4),1)),r=Math.min(r,Math.max(parseInt(s[1]/4),1)),i=null,t<r?n<r?i=["top","left"]:n>o.height-r&&(i=["bottom","left"]):t>o.width-r&&(n<r?i=["top","right"]:n>o.height-r&&(i=["bottom","right"])),i},e.prototype._getSizeInfo=function(){var t;return t=this.size(),"w "+t[0]+" \xD7 h "+t[1]},e}(h.Element),h.Region=function(u){M(e,u);function e(t){e.__super__.constructor.call(this),this._domElement=t,this.setContent(t)}return e.prototype.domElement=function(){return this._domElement},e.prototype.isMounted=function(){return!0},e.prototype.type=function(){return"Region"},e.prototype.html=function(t){var n,i;return t==null&&(t=""),i=h.LINE_ENDINGS,function(){var r,o,s,a;for(s=this.children,a=[],r=0,o=s.length;r<o;r++)n=s[r],a.push(n.html(t));return a}.call(this).join(i).trim()},e.prototype.setContent=function(t){var n,i,r,o,s,a,c,p,g,v,C,T,w,I;for(a=t,t.childNodes===void 0&&(g=document.createElement("div"),g.innerHTML=t,a=g),I=this.children.slice(),v=0,T=I.length;v<T;v++)i=I[v],this.detach(i);for(p=h.TagNames.get(),o=function(){var R,A,E,l;for(E=a.childNodes,l=[],R=0,A=E.length;R<A;R++)n=E[R],l.push(n);return l}(),C=0,w=o.length;C<w;C++)r=o[C],r.nodeType===1&&(r.getAttribute("data-ce-tag")?s=p.match(r.getAttribute("data-ce-tag")):s=p.match(r.tagName),c=s.fromDOMElement(r),a.removeChild(r),c&&this.attach(c));return h.Root.get().trigger("ready",this)},e}(h.NodeCollection),h.Fixture=function(u){M(e,u);function e(t){var n,i,r;e.__super__.constructor.call(this),this._domElement=t,r=h.TagNames.get(),this._domElement.getAttribute("data-ce-tag")?n=r.match(this._domElement.getAttribute("data-ce-tag")):n=r.match(this._domElement.tagName),i=n.fromDOMElement(this._domElement),this.children=[i],i._parent=this,i.mount(),h.Root.get().trigger("ready",this)}return e.prototype.domElement=function(){return this._domElement},e.prototype.isMounted=function(){return!0},e.prototype.type=function(){return"Fixture"},e.prototype.html=function(t){var n,i;return t==null&&(t=""),i=h.LINE_ENDINGS,function(){var r,o,s,a;for(s=this.children,a=[],r=0,o=s.length;r<o;r++)n=s[r],a.push(n.html(t));return a}.call(this).join(i).trim()},e}(h.NodeCollection),_=function(u){M(e,u);function e(){this._onStopResizing=D(this._onStopResizing,this),this._onResize=D(this._onResize,this),this._onStopDragging=D(this._onStopDragging,this),this._onDrag=D(this._onDrag,this),e.__super__.constructor.call(this),this._focused=null,this._dragging=null,this._dropTarget=null,this._draggingDOMElement=null,this._resizing=null,this._resizingInit=null}return e.prototype.dragging=function(){return this._dragging},e.prototype.dropTarget=function(){return this._dropTarget},e.prototype.focused=function(){return this._focused},e.prototype.resizing=function(){return this._resizing},e.prototype.type=function(){return"Root"},e.prototype.cancelDragging=function(){if(!!this._dragging)return document.body.removeChild(this._draggingDOMElement),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._dragging._removeCSSClass("ce-element--dragging"),this._dragging=null,this._dropTarget=null,h.removeCSSClass(document.body,"ce--dragging")},e.prototype.startDragging=function(t,n,i){if(!this._dragging)return this._dragging=t,this._dragging._addCSSClass("ce-element--dragging"),this._draggingDOMElement=this._dragging.createDraggingDOMElement(),document.body.appendChild(this._draggingDOMElement),this._draggingDOMElement.style.left=""+n+"px",this._draggingDOMElement.style.top=""+i+"px",document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),h.addCSSClass(document.body,"ce--dragging")},e.prototype._getDropPlacement=function(t,n){var i,r,o,s;return this._dropTarget?(r=this._dropTarget.domElement().getBoundingClientRect(),s=[t-r.left,n-r.top],t=s[0],n=s[1],i="center",t<h.DROP_EDGE_SIZE?i="left":t>r.width-h.DROP_EDGE_SIZE&&(i="right"),o="above",n>r.height/2&&(o="below"),[o,i]):null},e.prototype._onDrag=function(t){var n,i,r;if(ContentSelect.Range.unselectAll(),this._draggingDOMElement.style.left=""+t.pageX+"px",this._draggingDOMElement.style.top=""+t.pageY+"px",this._dropTarget&&(n=this._getDropPlacement(t.clientX,t.clientY),this._dropTarget._removeCSSClass("ce-element--drop-above"),this._dropTarget._removeCSSClass("ce-element--drop-below"),this._dropTarget._removeCSSClass("ce-element--drop-center"),this._dropTarget._removeCSSClass("ce-element--drop-left"),this._dropTarget._removeCSSClass("ce-element--drop-right"),i=n[0],V.call(this._dragging.constructor.placements,i)>=0&&this._dropTarget._addCSSClass("ce-element--drop-"+n[0]),r=n[1],V.call(this._dragging.constructor.placements,r)>=0))return this._dropTarget._addCSSClass("ce-element--drop-"+n[1])},e.prototype._onStopDragging=function(t){var n;return n=this._getDropPlacement(t.clientX,t.clientY),this._dragging.drop(this._dropTarget,n),this.cancelDragging()},e.prototype.startResizing=function(t,n,i,r,o){var s,a;if(!this._resizing)return this._resizing=t,this._resizingInit={corner:n,fixed:o,origin:[i,r],size:t.size()},this._resizing._addCSSClass("ce-element--resizing"),a=this._resizing.parent().domElement(),s=document.createElement("div"),s.setAttribute("class","ce-measure"),a.appendChild(s),this._resizingParentWidth=s.getBoundingClientRect().width,a.removeChild(s),document.addEventListener("mousemove",this._onResize),document.addEventListener("mouseup",this._onStopResizing),h.addCSSClass(document.body,"ce--resizing")},e.prototype._onResize=function(t){var n,i,r,o;return ContentSelect.Range.unselectAll(),r=this._resizingInit.origin[0]-t.clientX,this._resizingInit.corner[1]==="right"&&(r=-r),i=this._resizingInit.size[0]+r,i=Math.min(i,this._resizingParentWidth),this._resizingInit.fixed?n=i*this._resizing.aspectRatio():(o=this._resizingInit.origin[1]-t.clientY,this._resizingInit.corner[0]==="bottom"&&(o=-o),n=this._resizingInit.size[1]+o),this._resizing.size([i,n])},e.prototype._onStopResizing=function(t){return document.removeEventListener("mousemove",this._onResize),document.removeEventListener("mouseup",this._onStopResizing),this._resizing._removeCSSClass("ce-element--resizing"),this._resizing=null,this._resizingInit=null,this._resizingParentWidth=null,h.removeCSSClass(document.body,"ce--resizing")},e}(h.Node),h.Root=function(){var u;function e(){}return u=null,e.get=function(){return u!=null?u:u=new _},e}(),h.Static=function(u){M(e,u);function e(t,n,i){e.__super__.constructor.call(this,t,n),this._content=i}return e.prototype.cssTypeName=function(){return"static"},e.prototype.type=function(){return"Static"},e.prototype.typeName=function(){return"Static"},e.prototype.createDraggingDOMElement=function(){var t,n;if(!!this.isMounted())return t=e.__super__.createDraggingDOMElement.call(this),n=this._domElement.textContent,n.length>h.HELPER_CHAR_LIMIT&&(n=n.substr(0,h.HELPER_CHAR_LIMIT)),t.innerHTML=n,t},e.prototype.html=function(t){return t==null&&(t=""),HTMLString.Tag.SELF_CLOSING[this._tagName]?""+t+"<"+this._tagName+this._attributesToString()+">":""+t+"<"+this._tagName+this._attributesToString()+">"+(""+this._content)+(""+t+"</"+this._tagName+">")},e.prototype.mount=function(){var t,n,i;this._domElement=document.createElement(this._tagName),i=this._attributes;for(t in i)n=i[t],this._domElement.setAttribute(t,n);return this._domElement.innerHTML=this._content,e.__super__.mount.call(this)},e.prototype.blur=void 0,e.prototype.focus=void 0,e.prototype._onMouseDown=function(t){if(e.__super__._onMouseDown.call(this,t),this.attr("data-ce-moveable")!==void 0)return clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(n){return function(){return n.drag(t.pageX,t.pageY)}}(this),150)},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._onMouseUp=function(t){if(e.__super__._onMouseUp.call(this,t),this._dragTimeout)return clearTimeout(this._dragTimeout)},e.droppers={Static:h.Element._dropVert},e.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},e}(h.Element),h.TagNames.get().register(h.Static,"static"),h.Text=function(u){M(e,u);function e(t,n,i){e.__super__.constructor.call(this,t,n),i instanceof HTMLString.String?this.content=i:h.TRIM_WHITESPACE?this.content=new HTMLString.String(i).trim():this.content=new HTMLString.String(i,!0)}return e.prototype.cssTypeName=function(){return"text"},e.prototype.type=function(){return"Text"},e.prototype.typeName=function(){return"Text"},e.prototype.blur=function(){return this.isMounted()&&this._syncContent(),this.content.isWhitespace()&&this.can("remove")?this.parent()&&this.parent().detach(this):this.isMounted()&&(!document.documentMode&&!/Edge/.test(navigator.userAgent)&&this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),e.__super__.blur.call(this)},e.prototype.createDraggingDOMElement=function(){var t,n;if(!!this.isMounted())return t=e.__super__.createDraggingDOMElement.call(this),n=HTMLString.String.encode(this._domElement.textContent),n.length>h.HELPER_CHAR_LIMIT&&(n=n.substr(0,h.HELPER_CHAR_LIMIT)),t.innerHTML=n,t},e.prototype.drag=function(t,n){return this.storeState(),this._domElement.removeAttribute("contenteditable"),e.__super__.drag.call(this,t,n)},e.prototype.drop=function(t,n){return e.__super__.drop.call(this,t,n),this.restoreState()},e.prototype.focus=function(t){return this.isMounted()&&this._domElement.setAttribute("contenteditable",""),e.__super__.focus.call(this,t)},e.prototype.html=function(t){var n,i,r;return t==null&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(h.TRIM_WHITESPACE?i=this.content.copy().trim():i=this.content.copy(),i.optimize(),this._lastCached=Date.now(),this._cached=i.html()),r=h.LINE_ENDINGS,n=this._attributesToString(),""+t+"<"+this._tagName+n+">"+r+(""+t+h.INDENT+this._cached+r)+(""+t+"</"+this._tagName+">")},e.prototype.mount=function(){var t,n,i;this._domElement=document.createElement(this._tagName),i=this._attributes;for(t in i)n=i[t],this._domElement.setAttribute(t,n);return this.updateInnerHTML(),e.__super__.mount.call(this)},e.prototype.restoreState=function(){if(!!this._savedSelection){if(!(this.isMounted()&&this.isFocused())){this._savedSelection=void 0;return}return this._domElement.setAttribute("contenteditable",""),this._addCSSClass("ce-element--focused"),document.activeElement!==this.domElement()&&this.domElement().focus(),this._savedSelection.select(this._domElement),this._savedSelection=void 0}},e.prototype.selection=function(t){return t===void 0?this.isMounted()?ContentSelect.Range.query(this._domElement):new ContentSelect.Range(0,0):t.select(this._domElement)},e.prototype.storeState=function(){if(!!(this.isMounted()&&this.isFocused()))return this._savedSelection=ContentSelect.Range.query(this._domElement)},e.prototype.unmount=function(){return this._domElement.removeAttribute("contenteditable"),e.__super__.unmount.call(this)},e.prototype.updateInnerHTML=function(){return this._domElement.innerHTML=this.content.html(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},e.prototype._onKeyDown=function(t){switch(t.keyCode){case 40:return this._keyDown(t);case 37:return this._keyLeft(t);case 39:return this._keyRight(t);case 38:return this._keyUp(t);case 9:return this._keyTab(t);case 8:return this._keyBack(t);case 46:return this._keyDelete(t);case 13:return this._keyReturn(t)}},e.prototype._onKeyUp=function(t){return e.__super__._onKeyUp.call(this,t),this._syncContent()},e.prototype._onMouseDown=function(t){if(e.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(n){return function(){return n.drag(t.pageX,t.pageY)}}(this),h.DRAG_HOLD_DURATION),this.content.length()===0&&h.Root.get().focused()===this)return t.preventDefault(),document.activeElement!==this._domElement&&this._domElement.focus(),new ContentSelect.Range(0,0).select(this._domElement)},e.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.__super__._onMouseMove.call(this,t)},e.prototype._onMouseOut=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.__super__._onMouseOut.call(this,t)},e.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.__super__._onMouseUp.call(this,t)},e.prototype._keyBack=function(t){var n,i;if(i=ContentSelect.Range.query(this._domElement),!!(i.get()[0]===0&&i.isCollapsed())&&(t.preventDefault(),n=this.previousContent(),this._syncContent(),n))return n.merge(this)},e.prototype._keyDelete=function(t){var n,i;if(i=ContentSelect.Range.query(this._domElement),!!(this._atEnd(i)&&i.isCollapsed())&&(t.preventDefault(),n=this.nextContent(),n))return this.merge(n)},e.prototype._keyDown=function(t){return this._keyRight(t)},e.prototype._keyLeft=function(t){var n,i;if(i=ContentSelect.Range.query(this._domElement),!!(i.get()[0]===0&&i.isCollapsed()))return t.preventDefault(),n=this.previousContent(),n?(n.focus(),i=new ContentSelect.Range(n.content.length(),n.content.length()),i.select(n.domElement())):h.Root.get().trigger("previous-region",this.closest(function(r){return r.type()==="Fixture"||r.type()==="Region"}))},e.prototype._keyReturn=function(t){var n,i,r,o,s,a;if(t.preventDefault(),!(this.content.isWhitespace()&&!t.shiftKey^h.PREFER_LINE_BREAKS)){if(o=ContentSelect.Range.query(this._domElement),a=this.content.substring(0,o.get()[0]),s=this.content.substring(o.get()[1]),t.shiftKey^h.PREFER_LINE_BREAKS){i=o.get()[0],r="<br>",this.content.length()===i&&(this.content.length()===0||!this.content.characters[i-1].isTag("br"))&&(r="<br><br>"),this.content=this.content.insert(i,new HTMLString.String(r,!0),!0),this.updateInnerHTML(),i+=1,o=new ContentSelect.Range(i,i),o.select(this.domElement()),this.taint();return}if(!!this.can("spawn"))return this.content=a.trim(),this.updateInnerHTML(),n=new this.constructor("p",{},s.trim()),this.parent().attach(n,this.parent().children.indexOf(this)+1),a.length()?(n.focus(),o=new ContentSelect.Range(0,0),o.select(n.domElement())):(o=new ContentSelect.Range(0,a.length()),o.select(this._domElement)),this.taint()}},e.prototype._keyRight=function(t){var n,i;if(i=ContentSelect.Range.query(this._domElement),!!(this._atEnd(i)&&i.isCollapsed()))return t.preventDefault(),n=this.nextContent(),n?(n.focus(),i=new ContentSelect.Range(0,0),i.select(n.domElement())):h.Root.get().trigger("next-region",this.closest(function(r){return r.type()==="Fixture"||r.type()==="Region"}))},e.prototype._keyTab=function(t){if(t.preventDefault(),this.isFixed())return t.shiftKey?h.Root.get().trigger("previous-region",this.closest(function(n){return n.type()==="Fixture"||n.type()==="Region"})):h.Root.get().trigger("next-region",this.closest(function(n){return n.type()==="Fixture"||n.type()==="Region"}))},e.prototype._keyUp=function(t){return this._keyLeft(t)},e.prototype._atEnd=function(t){return t.get()[0]>=this.content.length()},e.prototype._flagIfEmpty=function(){return this.content.length()===0?this._addCSSClass("ce-element--empty"):this._removeCSSClass("ce-element--empty")},e.prototype._syncContent=function(t){var n,i;return i=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML,this.content.preserveWhitespace()),n=this.content.html(),i!==n&&this.taint(),this._flagIfEmpty()},e.droppers={Static:h.Element._dropVert,Text:h.Element._dropVert},e.mergers={Text:function(t,n){var i;return i=n.content.length(),t.content.length()&&(n.content=n.content.concat(t.content)),n.isMounted()&&n.updateInnerHTML(),n.focus(),new ContentSelect.Range(i,i).select(n._domElement),t.parent()&&t.parent().detach(t),n.taint()}},e.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML.replace(/^\s+|\s+$/g,""))},e}(h.Element),h.TagNames.get().register(h.Text,"address","blockquote","h1","h2","h3","h4","h5","h6","p"),h.PreText=function(u){M(e,u),e.TAB_INDENT="    ";function e(t,n,i){i instanceof HTMLString.String?this.content=i:this.content=new HTMLString.String(i,!0),h.Element.call(this,t,n)}return e.prototype.cssTypeName=function(){return"pre-text"},e.prototype.type=function(){return"PreText"},e.prototype.typeName=function(){return"Preformatted"},e.prototype.blur=function(){return this.isMounted()&&(this._domElement.innerHTML=this.content.html()),e.__super__.blur.call(this)},e.prototype.html=function(t){var n;return t==null&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(n=this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+t+"<"+this._tagName+this._attributesToString()+">"+(""+this._cached+"</"+this._tagName+">")},e.prototype.updateInnerHTML=function(){var t;return t=this.content.html(),this._domElement.innerHTML=t,this._ensureEndZWS(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},e.prototype._keyBack=function(t){var n;return n=ContentSelect.Range.query(this._domElement),n.get()[0]<=this.content.length()?e.__super__._keyBack.call(this,t):(n.set(this.content.length(),this.content.length()),n.select(this._domElement))},e.prototype._keyReturn=function(t){var n,i,r,o;return t.preventDefault(),i=ContentSelect.Range.query(this._domElement),n=i.get()[0]+1,i.get()[0]===0&&i.isCollapsed()?this.content=new HTMLString.String(`
`,!0).concat(this.content):this._atEnd(i)&&i.isCollapsed()?this.content=this.content.concat(new HTMLString.String(`
`,!0)):i.get()[0]===0&&i.get()[1]===this.content.length()?(this.content=new HTMLString.String(`
`,!0),n=0):(o=this.content.substring(0,i.get()[0]),r=this.content.substring(i.get()[1]),this.content=o.concat(new HTMLString.String(`
`,!0),r)),this.updateInnerHTML(),i.set(n,n),i.select(this._domElement),this.taint()},e.prototype._keyTab=function(t){var n,i,r,o,s,a,c,p,g,v,C,T,w,I,R,A,E,l,d,f,m,y,S,b,L,x;for(t.preventDefault(),n=this.content.length(),g=h.PreText.TAB_INDENT,p=g.length,w=this.content.split(`
`),I=this.selection().get(),I[0]=Math.min(I[0],n),I[1]=Math.min(I[1],n),r=0,E=-1,o=-1,a=f=0,b=w.length;f<b&&(C=w[a],T=C.length()+1,I[0]<r+T&&E===-1&&(E=a),I[1]<r+T&&o===-1&&(o=a),!(E>-1&&o>-1));a=++f)r+=T;if(E===o)p-=(I[0]-r)%p,c=new HTMLString.String(Array(p+1).join(" "),!0),d=w[E].substring(0,I[0]-r),l=w[E].substring(I[1]-r),w[E]=d.concat(c,l),A=p;else if(t.shiftKey){for(s=0,a=m=E;E<=o?m<=o:m>=o;a=E<=o?++m:--m){for(x=w[a].characters.slice(),v=y=0,L=x.length;y<L&&(i=x[v],!(v>p-1||!i.isWhitespace()));v=++y)w[a].characters.shift();a===E&&(s=v)}A=Math.max(-p,-s)}else{for(c=new HTMLString.String(g,!0),a=S=E;E<=o?S<=o:S>=o;a=E<=o?++S:--S)w[a]=c.concat(w[a]);A=p}return this.content=HTMLString.String.join(new HTMLString.String(`
`,!0),w),this.updateInnerHTML(),R=this.content.length()-n,new ContentSelect.Range(I[0]+A,I[1]+R).select(this._domElement)},e.prototype._syncContent=function(t){var n,i;return this._ensureEndZWS(),i=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML.replace(/\u200B$/g,""),this.content.preserveWhitespace()),n=this.content.html(),i!==n&&this.taint(),this._flagIfEmpty()},e.prototype._ensureEndZWS=function(){var t,n;if(!!this._domElement.lastChild&&(t=this._domElement.innerHTML,!(t[t.length-1]==="\u200B"&&t.indexOf("\u200B")<t.length-1)))return n=function(i){return function(){return t.indexOf("\u200B")>-1&&(i._domElement.innerHTML=t.replace(/\u200B/g,"")),i._domElement.lastChild.textContent+="\u200B"}}(this),this._savedSelection?n():(this.storeState(),n(),this.restoreState())},e.droppers={PreText:h.Element._dropVert,Static:h.Element._dropVert,Text:h.Element._dropVert},e.mergers={},e.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},e}(h.Text),h.TagNames.get().register(h.PreText,"pre"),h.Image=function(u){M(e,u);function e(t,n){var i;e.__super__.constructor.call(this,"img",t),this.a=n||null,i=this.size(),this._aspectRatio=i[1]/i[0]}return e.prototype.cssTypeName=function(){return"image"},e.prototype.type=function(){return"Image"},e.prototype.typeName=function(){return"Image"},e.prototype.createDraggingDOMElement=function(){var t;if(!!this.isMounted())return t=e.__super__.createDraggingDOMElement.call(this),t.style.backgroundImage="url('"+this._attributes.src+"')",t},e.prototype.html=function(t){var n,i,r;return t==null&&(t=""),i=""+t+"<img"+this._attributesToString()+">",this.a?(r=h.LINE_ENDINGS,n=h.attributesToString(this.a),n=""+n+' data-ce-tag="img"',""+t+"<a "+n+">"+r+(""+h.INDENT+i+r)+(""+t+"</a>")):i},e.prototype.mount=function(){var t,n;return this._domElement=document.createElement("div"),t="",this.a&&this.a.class&&(t+=" "+this.a.class),this._attributes.class&&(t+=" "+this._attributes.class),this._domElement.setAttribute("class",t),n=this._attributes.style?this._attributes.style:"",n+="background-image:url('"+this._attributes.src+"');",this._attributes.width&&(n+="width:"+this._attributes.width+"px;"),this._attributes.height&&(n+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",n),e.__super__.mount.call(this)},e.prototype.unmount=function(){var t,n;return this.isFixed()&&(n=document.createElement("div"),n.innerHTML=this.html(),t=n.querySelector("a, img"),this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t),e.__super__.unmount.call(this)},e.droppers={Image:h.Element._dropBoth,PreText:h.Element._dropBoth,Static:h.Element._dropBoth,Text:h.Element._dropBoth},e.placements=["above","below","left","right","center"],e.fromDOMElement=function(t){var n,i,r,o,s,a,c,p,g;if(n=null,t.tagName.toLowerCase()==="a"){for(n=this.getDOMElementAttributes(t),s=function(){var v,C,T,w;for(T=t.childNodes,w=[],v=0,C=T.length;v<C;v++)r=T[v],w.push(r);return w}(),p=0,g=s.length;p<g;p++)if(o=s[p],o.nodeType===1&&o.tagName.toLowerCase()==="img"){t=o;break}t.tagName.toLowerCase()==="a"&&(t=document.createElement("img"))}return i=this.getDOMElementAttributes(t),c=i.width,a=i.height,i.width===void 0&&(i.height===void 0?c=t.naturalWidth:c=t.clientWidth),i.height===void 0&&(i.width===void 0?a=t.naturalHeight:a=t.clientHeight),i.width=c,i.height=a,new this(i,n)},e}(h.ResizableElement),h.TagNames.get().register(h.Image,"img"),h.ImageFixture=function(u){M(e,u);function e(t,n,i){e.__super__.constructor.call(this,t,n),this._src=i}return e.prototype.cssTypeName=function(){return"image-fixture"},e.prototype.type=function(){return"ImageFixture"},e.prototype.typeName=function(){return"ImageFixture"},e.prototype.html=function(t){var n,i,r,o;return t==null&&(t=""),o=h.LINE_ENDINGS,i=this._attributesToString(),n="",this._attributes.alt!==void 0&&(n='alt="'+this._attributes.alt+'"'),r=""+t+'<img src="'+this.src()+'"'+n+">",""+t+"<"+this.tagName()+" "+i+">"+o+(""+h.INDENT+r+o)+(""+t+"</"+this.tagName()+">")},e.prototype.mount=function(){var t,n,i,r,o,s;this._domElement=document.createElement(this.tagName()),s=this._attributes;for(n in s)o=s[n],!(n==="alt"||n==="style")&&this._domElement.setAttribute(n,o);return t="",this.a&&this.a.class&&(t+=" "+this.a.class),this._attributes.class&&(t+=" "+this._attributes.class),this._domElement.setAttribute("class",t),i=this._attributes.style?this._attributes.style:"",r=document.createElement("div"),r.setAttribute("style",i.trim()),r.style.backgroundImage=null,i=r.getAttribute("style"),i=[i.trim(),"background-image:url('"+this.src()+"');"].join(" "),this._domElement.setAttribute("style",i.trim()),e.__super__.mount.call(this)},e.prototype.src=function(t){return t===void 0?this._src:(this._src=t,this.isMounted()&&(this.unmount(),this.mount()),this.taint())},e.prototype.unmount=function(){var t,n;return this.isFixed()?(n=document.createElement("div"),n.innerHTML=this.html(),t=n.firstElementChild,this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t,this.parent()._domElement=this._domElement):e.__super__.unmount.call(this)},e.prototype._attributesToString=function(){var t,n,i,r,o,s;this._attributes.style?(i=this._attributes.style?this._attributes.style:"",r=document.createElement("div"),r.setAttribute("style",i.trim()),r.style.backgroundImage=null,i=r.getAttribute("style"),i=[i.trim(),"background-image:url('"+this.src()+"');"].join(" "),this._attributes.style=i.trim()):this._attributes.style="background-image:url('"+this.src()+"');",t={},s=this._attributes;for(n in s)o=s[n],n!=="alt"&&(t[n]=o);return" "+h.attributesToString(t)},e.droppers={ImageFixture:h.Element._dropVert,Image:h.Element._dropVert,PreText:h.Element._dropVert,Text:h.Element._dropVert},e.fromDOMElement=function(t){var n,i,r,o,s,a,c,p;for(i=this.getDOMElementAttributes(t),a="",n="",s=function(){var g,v,C,T;for(C=t.childNodes,T=[],g=0,v=C.length;g<v;g++)r=C[g],T.push(r);return T}(),c=0,p=s.length;c<p;c++)if(o=s[c],o.nodeType===1&&o.tagName.toLowerCase()==="img"){a=o.getAttribute("src")||"",n=o.getAttribute("alt")||"";break}return i=this.getDOMElementAttributes(t),i.alt=n,new this(t.tagName,i,a)},e}(h.Element),h.TagNames.get().register(h.ImageFixture,"img-fixture"),h.Video=function(u){M(e,u);function e(t,n,i){var r;i==null&&(i=[]),e.__super__.constructor.call(this,t,n),this.sources=i,r=this.size(),this._aspectRatio=r[1]/r[0]}return e.prototype.cssTypeName=function(){return"video"},e.prototype.type=function(){return"Video"},e.prototype.typeName=function(){return"Video"},e.prototype._title=function(){var t;return t="",this.attr("src")?t=this.attr("src"):this.sources.length&&(t=this.sources[0].src),t||(t="No video source set"),t.length>80&&(t=t.substr(0,80)+"..."),t},e.prototype.createDraggingDOMElement=function(){var t;if(!!this.isMounted())return t=e.__super__.createDraggingDOMElement.call(this),t.innerHTML=this._title(),t},e.prototype.html=function(t){var n,i,r,o,s,a,c;if(t==null&&(t=""),i=h.LINE_ENDINGS,this.tagName()==="video"){for(o=[],c=this.sources,s=0,a=c.length;s<a;s++)r=c[s],n=h.attributesToString(r),o.push(""+t+h.INDENT+"<source "+n+">");return""+t+"<video"+this._attributesToString()+">"+i+o.join(i)+(""+i+t+"</video>")}else return""+t+"<"+this._tagName+this._attributesToString()+">"+("</"+this._tagName+">")},e.prototype.mount=function(){var t;return this._domElement=document.createElement("div"),this.a&&this.a.class?this._domElement.setAttribute("class",this.a.class):this._attributes.class&&this._domElement.setAttribute("class",this._attributes.class),t=this._attributes.style?this._attributes.style:"",this._attributes.width&&(t+="width:"+this._attributes.width+"px;"),this._attributes.height&&(t+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",t),this._domElement.setAttribute("data-ce-title",this._title()),e.__super__.mount.call(this)},e.prototype.unmount=function(){var t,n;return this.isFixed()&&(n=document.createElement("div"),n.innerHTML=this.html(),t=n.querySelector("iframe"),this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t),e.__super__.unmount.call(this)},e.droppers={Image:h.Element._dropBoth,PreText:h.Element._dropBoth,Static:h.Element._dropBoth,Text:h.Element._dropBoth,Video:h.Element._dropBoth},e.placements=["above","below","left","right","center"],e.fromDOMElement=function(t){var n,i,r,o,s,a;for(r=function(){var c,p,g,v;for(g=t.childNodes,v=[],c=0,p=g.length;c<p;c++)n=g[c],v.push(n);return v}(),o=[],s=0,a=r.length;s<a;s++)i=r[s],i.nodeType===1&&i.tagName.toLowerCase()==="source"&&o.push(this.getDOMElementAttributes(i));return new this(t.tagName,this.getDOMElementAttributes(t),o)},e}(h.ResizableElement),h.TagNames.get().register(h.Video,"iframe","video"),h.List=function(u){M(e,u);function e(t,n){e.__super__.constructor.call(this,t,n)}return e.prototype.cssTypeName=function(){return"list"},e.prototype.type=function(){return"List"},e.prototype.typeName=function(){return"List"},e.prototype._onMouseOver=function(t){if(this.parent().type()!=="ListItem")return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.droppers={Image:h.Element._dropBoth,ImageFixture:h.Element._dropVert,List:h.Element._dropVert,PreText:h.Element._dropVert,Static:h.Element._dropVert,Text:h.Element._dropVert,Video:h.Element._dropBoth},e.fromDOMElement=function(t){var n,i,r,o,s,a;for(o=new this(t.tagName,this.getDOMElementAttributes(t)),r=function(){var c,p,g,v;for(g=t.childNodes,v=[],c=0,p=g.length;c<p;c++)n=g[c],v.push(n);return v}(),s=0,a=r.length;s<a;s++)i=r[s],i.nodeType===1&&i.tagName.toLowerCase()==="li"&&o.attach(h.ListItem.fromDOMElement(i));return o.children.length===0?null:o},e}(h.ElementCollection),h.TagNames.get().register(h.List,"ol","ul"),h.ListItem=function(u){M(e,u);function e(t){e.__super__.constructor.call(this,"li",t),this._behaviours.indent=!0}return e.prototype.cssTypeName=function(){return"list-item"},e.prototype.list=function(){return this.children.length===2?this.children[1]:null},e.prototype.listItemText=function(){return this.children.length>0?this.children[0]:null},e.prototype.type=function(){return"ListItem"},e.prototype.html=function(t){var n;return t==null&&(t=""),n=[""+t+"<li"+this._attributesToString()+">"],this.listItemText()&&n.push(this.listItemText().html(t+h.INDENT)),this.list()&&n.push(this.list().html(t+h.INDENT)),n.push(""+t+"</li>"),n.join(h.LINE_ENDINGS)},e.prototype.indent=function(){var t;if(!!this.can("indent")&&this.parent().children.indexOf(this)!==0)return t=this.previousSibling(),t.list()||t.attach(new h.List(t.parent().tagName())),this.listItemText().storeState(),this.parent().detach(this),t.list().attach(this),this.listItemText().restoreState()},e.prototype.remove=function(){var t,n,i,r,o,s;if(!!this.parent()){if(i=this.parent().children.indexOf(this),this.list())for(s=this.list().children.slice(),n=r=0,o=s.length;r<o;n=++r)t=s[n],t.parent().detach(t),this.parent().attach(t,n+i);return this.parent().detach(this)}},e.prototype.unindent=function(){var t,n,i,r,o,s,a,c,p,g,v,C,T,w,I,R,A,E,l,d,f;if(!!this.can("indent"))if(s=this.parent(),n=s.parent(),g=s.children.slice(s.children.indexOf(this)+1,s.children.length),n.type()==="ListItem"){for(this.listItemText().storeState(),s.detach(this),n.parent().attach(this,n.parent().children.indexOf(n)+1),g.length&&!this.list()&&this.attach(new h.List(s.tagName())),C=0,R=g.length;C<R;C++)p=g[C],p.parent().detach(p),this.list().attach(p);return this.listItemText().restoreState()}else{if(v=new h.Text("p",this.attr("class")?{class:this.attr("class")}:{},this.listItemText().content),c=null,this.listItemText().isFocused()&&(c=ContentSelect.Range.query(this.listItemText().domElement())),a=n.children.indexOf(s),r=s.children.indexOf(this),r===0){if(o=null,s.children.length===1?(this.list()&&(o=new h.List(s.tagName())),n.detach(s)):s.detach(this),n.attach(v,a),o&&n.attach(o,a+1),this.list())for(d=this.list().children.slice(),i=T=0,A=d.length;T<A;i=++T)t=d[i],t.parent().detach(t),o?o.attach(t):s.attach(t,i)}else if(r===s.children.length-1)s.detach(this),n.attach(v,a+1),this.list()&&n.attach(this.list(),a+2);else{if(s.detach(this),n.attach(v,a+1),o=new h.List(s.tagName()),n.attach(o,a+2),this.list())for(f=this.list().children.slice(),w=0,E=f.length;w<E;w++)t=f[w],t.parent().detach(t),o.attach(t);for(I=0,l=g.length;I<l;I++)p=g[I],p.parent().detach(p),o.attach(p)}if(c)return v.focus(),c.select(v.domElement())}},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._addDOMEventListeners=function(){},e.prototype._removeDOMEventListners=function(){},e.fromDOMElement=function(t){var n,i,r,o,s,a,c,p,g,v;for(s=new this(this.getDOMElementAttributes(t)),i="",r=null,g=t.childNodes,c=0,p=g.length;c<p;c++)n=g[c],n.nodeType===1?(v=n.tagName.toLowerCase())==="ul"||v==="ol"||v==="li"?r||(r=n):i+=n.outerHTML:i+=HTMLString.String.encode(n.textContent);return i=i.replace(/^\s+|\s+$/g,""),a=new h.ListItemText(i),s.attach(a),r&&(o=h.List.fromDOMElement(r),s.attach(o)),s},e}(h.ElementCollection),h.ListItemText=function(u){M(e,u);function e(t){e.__super__.constructor.call(this,"div",{},t)}return e.prototype.cssTypeName=function(){return"list-item-text"},e.prototype.type=function(){return"ListItemText"},e.prototype.typeName=function(){return"List item"},e.prototype.blur=function(){return this.content.isWhitespace()&&this.can("remove")?this.parent().remove():this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),h.Element.prototype.blur.call(this)},e.prototype.can=function(t,n){if(n)throw new Error("Cannot set behaviour for ListItemText");return this.parent().can(t)},e.prototype.html=function(t){var n;return t==null&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(h.TRIM_WHITESPACE?n=this.content.copy().trim():n=this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+t+this._cached},e.prototype._onMouseDown=function(t){var n;return h.Element.prototype._onMouseDown.call(this,t),n=function(i){return function(){var r;return h.Root.get().dragging()===i?(h.Root.get().cancelDragging(),r=i.closest(function(o){return o.parent().type()==="Region"}),r.drag(t.pageX,t.pageY)):(i.drag(t.pageX,t.pageY),i._dragTimeout=setTimeout(n,h.DRAG_HOLD_DURATION*2))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(n,h.DRAG_HOLD_DURATION)},e.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),h.Element.prototype._onMouseMove.call(this,t)},e.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),h.Element.prototype._onMouseUp.call(this,t)},e.prototype._keyTab=function(t){return t.preventDefault(),t.shiftKey?this.parent().unindent():this.parent().indent()},e.prototype._keyReturn=function(t){var n,i,r,o,s,a;if(t.preventDefault(),this.content.isWhitespace()){this.parent().unindent();return}if(!!this.can("spawn")){if(ContentSelect.Range.query(this._domElement),o=ContentSelect.Range.query(this._domElement),a=this.content.substring(0,o.get()[0]),s=this.content.substring(o.get()[1]),a.length()+s.length()===0){this.parent().unindent();return}return this.content=a.trim(),this.updateInnerHTML(),n=this.parent().parent(),r=new h.ListItem(this.attr("class")?{class:this.attr("class")}:{}),n.attach(r,n.children.indexOf(this.parent())+1),r.attach(new h.ListItemText(s.trim())),i=this.parent().list(),i&&(this.parent().detach(i),r.attach(i)),a.length()?(r.listItemText().focus(),o=new ContentSelect.Range(0,0),o.select(r.listItemText().domElement())):(o=new ContentSelect.Range(0,a.length()),o.select(this._domElement)),this.taint()}},e.droppers={ListItemText:function(t,n,i){var r,o,s,a;if(r=t.parent(),a=n.parent(),r.remove(),r.detach(t),s=new h.ListItem(r._attributes),s.attach(t),a.list()&&i[0]==="below"){a.list().attach(s,0);return}return o=a.parent().children.indexOf(a),i[0]==="below"&&(o+=1),a.parent().attach(s,o)},Text:function(t,n,i){var r,o,s,a,c;if(t.type()==="Text"){if(a=n.parent(),t.parent().detach(t),r=t.attr("class"),s=new h.ListItem(r?{class:r}:{}),s.attach(new h.ListItemText(t.content)),a.list()&&i[0]==="below"){a.list().attach(s,0);return}if(o=a.parent().children.indexOf(a),i[0]==="below"&&(o+=1),a.parent().attach(s,o),s.listItemText().focus(),t._savedSelection)return t._savedSelection.select(s.listItemText().domElement())}else if(r=t.attr("class"),c=new h.Text("p",r?{class:r}:{},t.content),t.parent().remove(),o=n.parent().children.indexOf(n),i[0]==="below"&&(o+=1),n.parent().attach(c,o),c.focus(),t._savedSelection)return t._savedSelection.select(c.domElement())}},e.mergers={ListItemText:function(t,n){var i;return i=n.content.length(),t.content.length()&&(n.content=n.content.concat(t.content)),n.isMounted()&&(n._domElement.innerHTML=n.content.html()),n.focus(),new ContentSelect.Range(i,i).select(n._domElement),t.type()==="Text"?t.parent()&&t.parent().detach(t):t.parent().remove(),n.taint()}},e}(h.Text),P=h.ListItemText.mergers,P.Text=P.ListItemText,h.Table=function(u){M(e,u);function e(t){e.__super__.constructor.call(this,"table",t)}return e.prototype.cssTypeName=function(){return"table"},e.prototype.typeName=function(){return"Table"},e.prototype.type=function(){return"Table"},e.prototype.firstSection=function(){var t;return(t=this.thead())||(t=this.tbody())||(t=this.tfoot())?t:null},e.prototype.lastSection=function(){var t;return(t=this.tfoot())||(t=this.tbody())||(t=this.thead())?t:null},e.prototype.tbody=function(){return this._getChild("tbody")},e.prototype.tfoot=function(){return this._getChild("tfoot")},e.prototype.thead=function(){return this._getChild("thead")},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._getChild=function(t){var n,i,r,o;for(o=this.children,i=0,r=o.length;i<r;i++)if(n=o[i],n.tagName()===t)return n;return null},e.droppers={Image:h.Element._dropBoth,ImageFixture:h.Element._dropVert,List:h.Element._dropVert,PreText:h.Element._dropVert,Static:h.Element._dropVert,Table:h.Element._dropVert,Text:h.Element._dropVert,Video:h.Element._dropBoth},e.fromDOMElement=function(t){var n,i,r,o,s,a,c,p,g,v,C,T;for(c=new this(this.getDOMElementAttributes(t)),r=function(){var w,I,R,A;for(R=t.childNodes,A=[],w=0,I=R.length;w<I;w++)n=R[w],A.push(n);return A}(),o=[],g=0,C=r.length;g<C;g++)if(i=r[g],i.nodeType===1&&(p=i.tagName.toLowerCase(),!c._getChild(p)))switch(p){case"tbody":case"tfoot":case"thead":a=h.TableSection.fromDOMElement(i),c.attach(a);break;case"tr":o.push(h.TableRow.fromDOMElement(i))}if(o.length>0)for(c._getChild("tbody")||c.attach(new h.TableSection("tbody")),v=0,T=o.length;v<T;v++)s=o[v],c.tbody().attach(s);return c.children.length===0?null:c},e}(h.ElementCollection),h.TagNames.get().register(h.Table,"table"),h.TableSection=function(u){M(e,u);function e(t,n){e.__super__.constructor.call(this,t,n)}return e.prototype.cssTypeName=function(){return"table-section"},e.prototype.type=function(){return"TableSection"},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.fromDOMElement=function(t){var n,i,r,o,s,a;for(o=new this(t.tagName,this.getDOMElementAttributes(t)),r=function(){var c,p,g,v;for(g=t.childNodes,v=[],c=0,p=g.length;c<p;c++)n=g[c],v.push(n);return v}(),s=0,a=r.length;s<a;s++)i=r[s],i.nodeType===1&&i.tagName.toLowerCase()==="tr"&&o.attach(h.TableRow.fromDOMElement(i));return o},e}(h.ElementCollection),h.TableRow=function(u){M(e,u);function e(t){e.__super__.constructor.call(this,"tr",t)}return e.prototype.cssTypeName=function(){return"table-row"},e.prototype.isEmpty=function(){var t,n,i,r,o;for(o=this.children,i=0,r=o.length;i<r;i++)if(t=o[i],n=t.tableCellText(),n&&n.content.length()>0)return!1;return!0},e.prototype.type=function(){return"TableRow"},e.prototype.typeName=function(){return"Table row"},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.droppers={TableRow:h.Element._dropVert},e.fromDOMElement=function(t){var n,i,r,o,s,a,c;for(o=new this(this.getDOMElementAttributes(t)),r=function(){var p,g,v,C;for(v=t.childNodes,C=[],p=0,g=v.length;p<g;p++)n=v[p],C.push(n);return C}(),a=0,c=r.length;a<c;a++)i=r[a],i.nodeType===1&&(s=i.tagName.toLowerCase(),(s==="td"||s==="th")&&o.attach(h.TableCell.fromDOMElement(i)));return o},e}(h.ElementCollection),h.TableCell=function(u){M(e,u);function e(t,n){e.__super__.constructor.call(this,t,n)}return e.prototype.cssTypeName=function(){return"table-cell"},e.prototype.tableCellText=function(){return this.children.length>0?this.children[0]:null},e.prototype.type=function(){return"TableCell"},e.prototype.html=function(t){var n;return t==null&&(t=""),n=[""+t+"<"+this.tagName()+this._attributesToString()+">"],this.tableCellText()&&n.push(this.tableCellText().html(t+h.INDENT)),n.push(""+t+"</"+this.tagName()+">"),n.join(h.LINE_ENDINGS)},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._addDOMEventListeners=function(){},e.prototype._removeDOMEventListners=function(){},e.fromDOMElement=function(t){var n,i;return n=new this(t.tagName,this.getDOMElementAttributes(t)),i=new h.TableCellText(t.innerHTML.replace(/^\s+|\s+$/g,"")),n.attach(i),n},e}(h.ElementCollection),h.TableCellText=function(u){M(e,u);function e(t){e.__super__.constructor.call(this,"div",{},t)}return e.prototype.cssTypeName=function(){return"table-cell-text"},e.prototype.type=function(){return"TableCellText"},e.prototype._isInFirstRow=function(){var t,n,i,r;return t=this.parent(),n=t.parent(),i=n.parent(),r=i.parent(),i!==r.firstSection()?!1:n===i.children[0]},e.prototype._isInLastRow=function(){var t,n,i,r;return t=this.parent(),n=t.parent(),i=n.parent(),r=i.parent(),i!==r.lastSection()?!1:n===i.children[i.children.length-1]},e.prototype._isLastInSection=function(){var t,n,i;return t=this.parent(),n=t.parent(),i=n.parent(),n!==i.children[i.children.length-1]?!1:t===n.children[n.children.length-1]},e.prototype.blur=function(){return this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),h.Element.prototype.blur.call(this)},e.prototype.can=function(t,n){if(n)throw new Error("Cannot set behaviour for ListItemText");return this.parent().can(t)},e.prototype.html=function(t){var n;return t==null&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(h.TRIM_WHITESPACE?n=this.content.copy().trim():n=this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+t+this._cached},e.prototype._onMouseDown=function(t){var n;return h.Element.prototype._onMouseDown.call(this,t),n=function(i){return function(){var r,o;return r=i.parent(),h.Root.get().dragging()===r.parent()?(h.Root.get().cancelDragging(),o=r.parent().parent().parent(),o.drag(t.pageX,t.pageY)):(r.parent().drag(t.pageX,t.pageY),i._dragTimeout=setTimeout(n,h.DRAG_HOLD_DURATION*2))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(n,h.DRAG_HOLD_DURATION)},e.prototype._keyBack=function(t){var n,i,r,o;if(o=ContentSelect.Range.query(this._domElement),!!(o.get()[0]===0&&o.isCollapsed())&&(t.preventDefault(),n=this.parent(),r=n.parent(),!!(r.isEmpty()&&r.can("remove"))&&this.content.length()===0&&r.children.indexOf(n)===0))return i=this.previousContent(),i&&(i.focus(),o=new ContentSelect.Range(i.content.length(),i.content.length()),o.select(i.domElement())),r.parent().detach(r)},e.prototype._keyDelete=function(t){var n,i,r,o;if(r=this.parent().parent(),!!(r.isEmpty()&&r.can("remove")))return t.preventDefault(),n=r.children[r.children.length-1],i=n.tableCellText().nextContent(),i&&(i.focus(),o=new ContentSelect.Range(0,0),o.select(i.domElement())),r.parent().detach(r)},e.prototype._keyDown=function(t){var n,i,r,o,s,a,c;if(c=ContentSelect.Range.query(this._domElement),!!(this._atEnd(c)&&c.isCollapsed()))return t.preventDefault(),n=this.parent(),this._isInLastRow()?(a=n.parent(),r=a.children[a.children.length-1].tableCellText(),o=r.nextContent(),o?o.focus():h.Root.get().trigger("next-region",this.closest(function(p){return p.type()==="Fixture"||p.type()==="Region"}))):(s=n.parent().nextWithTest(function(p){return p.type()==="TableRow"}),i=n.parent().children.indexOf(n),i=Math.min(i,s.children.length),s.children[i].tableCellText().focus())},e.prototype._keyReturn=function(t){return t.preventDefault(),this._keyTab({shiftKey:!1,preventDefault:function(){}})},e.prototype._keyTab=function(t){var n,i,r,o,s,a,c,p,g,v;if(t.preventDefault(),n=this.parent(),t.shiftKey)return this._isInFirstRow()&&n.parent().children[0]===n?void 0:this.previousContent().focus();if(!this.can("spawn"))return;if(r=n.parent().parent(),r.tagName()==="tbody"&&this._isLastInSection()){for(a=new h.TableRow,v=n.parent().children,p=0,g=v.length;p<g;p++)i=v[p],o=new h.TableCell(i.tagName(),i._attributes),s=new h.TableCellText(""),o.attach(s),a.attach(o);return c=this.closest(function(C){return C.type()==="TableSection"}),c.attach(a),a.children[0].tableCellText().focus()}else return this.nextContent().focus()},e.prototype._keyUp=function(t){var n,i,r,o,s,a;if(a=ContentSelect.Range.query(this._domElement),!!(a.get()[0]===0&&a.isCollapsed()))return t.preventDefault(),n=this.parent(),this._isInFirstRow()?(s=n.parent(),r=s.children[0].previousContent(),r?r.focus():h.Root.get().trigger("previous-region",this.closest(function(c){return c.type()==="Fixture"||c.type()==="Region"}))):(o=n.parent().previousWithTest(function(c){return c.type()==="TableRow"}),i=n.parent().children.indexOf(n),i=Math.min(i,o.children.length),o.children[i].tableCellText().focus())},e.droppers={},e.mergers={},e}(h.Text)}.call(tt),function(){var h,_,k,P,z,V={}.hasOwnProperty,N=function(u,e){for(var t in e)V.call(e,t)&&(u[t]=e[t]);function n(){this.constructor=u}return n.prototype=e.prototype,u.prototype=new n,u.__super__=e.prototype,u},M=function(u,e){return function(){return u.apply(e,arguments)}},D=[].slice;_={Tools:{},CANCEL_MESSAGE:"Your changes have not been saved, do you really want to lose them?".trim(),DEFAULT_TOOLS:[["bold","italic","link","align-left","align-center","align-right"],["heading","subheading","paragraph","unordered-list","ordered-list","table","indent","unindent","line-break"],["image","video","preformatted"],["undo","redo","remove"]],DEFAULT_VIDEO_HEIGHT:300,DEFAULT_VIDEO_WIDTH:400,HIGHLIGHT_HOLD_DURATION:2e3,IMAGE_UPLOADER:null,INLINE_TAGS:["a","address","b","code","del","em","i","ins","span","strong","sup","u"],INSPECTOR_IGNORED_ELEMENTS:["Fixture","ListItemText","Region","TableCellText"],MIN_CROP:10,RESTRICTED_ATTRIBUTES:{"*":["style"],img:["height","src","width","data-ce-max-width","data-ce-min-width"],iframe:["height","width"]},getEmbedVideoURL:function(u){var e,t,n,i,r,o,s,a,c,p,g,v,C,T,w;for(e={"www.youtube.com":"youtube","youtu.be":"youtube","vimeo.com":"vimeo","player.vimeo.com":"vimeo"},p=document.createElement("a"),p.href=u,o=p.hostname.toLowerCase(),g=p.pathname,g!==null&&g.substr(0,1)!=="/"&&(g="/"+g),a={},c=p.search.slice(1),w=c.split("&"),C=0,T=w.length;C<T;C++)i=w[C],i=i.split("="),i[0]&&(a[i[0]]=i[1]);switch(e[o]){case"youtube":if(g.toLowerCase()==="/watch"){if(!a.v)return null;t=a.v,delete a.v}else{if(r=g.match(/\/([A-Za-z0-9_-]+)$/i),!r)return null;t=r[1]}return u="https://www.youtube.com/embed/"+t,s=function(){var I;I=[];for(n in a)v=a[n],I.push(""+n+"="+v);return I}().join("&"),s&&(u+="?"+s),u;case"vimeo":return r=g.match(/\/(\w+\/\w+\/){0,1}(\d+)/i),r?(u="https://player.vimeo.com/video/"+r[2],s=function(){var I;I=[];for(n in a)v=a[n],I.push(""+n+"="+v);return I}().join("&"),s&&(u+="?"+s),u):null}return null},getHTMLCleaner:function(){return new _.HTMLCleaner},getRestrictedAtributes:function(u){var e;return e=[],_.RESTRICTED_ATTRIBUTES[u]&&(e=e.concat(_.RESTRICTED_ATTRIBUTES[u])),_.RESTRICTED_ATTRIBUTES["*"]&&(e=e.concat(_.RESTRICTED_ATTRIBUTES["*"])),e},getScrollPosition:function(){var u,e;return e=window.pageXOffset!==void 0,u=(document.compatMode||4)===4,e?[window.pageXOffset,window.pageYOffset]:u?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[document.body.scrollLeft,document.body.scrollTop]}},typeof window!="undefined"&&(window.ContentTools=_),Y.exports&&(Y.exports=_),_.ComponentUI=function(){function u(){this._bindings={},this._parent=null,this._children=[],this._domElement=null}return u.prototype.children=function(){return this._children.slice()},u.prototype.domElement=function(){return this._domElement},u.prototype.isMounted=function(){return this._domElement!==null},u.prototype.parent=function(){return this._parent},u.prototype.attach=function(e,t){return e.parent()&&e.parent().detach(e),e._parent=this,t!==void 0?this._children.splice(t,0,e):this._children.push(e)},u.prototype.addCSSClass=function(e){if(!!this.isMounted())return ContentEdit.addCSSClass(this._domElement,e)},u.prototype.detach=function(e){var t;if(t=this._children.indexOf(e),t!==-1)return this._children.splice(t,1)},u.prototype.mount=function(){},u.prototype.removeCSSClass=function(e){if(!!this.isMounted())return ContentEdit.removeCSSClass(this._domElement,e)},u.prototype.unmount=function(){if(!!this.isMounted())return this._removeDOMEventListeners(),this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._domElement=null},u.prototype.addEventListener=function(e,t){this._bindings[e]===void 0&&(this._bindings[e]=[]),this._bindings[e].push(t)},u.prototype.createEvent=function(e,t){return new _.Event(e,t)},u.prototype.dispatchEvent=function(e){var t,n,i,r;if(!this._bindings[e.name()])return!e.defaultPrevented();for(r=this._bindings[e.name()],n=0,i=r.length;n<i&&(t=r[n],!e.propagationStopped());n++)!t||t.call(this,e);return!e.defaultPrevented()},u.prototype.removeEventListener=function(e,t){var n,i,r,o,s,a;if(!e){this._bindings={};return}if(!t){this._bindings[e]=void 0;return}if(!!this._bindings[e]){for(s=this._bindings[e],a=[],n=r=0,o=s.length;r<o;n=++r)i=s[n],i===t?a.push(this._bindings[e].splice(n,1)):a.push(void 0);return a}},u.prototype._addDOMEventListeners=function(){},u.prototype._removeDOMEventListeners=function(){},u.createDiv=function(e,t,n){var i,r,o;if(i=document.createElement("div"),e&&e.length>0&&i.setAttribute("class",e.join(" ")),t)for(r in t)o=t[r],i.setAttribute(r,o);return n&&(i.innerHTML=n),i},u}(),_.WidgetUI=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.attach=function(t,n){if(e.__super__.attach.call(this,t,n),!this.isMounted())return t.mount()},e.prototype.detach=function(t){if(e.__super__.detach.call(this,t),this.isMounted())return t.unmount()},e.prototype.detatch=function(t){return console.log("Please call detach, detatch will be removed in release 1.4.x"),this.detach(t)},e.prototype.show=function(){var t;return this._hideTimeout&&(clearTimeout(this._hideTimeout),this._hideTimeout=null,this.unmount()),this.isMounted()||this.mount(),t=function(n){return function(){return n.addCSSClass("ct-widget--active"),n._showTimeout=null}}(this),this._showTimeout=setTimeout(t,100)},e.prototype.hide=function(){var t;if(this._showTimeout&&(clearTimeout(this._showTimeout),this._showTimeout=null),this.removeCSSClass("ct-widget--active"),t=function(n){return function(){if(n._hideTimeout=null,!window.getComputedStyle){n.unmount();return}return parseFloat(window.getComputedStyle(n._domElement).opacity)<.01?n.unmount():n._hideTimeout=setTimeout(t,250)}}(this),this.isMounted())return this._hideTimeout=setTimeout(t,250)},e}(_.ComponentUI),_.AnchoredComponentUI=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.mount=function(t,n){return n==null&&(n=null),t.insertBefore(this._domElement,n),this._addDOMEventListeners()},e}(_.ComponentUI),_.Event=function(){function u(e,t){this._name=e,this._detail=t,this._timeStamp=Date.now(),this._defaultPrevented=!1,this._propagationStopped=!1}return u.prototype.defaultPrevented=function(){return this._defaultPrevented},u.prototype.detail=function(){return this._detail},u.prototype.name=function(){return this._name},u.prototype.propagationStopped=function(){return this._propagationStopped},u.prototype.timeStamp=function(){return this._timeStamp},u.prototype.preventDefault=function(){return this._defaultPrevented=!0},u.prototype.stopImmediatePropagation=function(){return this._propagationStopped=!0},u}(),_.FlashUI=function(u){N(e,u);function e(t){e.__super__.constructor.call(this),this.mount(t)}return e.prototype.mount=function(t){var n;return this._domElement=this.constructor.createDiv(["ct-flash","ct-flash--active","ct-flash--"+t,"ct-widget","ct-widget--active"]),e.__super__.mount.call(this,_.EditorApp.get().domElement()),n=function(i){return function(){if(!window.getComputedStyle){i.unmount();return}return parseFloat(window.getComputedStyle(i._domElement).opacity)<.01?i.unmount():setTimeout(n,250)}}(this),setTimeout(n,250)},e}(_.AnchoredComponentUI),_.IgnitionUI=function(u){N(e,u);function e(){e.__super__.constructor.call(this),this._revertToState="ready",this._state="ready"}return e.prototype.busy=function(t){if(this.dispatchEvent(this.createEvent("busy",{busy:t})))return t===(this._state==="busy")?void 0:t?(this._revertToState=this._state,this.state("busy")):this.state(this._revertToState)},e.prototype.cancel=function(){if(this.dispatchEvent(this.createEvent("cancel")))return this.state("ready")},e.prototype.confirm=function(){if(this.dispatchEvent(this.createEvent("confirm")))return this.state("ready")},e.prototype.edit=function(){if(this.dispatchEvent(this.createEvent("edit")))return this.state("editing")},e.prototype.mount=function(){return e.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-ignition","ct-ignition--ready"]),this.parent().domElement().appendChild(this._domElement),this._domEdit=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--edit"]),this._domElement.appendChild(this._domEdit),this._domConfirm=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--confirm"]),this._domElement.appendChild(this._domConfirm),this._domCancel=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--cancel"]),this._domElement.appendChild(this._domCancel),this._domBusy=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--busy"]),this._domElement.appendChild(this._domBusy),this._addDOMEventListeners()},e.prototype.state=function(t){if(t===void 0)return this._state;if(this._state!==t&&!!this.dispatchEvent(this.createEvent("statechange",{state:t}))){if(this._state=t,this.removeCSSClass("ct-ignition--busy"),this.removeCSSClass("ct-ignition--editing"),this.removeCSSClass("ct-ignition--ready"),this._state==="busy")return this.addCSSClass("ct-ignition--busy");if(this._state==="editing")return this.addCSSClass("ct-ignition--editing");if(this._state==="ready")return this.addCSSClass("ct-ignition--ready")}},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domEdit=null,this._domConfirm=null,this._domCancel=null},e.prototype._addDOMEventListeners=function(){return this._domEdit.addEventListener("click",function(t){return function(n){return n.preventDefault(),t.edit()}}(this)),this._domConfirm.addEventListener("click",function(t){return function(n){return n.preventDefault(),t.confirm()}}(this)),this._domCancel.addEventListener("click",function(t){return function(n){return n.preventDefault(),t.cancel()}}(this))},e}(_.WidgetUI),_.InspectorUI=function(u){N(e,u);function e(){e.__super__.constructor.call(this),this._tagUIs=[]}return e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-inspector"]),this.parent().domElement().appendChild(this._domElement),this._domTags=this.constructor.createDiv(["ct-inspector__tags","ct-tags"]),this._domElement.appendChild(this._domTags),this._domCounter=this.constructor.createDiv(["ct-inspector__counter"]),this._domElement.appendChild(this._domCounter),this.updateCounter(),this._addDOMEventListeners(),this._handleFocusChange=function(t){return function(){return t.updateTags()}}(this),ContentEdit.Root.get().bind("blur",this._handleFocusChange),ContentEdit.Root.get().bind("focus",this._handleFocusChange),ContentEdit.Root.get().bind("mount",this._handleFocusChange)},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domTags=null,ContentEdit.Root.get().unbind("blur",this._handleFocusChange),ContentEdit.Root.get().unbind("focus",this._handleFocusChange),ContentEdit.Root.get().unbind("mount",this._handleFocusChange)},e.prototype.updateCounter=function(){var t,n,i,r,o,s,a,c,p,g,v;if(!!this.isMounted()){for(n="",v=_.EditorApp.get().orderedRegions(),p=0,g=v.length;p<g;p++)s=v[p],s&&(n+=s.domElement().textContent);if(n=n.trim(),n=n.replace(/<\/?[a-z][^>]*>/gi,""),n=n.replace(/[\u200B]+/,""),n=n.replace(/['";:,.?\-!]+/g,""),c=(n.match(/\S+/g)||[]).length,c=c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),i=ContentEdit.Root.get().focused(),!(i&&i.type()==="PreText"&&i.selection().isCollapsed())){this._domCounter.textContent=c;return}return r=0,t=1,a=i.content.substring(0,i.selection().get()[0]),o=a.text().split(`
`),r=o.length,t=o[o.length-1].length+1,r=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),t=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),this._domCounter.textContent=""+c+" / "+r+":"+t}},e.prototype.updateTags=function(){var t,n,i,r,o,s,a,c,p;for(t=ContentEdit.Root.get().focused(),c=this._tagUIs,r=0,s=c.length;r<s;r++)i=c[r],i.unmount();if(this._tagUIs=[],!!t){for(n=t.parents(),n.reverse(),n.push(t),p=[],o=0,a=n.length;o<a;o++)t=n[o],_.INSPECTOR_IGNORED_ELEMENTS.indexOf(t.type())===-1&&(i=new _.TagUI(t),this._tagUIs.push(i),p.push(i.mount(this._domTags)));return p}},e.prototype._addDOMEventListeners=function(){return this._updateCounterInterval=setInterval(function(t){return function(){return t.updateCounter()}}(this),250)},e.prototype._removeDOMEventListeners=function(){return clearInterval(this._updateCounterInterval)},e}(_.WidgetUI),_.TagUI=function(u){N(e,u);function e(t){this.element=t,this._onMouseDown=M(this._onMouseDown,this),e.__super__.constructor.call(this)}return e.prototype.mount=function(t,n){return n==null&&(n=null),this._domElement=this.constructor.createDiv(["ct-tag"]),this._domElement.textContent=this.element.tagName(),e.__super__.mount.call(this,t,n)},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown)},e.prototype._onMouseDown=function(t){var n,i,r;return t.preventDefault(),this.element.storeState&&this.element.storeState(),n=_.EditorApp.get(),r=new _.ModalUI,i=new _.PropertiesDialog(this.element),i.addEventListener("cancel",function(o){return function(){if(r.hide(),i.hide(),o.element.restoreState)return o.element.restoreState()}}(this)),i.addEventListener("save",function(o){return function(s){var a,c,p,g,v,C,T,w,I,R,A,E,l,d,f,m,y;C=s.detail(),c=C.changedAttributes,R=C.changedStyles,w=C.innerHTML;for(I in c)if(A=c[I],I==="class"){for(A===null&&(A=""),g={},m=A.split(" "),E=0,d=m.length;E<d;E++)p=m[E],p=p.trim(),p&&(g[p]=!0,o.element.hasCSSClass(p)||o.element.addCSSClass(p));for(y=o.element.attr("class").split(" "),l=0,f=y.length;l<f;l++)p=y[l],p=p.trim(),g[p]===void 0&&o.element.removeCSSClass(p)}else A===null?o.element.removeAttr(I):o.element.attr(I,A);for(v in R)a=R[v],a?o.element.addCSSClass(v):o.element.removeCSSClass(v);if(w!==null&&w!==i.getElementInnerHTML()&&(T=o.element,T.content||(T=T.children[0]),T.content=new HTMLString.String(w,T.content.preserveWhitespace()),T.updateInnerHTML(),T.taint(),T.selection(new ContentSelect.Range(0,0)),T.storeState()),r.hide(),i.hide(),o.element.restoreState)return o.element.restoreState()}}(this)),n.attach(r),n.attach(i),r.show(),i.show()},e}(_.AnchoredComponentUI),_.ModalUI=function(u){N(e,u);function e(t,n){e.__super__.constructor.call(this),this._transparent=t,this._allowScrolling=n}return e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-modal"]),this.parent().domElement().appendChild(this._domElement),this._transparent&&this.addCSSClass("ct-modal--transparent"),this._allowScrolling||ContentEdit.addCSSClass(document.body,"ct--no-scroll"),this._addDOMEventListeners()},e.prototype.unmount=function(){return this._allowScrolling||ContentEdit.removeCSSClass(document.body,"ct--no-scroll"),e.__super__.unmount.call(this)},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("click",function(t){return function(n){return t.dispatchEvent(t.createEvent("click"))}}(this))},e}(_.WidgetUI),_.ToolboxUI=function(u){N(e,u);function e(t){this._onStopDragging=M(this._onStopDragging,this),this._onStartDragging=M(this._onStartDragging,this),this._onDrag=M(this._onDrag,this),e.__super__.constructor.call(this),this._tools=t,this._dragging=!1,this._draggingOffset=null,this._domGrip=null,this._toolUIs={}}return e.prototype.isDragging=function(){return this._dragging},e.prototype.hide=function(){return this._removeDOMEventListeners(),e.__super__.hide.call(this)},e.prototype.mount=function(){var t,n,i;return this._domElement=this.constructor.createDiv(["ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=this.constructor.createDiv(["ct-toolbox__grip","ct-grip"]),this._domElement.appendChild(this._domGrip),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domToolGroups=this.constructor.createDiv(["ct-tool-groups"]),this._domElement.appendChild(this._domToolGroups),this.tools(this._tools),i=window.localStorage.getItem("ct-toolbox-position"),i&&/^\d+,\d+$/.test(i)&&(n=function(){var r,o,s,a;for(s=i.split(","),a=[],r=0,o=s.length;r<o;r++)t=s[r],a.push(parseInt(t));return a}(),this._domElement.style.left=""+n[0]+"px",this._domElement.style.top=""+n[1]+"px",this._contain()),this._addDOMEventListeners()},e.prototype.tools=function(t){var n,i,r,o,s,a,c,p,g,v,C;if(t===void 0)return this._tools;if(this._tools=t,!!this.isMounted()){g=this._toolUIs;for(s in g)a=g[s],a.unmount();for(this._toolUIs={};this._domToolGroups.lastChild;)this._domToolGroups.removeChild(this._domToolGroups.lastChild);for(v=this._tools,C=[],i=c=0,p=v.length;c<p;i=++c)o=v[i],n=this.constructor.createDiv(["ct-tool-group"]),this._domToolGroups.appendChild(n),C.push(function(){var T,w,I;for(I=[],T=0,w=o.length;T<w;T++)s=o[T],r=_.ToolShelf.fetch(s),this._toolUIs[s]=new _.ToolUI(r),this._toolUIs[s].mount(n),this._toolUIs[s].disabled(!0),I.push(this._toolUIs[s].addEventListener("applied",function(R){return function(){return R.updateTools()}}(this)));return I}.call(this));return C}},e.prototype.updateTools=function(){var t,n,i,r,o,s;t=ContentEdit.Root.get().focused(),i=null,t&&t.selection&&(i=t.selection()),o=this._toolUIs,s=[];for(n in o)r=o[n],s.push(r.update(t,i));return s},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domGrip=null},e.prototype._addDOMEventListeners=function(){return this._domGrip.addEventListener("mousedown",this._onStartDragging),this._handleResize=function(t){return function(n){var i;return t._resizeTimeout&&clearTimeout(t._resizeTimeout),i=function(){return t._contain()},t._resizeTimeout=setTimeout(i,250)}}(this),window.addEventListener("resize",this._handleResize),this._updateTools=function(t){return function(){var n,i,r,o,s,a,c,p;if(n=_.EditorApp.get(),a=!1,i=ContentEdit.Root.get().focused(),o=null,i===t._lastUpdateElement?i&&i.selection&&(o=i.selection(),t._lastUpdateSelection&&o.eq(t._lastUpdateSelection)||(a=!0)):a=!0,n.history&&(t._lastUpdateHistoryLength!==n.history.length()&&(a=!0),t._lastUpdateHistoryLength=n.history.length(),t._lastUpdateHistoryIndex!==n.history.index()&&(a=!0),t._lastUpdateHistoryIndex=n.history.index()),t._lastUpdateElement=i,t._lastUpdateSelection=o,a){c=t._toolUIs,p=[];for(r in c)s=c[r],p.push(s.update(i,o));return p}}}(this),this._updateToolsInterval=setInterval(this._updateTools,100),this._handleKeyDown=function(t){return function(n){var i,r,o,s,a,c;if(r=ContentEdit.Root.get().focused(),r&&!r.content){if(n.keyCode===46)return n.preventDefault(),_.Tools.Remove.apply(r,null,function(){});if(n.keyCode===13)return n.preventDefault(),i=_.Tools.Paragraph,i.apply(r,null,function(){})}switch(c=navigator.appVersion,o="linux",c.indexOf("Mac")!==-1?o="mac":c.indexOf("Win")!==-1&&(o="windows"),s=!1,a=!1,o){case"linux":n.altKey||n.keyCode===90&&n.ctrlKey&&(s=n.shiftKey,a=!s);break;case"mac":n.altKey||n.ctrlKey||n.keyCode===90&&n.metaKey&&(s=n.shiftKey,a=!s);break;case"windows":(!n.altKey||n.shiftKey)&&(n.keyCode===89&&n.ctrlKey&&(s=!0),n.keyCode===90&&n.ctrlKey&&(a=!0))}if(a&&_.Tools.Undo.canApply(null,null)&&_.Tools.Undo.apply(null,null,function(){}),s&&_.Tools.Redo.canApply(null,null))return _.Tools.Redo.apply(null,null,function(){})}}(),window.addEventListener("keydown",this._handleKeyDown)},e.prototype._contain=function(){var t;if(!!this.isMounted())return t=this._domElement.getBoundingClientRect(),t.left+t.width>window.innerWidth&&(this._domElement.style.left=""+(window.innerWidth-t.width)+"px"),t.top+t.height>window.innerHeight&&(this._domElement.style.top=""+(window.innerHeight-t.height)+"px"),t.left<0&&(this._domElement.style.left="0px"),t.top<0&&(this._domElement.style.top="0px"),t=this._domElement.getBoundingClientRect(),window.localStorage.setItem("ct-toolbox-position",""+t.left+","+t.top)},e.prototype._removeDOMEventListeners=function(){return this.isMounted()&&this._domGrip.removeEventListener("mousedown",this._onStartDragging),window.removeEventListener("keydown",this._handleKeyDown),window.removeEventListener("resize",this._handleResize),clearInterval(this._updateToolsInterval)},e.prototype._onDrag=function(t){return ContentSelect.Range.unselectAll(),this._domElement.style.left=""+(t.clientX-this._draggingOffset.x)+"px",this._domElement.style.top=""+(t.clientY-this._draggingOffset.y)+"px"},e.prototype._onStartDragging=function(t){var n;if(t.preventDefault(),!this.isDragging())return this._dragging=!0,this.addCSSClass("ct-toolbox--dragging"),n=this._domElement.getBoundingClientRect(),this._draggingOffset={x:t.clientX-n.left,y:t.clientY-n.top},document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),ContentEdit.addCSSClass(document.body,"ce--dragging")},e.prototype._onStopDragging=function(t){if(!!this.isDragging())return this._contain(),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._draggingOffset=null,this._dragging=!1,this.removeCSSClass("ct-toolbox--dragging"),ContentEdit.removeCSSClass(document.body,"ce--dragging")},e}(_.WidgetUI),_.ToolUI=function(u){N(e,u);function e(t){this._onMouseUp=M(this._onMouseUp,this),this._onMouseLeave=M(this._onMouseLeave,this),this._onMouseDown=M(this._onMouseDown,this),this._addDOMEventListeners=M(this._addDOMEventListeners,this),e.__super__.constructor.call(this),this.tool=t,this._mouseDown=!1,this._disabled=!1}return e.prototype.apply=function(t,n){var i,r;if(!!this.tool.canApply(t,n)&&(r={element:t,selection:n},i=function(o){return function(s){if(s)return o.dispatchEvent(o.createEvent("applied",r))}}(this),this.dispatchEvent(this.createEvent("apply",r))))return this.tool.apply(t,n,i)},e.prototype.disabled=function(t){if(t===void 0)return this._disabled;if(this._disabled!==t)return this._disabled=t,t?(this._mouseDown=!1,this.addCSSClass("ct-tool--disabled"),this.removeCSSClass("ct-tool--applied")):this.removeCSSClass("ct-tool--disabled")},e.prototype.mount=function(t,n){return n==null&&(n=null),this._domElement=this.constructor.createDiv(["ct-tool","ct-tool--"+this.tool.icon]),this._domElement.setAttribute("data-ct-tooltip",ContentEdit._(this.tool.label)),e.__super__.mount.call(this,t,n)},e.prototype.update=function(t,n){if(this.tool.requiresElement&&!(t&&t.isMounted())){this.disabled(!0);return}if(this.tool.canApply(t,n))this.disabled(!1);else{this.disabled(!0);return}return this.tool.isApplied(t,n)?this.addCSSClass("ct-tool--applied"):this.removeCSSClass("ct-tool--applied")},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown),this._domElement.addEventListener("mouseleave",this._onMouseLeave),this._domElement.addEventListener("mouseup",this._onMouseUp)},e.prototype._onMouseDown=function(t){if(t.preventDefault(),!this.disabled())return this._mouseDown=!0,this.addCSSClass("ct-tool--down")},e.prototype._onMouseLeave=function(t){return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},e.prototype._onMouseUp=function(t){var n,i;if(this._mouseDown){if(n=ContentEdit.Root.get().focused(),this.tool.requiresElement&&!(n&&n.isMounted()))return;i=null,n&&n.selection&&(i=n.selection()),this.apply(n,i)}return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},e}(_.AnchoredComponentUI),_.AnchoredDialogUI=function(u){N(e,u);function e(){e.__super__.constructor.call(this),this._position=[0,0]}return e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-anchored-dialog"]),this.parent().domElement().appendChild(this._domElement),this._contain(),this._domElement.style.top=""+this._position[1]+"px",this._domElement.style.left=""+this._position[0]+"px"},e.prototype.position=function(t){if(t===void 0)return this._position.slice();if(this._position=t.slice(),this.isMounted())return this._contain(),this._domElement.style.top=""+this._position[1]+"px",this._domElement.style.left=""+this._position[0]+"px"},e.prototype._contain=function(){var t,n,i;if(!!this.isMounted()&&(i=this._domElement.getBoundingClientRect(),t=i.width/2+5,n=document.documentElement.clientWidth||document.body.clientWidth,this._position[0]+t>n&&(this._position[0]=n-t),this._position[0]<t&&(this._position[0]=t),this._position[1]+i.top<5))return this._position[1]=Math.abs(i.top)+5},e}(_.WidgetUI),_.DialogUI=function(u){N(e,u);function e(t){t==null&&(t=""),e.__super__.constructor.call(this),this._busy=!1,this._caption=t}return e.prototype.busy=function(t){if(t===void 0)return this._busy;if(this._busy!==t&&(this._busy=t,!!this.isMounted()))return this._busy?ContentEdit.addCSSClass(this._domElement,"ct-dialog--busy"):ContentEdit.removeCSSClass(this._domElement,"ct-dialog--busy")},e.prototype.caption=function(t){return t===void 0?this._caption:(this._caption=t,this._domCaption.textContent=ContentEdit._(t))},e.prototype.mount=function(){var t,n,i;return document.activeElement&&(document.activeElement.blur(),window.getSelection().removeAllRanges()),t=["ct-widget","ct-dialog"],this._busy&&t.push("ct-dialog--busy"),this._domElement=this.constructor.createDiv(t),this.parent().domElement().appendChild(this._domElement),i=this.constructor.createDiv(["ct-dialog__header"]),this._domElement.appendChild(i),this._domCaption=this.constructor.createDiv(["ct-dialog__caption"]),i.appendChild(this._domCaption),this.caption(this._caption),this._domClose=this.constructor.createDiv(["ct-dialog__close"]),i.appendChild(this._domClose),n=this.constructor.createDiv(["ct-dialog__body"]),this._domElement.appendChild(n),this._domView=this.constructor.createDiv(["ct-dialog__view"]),n.appendChild(this._domView),this._domControls=this.constructor.createDiv(["ct-dialog__controls"]),n.appendChild(this._domControls),this._domBusy=this.constructor.createDiv(["ct-dialog__busy"]),this._domElement.appendChild(this._domBusy)},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domBusy=null,this._domCaption=null,this._domClose=null,this._domControls=null,this._domView=null},e.prototype._addDOMEventListeners=function(){return this._handleEscape=function(t){return function(n){if(!t._busy&&n.keyCode===27)return t.dispatchEvent(t.createEvent("cancel"))}}(this),document.addEventListener("keyup",this._handleEscape),this._domClose.addEventListener("click",function(t){return function(n){if(n.preventDefault(),!t._busy)return t.dispatchEvent(t.createEvent("cancel"))}}(this))},e.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keyup",this._handleEscape)},e}(_.WidgetUI),_.ImageDialog=function(u){N(e,u);function e(){e.__super__.constructor.call(this,"Insert image"),this._cropMarks=null,this._imageURL=null,this._imageSize=null,this._progress=0,this._state="empty",_.IMAGE_UPLOADER&&_.IMAGE_UPLOADER(this)}return e.prototype.cropRegion=function(){return this._cropMarks?this._cropMarks.region():[0,0,1,1]},e.prototype.addCropMarks=function(){if(!this._cropMarks)return this._cropMarks=new k(this._imageSize),this._cropMarks.mount(this._domView),ContentEdit.addCSSClass(this._domCrop,"ct-control--active")},e.prototype.clear=function(){return this._domImage&&(this._domImage.parentNode.removeChild(this._domImage),this._domImage=null),this._imageURL=null,this._imageSize=null,this.state("empty")},e.prototype.mount=function(){var t,n,i;return e.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-image-dialog"),ContentEdit.addCSSClass(this._domElement,"ct-image-dialog--empty"),ContentEdit.addCSSClass(this._domView,"ct-image-dialog__view"),i=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(i),this._domRotateCCW=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--rotate-ccw"]),this._domRotateCCW.setAttribute("data-ct-tooltip",ContentEdit._("Rotate")+" -90\xB0"),i.appendChild(this._domRotateCCW),this._domRotateCW=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--rotate-cw"]),this._domRotateCW.setAttribute("data-ct-tooltip",ContentEdit._("Rotate")+" 90\xB0"),i.appendChild(this._domRotateCW),this._domCrop=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--crop"]),this._domCrop.setAttribute("data-ct-tooltip",ContentEdit._("Crop marks")),i.appendChild(this._domCrop),n=this.constructor.createDiv(["ct-progress-bar"]),i.appendChild(n),this._domProgress=this.constructor.createDiv(["ct-progress-bar__progress"]),n.appendChild(this._domProgress),t=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(t),this._domUpload=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--upload"]),this._domUpload.textContent=ContentEdit._("Upload"),t.appendChild(this._domUpload),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-image-dialog__file-upload"),this._domInput.setAttribute("name","file"),this._domInput.setAttribute("type","file"),this._domInput.setAttribute("accept","image/*"),this._domUpload.appendChild(this._domInput),this._domInsert=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--insert"]),this._domInsert.textContent=ContentEdit._("Insert"),t.appendChild(this._domInsert),this._domCancelUpload=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--cancel"]),this._domCancelUpload.textContent=ContentEdit._("Cancel"),t.appendChild(this._domCancelUpload),this._domClear=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--clear"]),this._domClear.textContent=ContentEdit._("Clear"),t.appendChild(this._domClear),this._addDOMEventListeners(),this.dispatchEvent(this.createEvent("imageuploader.mount"))},e.prototype.populate=function(t,n){return this._imageURL=t,this._imageSize=n,this._domImage||(this._domImage=this.constructor.createDiv(["ct-image-dialog__image"]),this._domView.appendChild(this._domImage)),this._domImage.style["background-image"]="url("+t+")",this.state("populated")},e.prototype.progress=function(t){if(t===void 0)return this._progress;if(this._progress=t,!!this.isMounted())return this._domProgress.style.width=""+this._progress+"%"},e.prototype.removeCropMarks=function(){if(!!this._cropMarks)return this._cropMarks.unmount(),this._cropMarks=null,ContentEdit.removeCSSClass(this._domCrop,"ct-control--active")},e.prototype.save=function(t,n,i){return this.dispatchEvent(this.createEvent("save",{imageURL:t,imageSize:n,imageAttrs:i}))},e.prototype.state=function(t){var n;if(t===void 0)return this._state;if(this._state!==t&&(n=this._state,this._state=t,!!this.isMounted()))return ContentEdit.addCSSClass(this._domElement,"ct-image-dialog--"+this._state),ContentEdit.removeCSSClass(this._domElement,"ct-image-dialog--"+n)},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domCancelUpload=null,this._domClear=null,this._domCrop=null,this._domInput=null,this._domInsert=null,this._domProgress=null,this._domRotateCCW=null,this._domRotateCW=null,this._domUpload=null,this.dispatchEvent(this.createEvent("imageuploader.unmount"))},e.prototype._addDOMEventListeners=function(){return e.__super__._addDOMEventListeners.call(this),this._domInput.addEventListener("change",function(t){return function(n){var i;if(i=n.target.files[0],!!i)return n.target.value="",n.target.value&&(n.target.type="text",n.target.type="file"),t.dispatchEvent(t.createEvent("imageuploader.fileready",{file:i}))}}(this)),this._domCancelUpload.addEventListener("click",function(t){return function(n){return t.dispatchEvent(t.createEvent("imageuploader.cancelupload"))}}(this)),this._domClear.addEventListener("click",function(t){return function(n){return t.removeCropMarks(),t.dispatchEvent(t.createEvent("imageuploader.clear"))}}(this)),this._domRotateCCW.addEventListener("click",function(t){return function(n){return t.removeCropMarks(),t.dispatchEvent(t.createEvent("imageuploader.rotateccw"))}}(this)),this._domRotateCW.addEventListener("click",function(t){return function(n){return t.removeCropMarks(),t.dispatchEvent(t.createEvent("imageuploader.rotatecw"))}}(this)),this._domCrop.addEventListener("click",function(t){return function(n){return t._cropMarks?t.removeCropMarks():t.addCropMarks()}}(this)),this._domInsert.addEventListener("click",function(t){return function(n){return t.dispatchEvent(t.createEvent("imageuploader.save"))}}(this))},e}(_.DialogUI),k=function(u){N(e,u);function e(t){e.__super__.constructor.call(this),this._bounds=null,this._dragging=null,this._draggingOrigin=null,this._imageSize=t}return e.prototype.mount=function(t,n){return n==null&&(n=null),this._domElement=this.constructor.createDiv(["ct-crop-marks"]),this._domClipper=this.constructor.createDiv(["ct-crop-marks__clipper"]),this._domElement.appendChild(this._domClipper),this._domRulers=[this.constructor.createDiv(["ct-crop-marks__ruler","ct-crop-marks__ruler--top-left"]),this.constructor.createDiv(["ct-crop-marks__ruler","ct-crop-marks__ruler--bottom-right"])],this._domClipper.appendChild(this._domRulers[0]),this._domClipper.appendChild(this._domRulers[1]),this._domHandles=[this.constructor.createDiv(["ct-crop-marks__handle","ct-crop-marks__handle--top-left"]),this.constructor.createDiv(["ct-crop-marks__handle","ct-crop-marks__handle--bottom-right"])],this._domElement.appendChild(this._domHandles[0]),this._domElement.appendChild(this._domHandles[1]),e.__super__.mount.call(this,t,n),this._fit(t)},e.prototype.region=function(){return[parseFloat(this._domHandles[0].style.top)/this._bounds[1],parseFloat(this._domHandles[0].style.left)/this._bounds[0],parseFloat(this._domHandles[1].style.top)/this._bounds[1],parseFloat(this._domHandles[1].style.left)/this._bounds[0]]},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domClipper=null,this._domHandles=null,this._domRulers=null},e.prototype._addDOMEventListeners=function(){return e.__super__._addDOMEventListeners.call(this),this._domHandles[0].addEventListener("mousedown",function(t){return function(n){if(n.button===0)return t._startDrag(0,n.clientY,n.clientX)}}(this)),this._domHandles[1].addEventListener("mousedown",function(t){return function(n){if(n.button===0)return t._startDrag(1,n.clientY,n.clientX)}}(this))},e.prototype._drag=function(t,n){var i,r,o,s,a;if(this._dragging!==null)return ContentSelect.Range.unselectAll(),s=t-this._draggingOrigin[1],o=n-this._draggingOrigin[0],i=this._bounds[1],n=0,t=0,a=this._bounds[0],r=Math.min(Math.min(_.MIN_CROP,i),a),this._dragging===0?(i=parseInt(this._domHandles[1].style.top)-r,a=parseInt(this._domHandles[1].style.left)-r):(n=parseInt(this._domHandles[0].style.left)+r,t=parseInt(this._domHandles[0].style.top)+r),s=Math.min(Math.max(t,s),i),o=Math.min(Math.max(n,o),a),this._domHandles[this._dragging].style.top=""+s+"px",this._domHandles[this._dragging].style.left=""+o+"px",this._domRulers[this._dragging].style.top=""+s+"px",this._domRulers[this._dragging].style.left=""+o+"px"},e.prototype._fit=function(t){var n,i,r,o,s,a,c,p;return s=t.getBoundingClientRect(),p=s.width/this._imageSize[0],i=s.height/this._imageSize[1],o=Math.min(p,i),c=o*this._imageSize[0],n=o*this._imageSize[1],r=(s.width-c)/2,a=(s.height-n)/2,this._domElement.style.width=""+c+"px",this._domElement.style.height=""+n+"px",this._domElement.style.top=""+a+"px",this._domElement.style.left=""+r+"px",this._domHandles[0].style.top="0px",this._domHandles[0].style.left="0px",this._domHandles[1].style.top=""+n+"px",this._domHandles[1].style.left=""+c+"px",this._domRulers[0].style.top="0px",this._domRulers[0].style.left="0px",this._domRulers[1].style.top=""+n+"px",this._domRulers[1].style.left=""+c+"px",this._bounds=[c,n]},e.prototype._startDrag=function(t,n,i){var r;return r=this._domHandles[t],this._dragging=t,this._draggingOrigin=[i-parseInt(r.style.left),n-parseInt(r.style.top)],this._onMouseMove=function(o){return function(s){return o._drag(s.clientY,s.clientX)}}(this),document.addEventListener("mousemove",this._onMouseMove),this._onMouseUp=function(o){return function(s){return o._stopDrag()}}(this),document.addEventListener("mouseup",this._onMouseUp)},e.prototype._stopDrag=function(){return document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._dragging=null,this._draggingOrigin=null},e}(_.AnchoredComponentUI),_.LinkDialog=function(u){var e;N(t,u),e="_blank";function t(n,i){n==null&&(n=""),i==null&&(i=""),t.__super__.constructor.call(this),this._href=n,this._target=i}return t.prototype.mount=function(){return t.__super__.mount.call(this),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-anchored-dialog__input"),this._domInput.setAttribute("name","href"),this._domInput.setAttribute("placeholder",ContentEdit._("Enter a link")+"..."),this._domInput.setAttribute("type","text"),this._domInput.setAttribute("value",this._href),this._domElement.appendChild(this._domInput),this._domTargetButton=this.constructor.createDiv(["ct-anchored-dialog__target-button"]),this._domElement.appendChild(this._domTargetButton),this._target===e&&ContentEdit.addCSSClass(this._domTargetButton,"ct-anchored-dialog__target-button--active"),this._domButton=this.constructor.createDiv(["ct-anchored-dialog__button"]),this._domElement.appendChild(this._domButton),this._addDOMEventListeners()},t.prototype.save=function(){var n;if(!this.isMounted()){this.dispatchEvent(this.createEvent("save"));return}return n={href:this._domInput.value.trim()},this._target&&(n.target=this._target),this.dispatchEvent(this.createEvent("save",n))},t.prototype.show=function(){if(t.__super__.show.call(this),this._domInput.focus(),this._href)return this._domInput.select()},t.prototype.unmount=function(){return this.isMounted()&&this._domInput.blur(),t.__super__.unmount.call(this),this._domButton=null,this._domInput=null},t.prototype._addDOMEventListeners=function(){return this._domInput.addEventListener("keypress",function(n){return function(i){if(i.keyCode===13)return n.save()}}(this)),this._domTargetButton.addEventListener("click",function(n){return function(i){return i.preventDefault(),n._target===e?(n._target="",ContentEdit.removeCSSClass(n._domTargetButton,"ct-anchored-dialog__target-button--active")):(n._target=e,ContentEdit.addCSSClass(n._domTargetButton,"ct-anchored-dialog__target-button--active"))}}(this)),this._domButton.addEventListener("click",function(n){return function(i){return i.preventDefault(),n.save()}}(this))},t}(_.AnchoredDialogUI),_.PropertiesDialog=function(u){N(e,u);function e(t){var n;this.element=t,e.__super__.constructor.call(this,"Properties"),this._attributeUIs=[],this._focusedAttributeUI=null,this._styleUIs=[],this._supportsCoding=this.element.content,((n=this.element.type())==="ListItem"||n==="TableCell")&&(this._supportsCoding=!0)}return e.prototype.caption=function(t){return t===void 0?this._caption:(this._caption=t,this._domCaption.textContent=ContentEdit._(t)+(": "+this.element.tagName()))},e.prototype.changedAttributes=function(){var t,n,i,r,o,s,a,c,p,g;for(n={},i={},p=this._attributeUIs,a=0,c=p.length;a<c;a++)t=p[a],r=t.name(),s=t.value(),r!==""&&(n[r.toLowerCase()]=!0,this.element.attr(r)!==s&&(i[r]=s));o=_.getRestrictedAtributes(this.element.tagName()),g=this.element.attributes();for(r in g)s=g[r],!(o&&o.indexOf(r.toLowerCase())!==-1)&&n[r]===void 0&&(i[r]=null);return i},e.prototype.changedStyles=function(){var t,n,i,r,o,s;for(i={},s=this._styleUIs,r=0,o=s.length;r<o;r++)n=s[r],t=n.style.cssClass(),this.element.hasCSSClass(t)!==n.applied()&&(i[t]=n.applied());return i},e.prototype.getElementInnerHTML=function(){return this._supportsCoding?this.element.content?this.element.content.html():this.element.children[0].content.html():null},e.prototype.mount=function(){var t,n,i,r,o,s,a,c,p,g,v,C,T,w,I;for(e.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog"),ContentEdit.addCSSClass(this._domView,"ct-properties-dialog__view"),this._domStyles=this.constructor.createDiv(["ct-properties-dialog__styles"]),this._domStyles.setAttribute("data-ct-empty",ContentEdit._("No styles available for this tag")),this._domView.appendChild(this._domStyles),I=_.StylePalette.styles(this.element),v=0,T=I.length;v<T;v++)c=I[v],p=new P(c,this.element.hasCSSClass(c.cssClass())),this._styleUIs.push(p),p.mount(this._domStyles);this._domAttributes=this.constructor.createDiv(["ct-properties-dialog__attributes"]),this._domView.appendChild(this._domAttributes),a=_.getRestrictedAtributes(this.element.tagName()),n=this.element.attributes(),t=[];for(s in n)g=n[s],!(a&&a.indexOf(s.toLowerCase())!==-1)&&t.push(s);for(t.sort(),C=0,w=t.length;C<w;C++)s=t[C],g=n[s],this._addAttributeUI(s,g);return this._addAttributeUI("",""),this._domCode=this.constructor.createDiv(["ct-properties-dialog__code"]),this._domView.appendChild(this._domCode),this._domInnerHTML=document.createElement("textarea"),this._domInnerHTML.setAttribute("class","ct-properties-dialog__inner-html"),this._domInnerHTML.setAttribute("name","code"),this._domInnerHTML.value=this.getElementInnerHTML(),this._domCode.appendChild(this._domInnerHTML),r=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(r),this._domStylesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--styles"]),this._domStylesTab.setAttribute("data-ct-tooltip",ContentEdit._("Styles")),r.appendChild(this._domStylesTab),this._domAttributesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--attributes"]),this._domAttributesTab.setAttribute("data-ct-tooltip",ContentEdit._("Attributes")),r.appendChild(this._domAttributesTab),this._domCodeTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--code"]),this._domCodeTab.setAttribute("data-ct-tooltip",ContentEdit._("Code")),r.appendChild(this._domCodeTab),this._supportsCoding||ContentEdit.addCSSClass(this._domCodeTab,"ct-control--muted"),this._domRemoveAttribute=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--remove","ct-control--muted"]),this._domRemoveAttribute.setAttribute("data-ct-tooltip",ContentEdit._("Remove")),r.appendChild(this._domRemoveAttribute),i=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(i),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent=ContentEdit._("Apply"),i.appendChild(this._domApply),o=window.localStorage.getItem("ct-properties-dialog-tab"),o==="attributes"?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--attributes"),ContentEdit.addCSSClass(this._domAttributesTab,"ct-control--active")):o==="code"&&this._supportsCoding?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--code"),ContentEdit.addCSSClass(this._domCodeTab,"ct-control--active")):(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--styles"),ContentEdit.addCSSClass(this._domStylesTab,"ct-control--active")),this._addDOMEventListeners()},e.prototype.save=function(){var t,n;return n=null,this._supportsCoding&&(n=this._domInnerHTML.value),t={changedAttributes:this.changedAttributes(),changedStyles:this.changedStyles(),innerHTML:n},this.dispatchEvent(this.createEvent("save",t))},e.prototype._addAttributeUI=function(t,n){var i,r;return r=this,i=new h(t,n),this._attributeUIs.push(i),i.addEventListener("blur",function(o){var s,a,c;if(r._focusedAttributeUI=null,ContentEdit.addCSSClass(r._domRemoveAttribute,"ct-control--muted"),s=r._attributeUIs.indexOf(this),c=r._attributeUIs.length,this.name()===""&&s<c-1&&(this.unmount(),r._attributeUIs.splice(s,1)),a=r._attributeUIs[c-1],a&&a.name()&&a.value())return r._addAttributeUI("","")}),i.addEventListener("focus",function(o){return r._focusedAttributeUI=this,ContentEdit.removeCSSClass(r._domRemoveAttribute,"ct-control--muted")}),i.addEventListener("namechange",function(o){var s,a,c,p,g,v,C;for(s=r.element,t=this.name().toLowerCase(),c=_.getRestrictedAtributes(s.tagName()),p=!0,c&&c.indexOf(t)!==-1&&(p=!1),C=r._attributeUIs,g=0,v=C.length;g<v;g++)a=C[g],t!==""&&a!==this&&a.name().toLowerCase()===t&&(p=!1);return this.valid(p),p?ContentEdit.removeCSSClass(r._domApply,"ct-control--muted"):ContentEdit.addCSSClass(r._domApply,"ct-control--muted")}),i.mount(this._domAttributes),i},e.prototype._addDOMEventListeners=function(){var t,n;return e.__super__._addDOMEventListeners.call(this),t=function(i){return function(r){var o,s,a,c,p,g;for(c=["attributes","code","styles"],p=0,g=c.length;p<g;p++)s=c[p],s!==r&&(a=s.charAt(0).toUpperCase()+s.slice(1),ContentEdit.removeCSSClass(i._domElement,"ct-properties-dialog--"+s),ContentEdit.removeCSSClass(i["_dom"+a+"Tab"],"ct-control--active"));return o=r.charAt(0).toUpperCase()+r.slice(1),ContentEdit.addCSSClass(i._domElement,"ct-properties-dialog--"+r),ContentEdit.addCSSClass(i["_dom"+o+"Tab"],"ct-control--active"),window.localStorage.setItem("ct-properties-dialog-tab",r)}}(this),this._domStylesTab.addEventListener("mousedown",function(i){return function(){return t("styles")}}()),this._domAttributesTab.addEventListener("mousedown",function(i){return function(){return t("attributes")}}()),this._supportsCoding&&this._domCodeTab.addEventListener("mousedown",function(i){return function(){return t("code")}}()),this._domRemoveAttribute.addEventListener("mousedown",function(i){return function(r){var o,s;if(r.preventDefault(),i._focusedAttributeUI&&(o=i._attributeUIs.indexOf(i._focusedAttributeUI),s=o===i._attributeUIs.length-1,i._focusedAttributeUI.unmount(),i._attributeUIs.splice(o,1),s))return i._addAttributeUI("","")}}(this)),n=function(i){return function(r){var o;try{return o=new HTMLString.String(i._domInnerHTML.value),ContentEdit.removeCSSClass(i._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.removeCSSClass(i._domApply,"ct-control--muted")}catch{return ContentEdit.addCSSClass(i._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.addCSSClass(i._domApply,"ct-control--muted")}}}(this),this._domInnerHTML.addEventListener("input",n),this._domInnerHTML.addEventListener("propertychange",n),this._domApply.addEventListener("click",function(i){return function(r){var o;if(r.preventDefault(),o=i._domApply.getAttribute("class"),o.indexOf("ct-control--muted")===-1)return i.save()}}(this))},e}(_.DialogUI),P=function(u){N(e,u);function e(t,n){this.style=t,e.__super__.constructor.call(this),this._applied=n}return e.prototype.applied=function(t){if(t===void 0)return this._applied;if(this._applied!==t)return this._applied=t,this._applied?ContentEdit.addCSSClass(this._domElement,"ct-section--applied"):ContentEdit.removeCSSClass(this._domElement,"ct-section--applied")},e.prototype.mount=function(t,n){var i;return n==null&&(n=null),this._domElement=this.constructor.createDiv(["ct-section"]),this._applied&&ContentEdit.addCSSClass(this._domElement,"ct-section--applied"),i=this.constructor.createDiv(["ct-section__label"]),i.textContent=this.style.name(),this._domElement.appendChild(i),this._domElement.appendChild(this.constructor.createDiv(["ct-section__switch"])),e.__super__.mount.call(this,t,n)},e.prototype._addDOMEventListeners=function(){var t;return t=function(n){return function(i){return i.preventDefault(),n.applied()?n.applied(!1):n.applied(!0)}}(this),this._domElement.addEventListener("click",t)},e}(_.AnchoredComponentUI),h=function(u){N(e,u);function e(t,n){e.__super__.constructor.call(this),this._initialName=t,this._initialValue=n}return e.prototype.name=function(){return this._domName.value.trim()},e.prototype.value=function(){return this._domValue.value.trim()},e.prototype.mount=function(t,n){return n==null&&(n=null),this._domElement=this.constructor.createDiv(["ct-attribute"]),this._domName=document.createElement("input"),this._domName.setAttribute("class","ct-attribute__name"),this._domName.setAttribute("name","name"),this._domName.setAttribute("placeholder",ContentEdit._("Name")),this._domName.setAttribute("type","text"),this._domName.setAttribute("value",this._initialName),this._domElement.appendChild(this._domName),this._domValue=document.createElement("input"),this._domValue.setAttribute("class","ct-attribute__value"),this._domValue.setAttribute("name","value"),this._domValue.setAttribute("placeholder",ContentEdit._("Value")),this._domValue.setAttribute("type","text"),this._domValue.setAttribute("value",this._initialValue),this._domElement.appendChild(this._domValue),e.__super__.mount.call(this,t,n)},e.prototype.valid=function(t){return t?ContentEdit.removeCSSClass(this._domName,"ct-attribute__name--invalid"):ContentEdit.addCSSClass(this._domName,"ct-attribute__name--invalid")},e.prototype._addDOMEventListeners=function(){return this._domName.addEventListener("blur",function(t){return function(){var n,i,r;if(n=t.name(),i=t._domElement.nextSibling,t.dispatchEvent(t.createEvent("blur")),n===""&&i)return r=i.querySelector(".ct-attribute__name"),r.focus()}}(this)),this._domName.addEventListener("focus",function(t){return function(){return t.dispatchEvent(t.createEvent("focus"))}}(this)),this._domName.addEventListener("input",function(t){return function(){return t.dispatchEvent(t.createEvent("namechange"))}}(this)),this._domName.addEventListener("keydown",function(t){return function(n){if(n.keyCode===13)return t._domValue.focus()}}(this)),this._domValue.addEventListener("blur",function(t){return function(){return t.dispatchEvent(t.createEvent("blur"))}}(this)),this._domValue.addEventListener("focus",function(t){return function(){return t.dispatchEvent(t.createEvent("focus"))}}(this)),this._domValue.addEventListener("keydown",function(t){return function(n){var i,r;if(!(n.keyCode!==13&&(n.keyCode!==9||n.shiftKey))&&(n.preventDefault(),i=t._domElement.nextSibling,i||(t._domValue.blur(),i=t._domElement.nextSibling),i))return r=i.querySelector(".ct-attribute__name"),r.focus()}}(this))},e}(_.AnchoredComponentUI),_.TableDialog=function(u){N(e,u);function e(t){this.table=t,this.table?e.__super__.constructor.call(this,"Update table"):e.__super__.constructor.call(this,"Insert table")}return e.prototype.mount=function(){var t,n,i,r,o,s,a;return e.__super__.mount.call(this),t={columns:3,foot:!1,head:!0},this.table&&(t={columns:this.table.firstSection().children[0].children.length,foot:this.table.tfoot(),head:this.table.thead()}),ContentEdit.addCSSClass(this._domElement,"ct-table-dialog"),ContentEdit.addCSSClass(this._domView,"ct-table-dialog__view"),a=["ct-section"],t.head&&a.push("ct-section--applied"),this._domHeadSection=this.constructor.createDiv(a),this._domView.appendChild(this._domHeadSection),o=this.constructor.createDiv(["ct-section__label"]),o.textContent=ContentEdit._("Table head"),this._domHeadSection.appendChild(o),this._domHeadSwitch=this.constructor.createDiv(["ct-section__switch"]),this._domHeadSection.appendChild(this._domHeadSwitch),this._domBodySection=this.constructor.createDiv(["ct-section","ct-section--applied","ct-section--contains-input"]),this._domView.appendChild(this._domBodySection),n=this.constructor.createDiv(["ct-section__label"]),n.textContent=ContentEdit._("Table body (columns)"),this._domBodySection.appendChild(n),this._domBodyInput=document.createElement("input"),this._domBodyInput.setAttribute("class","ct-section__input"),this._domBodyInput.setAttribute("maxlength","2"),this._domBodyInput.setAttribute("name","columns"),this._domBodyInput.setAttribute("type","text"),this._domBodyInput.setAttribute("value",t.columns),this._domBodySection.appendChild(this._domBodyInput),s=["ct-section"],t.foot&&s.push("ct-section--applied"),this._domFootSection=this.constructor.createDiv(s),this._domView.appendChild(this._domFootSection),r=this.constructor.createDiv(["ct-section__label"]),r.textContent=ContentEdit._("Table foot"),this._domFootSection.appendChild(r),this._domFootSwitch=this.constructor.createDiv(["ct-section__switch"]),this._domFootSection.appendChild(this._domFootSwitch),i=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(i),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent="Apply",i.appendChild(this._domApply),this._addDOMEventListeners()},e.prototype.save=function(){var t,n,i;return n=this._domFootSection.getAttribute("class"),i=this._domHeadSection.getAttribute("class"),t={columns:parseInt(this._domBodyInput.value),foot:n.indexOf("ct-section--applied")>-1,head:i.indexOf("ct-section--applied")>-1},this.dispatchEvent(this.createEvent("save",t))},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domBodyInput=null,this._domBodySection=null,this._domApply=null,this._domHeadSection=null,this._domHeadSwitch=null,this._domFootSection=null,this._domFootSwitch=null},e.prototype._addDOMEventListeners=function(){var t;return e.__super__._addDOMEventListeners.call(this),t=function(n){return n.preventDefault(),this.getAttribute("class").indexOf("ct-section--applied")>-1?ContentEdit.removeCSSClass(this,"ct-section--applied"):ContentEdit.addCSSClass(this,"ct-section--applied")},this._domHeadSection.addEventListener("click",t),this._domFootSection.addEventListener("click",t),this._domBodySection.addEventListener("click",function(n){return function(i){return n._domBodyInput.focus()}}(this)),this._domBodyInput.addEventListener("input",function(n){return function(i){var r;return r=/^[1-9]\d{0,1}$/.test(i.target.value),r?(ContentEdit.removeCSSClass(n._domBodyInput,"ct-section__input--invalid"),ContentEdit.removeCSSClass(n._domApply,"ct-control--muted")):(ContentEdit.addCSSClass(n._domBodyInput,"ct-section__input--invalid"),ContentEdit.addCSSClass(n._domApply,"ct-control--muted"))}}(this)),this._domApply.addEventListener("click",function(n){return function(i){var r;if(i.preventDefault(),r=n._domApply.getAttribute("class"),r.indexOf("ct-control--muted")===-1)return n.save()}}(this))},e}(_.DialogUI),_.VideoDialog=function(u){N(e,u);function e(){e.__super__.constructor.call(this,"Insert video")}return e.prototype.clearPreview=function(){if(this._domPreview)return this._domPreview.parentNode.removeChild(this._domPreview),this._domPreview=void 0},e.prototype.mount=function(){var t;return e.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-video-dialog"),ContentEdit.addCSSClass(this._domView,"ct-video-dialog__preview"),t=this.constructor.createDiv(["ct-control-group"]),this._domControls.appendChild(t),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-video-dialog__input"),this._domInput.setAttribute("name","url"),this._domInput.setAttribute("placeholder",ContentEdit._("Paste YouTube or Vimeo URL")+"..."),this._domInput.setAttribute("type","text"),t.appendChild(this._domInput),this._domButton=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--insert","ct-control--muted"]),this._domButton.textContent=ContentEdit._("Insert"),t.appendChild(this._domButton),this._addDOMEventListeners()},e.prototype.preview=function(t){return this.clearPreview(),this._domPreview=document.createElement("iframe"),this._domPreview.setAttribute("frameborder","0"),this._domPreview.setAttribute("height","100%"),this._domPreview.setAttribute("src",t),this._domPreview.setAttribute("width","100%"),this._domView.appendChild(this._domPreview)},e.prototype.save=function(){var t,n;return n=this._domInput.value.trim(),t=_.getEmbedVideoURL(n),t?this.dispatchEvent(this.createEvent("save",{url:t})):this.dispatchEvent(this.createEvent("save",{url:n}))},e.prototype.show=function(){return e.__super__.show.call(this),this._domInput.focus()},e.prototype.unmount=function(){return this.isMounted()&&this._domInput.blur(),e.__super__.unmount.call(this),this._domButton=null,this._domInput=null,this._domPreview=null},e.prototype._addDOMEventListeners=function(){return e.__super__._addDOMEventListeners.call(this),this._domInput.addEventListener("input",function(t){return function(n){var i;return n.target.value?ContentEdit.removeCSSClass(t._domButton,"ct-control--muted"):ContentEdit.addCSSClass(t._domButton,"ct-control--muted"),t._updatePreviewTimeout&&clearTimeout(t._updatePreviewTimeout),i=function(){var r,o;return o=t._domInput.value.trim(),r=_.getEmbedVideoURL(o),r?t.preview(r):t.clearPreview()},t._updatePreviewTimeout=setTimeout(i,500)}}(this)),this._domInput.addEventListener("keypress",function(t){return function(n){if(n.keyCode===13)return t.save()}}(this)),this._domButton.addEventListener("click",function(t){return function(n){var i;if(n.preventDefault(),i=t._domButton.getAttribute("class"),i.indexOf("ct-control--muted")===-1)return t.save()}}(this))},e}(_.DialogUI),_.HTMLCleaner=function(){u.DEFAULT_ATTRIBUTE_WHITELIST={a:["href"],td:["colspan"]},u.DEFAULT_TAG_WHITELIST=["a","address","b","blockquote","code","del","em","h1","h2","h3","h4","h5","h6","i","ins","li","ol","p","pre","strong","sup","table","tbody","td","tfoot","th","thead","tr","u","ul","#text"],u.NO_CONTENT_TAGS=["head","meta","style","script","title"];function u(e,t){this.tagWhitelist=e||this.constructor.DEFAULT_TAG_WHITELIST,this.attributeWhitelist=t||this.constructor.DEFAULT_ATTRIBUTE_WHITELIST}return u.prototype.clean=function(e){var t,n,i,r,o,s,a,c,p,g,v,C,T,w,I,R,A;for(e=e.replace(/<span( class="Apple-converted-space")?> <\/span>/g," "),p=document.implementation.createHTMLDocument(),C=p.createElement("div"),C.innerHTML=e,g=function(){var E,l,d,f;for(d=C.childNodes,f=[],E=0,l=d.length;E<l;E++)i=d[E],f.push(i);return f}();g.length>0;){if(o=g.shift(),s=o.nodeName.toLowerCase(),this.tagWhitelist.indexOf(s)<0){if(this.constructor.NO_CONTENT_TAGS.indexOf(s)>-1){o.remove();continue}for(A=o.childNodes,T=0,I=A.length;T<I;T++)r=A[T],r&&(r=r.cloneNode(!0),r.nodeName.toLowerCase(),o.parentNode.insertBefore(r,o),g.push(r));o.remove();continue}if(s!=="#text"&&o.textContent.trim()===""){o.textContent===""||o.parentNode===C?o.remove():o.parentNode.replaceChild(p.createTextNode(" "),o);continue}if((s==="td"||s==="th"||s==="li")&&o.querySelector("p")&&(o.innerHTML=o.textContent),o.attributes)for(c=this.attributeWhitelist[s]||[],a=function(){var E,l,d,f;for(d=o.attributes,f=[],E=0,l=d.length;E<l;E++)t=d[E],f.push(t);return f}(),w=0,R=a.length;w<R;w++){if(n=a[w],c.indexOf(n.name.toLowerCase())<0){o.removeAttribute(n.name);continue}if(n.name.toLowerCase()==="href"&&(v=o.getAttribute(n.name),v.startsWith("javascript:"))){o.removeAttribute(n.name);continue}}g.push.apply(g,function(){var E,l,d,f;for(d=o.childNodes,f=[],E=0,l=d.length;E<l;E++)i=d[E],f.push(i);return f}())}return C.innerHTML},u}(),z=function(u){N(e,u);function e(){e.__super__.constructor.call(this),this.history=null,this._state="dormant",this._busy=!1,this._namingProp=null,this._fixtureTest=function(t){return t.hasAttribute("data-fixture")},this._regionQuery=null,this._domRegions=null,this._regions={},this._orderedRegions=[],this._rootLastModified=null,this._regionsLastModified={},this._ignition=null,this._inspector=null,this._toolbox=null,this._emptyRegionsAllowed=!1}return e.prototype.ctrlDown=function(){return this._ctrlDown},e.prototype.domRegions=function(){return this._domRegions},e.prototype.getState=function(){return this._state},e.prototype.ignition=function(){return this._ignition},e.prototype.inspector=function(){return this._inspector},e.prototype.isDormant=function(){return this._state==="dormant"},e.prototype.isReady=function(){return this._state==="ready"},e.prototype.isEditing=function(){return this._state==="editing"},e.prototype.orderedRegions=function(){var t;return function(){var n,i,r,o;for(r=this._orderedRegions,o=[],n=0,i=r.length;n<i;n++)t=r[n],o.push(this._regions[t]);return o}.call(this)},e.prototype.regions=function(){return this._regions},e.prototype.shiftDown=function(){return this._shiftDown},e.prototype.toolbox=function(){return this._toolbox},e.prototype.busy=function(t){if(t===void 0)return this._busy;if(this._busy=t,this._ignition)return this._ignition.busy(t)},e.prototype.createPlaceholderElement=function(t){return new ContentEdit.Text("p",{},"")},e.prototype.init=function(t,n,i,r){return n==null&&(n="id"),i==null&&(i=null),r==null&&(r=!0),this._namingProp=n,i&&(this._fixtureTest=i),this.mount(),r&&(this._ignition=new _.IgnitionUI,this.attach(this._ignition),this._ignition.addEventListener("edit",function(o){return function(s){return s.preventDefault(),o.start(),o._ignition.state("editing")}}(this)),this._ignition.addEventListener("confirm",function(o){return function(s){if(s.preventDefault(),o._ignition.state()==="editing")return o._ignition.state("ready"),o.stop(!0)}}(this)),this._ignition.addEventListener("cancel",function(o){return function(s){if(s.preventDefault(),o._ignition.state()==="editing")return o.stop(!1),o.isEditing()?o._ignition.state("editing"):o._ignition.state("ready")}}(this))),this._toolbox=new _.ToolboxUI(_.DEFAULT_TOOLS),this.attach(this._toolbox),this._inspector=new _.InspectorUI,this.attach(this._inspector),this._state="ready",this._handleDetach=function(o){return function(s){return o._preventEmptyRegions()}}(this),this._handleClipboardPaste=function(o){return function(s,a){if(a.clipboardData){a.clipboardData.getData("text/html")&&s.type()!=="PreText"?o.pasteHTML(s,a.clipboardData.getData("text/html")):o.pasteText(s,a.clipboardData.getData("text/plain"));return}if(window.clipboardData)return window.clipboardData.getData("TEXT"),o.pasteText(s,window.clipboardData.getData("TEXT"))}}(this),this._handleNextRegionTransition=function(o){return function(s){var a,c,p,g,v,C,T;if(g=o.orderedRegions(),p=g.indexOf(s),!(p>=g.length-1)){for(s=g[p+1],c=null,T=s.descendants(),v=0,C=T.length;v<C;v++)if(a=T[v],a.content!==void 0){c=a;break}if(c){c.focus(),c.selection(new ContentSelect.Range(0,0));return}return ContentEdit.Root.get().trigger("next-region",s)}}}(this),this._handlePreviousRegionTransition=function(o){return function(s){var a,c,p,g,v,C,T,w;if(C=o.orderedRegions(),g=C.indexOf(s),!(g<=0)){for(s=C[g-1],p=null,c=s.descendants(),c.reverse(),T=0,w=c.length;T<w;T++)if(a=c[T],a.content!==void 0){p=a;break}if(p){v=p.content.length(),p.focus(),p.selection(new ContentSelect.Range(v,v));return}return ContentEdit.Root.get().trigger("previous-region",s)}}}(this),ContentEdit.Root.get().bind("detach",this._handleDetach),ContentEdit.Root.get().bind("paste",this._handleClipboardPaste),ContentEdit.Root.get().bind("next-region",this._handleNextRegionTransition),ContentEdit.Root.get().bind("previous-region",this._handlePreviousRegionTransition),this.syncRegions(t)},e.prototype.destroy=function(){return ContentEdit.Root.get().unbind("detach",this._handleDetach),ContentEdit.Root.get().unbind("paste",this._handleClipboardPaste),ContentEdit.Root.get().unbind("next-region",this._handleNextRegionTransition),ContentEdit.Root.get().unbind("previous-region",this._handlePreviousRegionTransition),this.removeEventListener(),this.unmount(),this._children=[]},e.prototype.highlightRegions=function(t){var n,i,r,o,s;for(o=this._domRegions,s=[],i=0,r=o.length;i<r;i++)n=o[i],t?s.push(ContentEdit.addCSSClass(n,"ct--highlight")):s.push(ContentEdit.removeCSSClass(n,"ct--highlight"));return s},e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-app"]),document.body.insertBefore(this._domElement,null),this._addDOMEventListeners()},e.prototype.unmount=function(){var t,n,i,r;if(!!this.isMounted()){for(r=this._children,n=0,i=r.length;n<i;n++)t=r[n],t.unmount();return this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,this._removeDOMEventListeners(),this._ignition=null,this._inspector=null,this._toolbox=null}},e.prototype.pasteHTML=function(t,n){var i,r,o,s,a,c,p,g,v,C,T,w,I,R,A,E,l,d,f,m,y,S,b,L,x,H,O,B,F;for(f=ContentEdit.TagNames.get(),l=document.implementation.createHTMLDocument(),b=l.createElement("div"),b.innerHTML=_.getHTMLCleaner().clean(n.trim()),o=[],B=b.childNodes,L=0,H=B.length;L<H;L++)r=B[L],r&&(r.nodeName.toLowerCase()==="#text"&&r.textContent.trim()===""||o.push(r));if(!!o.length){if(g=_.INLINE_TAGS.slice(),g.push("#text"),c=o[0].nodeName.toLowerCase(),C=o[o.length-1].nodeName.toLowerCase(),t.isFixed()||g.indexOf(c)>-1&&g.indexOf(C)>-1)if(g.indexOf(c)>-1&&g.indexOf(C)>-1?n=new HTMLString.String(b.innerHTML):n=new HTMLString.String(HTMLString.String.encode(b.textContent)),t.content){d=t.selection(),s=d.get()[0]+n.length(),S=t.content.substring(0,d.get()[0]),y=t.content.substring(d.get()[1]),E=t.content.substring(d.get()[0],d.get()[1]),E.length()&&(i=E.characters[0],m=i.tags(),i.isTag()&&m.shift(),m.length>=1&&(n=n.format.apply(n,[0,n.length()].concat(D.call(m))))),t.content=S.concat(n),t.content=t.content.concat(y,!1),t.updateInnerHTML(),t.taint(),d.set(s,s),t.selection(d);return}else b.innerHTML="<p>"+n.html()+"</p>";if(I=t,t.parent().type()!=="Region"&&(t=t.closest(function(U){return U.parent().type()==="Region"})),A=t.parent(),g.indexOf(c)>-1&&g.indexOf(C)>-1){for(v=b.createElement("p");b.childNodes.length>0;)v.appendChild(b.childNodes[0]);b.appendChild(v)}for(p=0,T=I,F=b.childNodes,x=0,O=F.length;x<O;x++)w=F[x],w&&(w.nodeName==="#text"&&w.textContent.trim()===""||(a=f.match(w.nodeName),a===ContentEdit.Static&&(R=document.createElement("p"),R.appendChild(w),w=R,a=ContentEdit.Text),T=a.fromDOMElement(w),A.attach(T,A.children.indexOf(t)+(1+p)),p+=1));if(T.focus)return T.focus();if(T.nextSibling()){if(T=T.nextSibling().previousWithTest(function(U){if(U.focus)return U}),T)return T.focus()}else return T=T.nextWithTest(function(U){if(U.focus)return U}),T?T.focus():I.focus()}},e.prototype.pasteText=function(t,n){var i,r,o,s,a,c,p,g,v,C,T,w,I,R,A,E,l,d,f,m,y,S;if(t.type()!=="PreText"?I=n.split(`
`):I=[n],I=I.filter(function(b){return b.trim()!==""}),!!I)if(o=HTMLString.String.encode,E=!0,m=t.type(),I.length===1&&(E=!1),m==="PreText"&&(E=!1),t.can("spawn")||(E=!1),E){for(m==="ListItemText"?(p=t.parent(),c=t.parent().parent(),a=c.children.indexOf(p)+1):(p=t,p.parent().type()!=="Region"&&(p=t.closest(function(b){return b.parent().type()==="Region"})),c=p.parent(),a=c.children.indexOf(p)+1),s=y=0,S=I.length;y<S;s=++y)T=I[s],T=o(T),m==="ListItemText"?(g=new ContentEdit.ListItem,v=new ContentEdit.ListItemText(T),g.attach(v),C=v):(g=new ContentEdit.Text("p",{},T),C=g),c.attach(g,a+s);return w=C.content.length(),C.focus(),C.selection(new ContentSelect.Range(w,w))}else return n=o(n),n=new HTMLString.String(n,m==="PreText"),A=t.selection(),r=A.get()[0]+n.length(),f=t.content.substring(0,A.get()[0]),d=t.content.substring(A.get()[1]),R=t.content.substring(A.get()[0],A.get()[1]),R.length()&&(i=R.characters[0],l=i.tags(),i.isTag()&&l.shift(),l.length>=1&&(n=n.format.apply(n,[0,n.length()].concat(D.call(l))))),t.content=f.concat(n),t.content=t.content.concat(d,!1),t.updateInnerHTML(),t.taint(),A.set(r,r),t.selection(A)},e.prototype.revert=function(){var t;if(!!this.dispatchEvent(this.createEvent("revert")))return _.CANCEL_MESSAGE&&(t=ContentEdit._(_.CANCEL_MESSAGE),ContentEdit.Root.get().lastModified()>this._rootLastModified&&!window.confirm(t))?!1:(this.revertToSnapshot(this.history.goTo(0),!1),!0)},e.prototype.revertToSnapshot=function(t,n){var i,r,o,s,a,c,p,g,v,C;n==null&&(n=!0),r=[],g=this._regions;for(o in g){for(s=g[o],v=s.children,c=0,p=v.length;c<p;c++)i=v[c],i.unmount();t.regions[o]!==void 0?s.children.length===1&&s.children[0].isFixed()?(a=this.constructor.createDiv(),a.innerHTML=t.regions[o],r.push(a.firstElementChild),s.domElement().parentNode.replaceChild(a.firstElementChild,s.domElement())):(r.push(s.domElement()),s.domElement().innerHTML=t.regions[o]):(s.domElement().remove(),delete this._regions[o])}if(this._domRegions=r,n){ContentEdit.Root.get().focused()&&ContentEdit.Root.get().focused().blur(),this._regions={},this.syncRegions(null,!0),ContentEdit.Root.get()._modified=t.rootModified,C=this._regions;for(o in C)s=C[o],t.regionModifieds[o]&&(s._modified=t.regionModifieds[o]);return this.history.replaceRegions(this._regions),this.history.restoreSelection(t),this._inspector.updateTags()}},e.prototype.save=function(t){var n,i,r,o,s,a,c,p,g,v,C,T;if(!!this.dispatchEvent(this.createEvent("save",{passive:t}))){if(c=ContentEdit.Root.get(),c.focused()&&!t&&c.focused().blur(),c.lastModified()===this._rootLastModified&&t){this.dispatchEvent(this.createEvent("saved",{regions:{},passive:t}));return}i=[],o={},C=this._regions;for(s in C){if(a=C[s],r=a.html(),a.children.length===1&&!a.type()==="Fixture"&&(n=a.children[0],n.content&&!n.content.html()&&(r="")),!t){for(T=a.children,g=0,v=T.length;g<v;g++)n=T[g],n.unmount();a.children.length===1&&a.children[0].isFixed()?(p=this.constructor.createDiv(),p.innerHTML=r,i.push(p.firstElementChild),a.domElement().parentNode.replaceChild(p.firstElementChild,a.domElement())):(i.push(a.domElement()),a.domElement().innerHTML=r)}a.lastModified()!==this._regionsLastModified[s]&&(o[s]=r,this._regionsLastModified[s]=a.lastModified())}return this._domRegions=i,this.dispatchEvent(this.createEvent("saved",{regions:o,passive:t}))}},e.prototype.setRegionOrder=function(t){return this._orderedRegions=t.slice()},e.prototype.start=function(){if(!!this.dispatchEvent(this.createEvent("start")))return this.busy(!0),this.syncRegions(),this._initRegions(),this._preventEmptyRegions(),this._rootLastModified=ContentEdit.Root.get().lastModified(),this.history=new _.History(this._regions),this.history.watch(),this._state="editing",this._toolbox.show(),this._inspector.show(),this.busy(!1),this.dispatchEvent(this.createEvent("started"))},e.prototype.stop=function(t){var n;if(!!this.dispatchEvent(this.createEvent("stop",{save:t}))){if(n=ContentEdit.Root.get().focused(),n&&n.isMounted()&&n._syncContent!==void 0&&n._syncContent(),t)this.save();else if(!this.revert())return;return this.history.stopWatching(),this.history=null,this._toolbox.hide(),this._inspector.hide(),this._regions={},this._state="ready",ContentEdit.Root.get().focused()&&this._allowEmptyRegions(function(i){return function(){return ContentEdit.Root.get().focused().blur()}}()),this.dispatchEvent(this.createEvent("stopped"))}},e.prototype.syncRegions=function(t,n){if(t&&(this._regionQuery=t),this._domRegions=[],this._regionQuery&&(typeof this._regionQuery=="string"||this._regionQuery instanceof String?this._domRegions=document.querySelectorAll(this._regionQuery):this._domRegions=this._regionQuery),this._state==="editing"&&(this._initRegions(n),this._preventEmptyRegions()),this._ignition)return this._domRegions.length?this._ignition.show():this._ignition.hide()},e.prototype._addDOMEventListeners=function(){return this._handleHighlightOn=function(t){return function(n){var i;if(((i=n.keyCode)===17||i===224||i===91||i===93)&&(t._ctrlDown=!0),n.keyCode===16&&!t._ctrlDown){if(t._highlightTimeout)return;t._shiftDown=!0,t._highlightTimeout=setTimeout(function(){return t.highlightRegions(!0)},_.HIGHLIGHT_HOLD_DURATION);return}return clearTimeout(t._highlightTimeout),t.highlightRegions(!1)}}(this),this._handleHighlightOff=function(t){return function(n){var i;if((i=n.keyCode)===17||i===224||i===91||i===93){t._ctrlDown=!1;return}if(n.keyCode===16)return t._shiftDown=!1,t._highlightTimeout&&(clearTimeout(t._highlightTimeout),t._highlightTimeout=null),t.highlightRegions(!1)}}(this),this._handleVisibility=function(t){return function(n){if(!document.hasFocus())return clearTimeout(t._highlightTimeout),t.highlightRegions(!1)}}(this),document.addEventListener("keydown",this._handleHighlightOn),document.addEventListener("keyup",this._handleHighlightOff),document.addEventListener("visibilitychange",this._handleVisibility),this._handleBeforeUnload=function(t){return function(n){var i;if(t._state==="editing"&&_.CANCEL_MESSAGE&&t.history&&t.history._snapshotIndex)return i=ContentEdit._(_.CANCEL_MESSAGE),(n||window.event).returnValue=i,i}}(this),window.addEventListener("beforeunload",this._handleBeforeUnload),this._handleUnload=function(t){return function(n){return t.destroy()}}(this),window.addEventListener("unload",this._handleUnload)},e.prototype._allowEmptyRegions=function(t){return this._emptyRegionsAllowed=!0,t(),this._emptyRegionsAllowed=!1},e.prototype._preventEmptyRegions=function(){var t,n,i,r,o,s,a,c,p,g,v;if(!this._emptyRegionsAllowed){p=this._regions,v=[];for(r in p){for(s=p[r],i=s.lastModified(),n=!1,g=s.children,a=0,c=g.length;a<c;a++)if(t=g[a],t.type()!=="Static"){n=!0;break}n||(o=this.createPlaceholderElement(s),s.attach(o),v.push(s._modified=i))}return v}},e.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keydown",this._handleHighlightOn),document.removeEventListener("keyup",this._handleHighlightOff),window.removeEventListener("beforeunload",this._handleBeforeUnload),window.removeEventListener("unload",this._handleUnload)},e.prototype._initRegions=function(t){var n,i,r,o,s,a,c,p,g,v,C;for(t==null&&(t=!1),r={},i=[],this._orderedRegions=[],g=this._domRegions,o=c=0,p=g.length;c<p;o=++c)n=g[o],a=n.getAttribute(this._namingProp),a||(a=o),r[a]=!0,this._orderedRegions.push(a),!(this._regions[a]&&this._regions[a].domElement()===n)&&(this._fixtureTest(n)?this._regions[a]=new ContentEdit.Fixture(n):this._regions[a]=new ContentEdit.Region(n),i.push(this._regions[a].domElement()),t||(this._regionsLastModified[a]=this._regions[a].lastModified()));this._domRegions=i,v=this._regions,C=[];for(a in v)r[a]||(delete this._regions[a],delete this._regionsLastModified[a],s=this._orderedRegions.indexOf(a),s>-1?C.push(this._orderedRegions.splice(s,1)):C.push(void 0));return C},e}(_.ComponentUI),_.EditorApp=function(){var u;function e(){}return u=null,e.get=function(){var t;return t=_.EditorApp.getCls(),u!=null?u:u=new t},e.getCls=function(){return z},e}(),_.History=function(){function u(e){this._lastSnapshotTaken=null,this._regions={},this.replaceRegions(e),this._snapshotIndex=-1,this._snapshots=[],this._store()}return u.prototype.canRedo=function(){return this._snapshotIndex<this._snapshots.length-1},u.prototype.canUndo=function(){return this._snapshotIndex>0},u.prototype.index=function(){return this._snapshotIndex},u.prototype.length=function(){return this._snapshots.length},u.prototype.snapshot=function(){return this._snapshots[this._snapshotIndex]},u.prototype.goTo=function(e){return this._snapshotIndex=Math.min(this._snapshots.length-1,Math.max(0,e)),this.snapshot()},u.prototype.redo=function(){return this.goTo(this._snapshotIndex+1)},u.prototype.replaceRegions=function(e){var t,n,i;this._regions={},i=[];for(t in e)n=e[t],i.push(this._regions[t]=n);return i},u.prototype.restoreSelection=function(e){var t,n;if(!!e.selected&&(n=this._regions[e.selected.region],t=n.descendants()[e.selected.element],t.focus(),t.selection&&e.selected.selection))return t.selection(e.selected.selection)},u.prototype.stopWatching=function(){if(this._watchInterval&&clearInterval(this._watchInterval),this._delayedStoreTimeout)return clearTimeout(this._delayedStoreTimeout)},u.prototype.undo=function(){return this.goTo(this._snapshotIndex-1)},u.prototype.watch=function(){var e;return this._lastSnapshotTaken=Date.now(),e=function(t){return function(){var n,i;if(i=ContentEdit.Root.get().lastModified(),i!==null&&i>t._lastSnapshotTaken)return t._delayedStoreRequested===i?void 0:(t._delayedStoreTimeout&&clearTimeout(t._delayedStoreTimeout),n=function(){return t._lastSnapshotTaken=i,t._store()},t._delayedStoreRequested=i,t._delayedStoreTimeout=setTimeout(n,500))}}(this),this._watchInterval=setInterval(e,50)},u.prototype._store=function(){var e,t,n,i,r,o,s;r={regions:{},regionModifieds:{},rootModified:ContentEdit.Root.get().lastModified(),selected:null},o=this._regions;for(t in o)i=o[t],r.regions[t]=i.html(),r.regionModifieds[t]=i.lastModified();if(e=ContentEdit.Root.get().focused(),e){if(r.selected={},i=e.closest(function(a){return a.type()==="Region"||a.type()==="Fixture"}),!i)return;s=this._regions;for(t in s)if(n=s[t],i===n){r.selected.region=t;break}r.selected.element=i.descendants().indexOf(e),e.selection&&(r.selected.selection=e.selection())}return this._snapshotIndex<this._snapshots.length-1&&(this._snapshots=this._snapshots.slice(0,this._snapshotIndex+1)),this._snapshotIndex++,this._snapshots.splice(this._snapshotIndex,0,r)},u}(),_.StylePalette=function(){function u(){}return u._styles=[],u.add=function(e){return this._styles=this._styles.concat(e)},u.styles=function(e){var t;return e===void 0?this._styles.slice():(t=e.tagName(),this._styles.filter(function(n){return n._applicableTo?n._applicableTo.indexOf(t)!==-1:!0}))},u}(),_.Style=function(){function u(e,t,n){this._name=e,this._cssClass=t,n?this._applicableTo=n:this._applicableTo=null}return u.prototype.applicableTo=function(){return this._applicableTo},u.prototype.cssClass=function(){return this._cssClass},u.prototype.name=function(){return this._name},u}(),_.ToolShelf=function(){function u(){}return u._tools={},u.stow=function(e,t){return this._tools[t]=e},u.fetch=function(e){if(!this._tools[e])throw new Error("`"+e+"` has not been stowed on the tool shelf");return this._tools[e]},u}(),_.Tool=function(){function u(){}return u.label="Tool",u.icon="tool",u.requiresElement=!0,u.canApply=function(e,t){return!1},u.isApplied=function(e,t){return!1},u.apply=function(e,t,n){throw new Error("Not implemented")},u.editor=function(){return _.EditorApp.get()},u.dispatchEditorEvent=function(e,t){return this.editor().dispatchEvent(this.editor().createEvent(e,t))},u._insertAt=function(e){var t,n;return n=e,n.parent().type()!=="Region"&&(n=e.closest(function(i){return i.parent().type()==="Region"})),t=n.parent().children.indexOf(n)+1,[n,t]},u}(),_.Tools.Bold=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"bold"),e.label="Bold",e.icon="bold",e.tagName="b",e.canApply=function(t,n){return t.content?n&&!n.isCollapsed():!1},e.isApplied=function(t,n){var i,r,o;return t.content===void 0||!t.content.length()?!1:(o=n.get(),i=o[0],r=o[1],i===r&&(r+=1),t.content.slice(i,r).hasTags(this.tagName,!0))},e.apply=function(t,n,i){var r,o,s,a;if(s={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",s))return t.storeState(),a=n.get(),r=a[0],o=a[1],this.isApplied(t,n)?t.content=t.content.unformat(r,o,new HTMLString.Tag(this.tagName)):t.content=t.content.format(r,o,new HTMLString.Tag(this.tagName)),t.content.optimize(),t.updateInnerHTML(),t.taint(),t.restoreState(),i(!0),this.dispatchEditorEvent("tool-applied",s)},e}(_.Tool),_.Tools.Italic=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"italic"),e.label="Italic",e.icon="italic",e.tagName="i",e}(_.Tools.Bold),_.Tools.Link=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"link"),e.label="Link",e.icon="link",e.tagName="a",e.getAttr=function(t,n,i){var r,o,s,a,c,p,g,v,C,T,w,I;if(n.type()==="Image"){if(n.a)return n.a[t]}else{if(n.isFixed()&&n.tagName()==="a")return n.attr(t);for(T=i.get(),o=T[0],c=T[1],s=n.content.slice(o,c),w=s.characters,p=0,v=w.length;p<v;p++)if(r=w[p],!!r.hasTags("a")){for(I=r.tags(),g=0,C=I.length;g<C;g++)if(a=I[g],a.name()==="a")return a.attr(t)}}return""},e.canApply=function(t,n){var i;return t.type()==="Image"||t.isFixed()&&t.tagName()==="a"?!0:!(!t.content||!n||n.isCollapsed()&&(i=t.content.characters[n.get()[0]],!i||!i.hasTags("a")))},e.isApplied=function(t,n){return t.type()==="Image"?t.a:t.isFixed()&&t.tagName()==="a"?!0:e.__super__.constructor.isApplied.call(this,t,n)},e.apply=function(t,n,i){var r,o,s,a,c,p,g,v,C,T,w,I,R,A,E,l,d,f;if(l={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",l)){if(o=!1,t.type()==="Image")T=t.domElement().getBoundingClientRect();else if(t.isFixed()&&t.tagName()==="a")T=t.domElement().getBoundingClientRect();else{if(n.isCollapsed()){for(s=t.content.characters,A=n.get(0)[0],p=A;A>0&&s[A-1].hasTags("a");)A-=1;for(;p<s.length&&s[p].hasTags("a");)p+=1;n=new ContentSelect.Range(A,p),n.select(t.domElement())}t.storeState(),R=new HTMLString.Tag("span",{class:"ct--pseudo-select"}),d=n.get(),g=d[0],E=d[1],t.content=t.content.format(g,E,R),t.updateInnerHTML(),c=t.domElement(),v=c.getElementsByClassName("ct--pseudo-select"),T=v[0].getBoundingClientRect()}return r=_.EditorApp.get(),C=new _.ModalUI(!0,!0),C.addEventListener("click",function(){if(this.unmount(),a.hide(),t.content&&(t.content=t.content.unformat(g,E,R),t.updateInnerHTML(),t.restoreState()),i(o),o)return _.Tools.Link.dispatchEditorEvent("tool-applied",l)}),a=new _.LinkDialog(this.getAttr("href",t,n),this.getAttr("target",t,n)),f=_.getScrollPosition(),w=f[0],I=f[1],a.position([T.left+T.width/2+w,T.top+T.height/2+I]),a.addEventListener("save",function(m){var y,S,b,L,x,H,O,B,F,U,W,G,j,q,K,X;if(L=m.detail(),o=!0,t.type()==="Image"){if(S=["align-center","align-left","align-right"],L.href){for(t.a={href:L.href},L.target&&(t.a.target=L.target),F=0,j=S.length;F<j;F++)if(b=S[F],t.hasCSSClass(b)){t.removeCSSClass(b),t.a.class=b;break}}else{for(O=[],t.a.class&&(O=t.a.class.split(" ")),U=0,q=S.length;U<q;U++)if(b=S[U],O.indexOf(b)>-1){t.addCSSClass(b);break}t.a=null}t.unmount(),t.mount()}else if(t.isFixed()&&t.tagName()==="a")t.attr("href",L.href);else{for(x=null,H=W=g;g<=E?W<E:W>E;H=g<=E?++W:--W){for(X=t.content.characters[H].tags(),G=0,K=X.length;G<K;G++)if(B=X[G],B.name()==="a"){x=B;break}if(x)break}t.content=t.content.unformat(g,E,"a"),L.href&&(x?y=x.copy():y=new HTMLString.Tag("a"),y.attr("href",L.href),L.target?y.attr("target",L.target):y.removeAttr("target"),console.log(y),t.content=t.content.format(g,E,y),t.content.optimize()),t.updateInnerHTML()}return t.taint(),C.dispatchEvent(C.createEvent("click"))}),r.attach(C),r.attach(a),C.show(),a.show()}},e}(_.Tools.Bold),_.Tools.Heading=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"heading"),e.label="Heading",e.icon="heading",e.tagName="h1",e.canApply=function(t,n){return t.isFixed()?!1:t.content!==void 0&&["Text","PreText"].indexOf(t.type())!==-1},e.isApplied=function(t,n){return!t.content||["Text","PreText"].indexOf(t.type())===-1?!1:t.tagName()===this.tagName},e.apply=function(t,n,i){var r,o,s,a,c;if(c={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",c))return t.storeState(),t.type()==="PreText"?(r=t.content.html().replace(/&nbsp;/g," "),a=new ContentEdit.Text(this.tagName,{},r),s=t.parent(),o=s.children.indexOf(t),s.detach(t),s.attach(a,o),t.blur(),a.focus(),a.selection(n)):(t.removeAttr("class"),t.tagName()===this.tagName?t.tagName("p"):t.tagName(this.tagName),t.restoreState()),this.dispatchEditorEvent("tool-applied",c),i(!0)},e}(_.Tool),_.Tools.Subheading=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"subheading"),e.label="Subheading",e.icon="subheading",e.tagName="h2",e}(_.Tools.Heading),_.Tools.Paragraph=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"paragraph"),e.label="Paragraph",e.icon="paragraph",e.tagName="p",e.canApply=function(t,n){return t.isFixed()?!1:t!==void 0},e.apply=function(t,n,i){var r,o,s,a;return r=this.editor().ctrlDown(),_.Tools.Heading.canApply(t)&&!r?e.__super__.constructor.apply.call(this,t,n,i):(a={tool:this,element:t,selection:n},this.dispatchEditorEvent("tool-apply",a)?(t.parent().type()!=="Region"&&(t=t.closest(function(c){return c.parent().type()==="Region"})),s=t.parent(),o=new ContentEdit.Text("p"),s.attach(o,s.children.indexOf(t)+1),o.focus(),i(!0),this.dispatchEditorEvent("tool-applied",a)):void 0)},e}(_.Tools.Heading),_.Tools.Preformatted=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"preformatted"),e.label="Preformatted",e.icon="preformatted",e.tagName="pre",e.apply=function(t,n,i){var r,o,s,a,c;if(c={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",c)){if(t.type()==="PreText"){_.Tools.Paragraph.apply(t,n,i);return}return a=t.content.text(),s=new ContentEdit.PreText("pre",{},HTMLString.String.encode(a)),o=t.parent(),r=o.children.indexOf(t),o.detach(t),o.attach(s,r),t.blur(),s.focus(),s.selection(n),i(!0),this.dispatchEditorEvent("tool-applied",c)}},e}(_.Tools.Heading),_.Tools.AlignLeft=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"align-left"),e.label="Align left",e.icon="align-left",e.className="text-left",e.canApply=function(t,n){return t.content!==void 0},e.isApplied=function(t,n){var i;return this.canApply(t)?(((i=t.type())==="ListItemText"||i==="TableCellText")&&(t=t.parent()),t.hasCSSClass(this.className)):!1},e.apply=function(t,n,i){var r,o,s,a,c,p;if(s={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",s)){for(((p=t.type())==="ListItemText"||p==="TableCellText")&&(t=t.parent()),r=[_.Tools.AlignLeft.className,_.Tools.AlignCenter.className,_.Tools.AlignRight.className],a=0,c=r.length;a<c;a++)if(o=r[a],t.hasCSSClass(o)&&(t.removeCSSClass(o),o===this.className))return i(!0);return t.addCSSClass(this.className),i(!0),this.dispatchEditorEvent("tool-applied",s)}},e}(_.Tool),_.Tools.AlignCenter=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"align-center"),e.label="Align center",e.icon="align-center",e.className="text-center",e}(_.Tools.AlignLeft),_.Tools.AlignRight=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"align-right"),e.label="Align right",e.icon="align-right",e.className="text-right",e}(_.Tools.AlignLeft),_.Tools.UnorderedList=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"unordered-list"),e.label="Bullet list",e.icon="unordered-list",e.listTag="ul",e.canApply=function(t,n){var i;return t.isFixed()?!1:t.content!==void 0&&((i=t.parent().type())==="Region"||i==="ListItem")},e.apply=function(t,n,i){var r,o,s,a,c,p;if(p={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",p))return t.parent().type()==="ListItem"?(t.storeState(),o=t.closest(function(g){return g.type()==="List"}),o.tagName(this.listTag),t.restoreState()):(a=new ContentEdit.ListItemText(t.content.copy()),s=new ContentEdit.ListItem,s.attach(a),o=new ContentEdit.List(this.listTag,{}),o.attach(s),c=t.parent(),r=c.children.indexOf(t),c.detach(t),c.attach(o,r),a.focus(),a.selection(n)),i(!0),this.dispatchEditorEvent("tool-applied",p)},e}(_.Tool),_.Tools.OrderedList=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"ordered-list"),e.label="Numbers list",e.icon="ordered-list",e.listTag="ol",e}(_.Tools.UnorderedList),_.Tools.Table=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"table"),e.label="Table",e.icon="table",e.canApply=function(t,n){return t.isFixed()?!1:t!==void 0},e.apply=function(t,n,i){var r,o,s,a,c;if(c={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",c))return t.storeState&&t.storeState(),r=_.EditorApp.get(),s=new _.ModalUI,a=t.closest(function(p){return p&&p.type()==="Table"}),o=new _.TableDialog(a),o.addEventListener("cancel",function(p){return function(){return s.hide(),o.hide(),t.restoreState&&t.restoreState(),i(!1)}}()),o.addEventListener("save",function(p){return function(g){var v,C,T,w,I;return w=g.detail(),C=!0,a?(p._updateTable(w,a),C=t.closest(function(R){return R&&R.type()==="Table"})):(a=p._createTable(w),I=p._insertAt(t),T=I[0],v=I[1],T.parent().attach(a,v),C=!1),C?t.restoreState():a.firstSection().children[0].children[0].children[0].focus(),s.hide(),o.hide(),i(!0),p.dispatchEditorEvent("tool-applied",c)}}(this)),r.attach(s),r.attach(o),s.show(),o.show()},e._adjustColumns=function(t,n){var i,r,o,s,a,c,p,g,v,C;for(v=t.children,C=[],p=0,g=v.length;p<g;p++)c=v[p],r=c.children[0].tagName(),s=c.children.length,a=n-s,a<0?C.push(function(){var T,w;for(w=[],T=a;a<=0?T<0:T>0;a<=0?++T:--T)i=c.children[c.children.length-1],w.push(c.detach(i));return w}()):a>0?C.push(function(){var T,w;for(w=[],T=0;0<=a?T<a:T>a;0<=a?++T:--T)i=new ContentEdit.TableCell(r),c.attach(i),o=new ContentEdit.TableCellText(""),w.push(i.attach(o));return w}()):C.push(void 0);return C},e._createTable=function(t){var n,i,r,o;return o=new ContentEdit.Table,t.head&&(r=this._createTableSection("thead","th",t.columns),o.attach(r)),n=this._createTableSection("tbody","td",t.columns),o.attach(n),t.foot&&(i=this._createTableSection("tfoot","td",t.columns),o.attach(i)),o},e._createTableSection=function(t,n,i){var r,o,s,a,c;for(a=new ContentEdit.TableSection(t),s=new ContentEdit.TableRow,a.attach(s),c=0;0<=i?c<i:c>i;0<=i?++c:--c)r=new ContentEdit.TableCell(n),s.attach(r),o=new ContentEdit.TableCellText(""),r.attach(o);return a},e._updateTable=function(t,n){var i,r,o,s,a,c,p;if(!t.head&&n.thead()&&n.detach(n.thead()),!t.foot&&n.tfoot()&&n.detach(n.tfoot()),i=n.firstSection().children[0].children.length,t.columns!==i)for(p=n.children,a=0,c=p.length;a<c;a++)s=p[a],this._adjustColumns(s,t.columns);if(t.head&&!n.thead()&&(o=this._createTableSection("thead","th",t.columns),n.attach(o,0)),t.foot&&!n.tfoot())return r=this._createTableSection("tfoot","td",t.columns),n.attach(r)},e}(_.Tool),_.Tools.Indent=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"indent"),e.label="Indent",e.icon="indent",e.canApply=function(t,n){return t.parent().type()==="ListItem"&&t.parent().parent().children.indexOf(t.parent())>0},e.apply=function(t,n,i){var r;if(r={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",r))return t.parent().indent(),i(!0),this.dispatchEditorEvent("tool-applied",r)},e}(_.Tool),_.Tools.Unindent=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"unindent"),e.label="Unindent",e.icon="unindent",e.canApply=function(t,n){return t.parent().type()==="ListItem"},e.apply=function(t,n,i){var r;if(r={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",r))return t.parent().unindent(),i(!0),this.dispatchEditorEvent("tool-applied",r)},e}(_.Tool),_.Tools.LineBreak=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"line-break"),e.label="Line break",e.icon="line-break",e.canApply=function(t,n){return t.content},e.apply=function(t,n,i){var r,o,s,a,c;if(c={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",c))return o=n.get()[0]+1,a=t.content.substring(0,n.get()[0]),s=t.content.substring(n.get()[1]),r=new HTMLString.String("<br>",t.content.preserveWhitespace()),t.content=a.concat(r,s),t.updateInnerHTML(),t.taint(),n.set(o,o),t.selection(n),i(!0),this.dispatchEditorEvent("tool-applied",c)},e}(_.Tool),_.Tools.Image=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"image"),e.label="Image",e.icon="image",e.canApply=function(t,n){return!(t.isFixed()&&t.type()!=="ImageFixture")},e.apply=function(t,n,i){var r,o,s,a;if(a={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",a))return t.storeState&&t.storeState(),r=_.EditorApp.get(),s=new _.ModalUI,o=new _.ImageDialog,o.addEventListener("cancel",function(c){return function(){return s.hide(),o.hide(),t.restoreState&&t.restoreState(),i(!1)}}()),o.addEventListener("save",function(c){return function(p){var g,v,C,T,w,I,R,A;return g=p.detail(),w=g.imageURL,T=g.imageSize,C=g.imageAttrs,C||(C={}),C.height=T[1],C.src=w,C.width=T[0],t.type()==="ImageFixture"?t.src(w):(v=new ContentEdit.Image(C),A=c._insertAt(t),R=A[0],I=A[1],R.parent().attach(v,I),v.focus()),s.hide(),o.hide(),i(!0),c.dispatchEditorEvent("tool-applied",a)}}(this)),r.attach(s),r.attach(o),s.show(),o.show()},e}(_.Tool),_.Tools.Video=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"video"),e.label="Video",e.icon="video",e.canApply=function(t,n){return!t.isFixed()},e.apply=function(t,n,i){var r,o,s,a;if(a={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",a))return t.storeState&&t.storeState(),r=_.EditorApp.get(),s=new _.ModalUI,o=new _.VideoDialog,o.addEventListener("cancel",function(c){return function(){return s.hide(),o.hide(),t.restoreState&&t.restoreState(),i(!1)}}()),o.addEventListener("save",function(c){return function(p){var g,v,C,T,w,I;if(T=p.detail().url,T?(w=new ContentEdit.Video("iframe",{frameborder:0,height:_.DEFAULT_VIDEO_HEIGHT,src:T,width:_.DEFAULT_VIDEO_WIDTH}),I=c._insertAt(t),C=I[0],v=I[1],C.parent().attach(w,v),w.focus()):t.restoreState&&t.restoreState(),s.hide(),o.hide(),g=T!=="",i(g),g)return c.dispatchEditorEvent("tool-applied",a)}}(this)),r.attach(s),r.attach(o),s.show(),o.show()},e}(_.Tool),_.Tools.Undo=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"undo"),e.label="Undo",e.icon="undo",e.requiresElement=!1,e.canApply=function(t,n){var i;return i=_.EditorApp.get(),i.history&&i.history.canUndo()},e.apply=function(t,n,i){var r,o,s;if(s={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",s))return r=this.editor(),r.history.stopWatching(),o=r.history.undo(),r.revertToSnapshot(o),r.history.watch(),this.dispatchEditorEvent("tool-applied",s)},e}(_.Tool),_.Tools.Redo=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"redo"),e.label="Redo",e.icon="redo",e.requiresElement=!1,e.canApply=function(t,n){var i;return i=_.EditorApp.get(),i.history&&i.history.canRedo()},e.apply=function(t,n,i){var r,o,s;if(s={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",s))return r=_.EditorApp.get(),r.history.stopWatching(),o=r.history.redo(),r.revertToSnapshot(o),r.history.watch(),this.dispatchEditorEvent("tool-applied",s)},e}(_.Tool),_.Tools.Remove=function(u){N(e,u);function e(){return e.__super__.constructor.apply(this,arguments)}return _.ToolShelf.stow(e,"remove"),e.label="Remove",e.icon="remove",e.canApply=function(t,n){return!t.isFixed()},e.apply=function(t,n,i){var r,o,s,a,c;if(c={tool:this,element:t,selection:n},!!this.dispatchEditorEvent("tool-apply",c)){if(r=this.editor(),t.blur(),t.nextContent()?t.nextContent().focus():t.previousContent()&&t.previousContent().focus(),!t.isMounted()){i(!0),this.dispatchEditorEvent("tool-applied",c);return}switch(t.type()){case"ListItemText":r.ctrlDown()?(o=t.closest(function(p){return p.parent().type()==="Region"}),o.parent().detach(o)):t.parent().parent().detach(t.parent());break;case"TableCellText":r.ctrlDown()?(a=t.closest(function(p){return p.type()==="Table"}),a.parent().detach(a)):(s=t.parent().parent(),s.parent().detach(s));break;default:t.parent().detach(t);break}return i(!0),this.dispatchEditorEvent("tool-applied",c)}},e}(_.Tool)}.call(tt)})(ft);var mt=ft.exports;export{mt as C};
