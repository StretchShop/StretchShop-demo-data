import{r as b,o as a,c,F as _,d as m,e as p,w as f,a as s,t as d,h as u,i as v,b as y}from"./sett-kcacPgfM.js";import{_ as $}from"./index-dpUgND6i.js";const S={name:"GlobalSearchResultRow",props:["results","type"],data(){return{searchTimeout:null,searchQuery:"",searchResults:null}},created:function(){},mounted:function(){},computed:{getLang:function(){return this.$store&&this.$store.state&&this.$store.state.language.code?this.$store.state.language.code:this.propLang?this.propLang:"en"}},methods:{getImage(e,l){return e.price>0?this.getProductImagePath(e.orderCode):this.getPageImagePath(e.slug)},getProductImagePath(e){return e&&this.$store&&this.$store.state&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getProductImagePath(this.$store.state.coredata,e):null},getPageImagePath(e){return e&&this.$store&&this.$store.state&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getImagePath("pages",this.$store.state.coredata,"cover/"+e,"cover.jpg"):null}}},R={key:0,id:"GlobalSearchResults"},k={key:0,class:"is-4"},I={class:"media"},L={class:"media-left"},P={class:"image is-48x48"},G=["src","alt"],Q={class:"media-content"},T={key:1,class:"is-4"},w={class:"media"},x={class:"media-left"},C={class:"image is-48x48"},D=["src","alt"],B={class:"media-content"},U={key:2,class:"is-4"},A={class:"media"},F={class:"media-left"},N={class:"image is-48x48"},V=["src","alt"],j={class:"media-content"};function H(e,l,i,n,r,o){const h=b("router-link");return i.results?(a(),c("div",R,[i.type==="product"?(a(),c("div",k,[(a(!0),c(_,null,m(i.results,(t,g)=>(a(),p(h,{key:t._id+"pro"+g,tag:"a",class:"result-link py-4",to:{name:"productDetail",params:{category:t.categories[0],product:t._id,slug:t.slug}}},{default:f(()=>[s("article",I,[s("figure",L,[s("p",P,[s("img",{src:o.getImage(t,e.listType),alt:t.name[o.getLang],onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,G)])]),s("div",Q,[s("strong",null,d(t.name[o.getLang]),1),s("p",null,d(t.descriptionShort[o.getLang]),1)])])]),_:2},1032,["to"]))),128))])):i.type==="page"?(a(),c("div",T,[(a(!0),c(_,null,m(i.results,(t,g)=>(a(),p(h,{key:t._id+"pag"+g,tag:"a",class:"result-link py-4",to:{name:"pageDetail",params:{category:t.categories[0],product:t._id,slug:t.slug}}},{default:f(()=>[s("article",w,[s("figure",x,[s("p",C,[s("img",{src:o.getImage(t,e.listType),alt:t.name[o.getLang],onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,D)])]),s("div",B,[s("strong",null,d(t.name[o.getLang]),1),s("p",null,d(t.descriptionShort[o.getLang]),1)])])]),_:2},1032,["to"]))),128))])):i.type==="category"?(a(),c("div",U,[(a(!0),c(_,null,m(i.results,(t,g)=>(a(),p(h,{key:t._id+"cat"+g,tag:"a",class:"result-link py-4",to:{name:"categoryList",params:{category:t.pathSlug}}},{default:f(()=>[s("article",A,[s("figure",F,[s("p",N,[s("img",{src:o.getImage(t,e.listType),alt:t.name[o.getLang],onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,V)])]),s("div",j,[s("strong",null,d(t.name[o.getLang]),1),s("p",null,d(t.descriptionShort[o.getLang]),1)])])]),_:2},1032,["to"]))),128))])):u("",!0)])):u("",!0)}const O=$(S,[["render",H],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/global/GlobalSearchResultRow.vue"]]),E={name:"GlobalSearch",components:{"global-search-result-row":O},data(){return{searchTimeout:null,searchQuery:"",searchResults:null}},created:function(){},mounted:function(){if(console.debug("url query: ",this.$route),this.$route.params&&this.$route.params.query){let e=this.$route.params.query;e=this.cleanQuery(e),e!==""&&(this.updateInput(e),this.globalSearch(e))}else this.$refs.searchQuery.focus()},methods:{inputSearch(e){const l=this.cleanQuery(e.target.value);l&&this.globalSearch(l)},cleanQuery(e){return e=e.toString().trim(),e.indexOf("/")>-1&&(e=e.split("/")[0]),e},globalSearch(e){const l=this;this.searchTimeout!==null&&clearTimeout(this.searchTimeout),e.length>=3?(this.$helpers.formUndecorateAndDecorateFields(["globalSearch"],[]),this.searchQuery=e,this.searchTimeout=setTimeout(()=>{this.$httpc.post("find",{query:e}).then(function(i){if(i&&i.data){l.searchResults=i.data;let n=l.$route.path.split("/");n=n.filter(Boolean);let r=[...n];n.length>2&&(r=n.slice(0,2)),history.pushState({},null,"/"+r.join("/")+"/"+encodeURIComponent(e))}})},1e3)):this.$helpers.formUndecorateAndDecorateFields(["globalSearch"],[{name:"globalSearch",action:"too-short"}])},updateInput(e){this.$refs.searchQuery.value=e}}},K={id:"GlobalSearch",class:"mt-4"},M=s("h2",{class:"title is-2",translate:"yes"},"Global search",-1),z=s("h3",{class:"mb-5",translate:"yes"},"Search for products, pages and categories",-1),J={class:"columns is-centered mb-5"},W={class:"column is-4"},X={class:"field globalSearch"},Y={class:"control has-icons-left has-icons-right"},Z=s("span",{class:"icon is-small is-left"},[s("i",{class:"fas fa-search"})],-1),q=s("i",{class:"fas fa-plus"},null,-1),ee=[q],se=s("div",{class:"form-messages is-hidden"},[s("div",{class:"form-message","data-message":"too-short",translate:"yes"},"Query too short")],-1),te={key:0,class:"columns is-8 is-centered mx-6 searchResults"},ae={key:0,class:"column is-4"},re=s("h3",{class:"title is-4",translate:"yes"},"Pages",-1),oe={key:1,class:"column is-4"},ce=s("h3",{class:"title is-4",translate:"yes"},"Products",-1),le={key:2,class:"column is-4"},ie=s("h3",{class:"title is-4",translate:"yes"},"Categories",-1);function ne(e,l,i,n,r,o){const h=b("global-search-result-row");return a(),c("div",K,[M,z,s("div",J,[s("div",W,[s("div",X,[s("div",Y,[s("input",{class:"input is-rounded",onKeyup:l[0]||(l[0]=v(t=>o.inputSearch(t),["prevent"])),autofocus:"autofocus",ref:"searchQuery",type:"text",placeholder:"Search Products or Pages"},null,544),Z,r.searchQuery.length>0?(a(),c("a",{key:0,href:"#",class:"icon is-small is-right rc-45 pointer",onClick:l[1]||(l[1]=v(t=>o.updateInput(""),["prevent"]))},[...ee])):u("",!0)]),se])])]),r.searchResults!==null?(a(),c("div",te,[r.searchResults.pages&&r.searchResults.pages.length>0?(a(),c("div",ae,[re,y(h,{results:r.searchResults.pages,type:"page"},null,8,["results"])])):u("",!0),r.searchResults.products&&r.searchResults.products.length>0?(a(),c("div",oe,[ce,y(h,{results:r.searchResults.products,type:"product"},null,8,["results"])])):u("",!0),r.searchResults.categories&&r.searchResults.categories.length>0?(a(),c("div",le,[ie,y(h,{results:r.searchResults.categories,type:"category"},null,8,["results"])])):u("",!0)])):u("",!0)])}const de=$(E,[["render",ne],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/global/GlobalSearch.vue"]]);export{de as default};
