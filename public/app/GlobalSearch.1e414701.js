import{_ as $,r as R,o as r,c as i,F as _,i as m,m as p,f,a as t,t as h,j as d,w as v,e as y}from"./index.9af5a96e.js";const S={name:"GlobalSearchResultRow",props:["results","type"],data(){return{searchTimeout:null,searchQuery:"",searchResults:null}},created:function(){},mounted:function(){console.log("------",this.results)},computed:{getLang:function(){return this.$store&&this.$store.state&&this.$store.state.language.code?this.$store.state.language.code:this.propLang?this.propLang:"en"}},methods:{getImage(e,l){return e.price>0?this.getProductImagePath(e.orderCode):this.getPageImagePath(e.slug)},getProductImagePath(e){return e&&this.$store&&this.$store.state&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getProductImagePath(this.$store.state.coredata,e):null},getPageImagePath(e){return e&&this.$store&&this.$store.state&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getImagePath("pages",this.$store.state.coredata,"cover/"+e,"cover.jpg"):null}}},k={key:0,id:"GlobalSearchResults"},b={key:0,class:"is-4"},I={class:"media"},L={class:"media-left"},P={class:"image is-48x48"},T=["src","alt"],w={class:"media-content"},x={key:1,class:"is-4"},G={class:"media"},Q={class:"media-left"},C={class:"image is-48x48"},B=["src","alt"],N={class:"media-content"},j={key:2,class:"is-4"},D={class:"media"},V={class:"media-left"},A={class:"image is-48x48"},F=["src","alt"],O={class:"media-content"};function E(e,l,c,n,o,a){const u=R("router-link");return c.results?(r(),i("div",k,[c.type==="product"?(r(),i("div",b,[(r(!0),i(_,null,m(c.results,(s,g)=>(r(),p(u,{key:s._id+"pro"+g,tag:"a",class:"result-link py-4",to:{name:"productDetail",params:{category:s.categories[0],product:s._id,slug:s.slug}}},{default:f(()=>[t("article",I,[t("figure",L,[t("p",P,[t("img",{src:a.getImage(s,e.listType),alt:s.name[a.getLang],onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,T)])]),t("div",w,[t("strong",null,h(s.name[a.getLang]),1),t("p",null,h(s.descriptionShort[a.getLang]),1)])])]),_:2},1032,["to"]))),128))])):c.type==="page"?(r(),i("div",x,[(r(!0),i(_,null,m(c.results,(s,g)=>(r(),p(u,{key:s._id+"pag"+g,tag:"a",class:"result-link py-4",to:{name:"pageDetail",params:{category:s.categories[0],product:s._id,slug:s.slug}}},{default:f(()=>[t("article",G,[t("figure",Q,[t("p",C,[t("img",{src:a.getImage(s,e.listType),alt:s.name[a.getLang],onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,B)])]),t("div",N,[t("strong",null,h(s.name[a.getLang]),1),t("p",null,h(s.descriptionShort[a.getLang]),1)])])]),_:2},1032,["to"]))),128))])):c.type==="category"?(r(),i("div",j,[(r(!0),i(_,null,m(c.results,(s,g)=>(r(),p(u,{key:s._id+"cat"+g,tag:"a",class:"result-link py-4",to:{name:"categoryList",params:{category:s.pathSlug}}},{default:f(()=>[t("article",D,[t("figure",V,[t("p",A,[t("img",{src:a.getImage(s,e.listType),alt:s.name[a.getLang],onerror:"this.src='/assets/_site/logo-product.svg'"},null,8,F)])]),t("div",O,[t("strong",null,h(s.name[a.getLang]),1),t("p",null,h(s.descriptionShort[a.getLang]),1)])])]),_:2},1032,["to"]))),128))])):d("",!0)])):d("",!0)}const K=$(S,[["render",E]]);const M={name:"GlobalSearch",components:{"global-search-result-row":K},data(){return{searchTimeout:null,searchQuery:"",searchResults:null}},created:function(){},mounted:function(){if(console.log("url query: ",this.$route),this.$route.params&&this.$route.params.query){let e=this.$route.params.query;e=this.cleanQuery(e),e!==""&&(this.updateInput(e),this.globalSearch(e))}},methods:{inputSearch(e){const l=this.cleanQuery(e.target.value);l&&this.globalSearch(l)},cleanQuery(e){return e=e.toString().trim(),e.indexOf("/")>-1&&(e=e.split("/")[0]),e},globalSearch(e){const l=this;this.searchTimeout!==null&&clearTimeout(this.searchTimeout),e.length>3?(this.searchQuery=e,this.searchTimeout=setTimeout(()=>{this.$httpc.post("find",{query:e}).then(function(c){if(c&&c.data){l.searchResults=c.data;let n=l.$route.path.split("/");n=n.filter(Boolean);let o=[...n];n.length>2&&(o=n.slice(0,2)),history.pushState({},null,"/"+o.join("/")+"/"+encodeURIComponent(e))}})},1e3)):console.error("query too short")},updateInput(e){this.$refs.searchQuery.value=e}}},U={id:"GlobalSearch",class:"mt-4"},z=t("h2",{class:"title is-2",translate:"yes"},"Global search",-1),H=t("h3",{class:"mb-5",translate:"yes"},"Search for products, pages and categories",-1),J={class:"columns is-centered mb-5"},W={class:"column is-4"},X={class:"field"},Y={class:"control has-icons-left has-icons-right"},Z=t("span",{class:"icon is-small is-left"},[t("i",{class:"fas fa-search"})],-1),q=t("i",{class:"fas fa-plus"},null,-1),ee=[q],te={key:0,class:"columns is-8 is-centered mx-6 searchResults"},se={key:0,class:"column is-4"},ae=t("h3",{class:"title is-4",translate:"yes"},"Pages",-1),re={key:1,class:"column is-4"},oe=t("h3",{class:"title is-4",translate:"yes"},"Products",-1),le={key:2,class:"column is-4"},ce=t("h3",{class:"title is-4",translate:"yes"},"Categories",-1);function ie(e,l,c,n,o,a){const u=R("global-search-result-row");return r(),i("div",U,[z,H,t("div",J,[t("div",W,[t("div",X,[t("p",Y,[t("input",{class:"input is-rounded",onKeyup:l[0]||(l[0]=v(s=>a.inputSearch(s),["prevent"])),ref:"searchQuery",type:"text",placeholder:"Search Products or Pages"},null,544),Z,t("a",{href:"#",class:"icon is-small is-right rc-45 pointer",onClick:l[1]||(l[1]=v(s=>a.updateInput(""),["prevent"]))},ee)])])])]),o.searchResults!==null?(r(),i("div",te,[o.searchResults.pages&&o.searchResults.pages.length>0?(r(),i("div",se,[ae,y(u,{results:o.searchResults.pages,type:"page"},null,8,["results"])])):d("",!0),o.searchResults.products&&o.searchResults.products.length>0?(r(),i("div",re,[oe,y(u,{results:o.searchResults.products,type:"product"},null,8,["results"])])):d("",!0),o.searchResults.categories&&o.searchResults.categories.length>0?(r(),i("div",le,[ce,y(u,{results:o.searchResults.categories,type:"category"},null,8,["results"])])):d("",!0)])):d("",!0)])}const ue=$(M,[["render",ie]]);export{ue as default};
