import{r as v,c as o,a as s,b as _,w as h,f as l,t as n,F as f,d as g,h as u,n as k,o as r,ai as S,aj as D}from"./sett-4GVrJM9M.js";import{_ as C}from"./index-D0WNZmOK.js";const x={name:"userSubscriptionDetail",data(){return{subscription:null}},created:function(){this.getSubscription(this.$route.params.id)},computed:{userIsAdmin:function(){return!!(this.$store.state&&this.$store.state.user&&this.$store.state.user.logged&&this.$store.state.user.profile&&this.$store.state.user.profile.type&&this.$store.state.user.profile.type==="admin")}},methods:{getSubscription(e){const a=this,b={timeout:3e3,tokenize:!0},y={query:{_id:e},limit:1};this.$httpc.post("subscription/list",y,b).then(function(t){t&&t.data&&t.data&&t.data.results&&t.data.results.length===1&&(a.subscription=t.data.results[0])}).catch(function(t){console.error(t)}).then(function(){a.eventBus.emit("translateContent",a.$store.getters.getTranslates)})},splitTitle(e){return[e.slice(0,6),e.slice(6)]},splitDate(e){return e.split("T")},actionsSuspend:function(){const e=this;e.$httpc.post("/subscription/suspend/"+e.subscription._id,{},{timeout:1e4}).then(a=>{console.debug("subscription/suspend response:",a)})},actionsActivate:function(){const e=this;e.$httpc.post("/subscription/reactivate/"+e.subscription._id,{},{timeout:1e4}).then(a=>{console.debug("subscription/activate response:",a)})},getPaymentProviderName:function(){if(this.order&&this.order.data&&this.order.data.paymentData&&this.order.data.paymentData.codename){const e=this.order.data.paymentData.codename.split("_");if(e.constructor===Array&&e.length>0)return e[e.length-1]}return"paypal"},actionsPaid:function(){const e=this;e.$httpc.get("/order/payment/"+e.getPaymentProviderName()+"/adminsubscriptionpaid?paymentId="+e.subscription.data.agreementId+"&ba_token=run_by_admin",{timeout:1e4}).then(a=>{console.debug("cycle paid response:",a),window.location.reload()})},statusClass:function(e){return e==="active"?"has-text-success":e==="suspended"?"has-text-danger":""}}},i=e=>(S("data-v-3efb503e"),e=e(),D(),e),I={id:"userSubscriptionDetail"},z={key:0},w={class:"container"},N={class:"columns is-variable is-centered"},O={class:"column is-8"},A={class:"breadcrumb","aria-label":"breadcrumbs"},P=i(()=>s("span",{translate:"yes"},"Subscriptions",-1)),T={class:"is-active"},B={"aria-current":"page"},E=i(()=>s("span",{class:"subscription-word",id:"subscription-breadcrumb",translate:"yes"}," Subscription ",-1)),U={class:"subscription-title"},V={class:"title is-2"},F=i(()=>s("span",{id:"subscription-detail-title",translate:"yes",class:"is-size-3"},"Subscription",-1)),L=i(()=>s("br",null,null,-1)),M={class:"subscription-title"},q={class:"container subscription-detail-data"},H={class:"columns is-variable is-centered"},R={class:"column is-8"},Y={class:"columns is-variable is-centered"},j={class:"column is-6"},G={key:0},Q=i(()=>s("h4",{class:"title is-4",translate:"yes"},"History",-1)),J={reversed:""},K={class:"is-size-7"},W={key:0},X=i(()=>s("span",{translate:"yes"},"Related order",-1)),Z={class:"column is-6"},$=i(()=>s("h4",{class:"title is-4",translate:"yes"},"Main info",-1)),ss={class:"info info-settings"},ts=i(()=>s("span",{translate:"yes"},"Status",-1)),es=i(()=>s("span",{translate:"yes"},"Price & Period",-1)),is=i(()=>s("span",{translate:"yes"},"Cycles",-1)),ns={key:0,id:"subscriptionCyclesInfinity",translate:"yes"},os={key:1},rs={class:"info info-dates"},as={key:0},cs=i(()=>s("span",{translate:"yes"},"Next payment",-1)),ls={class:"is-size-7"},us={key:1},ds=i(()=>s("span",{translate:"yes"},"Last payment",-1)),ps={class:"is-size-7"},_s={key:2},hs=i(()=>s("span",{translate:"yes"},"Created",-1)),bs={class:"is-size-7"},ys={key:3},ms=i(()=>s("span",{translate:"yes"},"Started",-1)),vs={class:"is-size-7"},fs={class:"info info-more"},gs=i(()=>s("span",{translate:"yes"},"Original order",-1)),ks={key:0},Ss=i(()=>s("h4",{class:"title is-5",translate:"yes"},"Available Actions",-1)),Ds={key:0},Cs=i(()=>s("p",{class:"is-size-7 has-text-grey-dark"}," Makes your subscription active again with related payment applying. You receive e-mail when your subscription and related services are re-activated. ",-1)),xs={key:1},Is=i(()=>s("span",{translate:"yes"},"Admin Actions",-1)),zs=i(()=>s("p",{class:"is-size-7 has-text-grey-dark",translate:"yes"}," Mark next cycle as paid. For cases when payment system failed but customer paid other way. ",-1)),ws={key:0},Ns=i(()=>s("p",{class:"is-size-7 has-text-grey-dark",translate:"yes"}," Suspends subscription and its payment. You receive e-mail when your subscription and related services are paused. ",-1)),Os={key:1,class:"container"},As={class:"columns is-variable is-centered"},Ps={class:"column is-8"},Ts=i(()=>s("h1",{class:"title is-1",translate:"yes"},"Unauthorized",-1)),Bs=i(()=>s("span",{translate:"yes"},"To see order detail, you may need to",-1));function Es(e,a,b,y,t,c){const p=v("router-link");return r(),o("div",I,[t.subscription?(r(),o("div",z,[s("div",w,[s("div",N,[s("div",O,[s("nav",A,[s("ul",null,[s("li",null,[_(p,{to:{name:"userSubscriptions"}},{default:h(()=>[P]),_:1})]),s("li",T,[s("a",B,[E,l("  "),s("span",U,[l("   #"),s("strong",null,n(c.splitTitle(t.subscription._id)[0]),1),l(n(c.splitTitle(t.subscription._id)[1]),1)])])])])])])])]),s("h2",V,[F,l(),L,s("strong",M,n(t.subscription.orderItemName),1)]),s("div",q,[s("div",H,[s("div",R,[s("div",Y,[s("div",j,[t.subscription.history?(r(),o("div",G,[Q,s("ol",J,[(r(!0),o(f,null,g(e.$helpers.reverseArrayItems(t.subscription.history),(d,m)=>(r(),o("li",{key:m},[s("div",K,n(d.date),1),s("div",null,[s("div",null,[s("strong",null,n(d.action),1)]),d.relatedOrder?(r(),o("div",W,[X,l(": "),_(p,{to:{name:"userOrderDetail",params:{id:d.relatedOrder}}},{default:h(()=>[l(n(d.relatedOrder),1)]),_:2},1032,["to"])])):u("",!0)])]))),128))])])):u("",!0)]),s("div",Z,[$,s("div",ss,[s("ul",null,[s("li",null,[ts,s("strong",{class:k(c.statusClass(t.subscription.status))},n(t.subscription.status),3)]),s("li",null,[es,s("strong",null,n(t.subscription.price)+" / "+n(t.subscription.duration)+" "+n(t.subscription.period),1)]),s("li",null,[is,s("strong",null,[t.subscription.cycles<=1?(r(),o("span",ns,"Infinity")):(r(),o("span",os,n(t.subscription.cycles),1))])])])]),s("div",rs,[s("ul",null,[t.subscription&&t.subscription.dates&&t.subscription.dates.dateOrderNext?(r(),o("li",as,[cs,s("strong",null,n(c.splitDate(t.subscription.dates.dateOrderNext)[0]),1),s("span",ls,n(c.splitDate(t.subscription.dates.dateOrderNext)[1]),1)])):u("",!0),t.subscription&&t.subscription.dates&&t.subscription.dates.dateEnd?(r(),o("li",us,[ds,s("strong",null,n(c.splitDate(t.subscription.dates.dateEnd)[0]),1),s("span",ps,n(c.splitDate(t.subscription.dates.dateEnd)[1]),1)])):u("",!0),t.subscription&&t.subscription.dates&&t.subscription.dates.dateCreated?(r(),o("li",_s,[hs,s("strong",null,n(c.splitDate(t.subscription.dates.dateCreated)[0]),1),s("span",bs,n(c.splitDate(t.subscription.dates.dateCreated)[1]),1)])):u("",!0),t.subscription&&t.subscription.dates&&t.subscription.dates.dateStart?(r(),o("li",ys,[ms,s("strong",null,n(c.splitDate(t.subscription.dates.dateStart)[0]),1),s("span",vs,n(c.splitDate(t.subscription.dates.dateStart)[1]),1)])):u("",!0)])]),s("div",fs,[s("ul",null,[s("li",null,[gs,s("strong",null,[_(p,{to:{name:"userOrderDetail",params:{id:t.subscription.orderOriginId}}},{default:h(()=>[l(n(t.subscription.orderOriginId),1)]),_:1},8,["to"])])]),t.subscription&&t.subscription.status?(r(),o("li",ks,[Ss,t.subscription.status==="suspended"?(r(),o("div",Ds,[s("button",{onClick:a[0]||(a[0]=d=>c.actionsActivate()),class:"button",translate:"yes"},"Re-activate"),Cs])):u("",!0)])):u("",!0),c.userIsAdmin?(r(),o("li",xs,[Is,s("div",null,[s("button",{onClick:a[1]||(a[1]=d=>c.actionsPaid()),class:"button",translate:"yes"},"Cycle Paid"),zs]),t.subscription.status==="active"?(r(),o("div",ws,[s("button",{onClick:a[2]||(a[2]=d=>c.actionsSuspend()),class:"button",translate:"yes"},"Suspend"),Ns])):u("",!0)])):u("",!0)])])])])])])])])):(r(),o("div",Os,[s("div",As,[s("div",Ps,[Ts,s("p",null,[Bs,l("   "),_(p,{to:{name:"login"},tag:"a",class:"","active-class":"is-active",translate:"yes"},{default:h(()=>[l("Log in")]),_:1}),l(". ")])])])]))])}const Fs=C(x,[["render",Es],["__scopeId","data-v-3efb503e"],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/users/UserSubscriptionDetail.vue"]]);export{Fs as default};
