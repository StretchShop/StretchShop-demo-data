import{o as c,c as g,H as V,a,t as v,h as p,r as F,G as T,I,F as M,d as b,b as y,w as x,f as D,L as G,S as U,e as $,j as O}from"./sett-20862007.js";import{_ as R,A as S,P as j,a as B,E}from"./index-7793c70e.js";import"./edit-bbc6728f.js";const N={name:"RangeSlider",data(){return{valueFrom:null,valueTo:null}},props:["inputMin","inputMax","inputFrom","inputTo","id"],mounted:function(){var e;console.log("RangeSlide this.props: ",this.inputMin,this.inputMax,this.inputFrom,this.inputTo,this.id),this.inputMin&&this.inputMax&&this.inputFrom&&this.inputTo&&((e=this.id)!=null&&e.name)&&(this.valueFrom=this.inputFrom,this.valueTo=this.inputTo,this.$refs.sliderRangeLeft.value=this.inputFrom,this.$refs.sliderRangeRight.value=this.inputTo,this.priceSliderChange({target:this.$refs.sliderRangeLeft,forceValue:this.inputFrom}),this.priceSliderChange({target:this.$refs.sliderRangeRight,forceValue:this.inputTo}))},methods:{priceSliderChange:function(e){var s;const t=typeof e.forceValue<"u"?e.forceValue:null,r=e.target;if(r){let i=r.getAttribute("position"),n="",o=0,l=null;i==="left"?(n="right",o=-1,l=r.parentNode.querySelector("input[type=range][position="+n+"]"),r.value=Math.min(r.value,parseInt(l.value)+o)):(i="right",n="left",o=1,l=r.parentNode.querySelector("input[type=range][position="+n+"]"),r.value=Math.max(r.value,parseInt(l.value)+o));let f=null;const u={min:this.inputMin,max:this.inputMax};t!==null?(r.min===0&&typeof u.min<"u"&&(r.min=u.min),r.max===0&&typeof u.max<"u"&&(r.max=u.max),f=100/(parseInt(r.max)-parseInt(r.min))*parseInt(t)-100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.min)):(r.value===0&&(i==="left"&&u&&(r.value=u.min),i==="right"&&u&&(r.value=u.max)),f=100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.value)-100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.min));const d=r.parentNode.querySelector(".slider-range-controls");i==="left"?(d.querySelector("[inverse-"+i+"]").style.width=f+"%",d.querySelector("[range]").style.left=f+"%"):(d.querySelector("[inverse-"+i+"]").style.width=100-f+"%",d.querySelector("[range]").style.right=100-f+"%"),d.querySelector("[thumb="+i+"]").style.left=f+"%",d.querySelector("[sign="+i+"]").style.left=f+"%",r.value===0?(i==="right"&&typeof u.max<"u"&&u.max>0&&(d.querySelector("[sign="+i+"] .value").innerText=Math.round(u.max*100)/100),i==="left"&&typeof u.min<"u"&&u.min>0&&(d.querySelector("[sign="+i+"] .value").innerText=Math.round(u.min*100)/100)):d.querySelector("[sign="+i+"] .value").innerText=Math.round(r.value*100)/100;const h={};i==="left"?(h.min=r.value,h.max=l.value):(h.min=l.value,h.max=r.value),h.min=h.min>this.inputMin?Math.round(h.min):this.inputMin,h.max=h.max<this.inputMax?Math.round(h.max):this.inputMax,this.valueFrom=h.min,this.valueTo=h.max,t===null&&(typeof this.id=="object"&&this.id.name&&this.id.key?this.eventBus.emit("rangeSliderChanged-"+(this.id.name||""),{key:this.id.key,result:h}):this.eventBus.emit("rangeSliderChanged-"+(((s=this.id)==null?void 0:s.name)||""),h))}}}},A={class:"slider-range-wrapper"},w={slider:"",class:"slider-range"},Q={class:"slider-range-controls"},H=a("div",{"inverse-left":"",style:{width:"0%"}},null,-1),z=a("div",{"inverse-right":"",style:{width:"0%"}},null,-1),Y=a("div",{range:"",style:{left:"0%",right:"0%"}},null,-1),K=a("span",{thumb:"left",style:{left:"0%"}},null,-1),W=a("span",{thumb:"right",style:{left:"100%"}},null,-1),J={sign:"left",style:{left:"0%"}},X={class:"value"},Z={sign:"right",style:{left:"100%"}},ee={class:"value"},te=["value","max","min"],ie=["value","max","min"];function re(e,t,r,s,i,n){return c(),g("div",A,[V(e.$slots,"default"),a("div",w,[a("div",Q,[H,z,Y,K,W,a("div",J,[a("span",X,v(Math.round(r.inputMin*100)/100),1)]),a("div",Z,[a("span",ee,v(Math.round(r.inputMax*100)/100),1)])]),a("input",{ref:"sliderRangeLeft",type:"range",position:"left",tabindex:"0",value:r.inputFrom,max:r.inputMax,min:r.inputMin,step:"any",onInput:t[0]||(t[0]=(...o)=>n.priceSliderChange&&n.priceSliderChange(...o))},null,40,te),a("input",{ref:"sliderRangeRight",type:"range",position:"right",tabindex:"0",value:r.inputTo,max:r.inputMax,min:r.inputMin,step:"any",onInput:t[1]||(t[1]=(...o)=>n.priceSliderChange&&n.priceSliderChange(...o))},null,40,ie)]),p(" <div>{{ inputMin }} / {{ inputMax }} || {{ inputFrom }} / {{ inputTo }} || {{ valueFrom }} / {{ valueTo }}</div> ")])}const k=R(N,[["render",re],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/global/RangeSlider.vue"]]);const q="__TOO_MANY_PROPERTIES__",ne={name:"ProductGenericFilter",components:{rangeslider:k},data(){return{filter:{},filterProps:{},tooManyProperties:!1}},mounted:function(){this.eventBus.emit("translateContent",this.$store.getters.getTranslates),this.eventBus.on("categoryPageChanged",e=>{console.log("ProductGenericFilter eventBus.categoryPageChanged newPageValue: ",e)}),this.eventBus.on("rangeSliderChanged-ProductGenericFilter",e=>{console.log("rangeSliderChanged-ProductGenericFilter: ",e),e!=null&&e.key&&(e!=null&&e.result)&&(this.filter[e.key]={from:Number(e.result.min),to:Number(e.result.max)},this.filterUpdated())}),console.log("ProductGenericFilter mounted() this.filter & this.filterDefinitions: ",this.filter,this.filterDefinitions),this.getGenericFilterValues()},props:["filterDefinitions","totalCount"],watch:{filterDefinitions(e,t){const r=this;this.tooManyProperties=!1,e&&(console.log("ProductGenericFilter watch filterDefinitions defsNew: ",t,e),e[q]?this.tooManyProperties=!0:this.tooManyProperties=!1,this.refreshFilterProps(e),e[q]&&delete e[q],r.filter===null&&(r.filter={}),Object.keys(e).forEach(s=>{(typeof r.filter[s]>"u"||r.filter[s]===null)&&(r.filter[s]=null)}))}},computed:{singleParams(){let e={};return this.filterDefinitions&&Object.keys(this.filterDefinitions).forEach(t=>{this.getFilterType(this.filterDefinitions[t])==="single"&&(e[t]=this.filterDefinitions[t])}),e}},methods:{refreshFilterProps(e){var t;if(this.filterProps={},e)if(e[q]||this.tooManyProperties){this.tooManyProperties||(this.tooManyProperties=!0);for(let r of Object.keys(e))e[r]&&(this.filterProps[r]={},this.filterProps[r].type="text"),e[r]&&e[r].value&&(this.filterProps[r].value=!0),(e[r]&&e[r].value&&((t=e[r].value)==null?void 0:t.constructor)!==Array&&typeof e[r].value=="object"||e[r]&&e[r].constructor!==Array&&typeof e[r]=="object")&&(this.filterProps[r].translation=!0)}else this.tooManyProperties=!1,Object.keys(e).forEach(r=>{var s;e[r]&&(this.filterProps[r]={},this.filterProps[r].type=this.getFilterType(e[r])),e[r]&&e[r].value&&(this.filterProps[r].value=!0),(e[r]&&e[r].value&&((s=e[r].value)==null?void 0:s.constructor)!==Array&&typeof e[r].value=="object"||e[r]&&e[r].constructor!==Array&&typeof e[r]=="object")&&(this.filterProps[r].translation=!0)});console.log("ProductGenericFilter refreshFilterProps() this.filterProps: ",this.filterProps)},getFilterName(e,t){return t.name?t.name[this.$store.state.language.code]?t.name[this.$store.state.language.code].constructor===Array?t.name[this.$store.state.language.code].join(", "):t.name[this.$store.state.language.code]:t.name.constructor===Array?t.name.join(", "):t.name:e},getFilterType(e){if(e=this.getRealValue(e),e)if(e.constructor===Array){let t=!0;return e.some(r=>{if(typeof r!="number")return t=!1,!0}),t?"range":"array"}else return"single"},getRealValue(e){return e!=null&&e.value?e.value[this.$store.state.language.code]?e.value[this.$store.state.language.code]:e.value:e},setSingleValue(e,t){var r,s;(r=e==null?void 0:e.target)!=null&&r.checked&&((s=e==null?void 0:e.target)!=null&&s.value)?(this.filter[t]=this.getRealValue(e.target.value),this.filterUpdated()):(delete this.filter[t],this.filterUpdated())},arrayValueChanged(e){var t;((t=this.filter[e])==null?void 0:t.length)===0&&delete this.filter[e],this.filterUpdated()},textValueChanged(e){this.filter[e].trim()===""&&delete this.filter[e],this.filterUpdated()},filterUpdated(){if(this.filter){const e=this.prepareGenericQuery();console.log("ProductGenericFilter filterUpdated() query: ",e),this.eventBus.emit("productGenericFilterUpdate",{query:e,url:this.prepareUrl(e)})}},prepareGenericQuery(e=!0){let t=null;return this.filter&&(e=!(typeof e<"u"&&e===!1),console.log("rebuildProps xxx -> : ",e),e=!0,e&&this.refreshFilterProps(this.filterDefinitions),Object.keys(this.filter).length>0&&(t={$and:[]},Object.keys(this.filter).forEach(s=>{var i;if(this.filter[s]&&((i=this.filterProps[s])!=null&&i.type))switch(console.log("productGenericFilter prepareGenericQuery() this.filterProps: ",this.filterProps),this.filterProps[s].type){case"range":t.$and.push(this.prepareRangeQuery(s,this.filter[s]));break;case"array":t.$and.push(this.prepareArrayQuery(s,this.filter[s]));break;case"text":t.$and.push(this.prepareTextQuery(s,this.filter[s]));break;default:t.$and.push(this.prepareSingleQuery(s,this.filter[s]))}})),t&&(t.$and===[]||t.$and.length===0)&&(t=null)),console.log("productGenericFilter prepareGenericQuery() result: ",t),t},prepareRangeQuery(e,t){const r={$gte:t.from,$lte:t.to};return this.prepareSingleQuery(e,r)},prepareTextQuery(e,t){const r={$regex:t};return this.prepareSingleQuery(e,r)},prepareArrayQuery(e,t){const r={$in:t};return this.prepareSingleQuery(e,r)},prepareSingleQuery(e,t){const r={$or:[]};let s="properties."+e;const i={};i[s]=t,s+=".value";const n={};n[s]=t,s+="."+this.$store.state.language.code;const o={};return o[s]=t,r.$or.push(i,n,o),r},prepareUrl(e){let t="";this.refreshFilterProps(this.filterDefinitions);const r=Object.keys(this.filter),s=Object.keys(this.filterProps);return(r==null?void 0:r.length)>0&&(s==null?void 0:s.length)>0&&(t=[],Object.keys(this.filter).forEach(i=>{var n,o;if(this.filter[i]&&((n=this.filterProps[i])!=null&&n.type))switch(this.filterProps[i].type){case"range":t.push("-gr--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i].from)+"-"+encodeURIComponent(this.filter[i].to));break;case"text":t.push("-gt--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i]));break;case"array":let l=[];this.filter&&this.filter[i]&&this.filter[i].constructor===Array&&((o=this.filter[i])==null||o.forEach((f,u)=>{l.push(encodeURIComponent(this.filter[i][u]))})),t.push("-ga--"+encodeURIComponent(i)+"="+l.join(";"));break;default:t.push("-g--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i]))}})),t.join("&")},getGenericFilterValues(){var e;this.filter=((e=this.filter)==null?void 0:e.genericFilter)||{}},queryStringtoFilter(){let e=null;return typeof this.$route.query<"u"&&Object.keys(this.$route.query).forEach(t=>{if(["-gr--","-gt--","-ga--","-g--"].some(s=>t.includes(s))){e===null&&(e={});const s=t.split("--")[1],i=this.$route.query[t].trim();if(t.indexOf("-ga--")>-1)e[s]=decodeURIComponent(i).split(";"),this.filterProps[s]={type:"array"};else if(t.indexOf("-gt--")>-1)e[s]=decodeURIComponent(i),this.filterProps[s]={type:"text"};else if(t.indexOf("-gr--")>-1){const n=decodeURIComponent(i).split("-");e[s]={from:Number(n[0]),to:Number(n[1])},this.filterProps[s]={type:"range"}}else t.indexOf("-g--")>-1&&(e[s]=decodeURIComponent(i).trim()!=="",this.filterProps[s]={type:"single"})}}),this.filter=e,console.log("productGenericFilter queryStringtoFilter() this.filter: ",this.filter),e}}},se={class:"generic-filter"},ae={key:0},oe={key:0,class:"gf-range"},le={class:"panel-block-multiwrapper"},ce={class:"gf-range-label"},ue=["id"],ge={key:1,class:"gf-array"},he={key:0,class:"autofield"},de={key:1},pe={class:"gf-text"},fe={key:0,class:"autofield"},ye={class:"gf-singles-wrapper"},me={class:"field gf-single"},_e={class:"s-input checkbox"},Pe=["value","checked","onClick"];function Fe(e,t,r,s,i,n){const o=F("rangeslider"),l=F("o-inputitems"),f=F("o-field"),u=F("o-input");return T((c(),g("nav",se,[(c(!0),g(M,null,b(r.filterDefinitions,(d,h)=>{var C,_;return c(),g("div",{key:"mp-"+h},[this.tooManyProperties?(c(),g("div",de,[a("div",pe,[i.filter?(c(),g("section",fe,[y(f,{label:n.getFilterName(h,d)},{default:x(()=>[y(u,{modelValue:i.filter[h],"onUpdate:modelValue":[m=>i.filter[h]=m,m=>n.textValueChanged(h)],data:n.getRealValue(d),type:"is-info"},null,8,["modelValue","onUpdate:modelValue","data"])]),_:2},1032,["label"])])):p("v-if",!0)])])):(c(),g("div",ae,[n.getFilterType(d)==="range"?(c(),g("div",oe,[a("div",le,[y(o,{id:{name:"ProductGenericFilter",key:h},ref_for:!0,ref:"productPriceRange","input-min":Math.min.apply(null,n.getRealValue(d)),"input-max":Math.max.apply(null,n.getRealValue(d)),"input-from":i.filter&&i.filter[h]?(C=i.filter[h])==null?void 0:C.from:Math.min.apply(null,n.getRealValue(d)),"input-to":i.filter&&i.filter[h]?(_=i.filter[h])==null?void 0:_.to:Math.max.apply(null,n.getRealValue(d))},{default:x(()=>[a("div",ce,[a("label",{class:"label",id:"gf-"+h,translate:"yes"},v(n.getFilterName(h,d)),9,ue)])]),_:2},1032,["id","input-min","input-max","input-from","input-to"])])])):p("v-if",!0),n.getFilterType(d)==="array"?(c(),g("div",ge,[i.filter?(c(),g("section",he,[y(f,{label:n.getFilterName(h,d)},{default:x(()=>[y(l,{modelValue:i.filter[h],"onUpdate:modelValue":[m=>i.filter[h]=m,m=>n.arrayValueChanged(h)],data:n.getRealValue(d),autocomplete:"","allow-new":!1,"open-on-focus":!0,type:"is-info"},null,8,["modelValue","onUpdate:modelValue","data"])]),_:2},1032,["label"])])):p("v-if",!0)])):p("v-if",!0)]))])}),128)),a("div",ye,[(c(!0),g(M,null,b(n.singleParams,(d,h)=>(c(),g("div",{key:"sp-"+h},[a("div",me,[a("label",_e,[a("input",{type:"checkbox",class:"check",value:n.getRealValue(d),checked:i.filter&&i.filter[h]?i.filter[h]:!1,onClick:C=>n.setSingleValue(C,h)},null,8,Pe),a("div",null,[a("strong",null,v(n.getFilterName(h,d))+": ",1),a("span",null,v(n.getRealValue(d)),1)])])])]))),128))])],512)),[[I,r.filterDefinitions&&r.totalCount>0]])}const ve=R(ne,[["render",Fe],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/ProductGenericFilter.vue"]]);const xe={name:"CategoryFilter",components:{rangeslider:k,genericfilter:ve},data(){return{eventTimeoutId:null,tempFilter:{page:1,minMaxPrice:{min:null,max:null},stringFilter:"",sort:this.getDefaultSorting()},introMinMaxPrice:{min:null,max:null},genericFilter:{}}},mounted:function(){this.eventBus.emit("translateContent",this.$store.getters.getTranslates),this.eventBus.on("categoryPageChanged",e=>{this.setActivePage(e||1)}),this.eventBus.on("rangeSliderChanged-CategoryFilter",e=>{this.$parent.introLoading===!1&&(this.tempFilter.minMaxPrice.min=e.min,this.tempFilter.minMaxPrice.max=e.max,this.requestFilteredProductList())}),this.eventBus.on("productGenericFilterUpdate",e=>{console.log("productGenericFilterUpdate genericFilter: ",e),this.genericFilter=e||{},this.requestFilteredProductList()})},props:["filter","filterDefinitions","categoryMinMaxPrice","categoryType","total"],computed:{filterPriceMin:function(){var e;return(e=this.tempFilter.minMaxPrice)!=null&&e.min?this.tempFilter.minMaxPrice.min:this.categoryPriceMin},filterPriceMax:function(){var e;return(e=this.tempFilter.minMaxPrice)!=null&&e.max?this.tempFilter.minMaxPrice.max:this.categoryPriceMax},categoryPriceMin:function(){return typeof this.categoryMinMaxPrice<"u"&&this.categoryMinMaxPrice.min<this.categoryMinMaxPrice.max?this.categoryMinMaxPrice.min:0},categoryPriceMax:function(){return typeof this.categoryMinMaxPrice<"u"&&this.categoryMinMaxPrice.max>this.categoryMinMaxPrice.min?this.categoryMinMaxPrice.max:0},filteredCount:function(){return typeof this.$parent<"u"?this.$parent.getCategoryFilteredCount():0},categoryTotalCount:function(){return typeof this.$parent<"u"&&typeof this.$parent.categoryDetail<"u"&&this.$parent.categoryDetail&&this.$parent.categoryDetail.count&&this.$parent.categoryDetail.count>0?this.$parent.categoryDetail.count:0},countsDoNotMatch:function(){return this.filteredCount>0&&this.filteredCount!==this.categoryTotalCount}},methods:{stringFilterChange:function(e){const t=e.target;this.$parent.filter.stringFilter=t.value,this.requestFilteredProductList()},requestFilteredProductList(){const e=this;e.$root.loadingShow(),clearTimeout(this.eventTimeoutId),this.eventTimeoutId=setTimeout(function(){e.$httpc.post(e.getCategoryType()+"/filter",e.buildFilterRequestObject(),{timeout:7e3}).then(function(t){const r=e.$parent.categoryDetail;t.data={categories:e.$parent.categories,categoryDetail:r,filter:t.data.filter,results:t.data.results,filteredProductsCount:t.data.filteredProductsCount},e.changeFilterUrl(),e.$parent.processCategoryResponse(t)}).catch(function(t){console.error(t)})},1e3)},buildFilterRequestObject(e){let t=this.tempFilter;typeof e<"u"&&e&&(t=e);let r=null;if(typeof this.$parent.categoryDetail<"u"&&this.$parent.categoryDetail){t.category={_id:this.$parent.categoryDetail._id,pathSlug:this.$parent.categoryDetail.pathSlug,subsSlugs:this.$parent.categoryDetail.subsSlugs};const o=t.category.subsSlugs;o.unshift(t.category.pathSlug),r={$in:o}}const s={limit:this.$parent.filter.limit,sort:t.sort};if(r&&(s.query={categories:r}),t.page>1){const o=Math.abs(t.page-1)*this.$parent.filter.limit;o>0&&(s.offset=o)}if(t.stringFilter&&t.stringFilter.trim()!==""){let o=[],l={};l["name."+this.$store.state.language.code]={$regex:t.stringFilter},o.push(l),this.getCategoryType()==="products"&&o.push({orderCode:{$regex:t.stringFilter}}),s.query={$or:o}}const i=typeof t.minMaxPrice<"u"&&typeof t.minMaxPrice.min<"u"?t.minMaxPrice.min:null,n=typeof t.minMaxPrice<"u"&&typeof t.minMaxPrice.max<"u"?t.minMaxPrice.max:null;if((i||n)&&(s.query||(s.query={}),s.query.price={},i&&(s.query.price.$gte=parseFloat(i)),n&&(s.query.price.$lte=parseFloat(n))),typeof this.$refs.productGenericFilter<"u"){const o=this.$refs.productGenericFilter.prepareGenericQuery(!1);o&&(s.query={...s.query,...o})}return console.log("CategoryFilter buildFilterRequestObject query: ",s),s},changeFilterUrl(){const e=this.filterObjectToQueryString();e!==""&&history.pushState({},null,e)},filterObjectToQueryString(){var r,s,i,n,o,l,f,u,d;const e=[];let t="";return this.tempFilter.page>1&&e.push("page="+encodeURIComponent(parseInt(this.tempFilter.page))),((r=this.tempFilter.minMaxPrice)==null?void 0:r.min)!==null&&((s=this.tempFilter.minMaxPrice)==null?void 0:s.min)>this.categoryPriceMin&&e.push("price-min="+encodeURIComponent(this.tempFilter.minMaxPrice.min)),((i=this.tempFilter.minMaxPrice)==null?void 0:i.max)!==null&&((n=this.tempFilter.minMaxPrice)==null?void 0:n.max)<this.categoryPriceMax&&e.push("price-max="+encodeURIComponent(this.tempFilter.minMaxPrice.max)),typeof this.tempFilter.stringFilter<"u"&&((o=this.tempFilter.stringFilter)==null?void 0:o.trim())!==""&&e.push("string="+encodeURIComponent((l=this.tempFilter.stringFilter)==null?void 0:l.trim())),typeof this.tempFilter.sort<"u"&&((f=this.tempFilter.sort)==null?void 0:f.trim())!==""&&this.tempFilter.sort!==this.filter.sort&&e.push("sort="+encodeURIComponent((u=this.tempFilter.sort)==null?void 0:u.trim())),(d=this.genericFilter)!=null&&d.url&&e.push(this.genericFilter.url),e.length>0&&(t=this.$route.path+"?"+e.join("&")),t},setActivePage(e){this.tempFilter.page=e,this.requestFilteredProductList()},changeSorting(e){this.tempFilter.sort=e.target.value,this.requestFilteredProductList()},setTempFilter(e){var n,o,l,f,u,d,h,C,_,m;const t=this;let r=!1;const s={target:(l=(o=(n=this.$refs)==null?void 0:n.productPriceRange)==null?void 0:o.$refs)==null?void 0:l.sliderRangeLeft},i={target:(d=(u=(f=this.$refs)==null?void 0:f.productPriceRange)==null?void 0:u.$refs)==null?void 0:d.sliderRangeRight};Object.keys(e).forEach(function(P){typeof t.tempFilter[P]<"u"&&(t.tempFilter[P]=e[P],P==="minMaxPrice"&&(s.forceValue=t.tempFilter.minMaxPrice.min,i.forceValue=t.tempFilter.minMaxPrice.max,r=!0))}),r&&((C=(h=this.$refs)==null?void 0:h.productPriceRange)==null||C.priceSliderChange(s),(m=(_=this.$refs)==null?void 0:_.productPriceRange)==null||m.priceSliderChange(i))},getCategoryType(){return this.categoryType?this.categoryType:"products"},getDefaultSorting(){return this.getCategoryType()==="pages"?S.PRODUCT_DEFAULT_SORTING:S.PAGE_DEFAULT_SORTING},queryStringtoFilter(e){var r,s;if(typeof this.$route.query["price-min"]<"u"){const i=parseFloat(this.$route.query["price-min"]);i>0&&(e.minMaxPrice={},e.minMaxPrice.min=i)}if(typeof this.$route.query["price-max"]<"u"){const i=parseFloat(this.$route.query["price-max"]);i>0&&(typeof e.minMaxPrice>"u"&&(e.minMaxPrice={}),e.minMaxPrice.max=i)}const t=(s=(r=this.$refs)==null?void 0:r.productGenericFilter)==null?void 0:s.queryStringtoFilter();return t!==""&&(e.genericFilter=t),this.tempFilter=e,e}}},Ce={class:"mt-6"},Me={class:"menu"},be=a("p",{class:"menu-label filter",translate:"yes"}," Filter ",-1),De={class:"menu-list"},Te={class:"control has-text-centered is-size-7"},Se={key:0},Re=a("span",{id:"products-filter-count-filtered",translate:"yes"},"Filtered",-1),$e=a("span",{id:"products-filter-count-total",translate:"yes"},"Total",-1),qe={class:"panel-block pb-4"},Le={class:"control has-icons-left"},Ie=a("span",{class:"icon is-small is-left"},[a("i",{class:"fas fa-search","aria-hidden":"true"})],-1),Ue={class:"panel-block py-4"},ke={key:0,class:"panel-block-multiwrapper"},Ve=a("div",null,[a("label",{class:"label",id:"filter_price",translate:"yes"},"Price")],-1),Ge={key:0,class:"panel-block py-4"},Oe={class:"panel-block-multiwrapper"},je=a("div",null,[a("label",{class:"label"},[a("span",{id:"filter_sortby",translate:"yes"},"Sort by"),D(":")])],-1),Be={class:"control has-text-centered"},Ee={class:"select is-small is-centered"},Ne=a("option",{value:"price"},"Price Ascending",-1),Ae=a("option",{value:"-price"},"Price Descending",-1),we=a("option",{value:"-dates.dateCreated"},"Latest",-1),Qe=a("option",{value:"stockAmount"},"On Stock Amount",-1),He=[Ne,Ae,we,Qe],ze={key:1,class:"panel-block py-4"},Ye={key:2,class:"panel-block py-4"},Ke={class:"panel-block-multiwrapper"},We=a("div",null,[a("label",{class:"label"},[a("span",{translate:"yes"},"Sort by"),D(":")])],-1),Je={class:"control has-text-centered"},Xe={class:"select is-small is-centered"},Ze=a("option",{value:"-dates.dateCreated"},"Latest",-1),et=a("option",{value:"dates.dateCreated"},"Oldest",-1),tt=[Ze,et];function it(e,t,r,s,i,n){var f;const o=F("rangeslider"),l=F("genericfilter");return T((c(),g("nav",Ce,[a("aside",Me,[be,a("ul",De,[a("li",null,[a("p",Te,[n.countsDoNotMatch?(c(),g("span",Se,[Re,D(": "),a("span",null,v(n.filteredCount),1),D(" / ")])):p("v-if",!0),$e,D(": "),a("span",null,v(n.categoryTotalCount),1)])]),a("li",qe,[a("p",Le,[T(a("input",{class:"input is-small",type:"text",translate:"yes",placeholder:"search","onUpdate:modelValue":t[0]||(t[0]=u=>i.tempFilter.stringFilter=u),onKeyup:t[1]||(t[1]=(...u)=>n.stringFilterChange&&n.stringFilterChange(...u))},null,544),[[G,i.tempFilter.stringFilter,void 0,{trim:!0}]]),Ie])]),T(a("li",Ue,[n.categoryPriceMin&&n.categoryPriceMax&&n.filterPriceMin&&n.filterPriceMax?(c(),g("div",ke,[y(o,{id:{name:"CategoryFilter"},ref:"productPriceRange","input-min":n.categoryPriceMin,"input-max":n.categoryPriceMax,"input-from":n.filterPriceMin,"input-to":n.filterPriceMax},{default:x(()=>[Ve]),_:1},8,["input-min","input-max","input-from","input-to"])])):p("v-if",!0)],512),[[I,r.categoryType=="products"]]),r.categoryType=="products"?(c(),g("li",Ge,[a("div",Oe,[je,a("div",null,[a("div",Be,[a("div",Ee,[T(a("select",{"onUpdate:modelValue":t[2]||(t[2]=u=>i.tempFilter.sort=u),onChange:t[3]||(t[3]=(...u)=>n.changeSorting&&n.changeSorting(...u))},He,544),[[U,i.tempFilter.sort]])])])])])])):p("v-if",!0),r.categoryType=="products"?(c(),g("li",ze,[y(l,{ref:"productGenericFilter",filterDefinitions:(f=r.filterDefinitions)==null?void 0:f.genericFilter,totalCount:r.total},null,8,["filterDefinitions","totalCount"])])):p("v-if",!0),r.categoryType=="pages"?(c(),g("li",Ye,[a("div",Ke,[We,a("div",null,[a("div",Je,[a("div",Xe,[T(a("select",{"onUpdate:modelValue":t[4]||(t[4]=u=>i.tempFilter.sort=u),onChange:t[5]||(t[5]=(...u)=>n.changeSorting&&n.changeSorting(...u))},tt,544),[[U,i.tempFilter.sort]])])])])])])):p("v-if",!0)])])],512)),[[I,n.categoryTotalCount>0]])}const rt=R(xe,[["render",it],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryFilter.vue"]]),nt={data(){return{order:"centered",size:"",isSimple:!1,isRounded:!0,activeThis:null}},props:{bottom:Boolean,active:{type:Number,required:!0},total:{type:Number,required:!0},perPage:{type:Number,required:!0}},mounted:function(){this.activeThis=this.active,this.eventBus.on("categoryPageChanged",e=>{this.activeThis=e||1})},methods:{pagingChanged:function(e){console.log("pagingChanged value: ",e),this.activeThis=e,this.eventBus.emit("categoryPageChanged",e)},loadMore:function(){let e=this.perPage+S.PER_PAGE;this.$parent.filter.limit=e,this.$parent.$refs.categoryFilter.requestFilteredProductList()}}},st={key:0},at={key:0};function ot(e,t,r,s,i,n){const o=F("o-pagination");return r.total>r.perPage?(c(),g("section",st,[y(o,{total:r.total,current:i.activeThis,"onUpdate:current":t[0]||(t[0]=l=>i.activeThis=l),order:i.order,size:i.size,simple:i.isSimple,rounded:i.isRounded,"per-page":r.perPage,onChange:n.pagingChanged,"aria-next-label":"Next page","aria-previous-label":"Previous page","aria-page-label":"Page","aria-current-label":"Current page",iconPack:"fas",iconNext:"angle-right",iconPrev:"angle-left"},null,8,["total","current","order","size","simple","rounded","per-page","onChange"]),r.bottom==!0?(c(),g("div",at,[a("button",{class:"button",onClick:t[1]||(t[1]=l=>n.loadMore())},"Load More ...")])):p("v-if",!0)])):p("v-if",!0)}const lt=R(nt,[["render",ot],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryPaging.vue"]]);const ct={name:"CategoryList",components:{"product-box":j,"category-filter":rt,"category-paging":lt,"page-detail-content":B,"error-page":E},data(){return{categories:[],filteredProductsCount:null,products:[],page:null,itemsToListType:"products",breadcrumbs:[],categoryDetail:null,filter:{minMaxPrice:{min:null,max:null},stringFilter:"",limit:S.PER_PAGE,sort:S.PRODUCT_DEFAULT_SORTING,genericFilter:null},filterDefinitions:{minMaxPrice:{min:null,max:null},genericFilter:null},language:"en",groupsLastRefresh:0,introLoading:!1}},computed:{getCategoryType:function(){return this.categoryDetail&&this.categoryDetail.type?this.categoryDetail.type:"products"},categoryMinMax:function(){return this.categoryDetail&&typeof this.categoryDetail.minMaxPrice<"u"?this.categoryDetail.minMaxPrice:{min:null,max:null}},categoryBackground:function(){return!!(this.categoryDetail&&this.categoryDetail.data&&this.categoryDetail.data.images&&this.categoryDetail.data.images.background)},categoryProductsTotalForPaging:function(){var e;return typeof this.filteredProductsCount<"u"&&this.filteredProductsCount!==null?this.filteredProductsCount:typeof((e=this.categoryDetail)==null?void 0:e.count)<"u"&&this.categoryDetail.count?this.categoryDetail.count:0},userCanEdit:function(){return!!(this.$store.state&&this.$store.state.user&&this.$store.state.user.logged&&this.$store.state.user.profile&&this.$store.state.user.profile.type&&this.$store.state.user.profile.type==="admin")},categoryTypePageContent:function(){return this.page&&this.page.data&&this.page.data.blocks&&this.page.data.blocks[0]&&this.page.data.blocks[0][this.$store.state.language.code]?this.page.data.blocks[0][this.$store.state.language.code]:""},categoryTypePageData:function(){return this.page&&this.page.functions&&this.page.functions.length>0?this.page.functions:null},categoryActivePage:function(){var e,t,r,s,i,n;return(r=(t=(e=this.$refs)==null?void 0:e.categoryFilter)==null?void 0:t.tempFilter)!=null&&r.page?(n=(i=(s=this.$refs)==null?void 0:s.categoryFilter)==null?void 0:i.tempFilter)==null?void 0:n.page:1}},mounted:function(){this.$store&&this.$store.state&&this.$store.state.language&&this.$store.state.language.code&&this.$store.state.user?this.listCategoryItems(!0):this.eventBus.on("coreDataLoaded",()=>{this.listCategoryItems(!0)}),this.eventBus.on("categoryPageChanged",e=>{this.page=e||1})},methods:{processCategoryResponse(e){var i;const t=new Date,r=this;this.groupsLastRefresh=t.getTime();let s=null;if(e.data.categoryDetail&&(this.categoryDetail=e.data.categoryDetail,this.categoryDetail&&this.categoryDetail.name&&r.$store.state&&typeof this.categoryDetail.name[r.$store.state.language.code]<"u"&&(document.title=this.categoryDetail.name[r.$store.state.language.code]+" - StretchShop"),e.data.categoryDetail.parentCategories&&(this.breadcrumbs=e.data.categoryDetail.parentCategories),s=this.categoryDetail.taxData?this.categoryDetail.taxData:(i=r.$store.state.coredata)==null?void 0:i.settings),e.data.categories&&(this.categories=e.data.categories),e.data.filteredProductsCount&&(this.filteredProductsCount=e.data.filteredProductsCount),e.data.results){const n=e.data.results;let o=null;e.data.categoryDetail&&e.data.categoryDetail.pathSlug&&(e.data.categoryDetail.type&&(o=e.data.categoryDetail.type),n.forEach(function(l){l=r.$helpers.getProductTaxData(l,s),l.activeParentCategoryUrl=e.data.categoryDetail.pathSlug})),o===null&&n&&n[0]&&n[0].type?this.itemsToListType=n[0].type+"s":this.itemsToListType=o,this.products=this.$store.state.chunk(n,S.PER_ROW)}if(e.data.filter){const n=Object.assign({},this.filter);this.filter=e.data.filter;const o=this;Object.keys(n).forEach(function(l){(typeof o.filter[l]>"u"||o.filter[l]===null)&&(o.filter[l]=n[l])})}e.data.filterProperties&&(this.filterDefinitions.genericFilter=e.data.filterProperties),this.$root.loadingClose()},listCategoryItems:function(e){typeof e>"u"||!e?e=!1:e=!0;const t=this,r=this.$route.path.split("/").filter(Boolean),s=typeof r[1]<"u"?r[1]:"products",i=this.categoryDetail&&this.categoryDetail.type==="pages"?"pageCategoryFilter":"categoryFilter";if(this.$route.params&&this.$route.params.category&&this.$route.params.category.toString().trim()!=="''")this.$root.loadingShow(),e&&Object.keys(this.$route.query).length>0?(this.queryStringtoFilter(i),t.$httpc.post(s+"/"+this.$route.params.category,{filter:this.$refs[i].buildFilterRequestObject(this.filter)},{timeout:7e3}).then(function(n){t.processCategoryResponse(n),typeof t.$refs[i]<"u"&&(t.introLoading=!0,t.introLoading=!1)}).catch(function(n){console.error(n)}).then(()=>{t.eventBus.emit("translateContent",t.$store.getters.getTranslates)})):this.$httpc.get(s+"/"+this.$route.params.category,{timeout:7e3,params:{limit:this.filter.limit}}).then(function(n){t.processCategoryResponse(n),typeof t.$refs[i]<"u"&&(t.introLoading=!0,t.$refs[i].setTempFilter(t.filter),t.introLoading=!1)}).catch(function(n){console.error(n)}).then(()=>{t.eventBus.emit("translateContent",t.$store.getters.getTranslates)});else{let n=this.$route.path;const o=n.split("/");let l=t.$store.state.language.code;o.length>1&&(l=o[1],o.splice(0,2),n=o.join("/"));const f=n;this.$httpc.post("categories/find",{query:{parentPathSlug:"",type:f},lang:l}).then(function(u){u.data&&(t.categories=u.data.categories,u.data.page&&u.data.page.data&&(t.page=u.data.page.data,t.page.name&&t.$store.state&&typeof t.page.name[t.$store.state.language.code]<"u"&&(document.title=t.page.name[t.$store.state.language.code]+" - StretchShop")))}).catch(function(u){console.error(u)}).then(function(){t.eventBus.emit("pageDetailLoaded")})}this.$root.loadingClose()},queryStringtoFilter(e){var r,s;let t={};if(typeof this.$route.query.page<"u"){const i=parseInt(this.$route.query.page);i>0&&(t.page=i)}if(typeof this.$route.query.string<"u"){const i=decodeURIComponent(this.$route.query.string).trim();i!==""&&(t.stringFilter=i)}if(typeof this.$route.query.sort<"u"){const i=decodeURIComponent(this.$route.query.sort).trim();i!==""&&(t.sort=i)}t=(s=(r=this.$refs)==null?void 0:r[e])==null?void 0:s.queryStringtoFilter(t),this.filter={...this.filter,...t},this.eventBus.emit("queryFromUrlProcessed",t)},getCategoryFilteredCount(){return this.filteredProductsCount&&this.filteredProductsCount>0?this.filteredProductsCount:0},getCategoryBackground(){var e,t,r,s,i,n,o,l;return(e=this.categoryDetail)!=null&&e.slug&&((n=(i=(s=(r=(t=this.$store)==null?void 0:t.state)==null?void 0:r.coredata)==null?void 0:s.settings)==null?void 0:i.assets)!=null&&n.url)?this.$helpers.getImagePath("categories",this.$store.state.coredata,this.categoryDetail.slug,this.categoryDetail.slug+".jpg")+"?"+new Date((l=(o=this.categoryDetail)==null?void 0:o.dates)==null?void 0:l.dateUpdated).getTime():""}}},ut={class:"container category-list"},gt={key:0,class:"edit-area"},ht={class:"columns",id:"category-main-content"},dt={class:"column is-3 pr-6"},pt={key:0,class:"mt-6"},ft={class:"menu"},yt=a("p",{class:"menu-label subcategories",translate:"yes"}," Sub-Categories ",-1),mt={class:"menu-list"},_t={class:"column is-9"},Pt={key:0,class:"breadcrumb mb-2","aria-label":"breadcrumbs"},Ft={class:"is-active"},vt={class:"column"},xt={key:0,class:"title mb-0"},Ct={key:1,class:"title is-6 mb-5 has-text-grey-dark"},Mt=a("h1",{translate:"yes",class:"title is-1 title-products"},"Products",-1),bt=["innerHTML"],Dt={key:1,ref:"categoryListResults"},Tt={key:0},St={key:1},Rt={key:2},$t={class:"columns"},qt={class:"column is-12"},Lt={key:0,class:"title is-1"},It={key:3};function Ut(e,t,r,s,i,n){const o=F("font-awesome-icon"),l=F("router-link"),f=F("category-filter"),u=F("category-paging"),d=F("product-box"),h=F("page-detail-content"),C=F("error-page");return c(),g("div",ut,[n.userCanEdit&&(i.categoryDetail&&i.categoryDetail.pathSlug||i.page)?(c(),g("div",gt,[i.categoryDetail&&i.categoryDetail.pathSlug?(c(),$(l,{key:0,class:"editor-button edit-button",to:{name:"categoryNewEdit",params:{category:i.categoryDetail.pathSlug}}},{default:x(()=>[y(o,{icon:"edit"})]),_:1},8,["to"])):p("v-if",!0),i.page&&i.page.slug?(c(),$(l,{key:1,class:"editor-button edit-button",to:{name:"pageNewEdit",params:{slug:i.page.slug}}},{default:x(()=>[y(o,{icon:"edit"})]),_:1},8,["to"])):p("v-if",!0)])):p("v-if",!0),a("div",ht,[p(` v-if="(products && products.length>0) || (page && page.data)" - filter didn't work `),a("div",dt,[i.categories&&i.categories.length>0?(c(),g("nav",pt,[a("aside",ft,[yt,a("ul",mt,[(c(!0),g(M,null,b(this.categories,(_,m)=>(c(),g("li",{key:m},[y(l,{title:_.descriptionShort[e.$store.state.language.code],to:{name:"categoryList",params:{category:_.pathSlug}}},{default:x(()=>[D(v(_.name[e.$store.state.language.code]),1)]),_:2},1032,["title","to"])]))),128))])])])):p("v-if",!0),y(f,{ref:"categoryFilter",filter:i.filter,categoryMinMaxPrice:n.categoryMinMax,filterDefinitions:i.filterDefinitions,categoryType:n.getCategoryType,total:n.categoryProductsTotalForPaging},null,8,["filter","categoryMinMaxPrice","filterDefinitions","categoryType","total"])]),a("div",_t,[i.breadcrumbs&&i.breadcrumbs!=null&&i.breadcrumbs.length>0?(c(),g("nav",Pt,[a("ul",null,[(c(!0),g(M,null,b(i.breadcrumbs,(_,m)=>(c(),g("li",{key:m},[y(l,{title:_.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:_.pathSlug}}},{default:x(()=>[D(v(_.name[e.$store.state.language.code]),1)]),_:2},1032,["title","to"])]))),128)),a("li",Ft,[y(l,{title:i.categoryDetail.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:i.categoryDetail.pathSlug}},"aria-current":"page"},{default:x(()=>[D(v(i.categoryDetail.name[e.$store.state.language.code]),1)]),_:1},8,["title","to"])])])])):p("v-if",!0),a("div",{class:"columns category-header mt-2",style:O({backgroundImage:"url("+n.getCategoryBackground()+")"})},[a("div",vt,[i.categoryDetail?(c(),g("h1",xt,v(i.categoryDetail.name[e.$store.state.language.code]),1)):p("v-if",!0),i.categoryDetail?(c(),g("h2",Ct,v(i.categoryDetail.descriptionShort[e.$store.state.language.code]),1)):(c(),g(M,{key:2},[p(' <p v-if="categoryDetail" class="">{{ categoryDetail.descriptionLong[$store.state.language.code] }}</p> '),Mt],2112)),i.categoryDetail?(c(),g("div",{key:3,class:"categoryDescLong",innerHTML:i.categoryDetail.descriptionLong[e.$store.state.language.code]},null,8,bt)):p("v-if",!0)])],4),i.products&&i.products.length>0?(c(),g("div",Dt,[y(u,{ref:"categoryPaging",total:n.categoryProductsTotalForPaging,active:n.categoryActivePage,perPage:i.filter.limit},null,8,["total","active","perPage"]),i.itemsToListType=="products"?(c(),g("div",Tt,[(c(!0),g(M,null,b(i.products,(_,m)=>(c(),g("div",{class:"tile is-ancestor",key:i.groupsLastRefresh+m},[(c(!0),g(M,null,b(_,(P,L)=>(c(),$(l,{key:i.groupsLastRefresh+P._id+(m+L),class:"tile is-parent is-4",title:P.descriptionShort[e.$store.state.language.code],to:{name:"productDetail",params:{category:i.categoryDetail.pathSlug,product:P._id,slug:P.slug}}},{default:x(()=>[y(d,{product:P,listType:i.itemsToListType,hideBuyButton:"true"},null,8,["product","listType"])]),_:2},1032,["title","to"]))),128))]))),128)),p(" tile end ")])):p("v-if",!0),i.itemsToListType=="pages"?(c(),g("div",St,[(c(!0),g(M,null,b(i.products,(_,m)=>(c(),g("div",{class:"tile is-ancestor",key:i.groupsLastRefresh+m},[(c(!0),g(M,null,b(_,(P,L)=>(c(),$(l,{key:i.groupsLastRefresh+P._id+(m+L),class:"tile is-parent is-4",title:P.descriptionShort[e.$store.state.language.code],to:{name:"pageDetailShort",params:{category:i.categoryDetail.pathSlug,slug:P.slug}}},{default:x(()=>[y(d,{product:P,listType:i.itemsToListType},null,8,["product","listType"])]),_:2},1032,["title","to"]))),128))]))),128)),p(" tile end ")])):p("v-if",!0),y(u,{ref:"categoryPaging",bottom:!0,total:n.categoryProductsTotalForPaging,active:n.categoryActivePage,perPage:i.filter.limit},null,8,["total","active","perPage"])],512)):i.page&&i.page.data?(c(),g("div",Rt,[a("div",$t,[a("div",qt,[i.page.data&&i.page.data.name?(c(),g("h1",Lt,v(i.page.data.name[e.$store.state.language.code]),1)):p("v-if",!0),y(h,{content:n.categoryTypePageContent,contentData:n.categoryTypePageData,contentLang:i.language.code},null,8,["content","contentData","contentLang"])])])])):(c(),g("div",It,[y(C)]))])])])}const Ot=R(ct,[["render",Ut],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryList.vue"]]);export{Ot as default};
