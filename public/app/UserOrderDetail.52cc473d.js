import{O as P}from"./PaymentStripe.bd83eb24.js";import{_ as w,c as o,a as e,e as p,f,t as n,g as l,s as y,j as c,F as g,i as k,r as b,o as i}from"./index.638fece5.js";const A={name:"userOrderDetail",components:{"payment-stripe":P},data(){return{order:null,subscription:{needToApprove:!1,count:0,total:0},productToSubscription:{}}},created:function(){this.getOrder(this.$route.params.id)},computed:{userIsAdmin:function(){return!!(this.$store.state&&this.$store.state.user&&this.$store.state.user.logged&&this.$store.state.user.profile&&this.$store.state.user.profile.type&&this.$store.state.user.profile.type==="admin")},subscriptionClass:function(){return!this.subscription||this.subscription.total>0&&this.subscription.count<this.subscription.total?"has-text-danger":"has-text-success"}},methods:{getOrder(r){const t=this,u={timeout:3e3,needsAuth:!0},_={query:{_id:r},limit:1};this.$httpc.post("order/list",_,u).then(function(s){s&&s.data&&s.data&&s.data.results&&s.data.results.length===1&&(t.order=s.data.results[0])}).then(function(){t.eventBus.emit("translateContent",t.$store.getters.getTranslates),t.order&&t.order.data&&t.order.data.subscription&&t.order.data.subscription&&t.order.data.subscription.ids&&t.order.data.subscription.ids.length>0&&t.order.data.subscription.ids.forEach(s=>{s&&s.subscription&&(t.subscription.total++,!s.agreed||s.agreed===null?t.subscription.needToApprove=!0:(t.subscription.count++,t.productToSubscription[s.product]=s.subscription))}),t.subscription.needToApprove&&t.order&&t.order.data&&t.order.data.paymentData&&t.order.data.paymentData.codename&&(t.order.data.paymentData.codename==="online_paypal_paypal"&&t.paymentPayPalCall(),t.order.data.paymentData.codename==="online_stripe"&&t.paymentStripeAction())}).catch(function(s){console.error(s)})},splitTitle(r){return[r.slice(0,6),r.slice(6)]},checkDeliveryAddress:function(){return!!(this.order&&this.order.addresses&&this.order.addresses.deliveryAddress&&Object.keys(this.order.addresses.deliveryAddress).length>0)},invoiceAddress:function(){if(this.$store.state.coredata)return this.$helpers.addressToString(this.order.addresses.invoiceAddress,this.$store.state.coredata.countries,["type"])},deliveryAddress:function(){return this.order.addresses.deliveryAddress?this.$helpers.addressToString(this.order.addresses.deliveryAddress,this.$store.state.coredata.countries,["type"]):null},checkDeliveryData:function(){return!!(this.order&&this.order.data.deliveryData&&this.order.data.deliveryData.codename)},deliveryData:function(){const r=this,t=[];if(this.order&&this.order.data.deliveryData&&this.order.data.deliveryData.codename){const u=this.order.data.deliveryData.codename;if(this.order.settings&&this.order.settings.deliveryMethods){const _=this.order.settings.deliveryMethods;Object.keys(u).forEach(s=>{if(u&&_&&u[s]&&u[s]!==null){const a=u[s];a.type=s,a.name=a.value,_[s]&&_[s].forEach(h=>{h.type&&h.codename&&h.type===s&&h.codename===a.value&&(a.name=h.name[r.$store.getters.getLanguage])}),t.push(a)}})}return t}},checkPaymentData:function(){return!!(this.order&&this.order.data.paymentData)},paymentData:function(){const r=this;let t=null;return this.order&&this.order.data.paymentData&&(t={name:typeof this.order.data.paymentData.name[r.$store.getters.getLanguage]<"u"?this.order.data.paymentData.name[r.$store.getters.getLanguage]:this.order.data.paymentData.codename,price:this.order.data.paymentData.price}),t},checkActions:function(){return!!(this.needsPayment("online_paypal_paypal")||this.needsPayment("online_stripe"))},getPaymentProviderName:function(){if(this.order&&this.order.data&&this.order.data.paymentData&&this.order.data.paymentData.codename){const r=this.order.data.paymentData.codename.split("_");if(r.constructor===Array&&r.length>0)return r[r.length-1]}return"paypal"},needsPayment:function(r){return!!(this.order&&this.order.data&&this.order.data.paymentData&&this.order.data.paymentData.codename&&this.order.data.paymentData.codename===r&&this.order.dates&&!this.order.dates.datePaid)},makePayment(){this.order.data.paymentData.codename.indexOf("online_paypal")>-1&&this.paymentPayPalCall()},paymentPayPalCall:function(){const r=this;r.$httpc.post("/order/payment/paypal/geturl",{orderId:r.order._id,checkoutData:null},{timeout:1e4}).then(t=>{t&&t.data&&t.data.url&&t.data.url.trim()!==""&&(window.location.href=t.data.url)})},paymentStripeAction:function(){},invoiceDownload:function(){const r=this,t=this.getOrderInvoiceRequest();t&&t.request&&r.$httpc.get("/order/invoice/download/"+t.request,{needsAuth:!0,responseType:"arraybuffer"}).then(u=>{this.downloadFile(u,t.filename)})},downloadFile(r,t){var u=new Blob([r.data],{type:"application/pdf"});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(u);return}const _=window.URL.createObjectURL(u);var s=document.createElement("a");s.href=_,s.download=t,s.click(),setTimeout(function(){window.URL.revokeObjectURL(_)},100)},orderPay:function(){const r=this;this.$httpc.get("/order/invoice/pay/"+this.order._id,{needsAuth:!0}).then(t=>{t&&t.html&&t.path&&(r.order.invoice||(r.order.invoice={}),r.order.invoice=t,r.$forceUpdate())})},orderCancel:function(){const r=this;this.$httpc.get("/order/invoice/cancel/"+this.order._id,{needsAuth:!0}).then(t=>{t&&t.success&&t.order&&(r.order||(r.order={}),r.order=t.order,r.$forceUpdate())})},makeExpedition:function(){const r=this;this.$httpc.get("/order/invoice/expeded/"+this.order._id,{needsAuth:!0}).then(t=>{t&&t.success&&t.order&&(r.order||(r.order={}),r.order=t.order,r.$forceUpdate())})},getOrderInvoiceRequest:function(){let r="",t=this.order.invoice.path.split("/"),u=null,_=null;return t=t.filter(Boolean),t[2]&&t[2].indexOf(".pdf")>-1&&(_=t[2],t[2]=t[2].split("."),t[2][1]&&(r=t[1]+"."+t[2][0],u=t[2][0])),{request:r,id:u,filename:_}},getSubscriptionIdFromProductId:function(r){this.order&&this.order.data&&this.order.data.subscription&&this.order.data.subscription.ids}}},T={id:"userOrderDetail"},O={key:0},C={class:"container"},S={class:"columns is-variable is-centered"},x={class:"column is-8"},I={class:"breadcrumb","aria-label":"breadcrumbs"},E=e("span",{translate:"yes"},"Orders",-1),L={class:"is-active"},U={"aria-current":"page"},B=e("span",{class:"order-word",translate:"yes"},"Order",-1),q=l(" \xA0 "),N={class:"order-title"},R=l("#"),F={class:"title is-2"},M=e("span",{translate:"yes"},"Order",-1),Y={class:"order-title"},j=l(" #"),z={class:"container"},V={key:0,class:"columns is-variable is-centered orderProgressVisual"},H={class:"column is-8"},W={class:"o-steps__wrapper"},Q={class:"o-steps o-steps--animated"},G={class:"o-steps__link o-steps__link-label-bottom"},J={class:"o-steps__marker o-steps__marker--rounded"},K={class:"step-details"},X={class:"o-step-title"},Z=e("span",{translate:"yes"},"Created",-1),$={class:"step-date"},ee=e("span",{class:"o-steps__divider"},null,-1),te={class:"o-steps__link o-steps__link-label-bottom"},se={class:"o-steps__marker o-steps__marker--rounded"},re={class:"step-details"},oe={class:"o-step-title"},ie=e("span",{translate:"yes"},"Paid",-1),ne={class:"step-date"},ae=e("span",{class:"o-steps__divider"},null,-1),de={class:"o-steps__link o-steps__link-label-bottom"},ce={class:"o-steps__marker o-steps__marker--rounded"},le={class:"step-details"},ue={class:"o-step-title"},_e=e("span",{translate:"yes"},"Expeded",-1),he={class:"step-date"},pe={class:"container order-detail-data"},ye={class:"columns is-variable"},me={class:"column is-12"},ve={key:0},fe=e("span",{translate:"yes"},"Your available actions",-1),be=l(": "),ge={key:0},ke=e("span",{translate:"yes"},"Pay order",-1),De=[ke],Pe={key:1},we=e("span",{id:"user-order-detail--subscription",translate:"yes"},"Subscriptions Approved",-1),Ae={key:0},Te=e("div",{class:"is-size-7"},[e("p",null,"Not all subscriptions are approved. Your order is not finished until all subscriptions are approved."),e("p",null,"Waiting to redirect you to payment gate to Approve next missing Subscriptions. If nothing happens, click the button bellow.")],-1),Oe=e("span",{translate:"yes"},"Approve Subscription",-1),Ce=[Oe],Se={key:1},xe=e("div",{class:"is-size-7"},[e("p",null,"All subscriptions are approved, we are preparing to finish your order.")],-1),Ie=[xe],Ee={class:"container order-detail-data"},Le={class:"columns is-variable"},Ue={class:"column is-6 pr-6"},Be={key:0},qe={class:"columns is-variable"},Ne={class:"column is-12"},Re={class:"b-table"},Fe={class:"table-wrapper"},Me={class:"table is-hoverable is-striped is-fullwidth"},Ye=e("thead",null,[e("tr",null,[e("th",{class:""},[e("div",{class:"th-wrap",translate:"yes"},"Name")]),e("th",{class:""},[e("div",{class:"th-wrap is-pulled-right",translate:"yes"},"Qty")]),e("th",{class:""},[e("div",{class:"th-wrap is-pulled-right",translate:"yes"},"Price")])])],-1),je={key:0,class:"desc"},ze={key:0},Ve={class:"cartItemAmount has-text-right"},He={class:"has-text-right"},We={key:0,class:"desc"},Qe={key:0},Ge=e("td",null,null,-1),Je=e("td",{class:"has-text-right"},[e("strong",{translate:"yes"},"Products Total")],-1),Ke={class:"has-text-right"},Xe={key:1},Ze=e("td",null,null,-1),$e=e("td",{class:"has-text-right"},[e("span",{translate:"yes"},"Price delivery")],-1),et={class:"has-text-right"},tt={key:2},st=e("td",null,null,-1),rt=e("td",{class:"has-text-right"},[e("span",{translate:"yes"},"Price payment")],-1),ot={class:"has-text-right"},it={key:3},nt=e("td",null,null,-1),at=e("td",{class:"has-text-right"},[e("strong",{translate:"yes"},"Total price")],-1),dt={class:"has-text-right"},ct={key:1},lt=e("h3",{class:"title is-3"},[e("span",{translate:"yes"},"No items in this order")],-1),ut=[lt],_t={class:"column is-6 pl-6"},ht={class:"columns is-variable is-2"},pt={class:"column is-6"},yt=e("h3",{class:"title is-5",translate:"yes"},"You are ordering to:",-1),mt={class:"summary-block with-pre-whitespace"},vt={key:0,class:"column is-6"},ft=e("h3",{class:"title is-5",translate:"yes"},"With delivery to:",-1),bt={class:"summary-block with-pre-whitespace"},gt={key:1,class:"column is-6"},kt=e("h3",{class:"title is-5",translate:"yes"},"With delivery to:",-1),Dt=e("div",{class:"summary-block",translate:"yes"},"same as invoice address",-1),Pt=[kt,Dt],wt={class:"columns is-variable is-2"},At={class:"column is-6",id:"order-detail--delivery-settings"},Tt=e("h3",{class:"title is-5",translate:"yes"},"Your Delivery settings:",-1),Ot={key:0,class:"content summary-block"},Ct={class:"capitalize"},St=l(" - "),xt={key:0,class:"column is-6"},It={id:"order-detail--payment-settings"},Et=e("h3",{class:"title is-5",translate:"yes"},"Your Payment settings:",-1),Lt={key:0,class:"content summary-block"},Ut=e("p",null,"Having issue with your order? Don't hesitate to contact us",-1),Bt=e("hr",{class:"mb-0"},null,-1),qt={key:0,id:"orderDetailAdminActions",class:"p-4 mb-4"},Nt={class:"columns is-variable"},Rt={key:0,class:"column is-12"},Ft=l(" Admin action: "),Mt={key:1,class:"container order-invoice-detail has-text-left"},Yt=e("h3",{class:"title is-2 is-centered",translate:"yes"},"Your Invoice",-1),jt={class:"columns is-variable"},zt={class:"column is-12"},Vt={class:"columns is-variable is-centered"},Ht={key:0,class:"column is-8"},Wt=["innerHTML"],Qt={key:1,class:"container"},Gt={class:"columns is-variable is-centered"},Jt={class:"column is-8"},Kt=e("h1",{class:"title is-1",translate:"yes"},"Unauthorized",-1),Xt=e("span",{translate:"yes"},"To see order detail, you may need to",-1),Zt=l(" \xA0 "),$t=l("Log in"),es=l(". "),ts=e("p",{translate:"yes"},[l(" If you ordered without registration, "),e("br"),l(" you may need to check your email for activation message first. ")],-1);function ss(r,t,u,_,s,a){const h=b("router-link"),m=b("font-awesome-icon"),D=b("payment-stripe");return i(),o("div",T,[s.order?(i(),o("div",O,[e("div",C,[e("div",S,[e("div",x,[e("nav",I,[e("ul",null,[e("li",null,[p(h,{to:{name:"userOrders"}},{default:f(()=>[E]),_:1})]),e("li",L,[e("a",U,[B,q,e("span",N,[R,e("strong",null,n(a.splitTitle(s.order._id)[0]),1),l(n(a.splitTitle(s.order._id)[1]),1)])])])])])])])]),e("h2",F,[M,e("span",Y,[j,e("strong",null,n(a.splitTitle(s.order._id)[0]),1),l(n(a.splitTitle(s.order._id)[1]),1)])]),e("div",z,[s.order.dates?(i(),o("div",V,[e("div",H,[e("div",W,[e("nav",Q,[e("div",{class:y(s.order.dates.dateCreated?"o-steps__nav-item o-steps__nav-item-previous":"o-steps__nav-item")},[e("a",G,[e("div",J,[p(m,{icon:"cart-plus"})]),e("div",K,[e("span",X,[Z,e("span",$,n(s.order.dates.dateCreated),1)])])])],2),e("div",{class:y(s.order.dates.datePaid?"o-steps__nav-item o-steps__nav-item-previous":"o-steps__nav-item")},[ee,e("a",te,[e("div",se,[p(m,{icon:"credit-card"})]),e("div",re,[e("span",oe,[ie,e("span",ne,n(s.order.dates.datePaid),1)])])])],2),e("div",{class:y(s.order.dates.dateExpeded?"o-steps__nav-item o-steps__nav-item-previous":"o-steps__nav-item")},[ae,e("a",de,[e("div",ce,[p(m,{icon:"truck"})]),e("div",le,[e("span",ue,[_e,e("span",he,n(s.order.dates.dateExpeded),1)])])])],2)])])])])):c("",!0)]),e("div",pe,[e("div",ye,[e("div",me,[a.checkActions()?(i(),o("span",ve,[fe,be,a.needsPayment("online_paypal_paypal")?(i(),o("div",ge,[s.order.dates&&!s.order.dates.datePaid?(i(),o("button",{key:0,type:"button",class:"button",onClick:t[0]||(t[0]=d=>a.makePayment())},De)):c("",!0)])):c("",!0),a.needsPayment("online_stripe")?(i(),o("div",Pe,[p(D,{order:s.order,description:"Uses secured Stripe engine for comfort card payment"},null,8,["order"])])):c("",!0)])):c("",!0),s.subscription.total?(i(),o("div",{key:1,class:y(a.subscriptionClass)},[we,l(" "+n(s.subscription.count)+" / "+n(s.subscription.total)+" ",1),s.subscription.count<s.subscription.total?(i(),o("div",Ae,[Te,e("button",{type:"button",class:"button is-danger",onClick:t[1]||(t[1]=d=>a.makePayment())},Ce)])):(i(),o("div",Se,Ie))],2)):c("",!0)])])]),e("div",Ee,[e("div",Le,[e("div",Ue,[s.order.items!=null&&s.order.items&&s.order.items.length>0?(i(),o("div",Be,[e("div",qe,[e("div",Ne,[e("div",Re,[e("div",Fe,[e("table",Me,[Ye,e("tbody",null,[(i(!0),o(g,null,k(s.order.items,(d,v)=>(i(),o("tr",{key:v},[e("th",null,[d.type!=="product"?(i(),o("span",je,[l(n(d.type)+" ",1),d.type==="subscription"?(i(),o("span",ze,[p(h,{to:{name:"userSubscriptionDetail",params:{id:s.productToSubscription[d._id]}}},{default:f(()=>[l(n(s.productToSubscription[d._id]),1)]),_:2},1032,["to"])])):c("",!0)])):c("",!0),l(" "+n(d.name[r.$store.state.language.code]),1)]),e("td",Ve,n(d.amount),1),e("td",He,[e("span",null,n(r.$helpers.numeral(d.price).format("0.00")),1),e("span",null,n(r.$store.state.currency.symbol),1),d.type!=="product"&&d.data&&d.data.subscription&&d.data.subscription.period?(i(),o("span",We," / "+n(d.data.subscription.period),1)):c("",!0)])]))),128))]),e("tfoot",null,[s.order.prices&&s.order.prices.priceItems?(i(),o("tr",Qe,[Ge,Je,e("td",Ke,n(r.$helpers.numeral(s.order.prices.priceItems).format("0.00"))+" "+n(r.$store.state.currency.symbol),1)])):c("",!0),s.order.prices&&s.order.prices.priceDelivery?(i(),o("tr",Xe,[Ze,$e,e("td",et,n(r.$helpers.numeral(s.order.prices.priceDelivery).format("0.00"))+" "+n(r.$store.state.currency.symbol),1)])):c("",!0),s.order.prices&&s.order.prices.pricePayment?(i(),o("tr",tt,[st,rt,e("td",ot,n(r.$helpers.numeral(s.order.prices.pricePayment).format("0.00"))+" "+n(r.$store.state.currency.symbol),1)])):c("",!0),s.order.prices&&s.order.prices.priceTotal?(i(),o("tr",it,[nt,at,e("td",dt,[e("strong",null,n(r.$helpers.numeral(s.order.prices.priceTotal).format("0.00")),1),l(" "+n(r.$store.state.currency.symbol),1)])])):c("",!0)])])])])])])])):(i(),o("div",ct,ut))]),e("div",_t,[e("div",ht,[e("div",pt,[yt,e("div",mt,n(a.invoiceAddress()),1)]),a.checkDeliveryAddress()?(i(),o("div",vt,[ft,e("div",bt,n(a.deliveryAddress()),1)])):(i(),o("div",gt,Pt))]),e("div",wt,[e("div",At,[Tt,a.checkDeliveryData()?(i(),o("div",Ot,[(i(!0),o(g,null,k(a.deliveryData(),(d,v)=>(i(),o("div",{key:v},[e("p",null,[e("span",Ct,n(d.type),1),St,e("strong",null,n(d.name),1),l(": "+n(r.$helpers.numeral(d.price).format("0.00"))+"\xA0"+n(r.$store.state.currency.symbol),1)])]))),128))])):c("",!0)]),a.checkPaymentData()?(i(),o("div",xt,[e("div",It,[Et,a.paymentData()?(i(),o("div",Lt,[e("p",null,[e("strong",null,n(a.paymentData().name),1),l(": "+n(r.$helpers.numeral(a.paymentData().price).format("0.00"))+"\xA0"+n(r.$store.state.currency.symbol),1)])])):c("",!0)])])):c("",!0)])])])]),Ut,Bt,a.userIsAdmin?(i(),o("div",qt,[e("div",Nt,[s.order.dates?(i(),o("div",Rt,[Ft,s.order.dates.datePaid?c("",!0):(i(),o("button",{key:0,type:"button",class:"button",onClick:t[2]||(t[2]=d=>a.orderPay())},"Pay Order")),s.order.dates.dateCanceled?c("",!0):(i(),o("button",{key:1,type:"button",class:"button",onClick:t[3]||(t[3]=d=>a.orderCancel())},"Cancel Order")),s.order.dates.dateExpeded?c("",!0):(i(),o("button",{key:2,type:"button",class:"button",onClick:t[4]||(t[4]=d=>a.makeExpedition())},"Make Expedition"))])):c("",!0)])])):c("",!0),s.order&&s.order.invoice?(i(),o("div",Mt,[Yt,e("div",jt,[e("div",zt,[e("button",{type:"button",class:"button",onClick:t[5]||(t[5]=d=>a.invoiceDownload())},"Download Invoice")])]),e("div",Vt,[s.order&&s.order.invoice&&s.order.invoice.html?(i(),o("div",Ht,[e("div",{class:"order-invoice-body",innerHTML:s.order.invoice.html},null,8,Wt)])):c("",!0)])])):c("",!0)])):(i(),o("div",Qt,[e("div",Gt,[e("div",Jt,[Kt,e("p",null,[Xt,Zt,p(h,{to:{name:"login"},tag:"a",class:"","active-class":"is-active",translate:"yes"},{default:f(()=>[$t]),_:1}),es]),ts])])]))])}const is=w(A,[["render",ss]]);export{is as default};
