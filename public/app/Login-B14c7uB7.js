import{G as f}from"./GoogleRecaptcha-BKMiERXp.js";import{r as c,c as g,a as s,i as _,I as l,N as d,a6 as v,e as y,h as b,f as m,b as w,w as k,o as u}from"./sett-4GVrJM9M.js";import{_ as R}from"./index-D0WNZmOK.js";const x={name:"UsersLogin",components:{"google-recaptcha":f},data(){return{email:"",password:"",remember:!1}},created:function(){},computed:{useRecaptcha:function(){var t,e,a;return((a=(e=(t=this.$store.state)==null?void 0:t.coredata)==null?void 0:e.settings)==null?void 0:a.formVerif)==="recaptcha"}},methods:{userLogin:function(){console.log("userLogin: email:",this.email,"password:",this.password,"remember:",this.remember,"useRecaptcha:",this.useRecaptcha);const t=this.$helpers.propertiesRequiredConfirm({email:this.email,password:this.password},["email","password"]);console.log("userLogin:",t,!t.result,this.email==="",this.password==="",!t.result||this.email===""||this.password===""),!t.result||this.email===""||this.password===""?(console.log("bad conditions"),this.$helpers.formUndecorateAndDecorateFields(t.fields,t.errors)):(console.log("good conditions"),this.$helpers.secureForm("login",this.$refs.recaptcha).then(e=>{console.log("secureForm result:",e),e&&this.sendRequest()}))},sendRequest:function(){const t=this;console.log("sendRequest"),this.$httpc.post("users/login",{user:{email:this.email,password:this.password}},{tokenize:!0}).then(function(e){if(e.data.user&&e.data.user._id){t.$store.state.user.logged=!0,t.$store.state.user.remember=t.remember;const a=e.data.user;t.$store.dispatch("setUser",a),t.$router.push({name:"me"})}}).catch(function(e){console.error("users/login:",e),e.response&&e.response.data&&e.response.data.errors&&Object.keys(e.response.data.errors).length>0&&Object.keys(e.response.data.errors).forEach(function(a){const i=t.$el.querySelector(".field."+a);if(i){const o=i.querySelector('.form-messages .form-message[data-message="'+e.response.data.errors[a]+'"]');if(o&&o!==null){t.$helpers.undecorateFormField(i,"danger");const n=o.innerText;t.$helpers.decorateFormField(i,n,"danger")}}})}).then(function(e){})}}},L={class:"container users-login"},F=s("div",{class:"column"},[s("h1",{class:"title is-1"},"Login")],-1),V={class:"column is-4 is-offset-4"},$={class:"field email"},C={class:"control"},U=s("div",{class:"form-messages is-hidden"},[s("div",{class:"form-message","data-message":"wrong credentials",translate:"yes"},"Wrong credentials"),s("div",{class:"form-message","data-message":"not activated",translate:"yes"},"Account not activated. Check your mailbox for activation email."),s("div",{class:"form-message","data-message":"is empty",translate:"yes"},"This field cannot be empty")],-1),q={class:"field password"},N={class:"control"},T=s("div",{class:"form-messages is-hidden"},[s("div",{class:"form-message","data-message":"is empty",translate:"yes"},"This field cannot be empty")],-1),B={class:"field"},E=s("span",{translate:"yes"},"Remember my login on this computer",-1),S=s("button",{class:"button is-medium is-primary",type:"submit",translate:"yes"},"Login",-1),D={class:"column is-4 is-offset-4"},G={translate:"yes"};function M(t,e,a,i,o,n){const p=c("google-recaptcha"),h=c("router-link");return u(),g("div",L,[F,s("div",V,[s("form",{onSubmit:e[3]||(e[3]=_((...r)=>n.userLogin&&n.userLogin(...r),["prevent"])),ref:"loginSubmit"},[s("div",$,[s("div",C,[l(s("input",{class:"input",placeholder:"Email",type:"email","onUpdate:modelValue":e[0]||(e[0]=r=>o.email=r)},null,512),[[d,o.email,void 0,{trim:!0}]])]),U]),s("div",q,[s("div",N,[l(s("input",{class:"input",placeholder:"Password",type:"password","onUpdate:modelValue":e[1]||(e[1]=r=>o.password=r)},null,512),[[d,o.password,void 0,{trim:!0}]])]),T]),s("div",B,[E,l(s("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=r=>o.remember=r)},null,512),[[v,o.remember]])]),S,n.useRecaptcha?(u(),y(p,{key:0,ref:"recaptcha"},null,512)):b("",!0)],544)]),s("div",D,[s("p",G,[m("Forgot your password? "),w(h,{to:{name:"reset"},tag:"a"},{default:k(()=>[m("Reset your password")]),_:1})])])])}const z=R(x,[["render",M],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/users/Login.vue"]]);export{z as default};
