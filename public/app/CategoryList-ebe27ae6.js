import{o as c,c as g,H as U,a,t as F,h,r as P,G as S,I as L,F as C,d as M,b as m,w as x,f as b,L as G,S as I,e as $,j as V}from"./sett-20862007.js";import{_ as R,A as T,P as O,a as j,E as B}from"./index-df1e1240.js";import"./edit-bbc6728f.js";const N={name:"RangeSlider",data(){return{valueFrom:null,valueTo:null}},props:["inputMin","inputMax","inputFrom","inputTo","id"],mounted:function(){var e;console.log("RangeSlide this.props: ",this.inputMin,this.inputMax,this.inputFrom,this.inputTo,this.id),this.inputMin&&this.inputMax&&this.inputFrom&&this.inputTo&&((e=this.id)!=null&&e.name)&&(this.valueFrom=this.inputFrom,this.valueTo=this.inputTo,this.$refs.sliderRangeLeft.value=this.inputFrom,this.$refs.sliderRangeRight.value=this.inputTo,this.priceSliderChange({target:this.$refs.sliderRangeLeft,forceValue:this.inputFrom}),this.priceSliderChange({target:this.$refs.sliderRangeRight,forceValue:this.inputTo}))},methods:{priceSliderChange:function(e){var s;const t=typeof e.forceValue<"u"?e.forceValue:null,r=e.target;if(r){let i=r.getAttribute("position"),n="",o=0,u=null;i==="left"?(n="right",o=-1,u=r.parentNode.querySelector("input[type=range][position="+n+"]"),r.value=Math.min(r.value,parseInt(u.value)+o)):(i="right",n="left",o=1,u=r.parentNode.querySelector("input[type=range][position="+n+"]"),r.value=Math.max(r.value,parseInt(u.value)+o));let p=null;const l={min:this.inputMin,max:this.inputMax};t!==null?(r.min===0&&typeof l.min<"u"&&(r.min=l.min),r.max===0&&typeof l.max<"u"&&(r.max=l.max),p=100/(parseInt(r.max)-parseInt(r.min))*parseInt(t)-100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.min)):(r.value===0&&(i==="left"&&l&&(r.value=l.min),i==="right"&&l&&(r.value=l.max)),p=100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.value)-100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.min));const d=r.parentNode.querySelector(".slider-range-controls");i==="left"?(d.querySelector("[inverse-"+i+"]").style.width=p+"%",d.querySelector("[range]").style.left=p+"%"):(d.querySelector("[inverse-"+i+"]").style.width=100-p+"%",d.querySelector("[range]").style.right=100-p+"%"),d.querySelector("[thumb="+i+"]").style.left=p+"%",d.querySelector("[sign="+i+"]").style.left=p+"%",r.value===0?(i==="right"&&typeof l.max<"u"&&l.max>0&&(d.querySelector("[sign="+i+"] .value").innerText=Math.round(l.max*100)/100),i==="left"&&typeof l.min<"u"&&l.min>0&&(d.querySelector("[sign="+i+"] .value").innerText=Math.round(l.min*100)/100)):d.querySelector("[sign="+i+"] .value").innerText=Math.round(r.value*100)/100;const f={};i==="left"?(f.min=r.value,f.max=u.value):(f.min=u.value,f.max=r.value),f.min=f.min>this.inputMin?Math.round(f.min):this.inputMin,f.max=f.max<this.inputMax?Math.round(f.max):this.inputMax,this.valueFrom=f.min,this.valueTo=f.max,t===null&&(typeof this.id=="object"&&this.id.name&&this.id.key?this.eventBus.emit("rangeSliderChanged-"+(this.id.name||""),{key:this.id.key,result:f}):this.eventBus.emit("rangeSliderChanged-"+(((s=this.id)==null?void 0:s.name)||""),f))}}}},E={class:"slider-range-wrapper"},w={slider:"",class:"slider-range"},A={class:"slider-range-controls"},Q=a("div",{"inverse-left":"",style:{width:"0%"}},null,-1),H=a("div",{"inverse-right":"",style:{width:"0%"}},null,-1),z=a("div",{range:"",style:{left:"0%",right:"0%"}},null,-1),K=a("span",{thumb:"left",style:{left:"0%"}},null,-1),Y=a("span",{thumb:"right",style:{left:"100%"}},null,-1),W={sign:"left",style:{left:"0%"}},J={class:"value"},X={sign:"right",style:{left:"100%"}},Z={class:"value"},ee=["value","max","min"],te=["value","max","min"];function ie(e,t,r,s,i,n){return c(),g("div",E,[U(e.$slots,"default"),a("div",w,[a("div",A,[Q,H,z,K,Y,a("div",W,[a("span",J,F(Math.round(r.inputMin*100)/100),1)]),a("div",X,[a("span",Z,F(Math.round(r.inputMax*100)/100),1)])]),a("input",{ref:"sliderRangeLeft",type:"range",position:"left",tabindex:"0",value:r.inputFrom,max:r.inputMax,min:r.inputMin,step:"any",onInput:t[0]||(t[0]=(...o)=>n.priceSliderChange&&n.priceSliderChange(...o))},null,40,ee),a("input",{ref:"sliderRangeRight",type:"range",position:"right",tabindex:"0",value:r.inputTo,max:r.inputMax,min:r.inputMin,step:"any",onInput:t[1]||(t[1]=(...o)=>n.priceSliderChange&&n.priceSliderChange(...o))},null,40,te)]),h(" <div>{{ inputMin }} / {{ inputMax }} || {{ inputFrom }} / {{ inputTo }} || {{ valueFrom }} / {{ valueTo }}</div> ")])}const k=R(N,[["render",ie],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/global/RangeSlider.vue"]]);const re={name:"ProductGenericFilter",components:{rangeslider:k},data(){return{filter:{},filterProps:{}}},mounted:function(){this.eventBus.emit("translateContent",this.$store.getters.getTranslates),this.eventBus.on("categoryPageChanged",e=>{console.log("ProductGenericFilter eventBus.categoryPageChanged newPageValue: ",e)}),this.eventBus.on("rangeSliderChanged-ProductGenericFilter",e=>{console.log("rangeSliderChanged-ProductGenericFilter: ",e),e!=null&&e.key&&(e!=null&&e.result)&&(this.filter[e.key]={from:Number(e.result.min),to:Number(e.result.max)},this.filterUpdated())}),console.log("ProductGenericFilter mounted() this.filter & this.filterDefinitions: ",this.filter,this.filterDefinitions),this.getGenericFilterValues()},props:["filterDefinitions","totalCount"],watch:{filterDefinitions(e,t){const r=this;e&&(this.refreshFilterProps(e),r.filter===null&&(r.filter={}),Object.keys(e).forEach(s=>{(typeof r.filter[s]>"u"||r.filter[s]===null)&&(r.filter[s]=null)}))}},computed:{singleParams(){let e={};return this.filterDefinitions&&Object.keys(this.filterDefinitions).forEach(t=>{this.getFilterType(this.filterDefinitions[t])==="single"&&(e[t]=this.filterDefinitions[t])}),e}},methods:{refreshFilterProps(e){this.filterProps={},e&&Object.keys(e).forEach(t=>{var r;e[t]&&(this.filterProps[t]={},this.filterProps[t].type=this.getFilterType(e[t])),e[t]&&e[t].value&&(this.filterProps[t].value=!0),(e[t]&&e[t].value&&((r=e[t].value)==null?void 0:r.constructor)!==Array&&typeof e[t].value=="object"||e[t]&&e[t].constructor!==Array&&typeof e[t]=="object")&&(this.filterProps[t].translation=!0)}),console.log("ProductGenericFilter refreshFilterProps() this.filterProps: ",this.filterProps)},getFilterName(e,t){return t.name?t.name[this.$store.state.language.code]?t.name[this.$store.state.language.code].constructor===Array?t.name[this.$store.state.language.code].join(", "):t.name[this.$store.state.language.code]:t.name.constructor===Array?t.name.join(", "):t.name:e},getFilterType(e){if(e=this.getRealValue(e),e)if(e.constructor===Array){let t=!0;return e.some(r=>{if(typeof r!="number")return t=!1,!0}),t?"range":"array"}else return"single"},getRealValue(e){return e!=null&&e.value?e.value[this.$store.state.language.code]?e.value[this.$store.state.language.code]:e.value:e},setSingleValue(e,t){var r,s;(r=e==null?void 0:e.target)!=null&&r.checked&&((s=e==null?void 0:e.target)!=null&&s.value)?(this.filter[t]=this.getRealValue(e.target.value),this.filterUpdated()):(delete this.filter[t],this.filterUpdated())},arrayValueChanged(e){var t;((t=this.filter[e])==null?void 0:t.length)===0&&delete this.filter[e],this.filterUpdated()},filterUpdated(){if(this.filter){const e=this.prepareGenericQuery();this.eventBus.emit("productGenericFilterUpdate",{query:e,url:this.prepareUrl(e)})}},prepareGenericQuery(e=!0){let t=null;return this.filter&&(e=!(typeof e<"u"&&e===!1),e&&this.refreshFilterProps(this.filterDefinitions),Object.keys(this.filter).length>0&&(t={$and:[]},Object.keys(this.filter).forEach(s=>{var i;if(this.filter[s]&&((i=this.filterProps[s])!=null&&i.type))switch(this.filterProps[s].type){case"range":t.$and.push(this.prepareRangeQuery(s,this.filter[s]));break;case"array":t.$and.push(this.prepareArrayQuery(s,this.filter[s]));break;default:t.$and.push(this.prepareSingleQuery(s,this.filter[s]))}})),t&&(t.$and===[]||t.$and.length===0)&&(t=null)),console.log("productGenericFilter prepareGenericQuery() result: ",t),t},prepareRangeQuery(e,t){const r={$gte:t.from,$lte:t.to};return this.prepareSingleQuery(e,r)},prepareArrayQuery(e,t){const r={$in:t};return this.prepareSingleQuery(e,r)},prepareSingleQuery(e,t){const r={$or:[]};let s="properties."+e;const i={};i[s]=t,s+=".value";const n={};n[s]=t,s+="."+this.$store.state.language.code;const o={};return o[s]=t,r.$or.push(i,n,o),r},prepareUrl(e){let t="";this.refreshFilterProps(this.filterDefinitions);const r=Object.keys(this.filter),s=Object.keys(this.filterProps);return(r==null?void 0:r.length)>0&&(s==null?void 0:s.length)>0&&(t=[],Object.keys(this.filter).forEach(i=>{var n;if(this.filter[i]&&((n=this.filterProps[i])!=null&&n.type))switch(this.filterProps[i].type){case"range":t.push("-gr--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i].from)+"-"+encodeURIComponent(this.filter[i].to));break;case"array":let o=[];this.filter[i].forEach((u,p)=>{o.push(encodeURIComponent(this.filter[i][p]))}),t.push("-ga--"+encodeURIComponent(i)+"="+o.join(";"));break;default:t.push("-g--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i]))}})),t.join("&")},getGenericFilterValues(){var e;this.filter=((e=this.filter)==null?void 0:e.genericFilter)||{}},queryStringtoFilter(){let e=null;return typeof this.$route.query<"u"&&Object.keys(this.$route.query).forEach(t=>{if(["-gr--","-ga--","-g--"].some(s=>t.includes(s))){e===null&&(e={});const s=t.split("--")[1],i=this.$route.query[t].trim();if(t.indexOf("-ga--")>-1)e[s]=decodeURIComponent(i).split(";"),this.filterProps[s]={type:"array"};else if(t.indexOf("-gr--")>-1){const n=decodeURIComponent(i).split("-");e[s]={from:Number(n[0]),to:Number(n[1])},this.filterProps[s]={type:"range"}}else t.indexOf("-g--")>-1&&(e[s]=decodeURIComponent(i).trim()!=="",this.filterProps[s]={type:"single"})}}),this.filter=e,console.log("productGenericFilter queryStringtoFilter() this.filter: ",this.filter),e}}},ne={class:"generic-filter"},se={key:0,class:"gf-range"},ae={class:"panel-block-multiwrapper"},oe={class:"gf-range-label"},le=["id"],ce={key:1,class:"gf-array"},ue={key:0,class:"autofield"},ge={class:"gf-singles-wrapper"},de={class:"field gf-single"},he={class:"s-input checkbox"},fe=["value","checked","onClick"];function pe(e,t,r,s,i,n){const o=P("rangeslider"),u=P("o-inputitems"),p=P("o-field");return S((c(),g("nav",ne,[(c(!0),g(C,null,M(r.filterDefinitions,(l,d)=>{var f,D;return c(),g("div",{key:"mp-"+d},[n.getFilterType(l)==="range"?(c(),g("div",se,[a("div",ae,[m(o,{id:{name:"ProductGenericFilter",key:d},ref_for:!0,ref:"productPriceRange","input-min":Math.min.apply(null,n.getRealValue(l)),"input-max":Math.max.apply(null,n.getRealValue(l)),"input-from":i.filter&&i.filter[d]?(f=i.filter[d])==null?void 0:f.from:Math.min.apply(null,n.getRealValue(l)),"input-to":i.filter&&i.filter[d]?(D=i.filter[d])==null?void 0:D.to:Math.max.apply(null,n.getRealValue(l))},{default:x(()=>[a("div",oe,[a("label",{class:"label",id:"gf-"+d,translate:"yes"},F(n.getFilterName(d,l)),9,le)])]),_:2},1032,["id","input-min","input-max","input-from","input-to"])])])):h("v-if",!0),n.getFilterType(l)==="array"?(c(),g("div",ce,[i.filter?(c(),g("section",ue,[m(p,{label:n.getFilterName(d,l)},{default:x(()=>[m(u,{modelValue:i.filter[d],"onUpdate:modelValue":[y=>i.filter[d]=y,y=>n.arrayValueChanged(d)],data:n.getRealValue(l),autocomplete:"","allow-new":!1,"open-on-focus":!0,type:"is-info"},null,8,["modelValue","onUpdate:modelValue","data"])]),_:2},1032,["label"])])):h("v-if",!0)])):h("v-if",!0)])}),128)),a("div",ge,[(c(!0),g(C,null,M(n.singleParams,(l,d)=>(c(),g("div",{key:"sp-"+d},[a("div",de,[a("label",he,[a("input",{type:"checkbox",class:"check",value:n.getRealValue(l),checked:i.filter&&i.filter[d]?i.filter[d]:!1,onClick:f=>n.setSingleValue(f,d)},null,8,fe),a("div",null,[a("strong",null,F(n.getFilterName(d,l))+": ",1),a("span",null,F(n.getRealValue(l)),1)])])])]))),128))])],512)),[[L,r.filterDefinitions&&r.totalCount>0]])}const me=R(re,[["render",pe],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/ProductGenericFilter.vue"]]);const ye={name:"CategoryFilter",components:{rangeslider:k,genericfilter:me},data(){return{eventTimeoutId:null,tempFilter:{page:1,minMaxPrice:{min:null,max:null},stringFilter:"",sort:this.getDefaultSorting()},introMinMaxPrice:{min:null,max:null},genericFilter:{}}},mounted:function(){this.eventBus.emit("translateContent",this.$store.getters.getTranslates),this.eventBus.on("categoryPageChanged",e=>{this.setActivePage(e||1)}),this.eventBus.on("rangeSliderChanged-CategoryFilter",e=>{this.$parent.introLoading===!1&&(this.tempFilter.minMaxPrice.min=e.min,this.tempFilter.minMaxPrice.max=e.max,this.requestFilteredProductList())}),this.eventBus.on("productGenericFilterUpdate",e=>{console.log("productGenericFilterUpdate genericFilter: ",e),this.genericFilter=e||{},this.requestFilteredProductList()})},props:["filter","filterDefinitions","categoryMinMaxPrice","categoryType","total"],computed:{filterPriceMin:function(){var e;return(e=this.tempFilter.minMaxPrice)!=null&&e.min?this.tempFilter.minMaxPrice.min:this.categoryPriceMin},filterPriceMax:function(){var e;return(e=this.tempFilter.minMaxPrice)!=null&&e.max?this.tempFilter.minMaxPrice.max:this.categoryPriceMax},categoryPriceMin:function(){return typeof this.categoryMinMaxPrice<"u"&&this.categoryMinMaxPrice.min<this.categoryMinMaxPrice.max?this.categoryMinMaxPrice.min:0},categoryPriceMax:function(){return typeof this.categoryMinMaxPrice<"u"&&this.categoryMinMaxPrice.max>this.categoryMinMaxPrice.min?this.categoryMinMaxPrice.max:0},filteredCount:function(){return typeof this.$parent<"u"?this.$parent.getCategoryFilteredCount():0},categoryTotalCount:function(){return typeof this.$parent<"u"&&typeof this.$parent.categoryDetail<"u"&&this.$parent.categoryDetail&&this.$parent.categoryDetail.count&&this.$parent.categoryDetail.count>0?this.$parent.categoryDetail.count:0},countsDoNotMatch:function(){return this.filteredCount>0&&this.filteredCount!==this.categoryTotalCount}},methods:{stringFilterChange:function(e){const t=e.target;this.$parent.filter.stringFilter=t.value,this.requestFilteredProductList()},requestFilteredProductList(){const e=this;e.$root.loadingShow(),clearTimeout(this.eventTimeoutId),this.eventTimeoutId=setTimeout(function(){e.$httpc.post(e.getCategoryType()+"/filter",e.buildFilterRequestObject(),{timeout:7e3}).then(function(t){const r=e.$parent.categoryDetail;t.data={categories:e.$parent.categories,categoryDetail:r,filter:t.data.filter,results:t.data.results,filteredProductsCount:t.data.filteredProductsCount},e.changeFilterUrl(),e.$parent.processCategoryResponse(t)}).catch(function(t){console.error(t)})},1e3)},buildFilterRequestObject(e){let t=this.tempFilter;typeof e<"u"&&e&&(t=e);let r=null;if(typeof this.$parent.categoryDetail<"u"&&this.$parent.categoryDetail){t.category={_id:this.$parent.categoryDetail._id,pathSlug:this.$parent.categoryDetail.pathSlug,subsSlugs:this.$parent.categoryDetail.subsSlugs};const o=t.category.subsSlugs;o.unshift(t.category.pathSlug),r={$in:o}}const s={limit:this.$parent.filter.limit,sort:t.sort};if(r&&(s.query={categories:r}),t.page>1){const o=Math.abs(t.page-1)*this.$parent.filter.limit;o>0&&(s.offset=o)}if(t.stringFilter&&t.stringFilter.trim()!==""){let o=[],u={};u["name."+this.$store.state.language.code]={$regex:t.stringFilter},o.push(u),this.getCategoryType()==="products"&&o.push({orderCode:{$regex:t.stringFilter}}),s.query={$or:o}}const i=typeof t.minMaxPrice<"u"&&typeof t.minMaxPrice.min<"u"?t.minMaxPrice.min:null,n=typeof t.minMaxPrice<"u"&&typeof t.minMaxPrice.max<"u"?t.minMaxPrice.max:null;if((i||n)&&(s.query||(s.query={}),s.query.price={},i&&(s.query.price.$gte=parseFloat(i)),n&&(s.query.price.$lte=parseFloat(n))),typeof this.$refs.productGenericFilter<"u"){const o=this.$refs.productGenericFilter.prepareGenericQuery(!1);o&&(s.query={...s.query,...o})}return console.log("CategoryFilter buildFilterRequestObject query: ",s),s},changeFilterUrl(){const e=this.filterObjectToQueryString();e!==""&&history.pushState({},null,e)},filterObjectToQueryString(){var r,s,i,n,o;const e=[];let t="";return this.tempFilter.page>1&&e.push("page="+encodeURIComponent(parseInt(this.tempFilter.page))),this.tempFilter.minMaxPrice.min!==null&&this.tempFilter.minMaxPrice.min>this.categoryPriceMin&&e.push("price-min="+encodeURIComponent(this.tempFilter.minMaxPrice.min)),this.tempFilter.minMaxPrice.max!==null&&this.tempFilter.minMaxPrice.max<this.categoryPriceMax&&e.push("price-max="+encodeURIComponent(this.tempFilter.minMaxPrice.max)),typeof this.tempFilter.stringFilter<"u"&&((r=this.tempFilter.stringFilter)==null?void 0:r.trim())!==""&&e.push("string="+encodeURIComponent((s=this.tempFilter.stringFilter)==null?void 0:s.trim())),typeof this.tempFilter.sort<"u"&&((i=this.tempFilter.sort)==null?void 0:i.trim())!==""&&this.tempFilter.sort!==this.filter.sort&&e.push("sort="+encodeURIComponent((n=this.tempFilter.sort)==null?void 0:n.trim())),(o=this.genericFilter)!=null&&o.url&&e.push(this.genericFilter.url),e.length>0&&(t=this.$route.path+"?"+e.join("&")),t},setActivePage(e){this.tempFilter.page=e,this.requestFilteredProductList()},changeSorting(e){this.tempFilter.sort=e.target.value,this.requestFilteredProductList()},setTempFilter(e){var n,o,u,p,l,d,f,D,y,v;const t=this;let r=!1;const s={target:(u=(o=(n=this.$refs)==null?void 0:n.productPriceRange)==null?void 0:o.$refs)==null?void 0:u.sliderRangeLeft},i={target:(d=(l=(p=this.$refs)==null?void 0:p.productPriceRange)==null?void 0:l.$refs)==null?void 0:d.sliderRangeRight};Object.keys(e).forEach(function(_){typeof t.tempFilter[_]<"u"&&(t.tempFilter[_]=e[_],_==="minMaxPrice"&&(s.forceValue=t.tempFilter.minMaxPrice.min,i.forceValue=t.tempFilter.minMaxPrice.max,r=!0))}),r&&((D=(f=this.$refs)==null?void 0:f.productPriceRange)==null||D.priceSliderChange(s),(v=(y=this.$refs)==null?void 0:y.productPriceRange)==null||v.priceSliderChange(i))},getCategoryType(){return this.categoryType?this.categoryType:"products"},getDefaultSorting(){return this.getCategoryType()==="pages"?T.PRODUCT_DEFAULT_SORTING:T.PAGE_DEFAULT_SORTING},queryStringtoFilter(e){var r,s;if(typeof this.$route.query["price-min"]<"u"){const i=parseFloat(this.$route.query["price-min"]);i>0&&(e.minMaxPrice={},e.minMaxPrice.min=i)}if(typeof this.$route.query["price-max"]<"u"){const i=parseFloat(this.$route.query["price-max"]);i>0&&(typeof e.minMaxPrice>"u"&&(e.minMaxPrice={}),e.minMaxPrice.max=i)}const t=(s=(r=this.$refs)==null?void 0:r.productGenericFilter)==null?void 0:s.queryStringtoFilter();return t!==""&&(e.genericFilter=t),this.tempFilter=e,e}}},_e={class:"mt-6"},Pe={class:"menu"},Fe=a("p",{class:"menu-label filter",translate:"yes"}," Filter ",-1),ve={class:"menu-list"},xe={class:"control has-text-centered is-size-7"},Ce={key:0},Me=a("span",{id:"products-filter-count-filtered",translate:"yes"},"Filtered",-1),be=a("span",{id:"products-filter-count-total",translate:"yes"},"Total",-1),De={class:"panel-block pb-4"},Se={class:"control has-icons-left"},Te=a("span",{class:"icon is-small is-left"},[a("i",{class:"fas fa-search","aria-hidden":"true"})],-1),Re={class:"panel-block py-4"},$e={key:0,class:"panel-block-multiwrapper"},qe=a("div",null,[a("label",{class:"label",id:"filter_price",translate:"yes"},"Price")],-1),Le={key:0,class:"panel-block py-4"},Ie={class:"panel-block-multiwrapper"},ke=a("div",null,[a("label",{class:"label"},[a("span",{id:"filter_sortby",translate:"yes"},"Sort by"),b(":")])],-1),Ue={class:"control has-text-centered"},Ge={class:"select is-small is-centered"},Ve=a("option",{value:"price"},"Price Ascending",-1),Oe=a("option",{value:"-price"},"Price Descending",-1),je=a("option",{value:"-dates.dateCreated"},"Latest",-1),Be=a("option",{value:"stockAmount"},"On Stock Amount",-1),Ne=[Ve,Oe,je,Be],Ee={key:1,class:"panel-block py-4"},we={key:2,class:"panel-block py-4"},Ae={class:"panel-block-multiwrapper"},Qe=a("div",null,[a("label",{class:"label"},[a("span",{translate:"yes"},"Sort by"),b(":")])],-1),He={class:"control has-text-centered"},ze={class:"select is-small is-centered"},Ke=a("option",{value:"-dates.dateCreated"},"Latest",-1),Ye=a("option",{value:"dates.dateCreated"},"Oldest",-1),We=[Ke,Ye];function Je(e,t,r,s,i,n){var p;const o=P("rangeslider"),u=P("genericfilter");return S((c(),g("nav",_e,[a("aside",Pe,[Fe,a("ul",ve,[a("li",null,[a("p",xe,[n.countsDoNotMatch?(c(),g("span",Ce,[Me,b(": "),a("span",null,F(n.filteredCount),1),b(" / ")])):h("v-if",!0),be,b(": "),a("span",null,F(n.categoryTotalCount),1)])]),a("li",De,[a("p",Se,[S(a("input",{class:"input is-small",type:"text",translate:"yes",placeholder:"search","onUpdate:modelValue":t[0]||(t[0]=l=>i.tempFilter.stringFilter=l),onKeyup:t[1]||(t[1]=(...l)=>n.stringFilterChange&&n.stringFilterChange(...l))},null,544),[[G,i.tempFilter.stringFilter,void 0,{trim:!0}]]),Te])]),S(a("li",Re,[n.categoryPriceMin&&n.categoryPriceMax&&n.filterPriceMin&&n.filterPriceMax?(c(),g("div",$e,[m(o,{id:{name:"CategoryFilter"},ref:"productPriceRange","input-min":n.categoryPriceMin,"input-max":n.categoryPriceMax,"input-from":n.filterPriceMin,"input-to":n.filterPriceMax},{default:x(()=>[qe]),_:1},8,["input-min","input-max","input-from","input-to"])])):h("v-if",!0)],512),[[L,r.categoryType=="products"]]),r.categoryType=="products"?(c(),g("li",Le,[a("div",Ie,[ke,a("div",null,[a("div",Ue,[a("div",Ge,[S(a("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>i.tempFilter.sort=l),onChange:t[3]||(t[3]=(...l)=>n.changeSorting&&n.changeSorting(...l))},Ne,544),[[I,i.tempFilter.sort]])])])])])])):h("v-if",!0),r.categoryType=="products"?(c(),g("li",Ee,[m(u,{ref:"productGenericFilter",filterDefinitions:(p=r.filterDefinitions)==null?void 0:p.genericFilter,totalCount:r.total},null,8,["filterDefinitions","totalCount"])])):h("v-if",!0),r.categoryType=="pages"?(c(),g("li",we,[a("div",Ae,[Qe,a("div",null,[a("div",He,[a("div",ze,[S(a("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>i.tempFilter.sort=l),onChange:t[5]||(t[5]=(...l)=>n.changeSorting&&n.changeSorting(...l))},We,544),[[I,i.tempFilter.sort]])])])])])])):h("v-if",!0)])])],512)),[[L,n.categoryTotalCount>0]])}const Xe=R(ye,[["render",Je],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryFilter.vue"]]),Ze={data(){return{order:"centered",size:"",isSimple:!1,isRounded:!0,activeThis:null}},props:{bottom:Boolean,active:{type:Number,required:!0},total:{type:Number,required:!0},perPage:{type:Number,required:!0}},mounted:function(){this.activeThis=this.active,this.eventBus.on("categoryPageChanged",e=>{this.activeThis=e||1})},methods:{pagingChanged:function(e){console.log("pagingChanged value: ",e),this.activeThis=e,this.eventBus.emit("categoryPageChanged",e)},loadMore:function(){let e=this.perPage+T.PER_PAGE;this.$parent.filter.limit=e,this.$parent.$refs.categoryFilter.requestFilteredProductList()}}},et={key:0},tt={key:0};function it(e,t,r,s,i,n){const o=P("o-pagination");return r.total>r.perPage?(c(),g("section",et,[m(o,{total:r.total,current:i.activeThis,"onUpdate:current":t[0]||(t[0]=u=>i.activeThis=u),order:i.order,size:i.size,simple:i.isSimple,rounded:i.isRounded,"per-page":r.perPage,onChange:n.pagingChanged,"aria-next-label":"Next page","aria-previous-label":"Previous page","aria-page-label":"Page","aria-current-label":"Current page",iconPack:"fas",iconNext:"angle-right",iconPrev:"angle-left"},null,8,["total","current","order","size","simple","rounded","per-page","onChange"]),r.bottom==!0?(c(),g("div",tt,[a("button",{class:"button",onClick:t[1]||(t[1]=u=>n.loadMore())},"Load More ...")])):h("v-if",!0)])):h("v-if",!0)}const rt=R(Ze,[["render",it],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryPaging.vue"]]);const nt={name:"CategoryList",components:{"product-box":O,"category-filter":Xe,"category-paging":rt,"page-detail-content":j,"error-page":B},data(){return{categories:[],filteredProductsCount:null,products:[],page:null,itemsToListType:"products",breadcrumbs:[],categoryDetail:null,filter:{minMaxPrice:{min:null,max:null},stringFilter:"",limit:T.PER_PAGE,sort:T.PRODUCT_DEFAULT_SORTING,genericFilter:null},filterDefinitions:{minMaxPrice:{min:null,max:null},genericFilter:null},language:"en",groupsLastRefresh:0,introLoading:!1}},computed:{getCategoryType:function(){return this.categoryDetail&&this.categoryDetail.type?this.categoryDetail.type:"products"},categoryMinMax:function(){return this.categoryDetail&&typeof this.categoryDetail.minMaxPrice<"u"?this.categoryDetail.minMaxPrice:{min:null,max:null}},categoryBackground:function(){return!!(this.categoryDetail&&this.categoryDetail.data&&this.categoryDetail.data.images&&this.categoryDetail.data.images.background)},categoryProductsTotalForPaging:function(){var e;return typeof this.filteredProductsCount<"u"&&this.filteredProductsCount!==null?this.filteredProductsCount:typeof((e=this.categoryDetail)==null?void 0:e.count)<"u"&&this.categoryDetail.count?this.categoryDetail.count:0},userCanEdit:function(){return!!(this.$store.state&&this.$store.state.user&&this.$store.state.user.logged&&this.$store.state.user.profile&&this.$store.state.user.profile.type&&this.$store.state.user.profile.type==="admin")},categoryTypePageContent:function(){return this.page&&this.page.data&&this.page.data.blocks&&this.page.data.blocks[0]&&this.page.data.blocks[0][this.$store.state.language.code]?this.page.data.blocks[0][this.$store.state.language.code]:""},categoryTypePageData:function(){return this.page&&this.page.functions&&this.page.functions.length>0?this.page.functions:null},categoryActivePage:function(){var e,t,r,s,i,n;return(r=(t=(e=this.$refs)==null?void 0:e.categoryFilter)==null?void 0:t.tempFilter)!=null&&r.page?(n=(i=(s=this.$refs)==null?void 0:s.categoryFilter)==null?void 0:i.tempFilter)==null?void 0:n.page:1}},mounted:function(){this.$store&&this.$store.state&&this.$store.state.language&&this.$store.state.language.code&&this.$store.state.user?this.listCategoryItems(!0):this.eventBus.on("coreDataLoaded",()=>{this.listCategoryItems(!0)}),this.eventBus.on("categoryPageChanged",e=>{this.page=e||1})},methods:{processCategoryResponse(e){var i;const t=new Date,r=this;this.groupsLastRefresh=t.getTime();let s=null;if(e.data.categoryDetail&&(this.categoryDetail=e.data.categoryDetail,this.categoryDetail&&this.categoryDetail.name&&r.$store.state&&typeof this.categoryDetail.name[r.$store.state.language.code]<"u"&&(document.title=this.categoryDetail.name[r.$store.state.language.code]+" - StretchShop"),e.data.categoryDetail.parentCategories&&(this.breadcrumbs=e.data.categoryDetail.parentCategories),s=this.categoryDetail.taxData?this.categoryDetail.taxData:(i=r.$store.state.coredata)==null?void 0:i.settings),e.data.categories&&(this.categories=e.data.categories),e.data.filteredProductsCount&&(this.filteredProductsCount=e.data.filteredProductsCount),e.data.results){const n=e.data.results;let o=null;e.data.categoryDetail&&e.data.categoryDetail.pathSlug&&(e.data.categoryDetail.type&&(o=e.data.categoryDetail.type),n.forEach(function(u){u=r.$helpers.getProductTaxData(u,s),u.activeParentCategoryUrl=e.data.categoryDetail.pathSlug})),o===null&&n&&n[0]&&n[0].type?this.itemsToListType=n[0].type+"s":this.itemsToListType=o,this.products=this.$store.state.chunk(n,T.PER_ROW)}if(e.data.filter){const n=Object.assign({},this.filter);this.filter=e.data.filter;const o=this;Object.keys(n).forEach(function(u){(typeof o.filter[u]>"u"||o.filter[u]===null)&&(o.filter[u]=n[u])})}e.data.filterProperties&&(this.filterDefinitions.genericFilter=e.data.filterProperties),this.$root.loadingClose()},listCategoryItems:function(e){typeof e>"u"||!e?e=!1:e=!0;const t=this,r=this.$route.path.split("/").filter(Boolean),s=typeof r[1]<"u"?r[1]:"products",i=this.categoryDetail&&this.categoryDetail.type==="pages"?"pageCategoryFilter":"categoryFilter";if(this.$route.params&&this.$route.params.category&&this.$route.params.category.toString().trim()!=="''")this.$root.loadingShow(),e&&Object.keys(this.$route.query).length>0?(this.queryStringtoFilter(i),t.$httpc.post(s+"/"+this.$route.params.category,{filter:this.$refs[i].buildFilterRequestObject(this.filter)},{timeout:7e3}).then(function(n){t.processCategoryResponse(n),typeof t.$refs[i]<"u"&&(t.introLoading=!0,t.introLoading=!1)}).catch(function(n){console.error(n)}).then(()=>{t.eventBus.emit("translateContent",t.$store.getters.getTranslates)})):this.$httpc.get(s+"/"+this.$route.params.category,{timeout:7e3,params:{limit:this.filter.limit}}).then(function(n){t.processCategoryResponse(n),typeof t.$refs[i]<"u"&&(t.introLoading=!0,t.$refs[i].setTempFilter(t.filter),t.introLoading=!1)}).catch(function(n){console.error(n)}).then(()=>{t.eventBus.emit("translateContent",t.$store.getters.getTranslates)});else{let n=this.$route.path;const o=n.split("/");let u=t.$store.state.language.code;o.length>1&&(u=o[1],o.splice(0,2),n=o.join("/"));const p=n;this.$httpc.post("categories/find",{query:{parentPathSlug:"",type:p},lang:u}).then(function(l){l.data&&(t.categories=l.data.categories,l.data.page&&l.data.page.data&&(t.page=l.data.page.data,t.page.name&&t.$store.state&&typeof t.page.name[t.$store.state.language.code]<"u"&&(document.title=t.page.name[t.$store.state.language.code]+" - StretchShop")))}).catch(function(l){console.error(l)}).then(function(){t.eventBus.emit("pageDetailLoaded")})}this.$root.loadingClose()},queryStringtoFilter(e){var r,s;let t={};if(typeof this.$route.query.page<"u"){const i=parseInt(this.$route.query.page);i>0&&(t.page=i)}if(typeof this.$route.query.string<"u"){const i=decodeURIComponent(this.$route.query.string).trim();i!==""&&(t.stringFilter=i)}if(typeof this.$route.query.sort<"u"){const i=decodeURIComponent(this.$route.query.sort).trim();i!==""&&(t.sort=i)}t=(s=(r=this.$refs)==null?void 0:r[e])==null?void 0:s.queryStringtoFilter(t),this.filter={...this.filter,...t},this.eventBus.emit("queryFromUrlProcessed",t)},getCategoryFilteredCount(){return this.filteredProductsCount&&this.filteredProductsCount>0?this.filteredProductsCount:0},getCategoryBackground(){var e,t,r,s,i,n,o,u;return(e=this.categoryDetail)!=null&&e.slug&&((n=(i=(s=(r=(t=this.$store)==null?void 0:t.state)==null?void 0:r.coredata)==null?void 0:s.settings)==null?void 0:i.assets)!=null&&n.url)?this.$helpers.getImagePath("categories",this.$store.state.coredata,this.categoryDetail.slug,this.categoryDetail.slug+".jpg")+"?"+new Date((u=(o=this.categoryDetail)==null?void 0:o.dates)==null?void 0:u.dateUpdated).getTime():""}}},st={class:"container category-list"},at={key:0,class:"edit-area"},ot={class:"columns",id:"category-main-content"},lt={class:"column is-3 pr-6"},ct={key:0,class:"mt-6"},ut={class:"menu"},gt=a("p",{class:"menu-label subcategories",translate:"yes"}," Sub-Categories ",-1),dt={class:"menu-list"},ht={class:"column is-9"},ft={key:0,class:"breadcrumb mb-2","aria-label":"breadcrumbs"},pt={class:"is-active"},mt={class:"column"},yt={key:0,class:"title mb-0"},_t={key:1,class:"title is-6 mb-5 has-text-grey-dark"},Pt=a("h1",{translate:"yes",class:"title is-1 title-products"},"Products",-1),Ft=["innerHTML"],vt={key:1,ref:"categoryListResults"},xt={key:0},Ct={key:1},Mt={key:2},bt={class:"columns"},Dt={class:"column is-12"},St={key:0,class:"title is-1"},Tt={key:3};function Rt(e,t,r,s,i,n){const o=P("font-awesome-icon"),u=P("router-link"),p=P("category-filter"),l=P("category-paging"),d=P("product-box"),f=P("page-detail-content"),D=P("error-page");return c(),g("div",st,[n.userCanEdit&&(i.categoryDetail&&i.categoryDetail.pathSlug||i.page)?(c(),g("div",at,[i.categoryDetail&&i.categoryDetail.pathSlug?(c(),$(u,{key:0,class:"editor-button edit-button",to:{name:"categoryNewEdit",params:{category:i.categoryDetail.pathSlug}}},{default:x(()=>[m(o,{icon:"edit"})]),_:1},8,["to"])):h("v-if",!0),i.page&&i.page.slug?(c(),$(u,{key:1,class:"editor-button edit-button",to:{name:"pageNewEdit",params:{slug:i.page.slug}}},{default:x(()=>[m(o,{icon:"edit"})]),_:1},8,["to"])):h("v-if",!0)])):h("v-if",!0),a("div",ot,[h(` v-if="(products && products.length>0) || (page && page.data)" - filter didn't work `),a("div",lt,[i.categories&&i.categories.length>0?(c(),g("nav",ct,[a("aside",ut,[gt,a("ul",dt,[(c(!0),g(C,null,M(this.categories,(y,v)=>(c(),g("li",{key:v},[m(u,{title:y.descriptionShort[e.$store.state.language.code],to:{name:"categoryList",params:{category:y.pathSlug}}},{default:x(()=>[b(F(y.name[e.$store.state.language.code]),1)]),_:2},1032,["title","to"])]))),128))])])])):h("v-if",!0),m(p,{ref:"categoryFilter",filter:i.filter,categoryMinMaxPrice:n.categoryMinMax,filterDefinitions:i.filterDefinitions,categoryType:n.getCategoryType,total:n.categoryProductsTotalForPaging},null,8,["filter","categoryMinMaxPrice","filterDefinitions","categoryType","total"])]),a("div",ht,[i.breadcrumbs&&i.breadcrumbs!=null&&i.breadcrumbs.length>0?(c(),g("nav",ft,[a("ul",null,[(c(!0),g(C,null,M(i.breadcrumbs,(y,v)=>(c(),g("li",{key:v},[m(u,{title:y.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:y.pathSlug}}},{default:x(()=>[b(F(y.name[e.$store.state.language.code]),1)]),_:2},1032,["title","to"])]))),128)),a("li",pt,[m(u,{title:i.categoryDetail.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:i.categoryDetail.pathSlug}},"aria-current":"page"},{default:x(()=>[b(F(i.categoryDetail.name[e.$store.state.language.code]),1)]),_:1},8,["title","to"])])])])):h("v-if",!0),a("div",{class:"columns category-header mt-2",style:V({backgroundImage:"url("+n.getCategoryBackground()+")"})},[a("div",mt,[i.categoryDetail?(c(),g("h1",yt,F(i.categoryDetail.name[e.$store.state.language.code]),1)):h("v-if",!0),i.categoryDetail?(c(),g("h2",_t,F(i.categoryDetail.descriptionShort[e.$store.state.language.code]),1)):(c(),g(C,{key:2},[h(' <p v-if="categoryDetail" class="">{{ categoryDetail.descriptionLong[$store.state.language.code] }}</p> '),Pt],2112)),i.categoryDetail?(c(),g("div",{key:3,class:"categoryDescLong",innerHTML:i.categoryDetail.descriptionLong[e.$store.state.language.code]},null,8,Ft)):h("v-if",!0)])],4),i.products&&i.products.length>0?(c(),g("div",vt,[m(l,{ref:"categoryPaging",total:n.categoryProductsTotalForPaging,active:n.categoryActivePage,perPage:i.filter.limit},null,8,["total","active","perPage"]),i.itemsToListType=="products"?(c(),g("div",xt,[(c(!0),g(C,null,M(i.products,(y,v)=>(c(),g("div",{class:"tile is-ancestor",key:i.groupsLastRefresh+v},[(c(!0),g(C,null,M(y,(_,q)=>(c(),$(u,{key:i.groupsLastRefresh+_._id+(v+q),class:"tile is-parent is-4",title:_.descriptionShort[e.$store.state.language.code],to:{name:"productDetail",params:{category:i.categoryDetail.pathSlug,product:_._id,slug:_.slug}}},{default:x(()=>[m(d,{product:_,listType:i.itemsToListType,hideBuyButton:"true"},null,8,["product","listType"])]),_:2},1032,["title","to"]))),128))]))),128)),h(" tile end ")])):h("v-if",!0),i.itemsToListType=="pages"?(c(),g("div",Ct,[(c(!0),g(C,null,M(i.products,(y,v)=>(c(),g("div",{class:"tile is-ancestor",key:i.groupsLastRefresh+v},[(c(!0),g(C,null,M(y,(_,q)=>(c(),$(u,{key:i.groupsLastRefresh+_._id+(v+q),class:"tile is-parent is-4",title:_.descriptionShort[e.$store.state.language.code],to:{name:"pageDetailShort",params:{category:i.categoryDetail.pathSlug,slug:_.slug}}},{default:x(()=>[m(d,{product:_,listType:i.itemsToListType},null,8,["product","listType"])]),_:2},1032,["title","to"]))),128))]))),128)),h(" tile end ")])):h("v-if",!0),m(l,{ref:"categoryPaging",bottom:!0,total:n.categoryProductsTotalForPaging,active:n.categoryActivePage,perPage:i.filter.limit},null,8,["total","active","perPage"])],512)):i.page&&i.page.data?(c(),g("div",Mt,[a("div",bt,[a("div",Dt,[i.page.data&&i.page.data.name?(c(),g("h1",St,F(i.page.data.name[e.$store.state.language.code]),1)):h("v-if",!0),m(f,{content:n.categoryTypePageContent,contentData:n.categoryTypePageData,contentLang:i.language.code},null,8,["content","contentData","contentLang"])])])])):(c(),g("div",Tt,[m(D)]))])])])}const It=R(nt,[["render",Rt],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryList.vue"]]);export{It as default};
