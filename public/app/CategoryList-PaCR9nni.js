import{o as c,c as g,I as V,a as o,t as x,r as F,K as T,J as L,F as M,d as b,b as m,w as v,h as f,f as D,N as G,a3 as U,e as $,j as O}from"./sett-kcacPgfM.js";import{_ as R,A as S,P as j,a as B,E}from"./index-dpUgND6i.js";const N={name:"RangeSlider",data(){return{valueFrom:null,valueTo:null}},props:["inputMin","inputMax","inputFrom","inputTo","id"],mounted:function(){var e;console.log("RangeSlide this.props: ",this.inputMin,this.inputMax,this.inputFrom,this.inputTo,this.id),this.inputMin&&this.inputMax&&this.inputFrom&&this.inputTo&&((e=this.id)!=null&&e.name)&&(this.valueFrom=this.inputFrom,this.valueTo=this.inputTo,this.$refs.sliderRangeLeft.value=this.inputFrom,this.$refs.sliderRangeRight.value=this.inputTo,this.priceSliderChange({target:this.$refs.sliderRangeLeft,forceValue:this.inputFrom}),this.priceSliderChange({target:this.$refs.sliderRangeRight,forceValue:this.inputTo}))},methods:{priceSliderChange:function(e){var n;const t=typeof e.forceValue<"u"?e.forceValue:null,r=e.target;if(r){let i=r.getAttribute("position"),s="",a=0,l=null;i==="left"?(s="right",a=-1,l=r.parentNode.querySelector("input[type=range][position="+s+"]"),r.value=Math.min(r.value,parseInt(l.value)+a)):(i="right",s="left",a=1,l=r.parentNode.querySelector("input[type=range][position="+s+"]"),r.value=Math.max(r.value,parseInt(l.value)+a));let p=null;const u={min:this.inputMin,max:this.inputMax};t!==null?(r.min===0&&typeof u.min<"u"&&(r.min=u.min),r.max===0&&typeof u.max<"u"&&(r.max=u.max),p=100/(parseInt(r.max)-parseInt(r.min))*parseInt(t)-100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.min)):(r.value===0&&(i==="left"&&u&&(r.value=u.min),i==="right"&&u&&(r.value=u.max)),p=100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.value)-100/(parseInt(r.max)-parseInt(r.min))*parseInt(r.min));const d=r.parentNode.querySelector(".slider-range-controls");i==="left"?(d.querySelector("[inverse-"+i+"]").style.width=p+"%",d.querySelector("[range]").style.left=p+"%"):(d.querySelector("[inverse-"+i+"]").style.width=100-p+"%",d.querySelector("[range]").style.right=100-p+"%"),d.querySelector("[thumb="+i+"]").style.left=p+"%",d.querySelector("[sign="+i+"]").style.left=p+"%",r.value===0?(i==="right"&&typeof u.max<"u"&&u.max>0&&(d.querySelector("[sign="+i+"] .value").innerText=Math.round(u.max*100)/100),i==="left"&&typeof u.min<"u"&&u.min>0&&(d.querySelector("[sign="+i+"] .value").innerText=Math.round(u.min*100)/100)):d.querySelector("[sign="+i+"] .value").innerText=Math.round(r.value*100)/100;const h={};i==="left"?(h.min=r.value,h.max=l.value):(h.min=l.value,h.max=r.value),h.min=h.min>this.inputMin?Math.round(h.min):this.inputMin,h.max=h.max<this.inputMax?Math.round(h.max):this.inputMax,this.valueFrom=h.min,this.valueTo=h.max,t===null&&(typeof this.id=="object"&&this.id.name&&this.id.key?this.eventBus.emit("rangeSliderChanged-"+(this.id.name||""),{key:this.id.key,result:h}):this.eventBus.emit("rangeSliderChanged-"+(((n=this.id)==null?void 0:n.name)||""),h))}}}},A={class:"slider-range-wrapper"},w={slider:"",class:"slider-range"},Q={class:"slider-range-controls"},H=o("div",{"inverse-left":"",style:{width:"0%"}},null,-1),z=o("div",{"inverse-right":"",style:{width:"0%"}},null,-1),K=o("div",{range:"",style:{left:"0%",right:"0%"}},null,-1),Y=o("span",{thumb:"left",style:{left:"0%"}},null,-1),W=o("span",{thumb:"right",style:{left:"100%"}},null,-1),J={sign:"left",style:{left:"0%"}},X={class:"value"},Z={sign:"right",style:{left:"100%"}},ee={class:"value"},te=["value","max","min"],ie=["value","max","min"];function re(e,t,r,n,i,s){return c(),g("div",A,[V(e.$slots,"default"),o("div",w,[o("div",Q,[H,z,K,Y,W,o("div",J,[o("span",X,x(Math.round(r.inputMin*100)/100),1)]),o("div",Z,[o("span",ee,x(Math.round(r.inputMax*100)/100),1)])]),o("input",{ref:"sliderRangeLeft",type:"range",position:"left",tabindex:"0",value:r.inputFrom,max:r.inputMax,min:r.inputMin,step:"any",onInput:t[0]||(t[0]=(...a)=>s.priceSliderChange&&s.priceSliderChange(...a))},null,40,te),o("input",{ref:"sliderRangeRight",type:"range",position:"right",tabindex:"0",value:r.inputTo,max:r.inputMax,min:r.inputMin,step:"any",onInput:t[1]||(t[1]=(...a)=>s.priceSliderChange&&s.priceSliderChange(...a))},null,40,ie)])])}const k=R(N,[["render",re],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/global/RangeSlider.vue"]]),q="__TOO_MANY_PROPERTIES__",se={name:"ProductGenericFilter",components:{rangeslider:k},data(){return{filter:{},filterProps:{},tooManyProperties:!1}},mounted:function(){this.eventBus.emit("translateContent",this.$store.getters.getTranslates),this.eventBus.on("categoryPageChanged",e=>{console.log("ProductGenericFilter eventBus.categoryPageChanged newPageValue: ",e)}),this.eventBus.on("rangeSliderChanged-ProductGenericFilter",e=>{console.log("rangeSliderChanged-ProductGenericFilter: ",e),e!=null&&e.key&&(e!=null&&e.result)&&(this.filter[e.key]={from:Number(e.result.min),to:Number(e.result.max)},this.filterUpdated())}),console.log("ProductGenericFilter mounted() this.filter & this.filterDefinitions: ",this.filter,this.filterDefinitions),this.getGenericFilterValues()},props:["filterDefinitions","totalCount"],watch:{filterDefinitions(e,t){const r=this;this.tooManyProperties=!1,e&&(console.log("ProductGenericFilter watch filterDefinitions defsNew: ",t,e),e[q]?this.tooManyProperties=!0:this.tooManyProperties=!1,this.refreshFilterProps(e),e[q]&&delete e[q],r.filter===null&&(r.filter={}),Object.keys(e).forEach(n=>{(typeof r.filter[n]>"u"||r.filter[n]===null)&&(r.filter[n]=null)}))}},computed:{singleParams(){let e={};return this.filterDefinitions&&Object.keys(this.filterDefinitions).forEach(t=>{this.getFilterType(this.filterDefinitions[t])==="single"&&(e[t]=this.filterDefinitions[t])}),e}},methods:{refreshFilterProps(e){var t;if(this.filterProps={},e)if(e[q]||this.tooManyProperties){this.tooManyProperties||(this.tooManyProperties=!0);for(let r of Object.keys(e))e[r]&&(this.filterProps[r]={},this.filterProps[r].type="text"),e[r]&&e[r].value&&(this.filterProps[r].value=!0),(e[r]&&e[r].value&&((t=e[r].value)==null?void 0:t.constructor)!==Array&&typeof e[r].value=="object"||e[r]&&e[r].constructor!==Array&&typeof e[r]=="object")&&(this.filterProps[r].translation=!0)}else this.tooManyProperties=!1,Object.keys(e).forEach(r=>{var n;e[r]&&(this.filterProps[r]={},this.filterProps[r].type=this.getFilterType(e[r])),e[r]&&e[r].value&&(this.filterProps[r].value=!0),(e[r]&&e[r].value&&((n=e[r].value)==null?void 0:n.constructor)!==Array&&typeof e[r].value=="object"||e[r]&&e[r].constructor!==Array&&typeof e[r]=="object")&&(this.filterProps[r].translation=!0)});console.log("ProductGenericFilter refreshFilterProps() this.filterProps: ",this.filterProps)},getFilterName(e,t){return t.name?t.name[this.$store.state.language.code]?t.name[this.$store.state.language.code].constructor===Array?t.name[this.$store.state.language.code].join(", "):t.name[this.$store.state.language.code]:t.name.constructor===Array?t.name.join(", "):t.name:e},getFilterType(e){if(e=this.getRealValue(e),e)if(e.constructor===Array){let t=!0;return e.some(r=>{if(typeof r!="number")return t=!1,!0}),t?"range":"array"}else return"single"},getRealValue(e){return e!=null&&e.value?e.value[this.$store.state.language.code]?e.value[this.$store.state.language.code]:e.value:e},setSingleValue(e,t){var r,n;(r=e==null?void 0:e.target)!=null&&r.checked&&((n=e==null?void 0:e.target)!=null&&n.value)?(this.filter[t]=this.getRealValue(e.target.value),this.filterUpdated()):(delete this.filter[t],this.filterUpdated())},arrayValueChanged(e){var t;((t=this.filter[e])==null?void 0:t.length)===0&&delete this.filter[e],this.filterUpdated()},textValueChanged(e){this.filter[e].trim()===""&&delete this.filter[e],this.filterUpdated()},filterUpdated(){if(this.filter){const e=this.prepareGenericQuery();console.log("ProductGenericFilter filterUpdated() query: ",e),this.eventBus.emit("productGenericFilterUpdate",{query:e,url:this.prepareUrl(e)})}},prepareGenericQuery(e=!0){let t=null;if(this.filter){e=!(typeof e<"u"&&e===!1),console.log("rebuildProps xxx -> : ",e,this.filterProps,this.filterDefinitions),e&&this.refreshFilterProps(this.filterDefinitions);const r=Object.keys(this.filter);console.log("vvvvvvvv filter/props/keys: ",this.filter,this.filterProps,r),r.length>0&&(t={$and:[]},Object.keys(this.filter).forEach(n=>{var i;if(this.filter[n]&&((i=this.filterProps[n])!=null&&i.type))switch(console.log("productGenericFilter prepareGenericQuery() this.filterProps: ",this.filterProps),this.filterProps[n].type){case"range":t.$and.push(this.prepareRangeQuery(n,this.filter[n]));break;case"array":t.$and.push(this.prepareArrayQuery(n,this.filter[n]));break;case"text":t.$and.push(this.prepareTextQuery(n,this.filter[n]));break;default:t.$and.push(this.prepareSingleQuery(n,this.filter[n]))}})),t&&(t.$and===[]||t.$and.length===0)&&(t=null)}return console.log("productGenericFilter prepareGenericQuery() result: ",t),t},prepareRangeQuery(e,t){const r={$gte:t.from,$lte:t.to};return this.prepareSingleQuery(e,r)},prepareTextQuery(e,t){const r={$regex:t};return this.prepareSingleQuery(e,r)},prepareArrayQuery(e,t){const r={$in:t};return this.prepareSingleQuery(e,r)},prepareSingleQuery(e,t){const r={$or:[]};let n="properties."+e;const i={};i[n]=t,n+=".value";const s={};s[n]=t,n+="."+this.$store.state.language.code;const a={};return a[n]=t,r.$or.push(i,s,a),r},prepareUrl(e){let t=[];this.refreshFilterProps(this.filterDefinitions);const r=Object.keys(this.filter),n=Object.keys(this.filterProps);return(r==null?void 0:r.length)>0&&(n==null?void 0:n.length)>0&&Object.keys(this.filter).forEach(i=>{var s,a;if(this.filter[i]&&((s=this.filterProps[i])!=null&&s.type))switch(this.filterProps[i].type){case"range":t.push("-gr--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i].from)+"-"+encodeURIComponent(this.filter[i].to));break;case"text":t.push("-gt--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i]));break;case"array":let l=[];this.filter&&this.filter[i]&&this.filter[i].constructor===Array&&((a=this.filter[i])==null||a.forEach((p,u)=>{l.push(encodeURIComponent(this.filter[i][u]))})),t.push("-ga--"+encodeURIComponent(i)+"="+l.join(";"));break;default:t.push("-g--"+encodeURIComponent(i)+"="+encodeURIComponent(this.filter[i]))}}),t.join("&")},getGenericFilterValues(){var e;this.filter=((e=this.filter)==null?void 0:e.genericFilter)||{}},queryStringtoFilter(){let e=null;return console.log("$route.query: ",this.$route),typeof this.$route.query<"u"&&Object.keys(this.$route.query).forEach(t=>{const r=["-gr--","-gt--","-ga--","-g--"];if(console.log("key: ",t," validKeys: ",r," validKeys.some(v => key.includes(v)): ",r.some(n=>t.includes(n))),r.some(n=>t.includes(n))){e===null&&(e={});const n=t.split("--")[1],i=this.$route.query[t].trim();if(t.indexOf("-ga--")>-1)e[n]=decodeURIComponent(i).split(";"),this.filterProps[n]={type:"array"};else if(t.indexOf("-gt--")>-1)e[n]=decodeURIComponent(i),this.filterProps[n]={type:"text"};else if(t.indexOf("-gr--")>-1){const s=decodeURIComponent(i).split("-");e[n]={from:Number(s[0]),to:Number(s[1])},this.filterProps[n]={type:"range"}}else t.indexOf("-g--")>-1&&(e[n]=decodeURIComponent(i).trim()!=="",this.filterProps[n]={type:"single"})}}),this.filter=e,console.log("productGenericFilter queryStringtoFilter() this.filter: ",this.filter),e}}},ne={class:"generic-filter"},oe={key:0},ae={key:0,class:"gf-range"},le={class:"panel-block-multiwrapper"},ce={class:"gf-range-label"},ue=["id"],ge={key:1,class:"gf-array"},he={key:0,class:"autofield"},de={key:1},pe={class:"gf-text"},fe={key:0,class:"autofield"},me={class:"gf-singles-wrapper"},ye={class:"field gf-single"},_e={class:"s-input checkbox"},Pe=["value","checked","onClick"];function Fe(e,t,r,n,i,s){const a=F("rangeslider"),l=F("o-inputitems"),p=F("o-field"),u=F("o-input");return T((c(),g("nav",ne,[(c(!0),g(M,null,b(r.filterDefinitions,(d,h)=>{var C,_;return c(),g("div",{key:"mp-"+h},[this.tooManyProperties?(c(),g("div",de,[o("div",pe,[i.filter?(c(),g("section",fe,[m(p,{label:s.getFilterName(h,d)},{default:v(()=>[m(u,{modelValue:i.filter[h],"onUpdate:modelValue":[y=>i.filter[h]=y,y=>s.textValueChanged(h)],data:s.getRealValue(d),type:"is-info"},null,8,["modelValue","onUpdate:modelValue","data"])]),_:2},1032,["label"])])):f("",!0)])])):(c(),g("div",oe,[s.getFilterType(d)==="range"?(c(),g("div",ae,[o("div",le,[m(a,{id:{name:"ProductGenericFilter",key:h},ref_for:!0,ref:"productPriceRange","input-min":Math.min.apply(null,s.getRealValue(d)),"input-max":Math.max.apply(null,s.getRealValue(d)),"input-from":i.filter&&i.filter[h]?(C=i.filter[h])==null?void 0:C.from:Math.min.apply(null,s.getRealValue(d)),"input-to":i.filter&&i.filter[h]?(_=i.filter[h])==null?void 0:_.to:Math.max.apply(null,s.getRealValue(d))},{default:v(()=>[o("div",ce,[o("label",{class:"label",id:"gf-"+h,translate:"yes"},x(s.getFilterName(h,d)),9,ue)])]),_:2},1032,["id","input-min","input-max","input-from","input-to"])])])):f("",!0),s.getFilterType(d)==="array"?(c(),g("div",ge,[i.filter?(c(),g("section",he,[m(p,{label:s.getFilterName(h,d)},{default:v(()=>[m(l,{modelValue:i.filter[h],"onUpdate:modelValue":[y=>i.filter[h]=y,y=>s.arrayValueChanged(h)],data:s.getRealValue(d),"allow-autocomplete":!0,"allow-new":!1,"open-on-focus":!0,type:"is-info"},null,8,["modelValue","onUpdate:modelValue","data"])]),_:2},1032,["label"])])):f("",!0)])):f("",!0)]))])}),128)),o("div",me,[(c(!0),g(M,null,b(s.singleParams,(d,h)=>(c(),g("div",{key:"sp-"+h},[o("div",ye,[o("label",_e,[o("input",{type:"checkbox",class:"check",value:s.getRealValue(d),checked:i.filter&&i.filter[h]?i.filter[h]:!1,onClick:C=>s.setSingleValue(C,h)},null,8,Pe),o("div",null,[o("strong",null,x(s.getFilterName(h,d))+": ",1),o("span",null,x(s.getRealValue(d)),1)])])])]))),128))])],512)),[[L,r.filterDefinitions&&r.totalCount>0]])}const xe=R(se,[["render",Fe],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/ProductGenericFilter.vue"]]),ve={name:"CategoryFilter",components:{rangeslider:k,genericfilter:xe},data(){return{eventTimeoutId:null,tempFilter:{page:1,minMaxPrice:{min:null,max:null},stringFilter:"",sort:this.getDefaultSorting()},introMinMaxPrice:{min:null,max:null},genericFilter:{}}},mounted:function(){this.eventBus.emit("translateContent",this.$store.getters.getTranslates),this.eventBus.on("categoryPageChanged",e=>{this.setActivePage(e||1)}),this.eventBus.on("rangeSliderChanged-CategoryFilter",e=>{this.$parent.introLoading===!1&&(this.tempFilter.minMaxPrice.min=e.min,this.tempFilter.minMaxPrice.max=e.max,this.requestFilteredProductList())}),this.eventBus.on("productGenericFilterUpdate",e=>{console.log("productGenericFilterUpdate genericFilter: ",e),this.genericFilter=e||{},this.requestFilteredProductList()})},props:["filter","filterDefinitions","categoryMinMaxPrice","categoryType","total"],computed:{filterPriceMin:function(){var e;return(e=this.tempFilter.minMaxPrice)!=null&&e.min?this.tempFilter.minMaxPrice.min:this.categoryPriceMin},filterPriceMax:function(){var e;return(e=this.tempFilter.minMaxPrice)!=null&&e.max?this.tempFilter.minMaxPrice.max:this.categoryPriceMax},categoryPriceMin:function(){return typeof this.categoryMinMaxPrice<"u"&&this.categoryMinMaxPrice.min<this.categoryMinMaxPrice.max?this.categoryMinMaxPrice.min:0},categoryPriceMax:function(){return typeof this.categoryMinMaxPrice<"u"&&this.categoryMinMaxPrice.max>this.categoryMinMaxPrice.min?this.categoryMinMaxPrice.max:0},filteredCount:function(){return typeof this.$parent<"u"?this.$parent.getCategoryFilteredCount():0},categoryTotalCount:function(){return typeof this.$parent<"u"&&typeof this.$parent.categoryDetail<"u"&&this.$parent.categoryDetail&&this.$parent.categoryDetail.count&&this.$parent.categoryDetail.count>0?this.$parent.categoryDetail.count:0},countsDoNotMatch:function(){return this.filteredCount>0&&this.filteredCount!==this.categoryTotalCount}},methods:{stringFilterChange:function(e){const t=e.target;this.$parent.filter.stringFilter=t.value,this.requestFilteredProductList()},requestFilteredProductList(){const e=this;e.$root.loadingShow(),clearTimeout(this.eventTimeoutId),this.eventTimeoutId=setTimeout(function(){e.$httpc.post(e.getCategoryType()+"/filter",e.buildFilterRequestObject(),{timeout:7e3}).then(function(t){const r=e.$parent.categoryDetail;t.data={categories:e.$parent.categories,categoryDetail:r,filter:t.data.filter,results:t.data.results,filteredProductsCount:t.data.filteredProductsCount},e.changeFilterUrl(),e.$parent.processCategoryResponse(t)}).catch(function(t){console.error(t)})},1e3)},buildFilterRequestObject(e){let t=this.tempFilter;typeof e<"u"&&e&&(t=e);let r=null;if(typeof this.$parent.categoryDetail<"u"&&this.$parent.categoryDetail){t.category={_id:this.$parent.categoryDetail._id,pathSlug:this.$parent.categoryDetail.pathSlug,subsSlugs:this.$parent.categoryDetail.subsSlugs};const a=t.category.subsSlugs;a.unshift(t.category.pathSlug),r={$in:a}}const n={limit:this.$parent.filter.limit,sort:t.sort};if(r&&(n.query={categories:r}),t.page>1){const a=Math.abs(t.page-1)*this.$parent.filter.limit;a>0&&(n.offset=a)}if(t.stringFilter&&t.stringFilter.trim()!==""){let a=[],l={};l["name."+this.$store.state.language.code]={$regex:t.stringFilter},a.push(l),this.getCategoryType()==="products"&&a.push({orderCode:{$regex:t.stringFilter}}),n.query={$or:a}}const i=typeof t.minMaxPrice<"u"&&typeof t.minMaxPrice.min<"u"?t.minMaxPrice.min:null,s=typeof t.minMaxPrice<"u"&&typeof t.minMaxPrice.max<"u"?t.minMaxPrice.max:null;if((i||s)&&(n.query||(n.query={}),n.query.price={},i&&(n.query.price.$gte=parseFloat(i)),s&&(n.query.price.$lte=parseFloat(s))),typeof this.$refs.productGenericFilter<"u"&&this.$refs.productGenericFilter){const a=this.$refs.productGenericFilter.prepareGenericQuery(!1);a&&(n.query={...n.query,...a})}return console.log("CategoryFilter buildFilterRequestObject query: ",n),n},changeFilterUrl(){const e=this.filterObjectToQueryString();e!==""&&history.pushState({},null,e)},filterObjectToQueryString(){var r,n,i,s,a,l,p,u,d;const e=[];let t="";return this.tempFilter.page>1&&e.push("page="+encodeURIComponent(parseInt(this.tempFilter.page))),((r=this.tempFilter.minMaxPrice)==null?void 0:r.min)!==null&&((n=this.tempFilter.minMaxPrice)==null?void 0:n.min)>this.categoryPriceMin&&e.push("price-min="+encodeURIComponent(this.tempFilter.minMaxPrice.min)),((i=this.tempFilter.minMaxPrice)==null?void 0:i.max)!==null&&((s=this.tempFilter.minMaxPrice)==null?void 0:s.max)<this.categoryPriceMax&&e.push("price-max="+encodeURIComponent(this.tempFilter.minMaxPrice.max)),typeof this.tempFilter.stringFilter<"u"&&((a=this.tempFilter.stringFilter)==null?void 0:a.trim())!==""&&e.push("string="+encodeURIComponent((l=this.tempFilter.stringFilter)==null?void 0:l.trim())),typeof this.tempFilter.sort<"u"&&((p=this.tempFilter.sort)==null?void 0:p.trim())!==""&&this.tempFilter.sort!==this.filter.sort&&e.push("sort="+encodeURIComponent((u=this.tempFilter.sort)==null?void 0:u.trim())),(d=this.genericFilter)!=null&&d.url&&e.push(this.genericFilter.url),e.length>0&&(t=this.$route.path+"?"+e.join("&")),t},setActivePage(e){this.tempFilter.page=e,this.requestFilteredProductList()},changeSorting(e){this.tempFilter.sort=e.target.value,this.requestFilteredProductList()},setTempFilter(e){var s,a,l,p,u,d,h,C,_,y;const t=this;let r=!1;const n={target:(l=(a=(s=this.$refs)==null?void 0:s.productPriceRange)==null?void 0:a.$refs)==null?void 0:l.sliderRangeLeft},i={target:(d=(u=(p=this.$refs)==null?void 0:p.productPriceRange)==null?void 0:u.$refs)==null?void 0:d.sliderRangeRight};Object.keys(e).forEach(function(P){typeof t.tempFilter[P]<"u"&&(t.tempFilter[P]=e[P],P==="minMaxPrice"&&(n.forceValue=t.tempFilter.minMaxPrice.min,i.forceValue=t.tempFilter.minMaxPrice.max,r=!0))}),r&&((C=(h=this.$refs)==null?void 0:h.productPriceRange)==null||C.priceSliderChange(n),(y=(_=this.$refs)==null?void 0:_.productPriceRange)==null||y.priceSliderChange(i))},getCategoryType(){return this.categoryType?this.categoryType:"products"},getDefaultSorting(){return this.getCategoryType()==="pages"?S.PRODUCT_DEFAULT_SORTING:S.PAGE_DEFAULT_SORTING},queryStringtoFilter(e){var r,n;if(typeof this.$route.query["price-min"]<"u"){const i=parseFloat(this.$route.query["price-min"]);i>0&&(e.minMaxPrice={},e.minMaxPrice.min=i)}if(typeof this.$route.query["price-max"]<"u"){const i=parseFloat(this.$route.query["price-max"]);i>0&&(typeof e.minMaxPrice>"u"&&(e.minMaxPrice={}),e.minMaxPrice.max=i)}const t=(n=(r=this.$refs)==null?void 0:r.productGenericFilter)==null?void 0:n.queryStringtoFilter();return t!==""&&(e.genericFilter=t),this.tempFilter=e,console.log("categoryFilter filter: ",e),e}}},Ce={class:"mt-6"},Me={class:"menu"},be=o("p",{class:"menu-label filter",translate:"yes"}," Filter ",-1),De={class:"menu-list"},Te={class:"control has-text-centered is-size-7"},Se={key:0},Re=o("span",{id:"products-filter-count-filtered",translate:"yes"},"Filtered",-1),$e=o("span",{id:"products-filter-count-total",translate:"yes"},"Total",-1),qe={class:"panel-block pb-4"},Ie={class:"control has-icons-left"},Le=o("span",{class:"icon is-small is-left"},[o("i",{class:"fas fa-search","aria-hidden":"true"})],-1),Ue={class:"panel-block py-4"},ke={key:0,class:"panel-block-multiwrapper"},Ve=o("div",null,[o("label",{class:"label",id:"filter_price",translate:"yes"},"Price")],-1),Ge={key:0,class:"panel-block py-4"},Oe={class:"panel-block-multiwrapper"},je=o("div",null,[o("label",{class:"label"},[o("span",{id:"filter_sortby",translate:"yes"},"Sort by"),D(":")])],-1),Be={class:"control has-text-centered"},Ee={class:"select is-small is-centered"},Ne=o("option",{value:"price"},"Price Ascending",-1),Ae=o("option",{value:"-price"},"Price Descending",-1),we=o("option",{value:"-dates.dateCreated"},"Latest",-1),Qe=o("option",{value:"stockAmount"},"On Stock Amount",-1),He=[Ne,Ae,we,Qe],ze={key:1,class:"panel-block py-4"},Ke={key:2,class:"panel-block py-4"},Ye={class:"panel-block-multiwrapper"},We=o("div",null,[o("label",{class:"label"},[o("span",{translate:"yes"},"Sort by"),D(":")])],-1),Je={class:"control has-text-centered"},Xe={class:"select is-small is-centered"},Ze=o("option",{value:"-dates.dateCreated"},"Latest",-1),et=o("option",{value:"dates.dateCreated"},"Oldest",-1),tt=[Ze,et];function it(e,t,r,n,i,s){var p;const a=F("rangeslider"),l=F("genericfilter");return T((c(),g("nav",Ce,[o("aside",Me,[be,o("ul",De,[o("li",null,[o("p",Te,[s.countsDoNotMatch?(c(),g("span",Se,[Re,D(": "),o("span",null,x(s.filteredCount),1),D(" / ")])):f("",!0),$e,D(": "),o("span",null,x(s.categoryTotalCount),1)])]),o("li",qe,[o("p",Ie,[T(o("input",{class:"input is-small",type:"text",translate:"yes",placeholder:"search","onUpdate:modelValue":t[0]||(t[0]=u=>i.tempFilter.stringFilter=u),onKeyup:t[1]||(t[1]=(...u)=>s.stringFilterChange&&s.stringFilterChange(...u))},null,544),[[G,i.tempFilter.stringFilter,void 0,{trim:!0}]]),Le])]),T(o("li",Ue,[s.categoryPriceMin&&s.categoryPriceMax&&s.filterPriceMin&&s.filterPriceMax?(c(),g("div",ke,[m(a,{id:{name:"CategoryFilter"},ref:"productPriceRange","input-min":s.categoryPriceMin,"input-max":s.categoryPriceMax,"input-from":s.filterPriceMin,"input-to":s.filterPriceMax},{default:v(()=>[Ve]),_:1},8,["input-min","input-max","input-from","input-to"])])):f("",!0)],512),[[L,r.categoryType=="products"]]),r.categoryType=="products"?(c(),g("li",Ge,[o("div",Oe,[je,o("div",null,[o("div",Be,[o("div",Ee,[T(o("select",{"onUpdate:modelValue":t[2]||(t[2]=u=>i.tempFilter.sort=u),onChange:t[3]||(t[3]=(...u)=>s.changeSorting&&s.changeSorting(...u))},[...He],544),[[U,i.tempFilter.sort]])])])])])])):f("",!0),r.categoryType=="products"?(c(),g("li",ze,[m(l,{ref:"productGenericFilter",filterDefinitions:(p=r.filterDefinitions)==null?void 0:p.genericFilter,totalCount:r.total},null,8,["filterDefinitions","totalCount"])])):f("",!0),r.categoryType=="pages"?(c(),g("li",Ke,[o("div",Ye,[We,o("div",null,[o("div",Je,[o("div",Xe,[T(o("select",{"onUpdate:modelValue":t[4]||(t[4]=u=>i.tempFilter.sort=u),onChange:t[5]||(t[5]=(...u)=>s.changeSorting&&s.changeSorting(...u))},[...tt],544),[[U,i.tempFilter.sort]])])])])])])):f("",!0)])])],512)),[[L,s.categoryTotalCount>0]])}const rt=R(ve,[["render",it],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryFilter.vue"]]),st={data(){return{order:"centered",size:"",isSimple:!1,isRounded:!0,activeThis:null}},props:{bottom:Boolean,active:{type:Number,required:!0},total:{type:Number,required:!0},perPage:{type:Number,required:!0}},mounted:function(){this.activeThis=this.active,this.eventBus.on("categoryPageChanged",e=>{this.activeThis=e||1})},methods:{pagingChanged:function(e){console.log("pagingChanged value: ",e),this.activeThis=e,this.eventBus.emit("categoryPageChanged",e)},loadMore:function(){let e=this.perPage+S.PER_PAGE;this.$parent.filter.limit=e,this.$parent.$refs.categoryFilter.requestFilteredProductList()}}},nt={key:0},ot={key:0};function at(e,t,r,n,i,s){const a=F("o-pagination");return r.total>r.perPage?(c(),g("section",nt,[m(a,{total:r.total,current:i.activeThis,"onUpdate:current":t[0]||(t[0]=l=>i.activeThis=l),order:i.order,size:i.size,simple:i.isSimple,rounded:i.isRounded,"per-page":r.perPage,onChange:s.pagingChanged,"aria-next-label":"Next page","aria-previous-label":"Previous page","aria-page-label":"Page","aria-current-label":"Current page",iconPack:"fas",iconNext:"angle-right",iconPrev:"angle-left"},null,8,["total","current","order","size","simple","rounded","per-page","onChange"]),r.bottom==!0?(c(),g("div",ot,[o("button",{class:"button",onClick:t[1]||(t[1]=l=>s.loadMore())},"Load More ...")])):f("",!0)])):f("",!0)}const lt=R(st,[["render",at],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryPaging.vue"]]),ct={name:"CategoryList",components:{"product-box":j,"category-filter":rt,"category-paging":lt,"page-detail-content":B,"error-page":E},data(){return{categories:[],filteredProductsCount:null,products:[],page:null,itemsToListType:"products",breadcrumbs:[],categoryDetail:null,filter:{minMaxPrice:{min:null,max:null},stringFilter:"",limit:S.PER_PAGE,sort:S.PRODUCT_DEFAULT_SORTING,genericFilter:null},filterDefinitions:{minMaxPrice:{min:null,max:null},genericFilter:null},language:"en",groupsLastRefresh:0,introLoading:!1}},computed:{getCategoryType:function(){return this.categoryDetail&&this.categoryDetail.type?this.categoryDetail.type:"products"},categoryMinMax:function(){return this.categoryDetail&&typeof this.categoryDetail.minMaxPrice<"u"?this.categoryDetail.minMaxPrice:{min:null,max:null}},categoryBackground:function(){return!!(this.categoryDetail&&this.categoryDetail.data&&this.categoryDetail.data.images&&this.categoryDetail.data.images.background)},categoryProductsTotalForPaging:function(){var e;return typeof this.filteredProductsCount<"u"&&this.filteredProductsCount!==null?this.filteredProductsCount:typeof((e=this.categoryDetail)==null?void 0:e.count)<"u"&&this.categoryDetail.count?this.categoryDetail.count:0},userCanEdit:function(){return!!(this.$store.state&&this.$store.state.user&&this.$store.state.user.logged&&this.$store.state.user.profile&&this.$store.state.user.profile.type&&this.$store.state.user.profile.type==="admin")},categoryTypePageContent:function(){return this.page&&this.page.data&&this.page.data.blocks&&this.page.data.blocks[0]&&this.page.data.blocks[0][this.$store.state.language.code]?this.page.data.blocks[0][this.$store.state.language.code]:""},categoryTypePageData:function(){return this.page&&this.page.functions&&this.page.functions.length>0?this.page.functions:null},categoryActivePage:function(){var e,t,r,n,i,s;return(r=(t=(e=this.$refs)==null?void 0:e.categoryFilter)==null?void 0:t.tempFilter)!=null&&r.page?(s=(i=(n=this.$refs)==null?void 0:n.categoryFilter)==null?void 0:i.tempFilter)==null?void 0:s.page:1}},mounted:function(){this.$store&&this.$store.state&&this.$store.state.language&&this.$store.state.language.code&&this.$store.state.user?this.listCategoryItems(!0):this.eventBus.on("coreDataLoaded",()=>{this.listCategoryItems(!0)}),this.eventBus.on("categoryPageChanged",e=>{this.page=e||1})},methods:{processCategoryResponse(e){var i;const t=new Date,r=this;this.groupsLastRefresh=t.getTime();let n=null;if(e.data.categoryDetail&&(this.categoryDetail=e.data.categoryDetail,this.categoryDetail&&this.categoryDetail.name&&r.$store.state&&typeof this.categoryDetail.name[r.$store.state.language.code]<"u"&&(document.title=this.categoryDetail.name[r.$store.state.language.code]+" - StretchShop"),e.data.categoryDetail.parentCategories&&(this.breadcrumbs=e.data.categoryDetail.parentCategories),n=this.categoryDetail.taxData?this.categoryDetail.taxData:(i=r.$store.state.coredata)==null?void 0:i.settings),e.data.categories&&(this.categories=e.data.categories),e.data.filteredProductsCount&&(this.filteredProductsCount=e.data.filteredProductsCount),e.data.results){const s=e.data.results;let a=null;e.data.categoryDetail&&e.data.categoryDetail.pathSlug&&(e.data.categoryDetail.type&&(a=e.data.categoryDetail.type),s.forEach(function(l){l=r.$helpers.getProductTaxData(l,n),l.activeParentCategoryUrl=e.data.categoryDetail.pathSlug})),a===null&&s&&s[0]&&s[0].type?this.itemsToListType=s[0].type+"s":this.itemsToListType=a,this.products=this.$store.state.chunk(s,S.PER_ROW)}if(e.data.filter){const s=Object.assign({},this.filter);this.filter=e.data.filter;const a=this;Object.keys(s).forEach(function(l){(typeof a.filter[l]>"u"||a.filter[l]===null)&&(a.filter[l]=s[l])})}e.data.filterProperties&&(this.filterDefinitions.genericFilter=e.data.filterProperties),this.$root.loadingClose()},listCategoryItems:function(e){typeof e>"u"||!e?e=!1:e=!0;const t=this,r=this.$route.path.split("/").filter(Boolean),n=typeof r[1]<"u"?r[1]:"products",i=this.categoryDetail&&this.categoryDetail.type==="pages"?"pageCategoryFilter":"categoryFilter";if(this.$route.params&&this.$route.params.category&&this.$route.params.category.toString().trim()!=="''")this.$root.loadingShow(),e&&Object.keys(this.$route.query).length>0?(this.queryStringtoFilter(i),t.$httpc.post(n+"/"+this.$route.params.category,{filter:this.$refs[i].buildFilterRequestObject(this.filter)},{timeout:7e3}).then(function(s){t.processCategoryResponse(s),typeof t.$refs[i]<"u"&&(t.introLoading=!0,t.introLoading=!1)}).catch(function(s){console.error(s)}).then(()=>{t.eventBus.emit("translateContent",t.$store.getters.getTranslates)})):this.$httpc.get(n+"/"+this.$route.params.category,{timeout:7e3,params:{limit:this.filter.limit}}).then(function(s){t.processCategoryResponse(s),typeof t.$refs[i]<"u"&&(t.introLoading=!0,t.$refs[i].setTempFilter(t.filter),t.introLoading=!1)}).catch(function(s){console.error(s)}).then(()=>{t.eventBus.emit("translateContent",t.$store.getters.getTranslates)});else{let s=this.$route.path;const a=s.split("/");let l=t.$store.state.language.code;a.length>1&&(l=a[1],a.splice(0,2),s=a.join("/"));const p=s;this.$httpc.post("categories/find",{query:{parentPathSlug:"",type:p},lang:l}).then(function(u){u.data&&(t.categories=u.data.categories,u.data.page&&u.data.page.data&&(t.page=u.data.page.data,t.page.name&&t.$store.state&&typeof t.page.name[t.$store.state.language.code]<"u"&&(document.title=t.page.name[t.$store.state.language.code]+" - StretchShop")))}).catch(function(u){console.error(u)}).then(function(){t.eventBus.emit("pageDetailLoaded")})}this.$root.loadingClose()},queryStringtoFilter(e){var r,n;let t={};if(typeof this.$route.query.page<"u"){const i=parseInt(this.$route.query.page);i>0&&(t.page=i)}if(typeof this.$route.query.string<"u"){const i=decodeURIComponent(this.$route.query.string).trim();i!==""&&(t.stringFilter=i)}if(typeof this.$route.query.sort<"u"){const i=decodeURIComponent(this.$route.query.sort).trim();i!==""&&(t.sort=i)}t=(n=(r=this.$refs)==null?void 0:r[e])==null?void 0:n.queryStringtoFilter(t),this.filter={...this.filter,...t},console.log("CategoryList filter",this.filter),this.eventBus.emit("queryFromUrlProcessed",t)},getCategoryFilteredCount(){return this.filteredProductsCount&&this.filteredProductsCount>0?this.filteredProductsCount:0},getCategoryBackground(){var e,t,r,n,i,s,a,l;return(e=this.categoryDetail)!=null&&e.slug&&((s=(i=(n=(r=(t=this.$store)==null?void 0:t.state)==null?void 0:r.coredata)==null?void 0:n.settings)==null?void 0:i.assets)!=null&&s.url)?this.$helpers.getImagePath("categories",this.$store.state.coredata,this.categoryDetail.slug,this.categoryDetail.slug+".jpg")+"?"+new Date((l=(a=this.categoryDetail)==null?void 0:a.dates)==null?void 0:l.dateUpdated).getTime():""}}},ut={class:"container category-list"},gt={key:0,class:"edit-area"},ht={class:"columns",id:"category-main-content"},dt={class:"column is-3 pr-6"},pt={key:0,class:"mt-6"},ft={class:"menu"},mt=o("p",{class:"menu-label subcategories",translate:"yes"}," Sub-Categories ",-1),yt={class:"menu-list"},_t={class:"column is-9"},Pt={key:0,class:"breadcrumb mb-2","aria-label":"breadcrumbs"},Ft={class:"is-active"},xt={class:"column"},vt={key:0,class:"title mb-0"},Ct={key:1,class:"title is-6 mb-5 has-text-grey-dark"},Mt={key:2,translate:"yes",class:"title is-1 title-products"},bt=["innerHTML"],Dt={key:1,ref:"categoryListResults"},Tt={key:0,class:"mb-5"},St={key:1},Rt={key:2},$t={class:"columns"},qt={class:"column is-12"},It={key:0,class:"title is-1"},Lt={key:3};function Ut(e,t,r,n,i,s){const a=F("font-awesome-icon"),l=F("router-link"),p=F("category-filter"),u=F("category-paging"),d=F("product-box"),h=F("page-detail-content"),C=F("error-page");return c(),g("div",ut,[s.userCanEdit&&(i.categoryDetail&&i.categoryDetail.pathSlug||i.page)?(c(),g("div",gt,[i.categoryDetail&&i.categoryDetail.pathSlug?(c(),$(l,{key:0,class:"editor-button edit-button",to:{name:"categoryNewEdit",params:{category:i.categoryDetail.pathSlug}}},{default:v(()=>[m(a,{icon:"edit"})]),_:1},8,["to"])):f("",!0),i.page&&i.page.slug?(c(),$(l,{key:1,class:"editor-button edit-button",to:{name:"pageNewEdit",params:{slug:i.page.slug}}},{default:v(()=>[m(a,{icon:"edit"})]),_:1},8,["to"])):f("",!0)])):f("",!0),o("div",ht,[o("div",dt,[i.categories&&i.categories.length>0?(c(),g("nav",pt,[o("aside",ft,[mt,o("ul",yt,[(c(!0),g(M,null,b(this.categories,(_,y)=>(c(),g("li",{key:y},[m(l,{title:_.descriptionShort[e.$store.state.language.code],to:{name:"categoryList",params:{category:_.pathSlug}}},{default:v(()=>[D(x(_.name[e.$store.state.language.code]),1)]),_:2},1032,["title","to"])]))),128))])])])):f("",!0),m(p,{ref:"categoryFilter",filter:i.filter,categoryMinMaxPrice:s.categoryMinMax,filterDefinitions:i.filterDefinitions,categoryType:s.getCategoryType,total:s.categoryProductsTotalForPaging},null,8,["filter","categoryMinMaxPrice","filterDefinitions","categoryType","total"])]),o("div",_t,[i.breadcrumbs&&i.breadcrumbs!=null&&i.breadcrumbs.length>0?(c(),g("nav",Pt,[o("ul",null,[(c(!0),g(M,null,b(i.breadcrumbs,(_,y)=>(c(),g("li",{key:y},[m(l,{title:_.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:_.pathSlug}}},{default:v(()=>[D(x(_.name[e.$store.state.language.code]),1)]),_:2},1032,["title","to"])]))),128)),o("li",Ft,[m(l,{title:i.categoryDetail.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:i.categoryDetail.pathSlug}},"aria-current":"page"},{default:v(()=>[D(x(i.categoryDetail.name[e.$store.state.language.code]),1)]),_:1},8,["title","to"])])])])):f("",!0),o("div",{class:"columns category-header mt-2",style:O({backgroundImage:"url("+s.getCategoryBackground()+")"})},[o("div",xt,[i.categoryDetail?(c(),g("h1",vt,x(i.categoryDetail.name[e.$store.state.language.code]),1)):f("",!0),i.categoryDetail?(c(),g("h2",Ct,x(i.categoryDetail.descriptionShort[e.$store.state.language.code]),1)):(c(),g("h1",Mt,"Products")),i.categoryDetail?(c(),g("div",{key:3,class:"categoryDescLong",innerHTML:i.categoryDetail.descriptionLong[e.$store.state.language.code]},null,8,bt)):f("",!0)])],4),i.products&&i.products.length>0?(c(),g("div",Dt,[m(u,{ref:"categoryPaging",total:s.categoryProductsTotalForPaging,active:s.categoryActivePage,perPage:i.filter.limit},null,8,["total","active","perPage"]),i.itemsToListType=="products"?(c(),g("div",Tt,[(c(!0),g(M,null,b(i.products,(_,y)=>(c(),g("div",{class:"tile is-ancestor",key:i.groupsLastRefresh+y},[(c(!0),g(M,null,b(_,(P,I)=>(c(),$(l,{key:i.groupsLastRefresh+P._id+(y+I),class:"tile is-parent is-4",title:P.descriptionShort[e.$store.state.language.code],to:{name:"productDetail",params:{category:i.categoryDetail.pathSlug,product:P._id,slug:P.slug}}},{default:v(()=>[m(d,{product:P,listType:i.itemsToListType,hideBuyButton:"true"},null,8,["product","listType"])]),_:2},1032,["title","to"]))),128))]))),128))])):f("",!0),i.itemsToListType=="pages"?(c(),g("div",St,[(c(!0),g(M,null,b(i.products,(_,y)=>(c(),g("div",{class:"tile is-ancestor",key:i.groupsLastRefresh+y},[(c(!0),g(M,null,b(_,(P,I)=>(c(),$(l,{key:i.groupsLastRefresh+P._id+(y+I),class:"tile is-parent is-4",title:P.descriptionShort[e.$store.state.language.code],to:{name:"pageDetailShort",params:{category:i.categoryDetail.pathSlug,slug:P.slug}}},{default:v(()=>[m(d,{product:P,listType:i.itemsToListType},null,8,["product","listType"])]),_:2},1032,["title","to"]))),128))]))),128))])):f("",!0),m(u,{ref:"categoryPaging",bottom:!0,total:s.categoryProductsTotalForPaging,active:s.categoryActivePage,perPage:i.filter.limit},null,8,["total","active","perPage"])],512)):i.page&&i.page.data?(c(),g("div",Rt,[o("div",$t,[o("div",qt,[i.page.data&&i.page.data.name?(c(),g("h1",It,x(i.page.data.name[e.$store.state.language.code]),1)):f("",!0),m(h,{content:s.categoryTypePageContent,contentData:s.categoryTypePageData,contentLang:i.language.code},null,8,["content","contentData","contentLang"])])])])):(c(),g("div",Lt,[m(C)]))])])])}const Gt=R(ct,[["render",Ut],["__file","/Users/marthol/Documents/GitHub/stretchshop-front-vue/src/components/products/CategoryList.vue"]]);export{Gt as default};
