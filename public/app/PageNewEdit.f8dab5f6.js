import{E as T,S as A}from"./Sidebar.9422624e.js";import{_ as L,c as g,e as d,f as r,a as e,F as N,i as F,j as y,n as V,w as U,b as u,v as p,y as M,r as h,o as m,g as w,t as I}from"./index.638fece5.js";const q={name:"PageNewEdit",data(){return{sidebar:!0,page:null,pageMainImageFile:null,parentCategoryDetail:null,language:{code:"en",longCode:"en-US",name:"English"},newLanguage:null,editor:null,editing:!1,userEditAllowed:!1,filteredCategoriesSlugs:[],filteredPagesSlugs:[],filteredReqProductOrderCodes:[],modal:null,fireCounter:0,dataToGenerateFromName:{slug:!0,externalId:!0}}},components:{editorwrapper:T,sidebar:A},created:function(){this.language=this.$store.state.language},computed:{user(){return this.$store.getters.getUserProfile},editorToolsConfig(){let s=this;return{image:{config:{uploader:{uploadByFile(a){return s.$helpers.uploadFileGlobal("image","pages","pages/upload/"+s.page.data.slug,a,s.$httpc,s.$store)},uploadByUrl(a){}}}}}}},beforeRouteLeave(s,a,i){this.eventBus.emit("removeEditor"),i()},watch:{user(s,a){s&&s!==null&&(this.getUserEditAllowed(),this.userEditAllowed&&this.getPageDetail())}},mounted:function(){this.getUserEditAllowed(),this.userEditAllowed&&this.getPageDetail()},methods:{toggleSidebar(){this.sidebar=!this.sidebar},checkLang(){var s,a;if(this.$route.query.lang&&((s=this.$store.state.coredata)==null?void 0:s.langs)){let i=this.$helpers.checkValidLanguageSync(this.$route.query.lang,(a=this.$store.state.coredata)==null?void 0:a.langs);i!=null&&i.valid&&(this.language=i.match)}},getUserEditAllowed(){return this.user&&this.user!==null&&this.user.type&&this.user.type==="admin"?(this.userEditAllowed=!0,!0):(this.userEditAllowed=!1,!1)},getPageDetail:function(){this.checkLang();const s=this;typeof this.$route.params.category>"u"&&(this.$route.params.category="-"),this.$route.params&&this.$route.params.slug&&this.$route.params.slug.toString().trim()!==""&&(this.$route.params.slug.toString().trim()==="---new"?setTimeout(function(){s.page=s.getEmptyPage(),s.eventBus.emit("runEditor")},1e3):this.$httpc.get("pages/"+this.$route.params.category+"/detail/"+this.$route.params.slug+"?lang="+s.language.code).then(function(a){a.data&&(s.page=a.data,s.page&&s.page.data&&s.page.data.name&&s.$store.state&&typeof s.page.data.name[s.language.code]<"u"&&(document.title=s.page.data.name[s.language.code]+" - StretchShop")),s.page&&s.page.data&&s.page.data.parentCategoryDetail&&(s.parentCategoryDetail=s.page.data.parentCategoryDetail,delete s.page.data.parentCategoryDetail)}).catch(function(a){console.error(a)}).then(function(){s.eventBus.emit("runEditor")}))},changeEditedLang(){this.fireCounter++,this.editing&&this.newLanguage&&this.newLanguage.code&&this.fireCounter===1&&(window.location=window.location.origin+this.$route.path+"?lang="+this.newLanguage.code)},save(s){var o,t,n,c,_,v,b,C,x,S,P,k,l;const a=this;(n=(t=(o=a.page)==null?void 0:o.data)==null?void 0:t.data)!=null&&n.blocks||(a.page.data.data.blocks=[]),((b=(v=(_=(c=a.page)==null?void 0:c.data)==null?void 0:_.data)==null?void 0:v.blocks)==null?void 0:b.length)===0&&a.page.data.data.blocks.push(a.$helpers.getLangsObject(a.$store.state.coredata.langCodes,"<p></p>")),((S=(x=(C=a.page)==null?void 0:C.data)==null?void 0:x.data)==null?void 0:S.blocks[0])&&typeof((l=(k=(P=a.page)==null?void 0:P.data)==null?void 0:k.data)==null?void 0:l.blocks[0][a.language.code])>"u"&&(a.page.data.data.blocks[0]=a.$helpers.getLangsObject(a.$store.state.coredata.langCodes,"<p></p>")),a.page.data.data.blocks[0][a.language.code]=s,this.page&&this.page.data&&this.page.data._id&&!this.page.data.id&&(this.page.data.id=this.page.data._id,delete this.page.data._id);const i={pages:[]};i.pages.push(this.page.data),this.$httpc.put("pages",i,{needsAuth:!0}).then(function(f){if(f.data&&f.data.length>0){const D=f.data[0],E=a.$router.resolve({name:"pageNewEdit",params:{slug:D.slug}});window.location=E.href}}).catch(function(f){console.error("savePage error:",f)})},deletePage(){const a={pages:[{id:this.page._id}]};this.page&&this.page._id&&confirm("Are you sure you want to delete this page?")&&this.$httpc.delete("pages",{data:a}).then(i=>{i&&i.data&&alert("Page has been successfully removed. You will be redirected now")})},getFilteredCategories:function(s){const a=this;return s&&s.toString().trim()!==""?this.$httpc.post("categories/find",{query:{pathSlug:{$regex:s},type:"pages"}}).then(function(i){if(i.data)return i.data}).catch(function(i){console.error(i)}).then(function(i){const o=[];if(a.page.data.categories&&i&&i.categories&&i.categories.length>0)for(let t=0;t<i.categories.length;t++)i.categories[t].pathSlug&&a.page.data.categories.indexOf(i.categories[t].pathSlug)<0&&o.push(i.categories[t].pathSlug);return a.filteredCategoriesSlugs=o,o}):(a.filteredCategoriesSlugs=[],[])},getFilteredPages:function(s){const a=this;return s&&s.toString().trim()!==""?this.$httpc.post("pages/listTemplates/"+a.page.data.slug,{query:{slug:s}}).then(function(i){if(i.data)return i.data}).catch(function(i){console.error(i)}).then(function(i){const o=[];if(a.page.data.pages&&i&&i.length>0)for(let t=0;t<i.length;t++)a.page.data.pages.indexOf(i[t])<0&&o.push(i[t]);return a.filteredPagesSlugs=o,o}):(a.filteredPagesSlugs=[],[])},getFilteredProducts:function(s){const a=this;return s&&s.toString().trim()!==""?this.$httpc.post("products/find",{query:{orderCode:{$regex:s},"data.contentDependency":!0}}).then(function(i){if(i.data)return i.data}).catch(function(i){console.error(i)}).then(function(i){const o=[];if(a.page.data.pages&&i&&i.length>0)for(let t=0;t<i.length;t++)a.page.data.pages.indexOf(i[t])<0&&o.push(i[t].orderCode);return a.filteredReqProductOrderCodes=o,o}):(a.filteredReqProductOrderCodes=[],[])},getEmptyPage(){const s=this;return{body:'<div data-editable data-name="content"><p>Your content here</p></div>',data:{externalId:null,variationGroupId:null,slug:null,publisher:s.user.email,authors:null,type:"page",subtype:"default",name:s.$helpers.getLangsObject(s.$store.state.coredata.langCodes),descriptionShort:s.$helpers.getLangsObject(s.$store.state.coredata.langCodes),descriptionLong:s.$helpers.getLangsObject(s.$store.state.coredata.langCodes),properties:null,data:{blocks:[s.$helpers.getLangsObject(s.$store.state.coredata.langCodes,"<p></p>")]},categories:[],pages:[],dates:{dateCreated:null,dateUpdated:null,dateSynced:null},note:null,activity:null}}},checkNameDependents(){if(this.page&&this.page.data&&!this.page.data._id){let s=this.language&&this.language.code?this.language.code:null;this.newLanguage&&this.newLanguage.code&&(s=this.newLanguage.code),this.page.data.name&&this.page.data.name[s]&&this.page.data.name[s].trim()!==""&&((this.page.data.slug&&this.page.data.slug.trim()===""||this.dataToGenerateFromName.slug)&&(this.page.data.slug=this.$helpers.stringToSlug(this.page.data.name[s]),this.dataToGenerateFromName.slug=!0),(this.page.data.externalId&&this.page.data.externalId.trim()===""||this.dataToGenerateFromName.externalId)&&(this.page.data.externalId=this.$helpers.stringToSlug(this.page.data.name[s]),this.dataToGenerateFromName.externalId=!0))}},getActivity(){const s={start:null,end:null};return this.page&&this.page.data&&this.page.data!==null&&this.page.data.activity&&this.page.data.activity!==null&&(this.page.data.activity.start&&this.page.data.activity.start.toString().trim()!==""&&(s.start=new Date(this.page.data.activity.start)),this.page.data.activity.end&&this.page.data.activity.end.toString().trim()!==""&&(s.end=new Date(this.page.data.activity.end))),s},setActivity(s,a){a&&this.page&&this.page.data&&this.page.data!==null&&(this.page.data.activity||(this.page.data.activity={start:null,end:null}),this.page.data.activity[s]=a)},getPageImagePath(s){return s&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getImagePath("pages",this.$store.state.coredata,"cover/"+s,"cover.jpg"):null},pageMainImageDelete(){const s=this;if(confirm("Are you sure?")){const a={timeout:15e3,needsAuth:!0},i=this.getPageImagePath(this.page.data.slug);let o="";if(i.trim()!==""){const t=i.split("/");t.length>0&&(o=t[t.length-1])}console.debug(s.page.data.slug,i),this.$httpc.delete("user/image/pages/"+this.page.data.slug+"/"+o,a).then(function(t){if(t&&t.data&&t.data.success){const n=new Date;s.$el.querySelector(".page-detail-cover").style.backgroundImage="url('"+s.getPageImagePath(s.page.data.slug)+"?"+n.getTime()+"')"}})}},pageMainImageUpload(s){if(this.pageMainImageFile=s.target.files,this.pageMainImageFile){const i=this,o=new FormData;if(this.pageMainImageFile.length&&this.pageMainImageFile.length>0)for(var a=0;a<this.pageMainImageFile.length;a++){const t=this.pageMainImageFile[a];o.append("files["+a+"]",t)}else o.append("files[0]",this.pageMainImageFile);this.$httpc.post("/pages/upload/"+this.page.data.slug+"/main",o,{needsAuth:!0}).then(function(t){if(t&&t.data&&t.data.substr(0,1)==="'"&&t.data[t.data.length-1]==="'"){const n=t.data.length-2;if(t.data=t.data.substr(1,n),t.data=JSON.parse(t.data),t.data.files&&t.data.files.length>0&&t.data.files[0].path&&t.data.files[0].path.trim()!==""){const c=i.$el.querySelector(".page-detail-cover");if(c){const _=new Date;c.style.backgroundImage="url('"+i.$store.state.coredata.settings.assets.url+"/pages/cover/"+t.data.files[0].path+"?"+_.getTime()+"')"}}}})}}}},O={key:0,id:"page-new-edit",class:"container page-detail"},j={class:"page-categories-related"},B={class:"title is-3","aria-controls":"contentCategoriesRelated"},R=e("span",{translate:"yes"},"Categories & Related Pages",-1),G=w(),z={class:"categoriesRelated-hidden collapse-content",id:"contentCategoriesRelated","aria-expanded":"true"},H={class:"container is-fluid p-3"},W={class:"columns"},Y={class:"column"},J={class:"columns"},K={class:"column"},Q={class:"page-hidden-properties"},X={class:"title is-3","aria-controls":"contentHiddenProperties"},Z=e("span",{translate:"yes"},"Page's hidden properties",-1),$=w(),ee={class:"editableByAuthor-hidden collapse-content",id:"contentHiddenProperties","aria-expanded":"true"},te={class:"container is-fluid p-3"},ae={class:"columns"},se={class:"column"},ie={class:"field"},le=e("label",{class:"label",translate:"yes"},"Type",-1),ne={class:"control"},oe={class:"columns"},de={class:"column"},re={class:"field"},ce=e("label",{class:"label",translate:"yes"},"Subtype",-1),ge={class:"control"},ue={class:"columns"},pe={class:"column"},he={class:"field"},me=e("label",{class:"label",translate:"yes"},"External Id",-1),_e={class:"control"},fe={class:"columns"},ye={class:"column"},ve={class:"field"},be=e("label",{class:"label",translate:"yes"},"Slug",-1),we={class:"control"},Pe={class:"columns"},Ce={class:"column"},xe={class:"field"},Se=e("label",{class:"label",translate:"yes"},"Note",-1),ke={class:"control"},Ie={key:0},De={class:"columns"},Ee={class:"column"},Te={class:"field"},Ae=e("label",{class:"label",translate:"yes"},"Activity Start",-1),Le={class:"control"},Ne={class:"columns"},Fe={class:"column"},Ve={class:"field"},Ue=e("label",{class:"label",translate:"yes"},"Activity End",-1),Me={class:"control"},qe={key:0},Oe={class:"title is-3","aria-controls":"contentHiddenProperties",translate:"yes"},je=e("span",{traslate:"yes"},"Editable by admin user",-1),Be=w(),Re={class:"editableByAdmin-hidden"},Ge={class:"container is-fluid p-3"},ze={class:"columns"},He={class:"column"},We={class:"field"},Ye=e("label",{class:"label",translate:"yes"},"Publisher",-1),Je={class:"control"},Ke={class:"columns"},Qe={class:"column"},Xe=e("p",{class:"has-text-info"},"Note: Product must have Content Dependency checked in product settings!",-1),Ze={class:"columns"},$e={class:"column is-12"},et={class:"page-image-wrapper"},tt={class:"columns is-centered pb-0"},at={class:"column is-6"},st={key:0,class:"breadcrumb","aria-label":"breadcrumbs"},it={key:0},lt={class:"is-active"},nt={class:"columns is-centered page-detail-cover-wrapper mt-0"},ot={class:"page-image-actions"},dt={class:"file is-primary action edit"},rt={class:"file-label"},ct=M('<span class="file-cta"><span class="file-icon"><i class="fa fa-file-upload"></i></span><span class="file-label show-on-hover" translate="yes"> \xA0Click to upload <span class="recommended-size">min 684 x 300 px</span></span></span>',1),gt=e("i",{class:"fa fa-trash"},null,-1),ut=w("\xA0 "),pt=e("span",{class:"show-on-hover",translate:"yes"},"Click to remove",-1),ht=[gt,ut,pt],mt={class:"columns"},_t={class:"column is-offset-3 is-6"},ft={key:0,class:"data-main"},yt={class:"field"},vt=e("label",{class:"label",translate:"yes"},"Name",-1),bt={class:"control"},wt={class:"field"},Pt=e("label",{class:"label",translate:"yes"},"Description Short",-1),Ct={class:"control"},xt={class:"field"},St=e("label",{class:"label",translate:"yes"},"Description Long",-1),kt={class:"control"},It={key:0,class:"columns page-delete"},Dt={class:"column is-12"},Et=e("p",{translate:"yes"},"Warning: This action cannot be undone!",-1);function Tt(s,a,i,o,t,n){const c=h("font-awesome-icon"),_=h("o-inputitems"),v=h("o-field"),b=h("o-collapse"),C=h("o-datetimepicker"),x=h("o-datepicker"),S=h("sidebar"),P=h("router-link"),k=h("editorwrapper");return t.page?(m(),g("div",O,[d(S,{fullheight:!0,overlay:!1,right:!0,open:t.sidebar,canCancel:!1},{default:r(()=>[e("div",j,[d(b,{open:!0,"aria-id":"contentCategoriesRelated"},{trigger:r(l=>[e("h3",B,[R,G,d(c,{icon:l.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:r(()=>[e("div",z,[e("div",H,[e("div",W,[e("div",Y,[e("section",null,[d(v,{label:"Enter categories' url slugs"},{default:r(()=>[d(_,{modelValue:t.page.data.categories,"onUpdate:modelValue":a[0]||(a[0]=l=>t.page.data.categories=l),data:t.filteredCategoriesSlugs,autocomplete:"","allow-new":!1,iconPack:"fas",icon:"tags",placeholder:"Categories",type:"is-info",onTyping:n.getFilteredCategories},null,8,["modelValue","data","onTyping"])]),_:1})])])]),e("div",J,[e("div",K,[e("section",null,[d(v,{label:"Enter related pages' url slugs"},{default:r(()=>[d(_,{modelValue:t.page.data.pages,"onUpdate:modelValue":a[1]||(a[1]=l=>t.page.data.pages=l),data:t.filteredPagesSlugs,autocomplete:"",field:"pathSlug","allow-new":!0,iconPack:"fas",icon:"tags",placeholder:"Pages",type:"is-info",onTyping:n.getFilteredPages},null,8,["modelValue","data","onTyping"])]),_:1})])])])])])]),_:1})]),e("div",Q,[d(b,{open:!0,"aria-id":"contentHiddenProperties"},{trigger:r(l=>[e("h3",X,[Z,$,d(c,{icon:l.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:r(()=>[e("div",ee,[e("div",te,[e("div",ae,[e("div",se,[e("div",ie,[le,e("div",ne,[u(e("input",{class:"input",type:"text","onUpdate:modelValue":a[2]||(a[2]=l=>t.page.data.type=l),translate:"yes",placeholder:"Type"},null,512),[[p,t.page.data.type]])])])])]),e("div",oe,[e("div",de,[e("div",re,[ce,e("div",ge,[u(e("input",{class:"input",type:"text","onUpdate:modelValue":a[3]||(a[3]=l=>t.page.data.subtype=l),translate:"yes",placeholder:"Subtype"},null,512),[[p,t.page.data.subtype]])])])])]),e("div",ue,[e("div",pe,[e("div",he,[me,e("div",_e,[u(e("input",{class:"input",type:"text","onUpdate:modelValue":a[4]||(a[4]=l=>t.page.data.externalId=l),translate:"yes",placeholder:"External Id"},null,512),[[p,t.page.data.externalId]])])])])]),e("div",fe,[e("div",ye,[e("div",ve,[be,e("div",we,[u(e("input",{class:"input",type:"text","onUpdate:modelValue":a[5]||(a[5]=l=>t.page.data.slug=l),translate:"yes",placeholder:"Slug"},null,512),[[p,t.page.data.slug]])])])])]),e("div",Pe,[e("div",Ce,[e("div",xe,[Se,e("div",ke,[u(e("textarea",{class:"textarea","onUpdate:modelValue":a[6]||(a[6]=l=>t.page.data.note=l),translate:"yes",placeholder:"Note"},null,512),[[p,t.page.data.note]])])])])]),t.page&&t.page.data?(m(),g("div",Ie,[e("div",De,[e("div",Ee,[e("div",Te,[Ae,e("div",Le,[d(C,{value:n.getActivity().start,onInput:a[7]||(a[7]=l=>n.setActivity("start",l)),placeholder:"Activity Start DateTime",iconPack:"fa",icon:"calendar-alt",iconPrev:"angle-left",iconNext:"angle-right",position:"bottom-left","trap-focus":""},null,8,["value"])])])])]),e("div",Ne,[e("div",Fe,[e("div",Ve,[Ue,e("div",Me,[d(x,{value:n.getActivity().end,onInput:a[8]||(a[8]=l=>n.setActivity("end",l)),placeholder:"Activity End DateTime",iconPack:"fa",icon:"calendar-alt",iconPrev:"angle-left",iconNext:"angle-right",position:"bottom-left","trap-focus":""},null,8,["value"])])])])])])):y("",!0)])])]),_:1}),n.user&&n.user!=null&&n.user.type&&n.user.type=="admin"?(m(),g("div",qe,[d(b,{open:!0,"aria-id":"contentHiddenPropertiesAdmin"},{trigger:r(l=>[e("h3",Oe,[je,Be,d(c,{icon:l.open?"angle-down":"angle-up"},null,8,["icon"])])]),default:r(()=>[e("div",Re,[e("div",Ge,[e("div",ze,[e("div",He,[e("div",We,[Ye,e("div",Je,[u(e("input",{class:"input",type:"text","onUpdate:modelValue":a[9]||(a[9]=l=>t.page.data.publisher=l),translate:"yes",placeholder:"Publisher"},null,512),[[p,t.page.data.publisher]])])])])]),e("div",Ke,[e("div",Qe,[e("section",null,[d(v,{label:"Enter order code of required products"},{default:r(()=>[d(_,{modelValue:t.page.data.data.requirements.userdata.products,"onUpdate:modelValue":a[10]||(a[10]=l=>t.page.data.data.requirements.userdata.products=l),data:t.filteredReqProductOrderCodes,autocomplete:"",field:"orderCode","allow-new":!0,iconPack:"fas",icon:"tags",placeholder:"Products",type:"is-info",onTyping:n.getFilteredProducts},null,8,["modelValue","data","onTyping"])]),_:1}),Xe])])])])])]),_:1})])):y("",!0)])]),_:1},8,["open"]),e("div",Ze,[e("div",$e,[e("div",et,[e("div",tt,[e("div",at,[t.parentCategoryDetail?(m(),g("nav",st,[t.parentCategoryDetail.parentCategories?(m(),g("ul",it,[(m(!0),g(N,null,F(t.parentCategoryDetail.parentCategories,(l,f)=>(m(),g("li",{key:f},[d(P,{title:l.name[t.language.code],to:{name:"categoryList",params:{category:l.pathSlug}}},{default:r(()=>[w(I(l.name[t.language.code]),1)]),_:2},1032,["title","to"])]))),128)),e("li",lt,[d(P,{title:t.parentCategoryDetail.name[t.language.code],to:{name:"categoryList",params:{category:t.parentCategoryDetail.pathSlug}},"aria-current":"page"},{default:r(()=>[w(I(t.parentCategoryDetail.name[t.language.code]),1)]),_:1},8,["title","to"])])])):y("",!0)])):y("",!0)])]),e("div",nt,[e("div",{class:"column is-6 page-detail-cover",style:V("background-image: url("+n.getPageImagePath(t.page.data.slug)+")")},[e("div",ot,[e("div",dt,[e("label",rt,[e("input",{class:"file-input",type:"file",name:"resume",onInput:a[11]||(a[11]=l=>n.pageMainImageUpload(l))},null,32),ct])]),e("a",{class:"action remove button is-danger has-text-white",onClick:a[12]||(a[12]=U(l=>n.pageMainImageDelete(),["prevent"]))},ht)])],4)])])])]),e("div",mt,[e("div",_t,[t.page&&t.page.data&&t.page.data!=null?(m(),g("div",ft,[e("div",yt,[vt,e("div",bt,[u(e("input",{class:"input is-size-1 has-text-weight-semibold has-text-centered",type:"text","onUpdate:modelValue":a[13]||(a[13]=l=>t.page.data.name[t.language.code]=l),onKeyup:a[14]||(a[14]=l=>n.checkNameDependents()),translate:"yes",placeholder:"Name"},null,544),[[p,t.page.data.name[t.language.code]]])])]),e("div",wt,[Pt,e("div",Ct,[u(e("input",{class:"input is-size-5 has-text-weight-normal has-text-centered",type:"text","onUpdate:modelValue":a[15]||(a[15]=l=>t.page.data.descriptionShort[t.language.code]=l),translate:"yes",placeholder:"Description Short"},null,512),[[p,t.page.data.descriptionShort[t.language.code]]])])]),e("div",xt,[St,e("div",kt,[u(e("input",{class:"input is-size-5 has-text-weight-normal has-text-centered",type:"text","onUpdate:modelValue":a[16]||(a[16]=l=>t.page.data.descriptionLong[t.language.code]=l),translate:"yes",placeholder:"Description Long"},null,512),[[p,t.page.data.descriptionLong[t.language.code]]])])])])):y("",!0),d(k,{type:"editorjs",editordata:{editorjs:{setup:n.editorToolsConfig,data:t.page.data.data.blocks[0][t.language.code]}}},null,8,["editordata"])])]),t.page&&t.page!=null?(m(),g("div",It,[e("div",Dt,[e("section",null,[e("button",{class:"button is-danger",onClick:a[17]||(a[17]=l=>n.deletePage()),translate:"yes"},"DELETE This Page"),Et])])])):y("",!0)])):y("",!0)}const Nt=L(q,[["render",Tt]]);export{Nt as default};
