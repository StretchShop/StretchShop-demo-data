(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40afdcca"],{"4c4c":function(e,a,t){"use strict";var s=t("a4c3"),i=t.n(s);i.a},a4c3:function(e,a,t){},df24:function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return e.page?t("div",{staticClass:"container page-detail"},[t("div",{staticClass:"field product-edit-language hidden"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Edit Language")]),t("div",{staticClass:"control select"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.newLanguage,expression:"newLanguage"}],on:{change:[function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.newLanguage=a.target.multiple?t:t[0]},function(a){return e.changeEditedLang()}]}},e._l(e.$store.state.coredata.langs,(function(a,s){return t("option",{key:s+"langs",domProps:{value:a}},[e._v(" "+e._s(a.name)+" ")])})),0)])]),e.editing?t("div",{staticClass:"page-hidden-properties"},[t("b-collapse",{attrs:{open:!1,"aria-id":"contentHiddenProperties"},scopedSlots:e._u([{key:"trigger",fn:function(a){return t("h3",{staticClass:"title is-3",attrs:{"aria-controls":"contentHiddenProperties"}},[t("span",{attrs:{translate:"yes"}},[e._v("Page's hidden properties")]),e._v(" "),t("font-awesome-icon",{attrs:{icon:a.open?"angle-down":"angle-up"}})],1)}}],null,!1,4003255297)},[t("div",{staticClass:"editableByAuthor-hidden collapse-content",attrs:{id:"contentHiddenProperties","aria-expanded":"true"}},[t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-12"},[e.editing?t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-3"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Type")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.type,expression:"page.data.type"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Type"},domProps:{value:e.page.data.type},on:{input:function(a){a.target.composing||e.$set(e.page.data,"type",a.target.value)}}})])])]),t("div",{staticClass:"column is-3"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Subtype")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.subtype,expression:"page.data.subtype"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Subtype"},domProps:{value:e.page.data.subtype},on:{input:function(a){a.target.composing||e.$set(e.page.data,"subtype",a.target.value)}}})])])]),t("div",{staticClass:"column is-3"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("External Id")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.externalId,expression:"page.data.externalId"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"External Id"},domProps:{value:e.page.data.externalId},on:{input:function(a){a.target.composing||e.$set(e.page.data,"externalId",a.target.value)}}})])])])]):e._e()])]),t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-12"},[e.editing?t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-3"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Slug")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.slug,expression:"page.data.slug"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Slug"},domProps:{value:e.page.data.slug},on:{input:function(a){a.target.composing||e.$set(e.page.data,"slug",a.target.value)}}})])])]),t("div",{staticClass:"column is-6"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Note")]),t("div",{staticClass:"control"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.page.data.note,expression:"page.data.note"}],staticClass:"textarea",attrs:{translate:"yes",placeholder:"Note"},domProps:{value:e.page.data.note},on:{input:function(a){a.target.composing||e.$set(e.page.data,"note",a.target.value)}}})])])]),t("div",{staticClass:"column is-3"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Activity")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.activity,expression:"page.data.activity"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Activity"},domProps:{value:e.page.data.activity},on:{input:function(a){a.target.composing||e.$set(e.page.data,"activity",a.target.value)}}})])])])]):e._e()])])])]),e.user&&null!=e.user&&e.user.type&&"admin"==e.user.type?t("div",[t("b-collapse",{attrs:{open:!1,"aria-id":"contentHiddenPropertiesAdmin"},scopedSlots:e._u([{key:"trigger",fn:function(a){return t("h3",{staticClass:"title is-3",attrs:{"aria-controls":"contentHiddenProperties",translate:"yes"}},[t("span",{attrs:{traslate:"yes"}},[e._v("Editable by admin user")]),e._v(" "),t("font-awesome-icon",{attrs:{icon:a.open?"angle-down":"angle-up"}})],1)}}],null,!1,476455311)},[t("div",{staticClass:"editableByAdmin-hidden"},[t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-4 is-offset-4"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Publisher")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.publisher,expression:"page.data.publisher"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Publisher"},domProps:{value:e.page.data.publisher},on:{input:function(a){a.target.composing||e.$set(e.page.data,"publisher",a.target.value)}}})])])])])])])],1):e._e()],1):e._e(),t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-3"}),t("div",{staticClass:"column is-6"},[t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-6"},[t("section",[t("b-field",{attrs:{label:"Enter categories' url slugs"}},[t("b-taginput",{attrs:{data:e.filteredCategoriesSlugs,autocomplete:"","allow-new":!1,field:"user.first_name",icon:"tags",placeholder:"Categories",type:"is-info"},on:{typing:e.getFilteredCategories},model:{value:e.page.data.categories,callback:function(a){e.$set(e.page.data,"categories",a)},expression:"page.data.categories"}})],1)],1),e.parentCategoryDetail?t("nav",{staticClass:"breadcrumb",attrs:{"aria-label":"breadcrumbs"}},[e.parentCategoryDetail.parentCategories?t("ul",[e._l(e.parentCategoryDetail.parentCategories,(function(a,s){return t("li",{key:s},[t("router-link",{attrs:{title:a.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:a.pathSlug}}}},[e._v(" "+e._s(a.name[e.$store.state.language.code])+" ")])],1)})),t("li",{staticClass:"is-active"},[t("router-link",{attrs:{title:e.parentCategoryDetail.name[e.$store.state.language.code],to:{name:"categoryList",params:{category:e.parentCategoryDetail.pathSlug}},"aria-current":"page"}},[e._v(" "+e._s(e.parentCategoryDetail.name[e.$store.state.language.code])+" ")])],1)],2):e._e()]):e._e()]),t("div",{staticClass:"column is-6"},[t("section",[t("b-field",{attrs:{label:"Enter related pages' url slugs"}},[t("b-taginput",{attrs:{data:e.filteredPagesSlugs,autocomplete:"","allow-new":!1,icon:"tags",placeholder:"Pages",type:"is-info"},on:{typing:e.getFilteredPages},model:{value:e.page.data.pages,callback:function(a){e.$set(e.page.data,"pages",a)},expression:"page.data.pages"}})],1)],1)])]),e.page&&e.page.data&&null!=e.page.data?t("div",{staticClass:"data-main"},[t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Name")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.name[e.language.code],expression:"page.data.name[language.code]"}],staticClass:"input is-size-1 has-text-weight-semibold has-text-centered",attrs:{type:"text",translate:"yes",placeholder:"Name"},domProps:{value:e.page.data.name[e.language.code]},on:{keyup:function(a){return e.checkNameDependents()},input:function(a){a.target.composing||e.$set(e.page.data.name,e.language.code,a.target.value)}}})])]),t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Description Short")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.descriptionShort[e.language.code],expression:"page.data.descriptionShort[language.code]"}],staticClass:"input is-size-5 has-text-weight-normal has-text-centered",attrs:{type:"text",translate:"yes",placeholder:"Description Short"},domProps:{value:e.page.data.descriptionShort[e.language.code]},on:{input:function(a){a.target.composing||e.$set(e.page.data.descriptionShort,e.language.code,a.target.value)}}})])]),t("div",{staticClass:"field"},[t("label",{staticClass:"label",attrs:{translate:"yes"}},[e._v("Description Long")]),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.page.data.descriptionLong[e.language.code],expression:"page.data.descriptionLong[language.code]"}],staticClass:"input is-size-5 has-text-weight-normal has-text-centered",attrs:{type:"text",translate:"yes",placeholder:"Description Long"},domProps:{value:e.page.data.descriptionLong[e.language.code]},on:{input:function(a){a.target.composing||e.$set(e.page.data.descriptionLong,e.language.code,a.target.value)}}})])])]):e._e(),t("div",{staticClass:"page-body",domProps:{innerHTML:e._s(e.page.body)}})])]),e.page&&null!=e.page?t("div",{staticClass:"columns page-delete"},[t("div",{staticClass:"column is-12"},[t("section",[t("button",{staticClass:"button is-danger",attrs:{translate:"yes"},on:{click:function(a){return e.deletePage()}}},[e._v("DELETE This Page")]),t("p",{attrs:{translate:"yes"}},[e._v("Warning: This action cannot be undone!")])])])]):e._e()]):e._e()},i=[],n=(t("a481"),t("456d"),t("ac6a"),t("3b2b"),t("7618")),l=(t("7f7f"),t("6b54"),t("77b6")),o=t.n(l),r=(t("2b31"),{name:"PageNewEdit",data:function(){return{page:null,parentCategoryDetail:null,language:{code:"en",longCode:"en-US",name:"English"},newLanguage:null,editor:null,editing:!1,userEditAllowed:!1,filteredCategoriesSlugs:[],filteredPagesSlugs:[],modal:null,fireCounter:0,dataToGenerateFromName:{slug:!0,externalId:!0}}},created:function(){this.language=this.$store.state.language},computed:{user:function(){return this.$store.getters.getUserProfile}},beforeRouteLeave:function(e,a,t){this.editor&&this.editor.destroy(),t()},watch:{user:function(e,a){console.log("new & old",e,a),e&&null!=e&&(this.getUserEditAllowed(),this.userEditAllowed&&this.getPageDetail())}},mounted:function(){this.getUserEditAllowed(),this.userEditAllowed&&this.getPageDetail()},methods:{getUserEditAllowed:function(){if(this.language=this.$store.state.language,this.user&&null!=this.user&&this.user.type&&"admin"==this.user.type)return this.userEditAllowed=!0,void this.user.settings.language;this.userEditAllowed=!1},getPageDetail:function(){var e=this;"undefined"==typeof this.$route.params.category&&(this.$route.params.category="-"),this.$route.params&&this.$route.params.slug&&""!=this.$route.params.slug.toString().trim()&&("---new"==this.$route.params.slug.toString().trim()?setTimeout((function(){e.page=e.getEmptyPage(),e.runEditor()}),1e3):this.$httpc.get("pages/"+this.$route.params.category+"/detail/"+this.$route.params.slug+"?lang="+e.$store.state.language.code).then((function(a){a.data&&(e.page=a.data,e.page&&e.page.data&&e.page.data.name&&e.$store.state&&void 0!==Object(n["a"])(e.page.data.name[e.$store.state.language.code])&&(document.title=e.page.data.name[e.$store.state.language.code]+" - StretchShop"),console.log("page detail",a.data)),e.page&&e.page.data&&e.page.data.parentCategoryDetail&&(e.parentCategoryDetail=e.page.data.parentCategoryDetail,delete e.page.data.parentCategoryDetail)})).catch((function(e){console.log(e)})).then((function(){e.runEditor()})))},runEditor:function(){var e=this;if(this.$route.query.lang){var a=this.$store.dispatch("checkLanguage",this.$route.query.lang);a.then((function(a){console.log("language check result:",a),e.language&&e.language.code&&a&&a.code&&e.language.code!=a.code&&(e.language=a)}))}setTimeout((function(){o.a.IMAGE_UPLOADER=e.editorCTimageUploader,e.editor=o.a.EditorApp.get(),console.log("get editor"),e.editor.init("*[data-editable]","data-name"),console.log("init editor"),e.editor.start(),console.log("start editor"),e.editor.ignition().state("editing"),console.log("editor ignition state editing"),e.editing=!0,e.newLanguage=e.language,e.editor.addEventListener("saved",(function(a){console.log("editor saved",a);var t=a.detail().regions;console.log("regions",t),e.editor.busy(!0),t&&"undefined"!==typeof t["content"]&&(console.log("self.page: ",e.page),console.log("self.page.data: ",e.page.data),console.log("self.page.data.data: ",e.page.data.data),e.page.data.data.blocks||(e.page.data.data.blocks=[]),0==e.page.data.data.blocks.length&&e.page.data.data.blocks.push({}),console.log("self.page.data.data.blocks: ",e.page.data.data.blocks),console.log("self.page.data.data.blocks[0]: ",e.page.data.data.blocks[0]),e.page.data.data.blocks[0]&&!e.page.data.data.blocks[0][e.language.code]&&(e.page.data.data.blocks[0][e.language.code]={}),e.page.data.data.blocks[0][e.language.code]=t["content"],console.log("page data.blocks[0]["+e.language.code+"]:",e.page.data.data.blocks[0][e.language.code])),e.savePage()}))}),1e3)},editorCTimageUploader:function(e){var a,t,s,i,n=this;console.log("xxx",e),e.addEventListener("imageuploader.cancelupload",(function(){t&&(t.upload.removeEventListener("progress",i),t.removeEventListener("readystatechange",s),t.abort()),e.state("empty")})),e.addEventListener("imageuploader.clear",(function(){e.clear(),a=null})),e.addEventListener("imageuploader.fileready",(function(l){var r,d=l.detail().file;i=function(a){e.progress(a.loaded/a.total*100)},s=function(l){var r;if(4==l.target.readyState)if(t=null,i=null,s=null,200==parseInt(l.target.status)){var d=l.target.responseText.length-2,g=l.target.responseText.substr(1,d);r=JSON.parse(g),console.log("upload response:",r);var c=new Image,u=n.$store.state.coredata.settings.assets.url+"/pages/editor/"+r.files[0].path;c.onload=function(){a={size:[c.width,c.height],url:u},e.populate(a.url,a.size)},c.src=u}else new o.a.FlashUI("no")},e.state("uploading"),e.progress(0),r=new FormData,r.append("image",d),t=new XMLHttpRequest,t.withCredentials=!0,t.upload.addEventListener("progress",i),t.addEventListener("readystatechange",s),t.open("POST",n.$httpc.defaults.baseURL+"pages/upload/"+n.page.data.slug,!0),t.setRequestHeader("Accept","application/json"),t.send(r)})),e.addEventListener("imageuploader.save",(function(){e.save(a.url,a.size,{alt:"test","data-ce-max-width":a.size[0]})}))},changeEditedLang:function(){this.fireCounter++,this.editing&&this.newLanguage&&this.newLanguage.code&&1==this.fireCounter&&(window.location=window.location.origin+this.$route.path+"?lang="+this.newLanguage.code)},savePage:function(){var e=this;if(this.page&&this.page.data&&this.page.data._id&&!this.page.data.id&&(this.page.data.id=this.page.data._id,delete this.page.data._id),this.page.data.blocks){var a=new RegExp(" data-editable ","g");Object.keys(this.page.data.blocks).forEach((function(e){if(this.page.data.blocks[e].indexOf(" data-editable ")){this.$route.params.id.toString().replace("---","@").replace(a,".");this.page.data.blocks[e]=this.page.data.blocks[e].replace(a)}}))}var t={pages:[]};t.pages.push(this.page.data),console.log("pagesToPut: ",t),this.$httpc.put("pages",t,{needsAuth:!0}).then((function(a){if(a.data&&a.data.length>0){var t=a.data[0],s=e.$router.resolve({name:"pageNewEdit",params:{slug:t.slug}});window.location=s.href}})).catch((function(a){console.log("savePage error:",a),e.editor.busy(!1)}))},deletePage:function(){var e=this,a={pages:[{id:e.page._id}]};this.page&&this.page._id&&confirm("Are you sure you want to delete this page?")&&this.$httpc.delete("pages",{data:a}).then((function(e){e&&e.data&&alert("Page has been successfully removed. You will be redirected now")}))},getFilteredCategories:function(e){var a=this;return e&&""!=e.toString().trim()?this.$httpc.post("categories/find",{query:{pathSlug:{$regex:e},type:"pages"}}).then((function(e){if(e.data)return e.data})).catch((function(e){console.log(e)})).then((function(e){var t=[];if(a.page.data.categories&&e&&e.categories&&e.categories.length>0)for(var s=0;s<e.categories.length;s++)e.categories[s].pathSlug&&a.page.data.categories.indexOf(e.categories[s].pathSlug)<0&&t.push(e.categories[s].pathSlug);return a.filteredCategoriesSlugs=t,t})):(a.filteredCategoriesSlugs=[],[])},getFilteredPages:function(e){var a=this;return e&&""!=e.toString().trim()?this.$httpc.post("pages/listTemplates/"+a.page.data.slug,{query:{slug:e}}).then((function(e){if(e.data)return e.data})).catch((function(e){console.log(e)})).then((function(e){var t=[];if(a.page.data.pages&&e&&e.length>0)for(var s=0;s<e.length;s++)a.page.data.pages.indexOf(e[s])<0&&t.push(e[s]);return a.filteredPagesSlugs=t,console.log("pageSlugs:",t),t})):(a.filteredPagesSlugs=[],[])},getEmptyPage:function(){var e=this;return console.log("GEP:",e.$helpers.getLangsObject(e.$store.state.coredata.langCodes)),{body:'<div data-editable data-name="content"><p>Your content here</p></div>',data:{externalId:null,variationGroupId:null,slug:null,publisher:e.user.email,authors:null,type:"page",subtype:"default",name:e.$helpers.getLangsObject(e.$store.state.coredata.langCodes),descriptionShort:e.$helpers.getLangsObject(e.$store.state.coredata.langCodes),descriptionLong:e.$helpers.getLangsObject(e.$store.state.coredata.langCodes),properties:null,data:{blocks:e.$helpers.getLangsObject(e.$store.state.coredata.langCodes,"<p></p>")},categories:[],pages:[],dates:{dateCreated:null,dateUpdated:null,dateSynced:null},note:null,activity:null}}},checkNameDependents:function(){if(this.page&&this.page.data&&!this.page.data._id){var e=this.language&&this.language.code?this.language.code:null;this.newLanguage&&this.newLanguage.code&&(e=this.newLanguage.code),this.page.data.name&&this.page.data.name[e]&&""!=this.page.data.name[e].trim()&&((this.page.data.slug&&""==this.page.data.slug.trim()||this.dataToGenerateFromName.slug)&&(this.page.data.slug=this.$helpers.stringToSlug(this.page.data.name[e]),this.dataToGenerateFromName.slug=!0),(this.page.data.externalId&&""==this.page.data.externalId.trim()||this.dataToGenerateFromName.externalId)&&(this.page.data.externalId=this.$helpers.stringToSlug(this.page.data.name[e]),this.dataToGenerateFromName.externalId=!0))}}}}),d=r,g=(t("4c4c"),t("2877")),c=Object(g["a"])(d,s,i,!1,null,"29304c5f",null);a["default"]=c.exports}}]);
//# sourceMappingURL=chunk-40afdcca.f0cfa6dd.js.map